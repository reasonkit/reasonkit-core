
{"source":"github","repo":"gemini-cli","path":"SECURITY.md","content":"# Reporting Security Issues\n\nTo report a security issue, please use [https://g.co/vulnz](https://g.co/vulnz).\nWe use g.co/vulnz for our intake, and do coordination and disclosure here on\nGitHub (including using GitHub Security Advisory). The Google Security Team will\nrespond within 5 working days of your report on g.co/vulnz.\n\n[GitHub Security Advisory]:\n  https://github.com/google-gemini/gemini-cli/security/advisories\n"}
{"source":"github","repo":"gemini-cli","path":"CONTRIBUTING.md","content":"# How to contribute\n\nWe would love to accept your patches and contributions to this project. This\ndocument includes:\n\n- **[Before you begin](#before-you-begin):** Essential steps to take before\n  becoming a Gemini CLI contributor.\n- **[Code contribution process](#code-contribution-process):** How to contribute\n  code to Gemini CLI.\n- **[Development setup and workflow](#development-setup-and-workflow):** How to\n  set up your development environment and workflow.\n- **[Documentation contribution process](#documentation-contribution-process):**\n  How to contribute documentation to Gemini CLI.\n\nWe're looking forward to seeing your contributions!\n\n## Before you begin\n\n### Sign our Contributor License Agreement\n\nContributions to this project must be accompanied by a\n[Contributor License Agreement](https://cla.developers.google.com/about) (CLA).\nYou (or your employer) retain the copyright to your contribution; this simply\ngives us permission to use and redistribute your contributions as part of the\nproject.\n\nIf you or your current employer have already signed the Google CLA (even if it\nwas for a different project), you probably don't need to do it again.\n\nVisit <https://cla.developers.google.com/> to see your current agreements or to\nsign a new one.\n\n### Review our Community Guidelines\n\nThis project follows\n[Google's Open Source Community Guidelines](https://opensource.google/conduct/).\n\n## Code contribution process\n\n### Get started\n\nThe process for contributing code is as follows:\n\n1.  **Find an issue** that you want to work on.\n2.  **Fork the repository** and create a new branch.\n3.  **Make your changes** in the `packages/` directory.\n4.  **Ensure all checks pass** by running `npm run preflight`.\n5.  **Open a pull request** with your changes.\n\n### Code reviews\n\nAll submissions, including submissions by project members, require review. We\nuse [GitHub pull requests](https://docs.github.com/articles/about-pull-requests)\nfor this purpose.\n\nIf your pull request involves changes to `packages/cli` (the frontend), we\nrecommend running our automated frontend review tool. **Note: This tool is\ncurrently experimental.** It helps detect common React anti-patterns, testing\nissues, and other frontend-specific best practices that are easy to miss.\n\nTo run the review tool, enter the following command from within Gemini CLI:\n\n```text\n/review-frontend <PR_NUMBER>\n```\n\nReplace `<PR_NUMBER>` with your pull request number. Authors are encouraged to\nrun this on their own PRs for self-review, and reviewers should use it to\naugment their manual review process.\n\n### Self assigning issues\n\nTo assign an issue to yourself, simply add a comment with the text `/assign`.\nThe comment must contain only that text and nothing else. This command will\nassign the issue to you, provided it is not already assigned.\n\nPlease note that you can have a maximum of 3 issues assigned to you at any given\ntime.\n\n### Pull request guidelines\n\nTo help us review and merge your PRs quickly, please follow these guidelines.\nPRs that do not meet these standards may be closed.\n\n#### 1. Link to an existing issue\n\nAll PRs should be linked to an existing issue in our tracker. This ensures that\nevery change has been discussed and is aligned with the project's goals before\nany code is written.\n\n- **For bug fixes:** The PR should be linked to the bug report issue.\n- **For features:** The PR should be linked to the feature request or proposal\n  issue that has been approved by a maintainer.\n\nIf an issue for your change doesn't exist, please **open one first** and wait\nfor feedback before you start coding.\n\n#### 2. Keep it small and focused\n\nWe favor small, atomic PRs that address a single issue or add a single,\nself-contained feature.\n\n- **Do:** Create a PR that fixes one specific bug or adds one specific feature.\n- **Don't:** Bundle multiple unrelated changes (e.g., a bug fix, a new feature,\n  and a refactor) into a single PR.\n\nLarge changes should be broken down into a series of smaller, logical PRs that\ncan be reviewed and merged independently.\n\n#### 3. Use draft PRs for work in progress\n\nIf you'd like to get early feedback on your work, please use GitHub's **Draft\nPull Request** feature. This signals to the maintainers that the PR is not yet\nready for a formal review but is open for discussion and initial feedback.\n\n#### 4. Ensure all checks pass\n\nBefore submitting your PR, ensure that all automated checks are passing by\nrunning `npm run preflight`. This command runs all tests, linting, and other\nstyle checks.\n\n#### 5. Update documentation\n\nIf your PR introduces a user-facing change (e.g., a new command, a modified\nflag, or a change in behavior), you must also update the relevant documentation\nin the `/docs` directory.\n\nSee more about writing documentation:\n[Documentation contribution process](#documentation-contribution-process).\n\n#### 6. Write clear commit messages and a good PR description\n\nYour PR should have a clear, descriptive title and a detailed description of the\nchanges. Follow the [Conventional Commits](https://www.conventionalcommits.org/)\nstandard for your commit messages.\n\n- **Good PR title:** `feat(cli): Add --json flag to 'config get' command`\n- **Bad PR title:** `Made some changes`\n\nIn the PR description, explain the \"why\" behind your changes and link to the\nrelevant issue (e.g., `Fixes #123`).\n\n### Forking\n\nIf you are forking the repository you will be able to run the Build, Test and\nIntegration test workflows. However in order to make the integration tests run\nyou'll need to add a\n[GitHub Repository Secret](https://docs.github.com/en/actions/security-for-github-actions/security-guides/using-secrets-in-github-actions#creating-secrets-for-a-repository)\nwith a value of `GEMINI_API_KEY` and set that to a valid API key that you have\navailable. Your key and secret are private to your repo; no one without access\ncan see your key and you cannot see any secrets related to this repo.\n\nAdditionally you will need to click on the `Actions` tab and enable workflows\nfor your repository, you'll find it's the large blue button in the center of the\nscreen.\n\n### Development setup and workflow\n\nThis section guides contributors on how to build, modify, and understand the\ndevelopment setup of this project.\n\n### Setting up the development environment\n\n**Prerequisites:**\n\n1.  **Node.js**:\n    - **Development:** Please use Node.js `~20.19.0`. This specific version is\n      required due to an upstream development dependency issue. You can use a\n      tool like [nvm](https://github.com/nvm-sh/nvm) to manage Node.js versions.\n    - **Production:** For running the CLI in a production environment, any\n      version of Node.js `>=20` is acceptable.\n2.  **Git**\n\n### Build process\n\nTo clone the repository:\n\n```bash\ngit clone https://github.com/google-gemini/gemini-cli.git # Or your fork's URL\ncd gemini-cli\n```\n\nTo install dependencies defined in `package.json` as well as root dependencies:\n\n```bash\nnpm install\n```\n\nTo build the entire project (all packages):\n\n```bash\nnpm run build\n```\n\nThis command typically compiles TypeScript to JavaScript, bundles assets, and\nprepares the packages for execution. Refer to `scripts/build.js` and\n`package.json` scripts for more details on what happens during the build.\n\n### Enabling sandboxing\n\n[Sandboxing](#sandboxing) is highly recommended and requires, at a minimum,\nsetting `GEMINI_SANDBOX=true` in your `~/.env` and ensuring a sandboxing\nprovider (e.g. `macOS Seatbelt`, `docker`, or `podman`) is available. See\n[Sandboxing](#sandboxing) for details.\n\nTo build both the `gemini` CLI utility and the sandbox container, run\n`build:all` from the root directory:\n\n```bash\nnpm run build:all\n```\n\nTo skip building the sandbox container, you can use `npm run build` instead.\n\n### Running the CLI\n\nTo start the Gemini CLI from the source code (after building), run the following\ncommand from the root directory:\n\n```bash\nnpm start\n```\n\nIf you'd like to run the source build outside of the gemini-cli folder, you can\nutilize `npm link path/to/gemini-cli/packages/cli` (see:\n[docs](https://docs.npmjs.com/cli/v9/commands/npm-link)) or\n`alias gemini=\"node path/to/gemini-cli/packages/cli\"` to run with `gemini`\n\n### Running tests\n\nThis project contains two types of tests: unit tests and integration tests.\n\n#### Unit tests\n\nTo execute the unit test suite for the project:\n\n```bash\nnpm run test\n```\n\nThis will run tests located in the `packages/core` and `packages/cli`\ndirectories. Ensure tests pass before submitting any changes. For a more\ncomprehensive check, it is recommended to run `npm run preflight`.\n\n#### Integration tests\n\nThe integration tests are designed to validate the end-to-end functionality of\nthe Gemini CLI. They are not run as part of the default `npm run test` command.\n\nTo run the integration tests, use the following command:\n\n```bash\nnpm run test:e2e\n```\n\nFor more detailed information on the integration testing framework, please see\nthe [Integration Tests documentation](/docs/integration-tests.md).\n\n### Linting and preflight checks\n\nTo ensure code quality and formatting consistency, run the preflight check:\n\n```bash\nnpm run preflight\n```\n\nThis command will run ESLint, Prettier, all tests, and other checks as defined\nin the project's `package.json`.\n\n_ProTip_\n\nafter cloning create a git precommit hook file to ensure your commits are always\nclean.\n\n```bash\necho \"\n# Run npm build and check for errors\nif ! npm run preflight; then\n  echo \"npm build failed. Commit aborted.\"\n  exit 1\nfi\n\" > .git/hooks/pre-commit && chmod +x .git/hooks/pre-commit\n```\n\n#### Formatting\n\nTo separately format the code in this project by running the following command\nfrom the root directory:\n\n```bash\nnpm run format\n```\n\nThis command uses Prettier to format the code according to the project's style\nguidelines.\n\n#### Linting\n\nTo separately lint the code in this project, run the following command from the\nroot directory:\n\n```bash\nnpm run lint\n```\n\n### Coding conventions\n\n- Please adhere to the coding style, patterns, and conventions used throughout\n  the existing codebase.\n- Consult\n  [GEMINI.md](https://github.com/google-gemini/gemini-cli/blob/main/GEMINI.md)\n  (typically found in the project root) for specific instructions related to\n  AI-assisted development, including conventions for React, comments, and Git\n  usage.\n- **Imports:** Pay special attention to import paths. The project uses ESLint to\n  enforce restrictions on relative imports between packages.\n\n### Project structure\n\n- `packages/`: Contains the individual sub-packages of the project.\n  - `a2a-server`: A2A server implementation for the Gemini CLI. (Experimental)\n  - `cli/`: The command-line interface.\n  - `core/`: The core backend logic for the Gemini CLI.\n  - `test-utils` Utilities for creating and cleaning temporary file systems for\n    testing.\n  - `vscode-ide-companion/`: The Gemini CLI Companion extension pairs with\n    Gemini CLI.\n- `docs/`: Contains all project documentation.\n- `scripts/`: Utility scripts for building, testing, and development tasks.\n\nFor more detailed architecture, see `docs/architecture.md`.\n\n### Debugging\n\n#### VS Code\n\n0.  Run the CLI to interactively debug in VS Code with `F5`\n1.  Start the CLI in debug mode from the root directory:\n    ```bash\n    npm run debug\n    ```\n    This command runs `node --inspect-brk dist/gemini.js` within the\n    `packages/cli` directory, pausing execution until a debugger attaches. You\n    can then open `chrome://inspect` in your Chrome browser to connect to the\n    debugger.\n2.  In VS Code, use the \"Attach\" launch configuration (found in\n    `.vscode/launch.json`).\n\nAlternatively, you can use the \"Launch Program\" configuration in VS Code if you\nprefer to launch the currently open file directly, but 'F5' is generally\nrecommended.\n\nTo hit a breakpoint inside the sandbox container run:\n\n```bash\nDEBUG=1 gemini\n```\n\n**Note:** If you have `DEBUG=true` in a project's `.env` file, it won't affect\ngemini-cli due to automatic exclusion. Use `.gemini/.env` files for gemini-cli\nspecific debug settings.\n\n### React DevTools\n\nTo debug the CLI's React-based UI, you can use React DevTools. Ink, the library\nused for the CLI's interface, is compatible with React DevTools version 4.x.\n\n1.  **Start the Gemini CLI in development mode:**\n\n    ```bash\n    DEV=true npm start\n    ```\n\n2.  **Install and run React DevTools version 4.28.5 (or the latest compatible\n    4.x version):**\n\n    You can either install it globally:\n\n    ```bash\n    npm install -g react-devtools@4.28.5\n    react-devtools\n    ```\n\n    Or run it directly using npx:\n\n    ```bash\n    npx react-devtools@4.28.5\n    ```\n\n    Your running CLI application should then connect to React DevTools.\n    ![](/docs/assets/connected_devtools.png)\n\n### Sandboxing\n\n#### macOS Seatbelt\n\nOn macOS, `gemini` uses Seatbelt (`sandbox-exec`) under a `permissive-open`\nprofile (see `packages/cli/src/utils/sandbox-macos-permissive-open.sb`) that\nrestricts writes to the project folder but otherwise allows all other operations\nand outbound network traffic (\"open\") by default. You can switch to a\n`restrictive-closed` profile (see\n`packages/cli/src/utils/sandbox-macos-restrictive-closed.sb`) that declines all\noperations and outbound network traffic (\"closed\") by default by setting\n`SEATBELT_PROFILE=restrictive-closed` in your environment or `.env` file.\nAvailable built-in profiles are `{permissive,restrictive}-{open,closed,proxied}`\n(see below for proxied networking). You can also switch to a custom profile\n`SEATBELT_PROFILE=<profile>` if you also create a file\n`.gemini/sandbox-macos-<profile>.sb` under your project settings directory\n`.gemini`.\n\n#### Container-based sandboxing (all platforms)\n\nFor stronger container-based sandboxing on macOS or other platforms, you can set\n`GEMINI_SANDBOX=true|docker|podman|<command>` in your environment or `.env`\nfile. The specified command (or if `true` then either `docker` or `podman`) must\nbe installed on the host machine. Once enabled, `npm run build:all` will build a\nminimal container (\"sandbox\") image and `npm start` will launch inside a fresh\ninstance of that container. The first build can take 20-30s (mostly due to\ndownloading of the base image) but after that both build and start overhead\nshould be minimal. Default builds (`npm run build`) will not rebuild the\nsandbox.\n\nContainer-based sandboxing mounts the project directory (and system temp\ndirectory) with read-write access and is started/stopped/removed automatically\nas you start/stop Gemini CLI. Files created within the sandbox should be\nautomatically mapped to your user/group on host machine. You can easily specify\nadditional mounts, ports, or environment variables by setting\n`SANDBOX_{MOUNTS,PORTS,ENV}` as needed. You can also fully customize the sandbox\nfor your projects by creating the files `.gemini/sandbox.Dockerfile` and/or\n`.gemini/sandbox.bashrc` under your project settings directory (`.gemini`) and\nrunning `gemini` with `BUILD_SANDBOX=1` to trigger building of your custom\nsandbox.\n\n#### Proxied networking\n\nAll sandboxing methods, including macOS Seatbelt using `*-proxied` profiles,\nsupport restricting outbound network traffic through a custom proxy server that\ncan be specified as `GEMINI_SANDBOX_PROXY_COMMAND=<command>`, where `<command>`\nmust start a proxy server that listens on `:::8877` for relevant requests. See\n`docs/examples/proxy-script.md` for a minimal proxy that only allows `HTTPS`\nconnections to `example.com:443` (e.g. `curl https://example.com`) and declines\nall other requests. The proxy is started and stopped automatically alongside the\nsandbox.\n\n### Manual publish\n\nWe publish an artifact for each commit to our internal registry. But if you need\nto manually cut a local build, then run the following commands:\n\n```\nnpm run clean\nnpm install\nnpm run auth\nnpm run prerelease:dev\nnpm publish --workspaces\n```\n\n## Documentation contribution process\n\nOur documentation must be kept up-to-date with our code contributions. We want\nour documentation to be clear, concise, and helpful to our users. We value:\n\n- **Clarity:** Use simple and direct language. Avoid jargon where possible.\n- **Accuracy:** Ensure all information is correct and up-to-date.\n- **Completeness:** Cover all aspects of a feature or topic.\n- **Examples:** Provide practical examples to help users understand how to use\n  Gemini CLI.\n\n### Getting started\n\nThe process for contributing to the documentation is similar to contributing\ncode.\n\n1. **Fork the repository** and create a new branch.\n2. **Make your changes** in the `/docs` directory.\n3. **Preview your changes locally** in Markdown rendering.\n4. **Lint and format your changes.** Our preflight check includes linting and\n   formatting for documentation files.\n   ```bash\n   npm run preflight\n   ```\n5. **Open a pull request** with your changes.\n\n### Documentation structure\n\nOur documentation is organized using [sidebar.json](/docs/sidebar.json) as the\ntable of contents. When adding new documentation:\n\n1. Create your markdown file **in the appropriate directory** under `/docs`.\n2. Add an entry to `sidebar.json` in the relevant section.\n3. Ensure all internal links use relative paths and point to existing files.\n\n### Style guide\n\nWe follow the\n[Google Developer Documentation Style Guide](https://developers.google.com/style).\nPlease refer to it for guidance on writing style, tone, and formatting.\n\n#### Key style points\n\n- Use sentence case for headings.\n- Write in second person (\"you\") when addressing the reader.\n- Use present tense.\n- Keep paragraphs short and focused.\n- Use code blocks with appropriate language tags for syntax highlighting.\n- Include practical examples whenever possible.\n\n### Linting and formatting\n\nWe use `prettier` to enforce a consistent style across our documentation. The\n`npm run preflight` command will check for any linting issues.\n\nYou can also run the linter and formatter separately:\n\n- `npm run lint` - Check for linting issues\n- `npm run format` - Auto-format markdown files\n- `npm run lint:fix` - Auto-fix linting issues where possible\n\nPlease make sure your contributions are free of linting errors before submitting\na pull request.\n\n### Before you submit\n\nBefore submitting your documentation pull request, please:\n\n1. Run `npm run preflight` to ensure all checks pass.\n2. Review your changes for clarity and accuracy.\n3. Check that all links work correctly.\n4. Ensure any code examples are tested and functional.\n5. Sign the\n   [Contributor License Agreement (CLA)](https://cla.developers.google.com/) if\n   you haven't already.\n\n### Need help?\n\nIf you have questions about contributing documentation:\n\n- Check our [FAQ](/docs/faq.md).\n- Review existing documentation for examples.\n- Open [an issue](https://github.com/google-gemini/gemini-cli/issues) to discuss\n  your proposed changes.\n- Reach out to the maintainers.\n\nWe appreciate your contributions to making Gemini CLI documentation better!\n"}
{"source":"github","repo":"gemini-cli","path":"README.md","content":"# Gemini CLI\n\n[![Gemini CLI CI](https://github.com/google-gemini/gemini-cli/actions/workflows/ci.yml/badge.svg)](https://github.com/google-gemini/gemini-cli/actions/workflows/ci.yml)\n[![Gemini CLI E2E (Chained)](https://github.com/google-gemini/gemini-cli/actions/workflows/chained_e2e.yml/badge.svg)](https://github.com/google-gemini/gemini-cli/actions/workflows/chained_e2e.yml)\n[![Version](https://img.shields.io/npm/v/@google/gemini-cli)](https://www.npmjs.com/package/@google/gemini-cli)\n[![License](https://img.shields.io/github/license/google-gemini/gemini-cli)](https://github.com/google-gemini/gemini-cli/blob/main/LICENSE)\n[![View Code Wiki](https://www.gstatic.com/_/boq-sdlc-agents-ui/_/r/YUi5dj2UWvE.svg)](https://codewiki.google/github.com/google-gemini/gemini-cli)\n\n![Gemini CLI Screenshot](./docs/assets/gemini-screenshot.png)\n\nGemini CLI is an open-source AI agent that brings the power of Gemini directly\ninto your terminal. It provides lightweight access to Gemini, giving you the\nmost direct path from your prompt to our model.\n\nLearn all about Gemini CLI in our [documentation](https://geminicli.com/docs/).\n\n## üöÄ Why Gemini CLI?\n\n- **üéØ Free tier**: 60 requests/min and 1,000 requests/day with personal Google\n  account.\n- **üß† Powerful Gemini 2.5 Pro**: Access to 1M token context window.\n- **üîß Built-in tools**: Google Search grounding, file operations, shell\n  commands, web fetching.\n- **üîå Extensible**: MCP (Model Context Protocol) support for custom\n  integrations.\n- **üíª Terminal-first**: Designed for developers who live in the command line.\n- **üõ°Ô∏è Open source**: Apache 2.0 licensed.\n\n## üì¶ Installation\n\n### Pre-requisites before installation\n\n- Node.js version 20 or higher\n- macOS, Linux, or Windows\n\n### Quick Install\n\n#### Run instantly with npx\n\n```bash\n# Using npx (no installation required)\nnpx https://github.com/google-gemini/gemini-cli\n```\n\n#### Install globally with npm\n\n```bash\nnpm install -g @google/gemini-cli\n```\n\n#### Install globally with Homebrew (macOS/Linux)\n\n```bash\nbrew install gemini-cli\n```\n\n## Release Cadence and Tags\n\nSee [Releases](./docs/releases.md) for more details.\n\n### Preview\n\nNew preview releases will be published each week at UTC 2359 on Tuesdays. These\nreleases will not have been fully vetted and may contain regressions or other\noutstanding issues. Please help us test and install with `preview` tag.\n\n```bash\nnpm install -g @google/gemini-cli@preview\n```\n\n### Stable\n\n- New stable releases will be published each week at UTC 2000 on Tuesdays, this\n  will be the full promotion of last week's `preview` release + any bug fixes\n  and validations. Use `latest` tag.\n\n```bash\nnpm install -g @google/gemini-cli@latest\n```\n\n### Nightly\n\n- New releases will be published each day at UTC 0000. This will be all changes\n  from the main branch as represented at time of release. It should be assumed\n  there are pending validations and issues. Use `nightly` tag.\n\n```bash\nnpm install -g @google/gemini-cli@nightly\n```\n\n## üìã Key Features\n\n### Code Understanding & Generation\n\n- Query and edit large codebases\n- Generate new apps from PDFs, images, or sketches using multimodal capabilities\n- Debug issues and troubleshoot with natural language\n\n### Automation & Integration\n\n- Automate operational tasks like querying pull requests or handling complex\n  rebases\n- Use MCP servers to connect new capabilities, including\n  [media generation with Imagen, Veo or Lyria](https://github.com/GoogleCloudPlatform/vertex-ai-creative-studio/tree/main/experiments/mcp-genmedia)\n- Run non-interactively in scripts for workflow automation\n\n### Advanced Capabilities\n\n- Ground your queries with built-in\n  [Google Search](https://ai.google.dev/gemini-api/docs/grounding) for real-time\n  information\n- Conversation checkpointing to save and resume complex sessions\n- Custom context files (GEMINI.md) to tailor behavior for your projects\n\n### GitHub Integration\n\nIntegrate Gemini CLI directly into your GitHub workflows with\n[**Gemini CLI GitHub Action**](https://github.com/google-github-actions/run-gemini-cli):\n\n- **Pull Request Reviews**: Automated code review with contextual feedback and\n  suggestions\n- **Issue Triage**: Automated labeling and prioritization of GitHub issues based\n  on content analysis\n- **On-demand Assistance**: Mention `@gemini-cli` in issues and pull requests\n  for help with debugging, explanations, or task delegation\n- **Custom Workflows**: Build automated, scheduled and on-demand workflows\n  tailored to your team's needs\n\n## üîê Authentication Options\n\nChoose the authentication method that best fits your needs:\n\n### Option 1: Login with Google (OAuth login using your Google Account)\n\n**‚ú® Best for:** Individual developers as well as anyone who has a Gemini Code\nAssist License. (see\n[quota limits and terms of service](https://cloud.google.com/gemini/docs/quotas)\nfor details)\n\n**Benefits:**\n\n- **Free tier**: 60 requests/min and 1,000 requests/day\n- **Gemini 2.5 Pro** with 1M token context window\n- **No API key management** - just sign in with your Google account\n- **Automatic updates** to latest models\n\n#### Start Gemini CLI, then choose _Login with Google_ and follow the browser authentication flow when prompted\n\n```bash\ngemini\n```\n\n#### If you are using a paid Code Assist License from your organization, remember to set the Google Cloud Project\n\n```bash\n# Set your Google Cloud Project\nexport GOOGLE_CLOUD_PROJECT=\"YOUR_PROJECT_ID\"\ngemini\n```\n\n### Option 2: Gemini API Key\n\n**‚ú® Best for:** Developers who need specific model control or paid tier access\n\n**Benefits:**\n\n- **Free tier**: 100 requests/day with Gemini 2.5 Pro\n- **Model selection**: Choose specific Gemini models\n- **Usage-based billing**: Upgrade for higher limits when needed\n\n```bash\n# Get your key from https://aistudio.google.com/apikey\nexport GEMINI_API_KEY=\"YOUR_API_KEY\"\ngemini\n```\n\n### Option 3: Vertex AI\n\n**‚ú® Best for:** Enterprise teams and production workloads\n\n**Benefits:**\n\n- **Enterprise features**: Advanced security and compliance\n- **Scalable**: Higher rate limits with billing account\n- **Integration**: Works with existing Google Cloud infrastructure\n\n```bash\n# Get your key from Google Cloud Console\nexport GOOGLE_API_KEY=\"YOUR_API_KEY\"\nexport GOOGLE_GENAI_USE_VERTEXAI=true\ngemini\n```\n\nFor Google Workspace accounts and other authentication methods, see the\n[authentication guide](./docs/get-started/authentication.md).\n\n## üöÄ Getting Started\n\n### Basic Usage\n\n#### Start in current directory\n\n```bash\ngemini\n```\n\n#### Include multiple directories\n\n```bash\ngemini --include-directories ../lib,../docs\n```\n\n#### Use specific model\n\n```bash\ngemini -m gemini-2.5-flash\n```\n\n#### Non-interactive mode for scripts\n\nGet a simple text response:\n\n```bash\ngemini -p \"Explain the architecture of this codebase\"\n```\n\nFor more advanced scripting, including how to parse JSON and handle errors, use\nthe `--output-format json` flag to get structured output:\n\n```bash\ngemini -p \"Explain the architecture of this codebase\" --output-format json\n```\n\nFor real-time event streaming (useful for monitoring long-running operations),\nuse `--output-format stream-json` to get newline-delimited JSON events:\n\n```bash\ngemini -p \"Run tests and deploy\" --output-format stream-json\n```\n\n### Quick Examples\n\n#### Start a new project\n\n```bash\ncd new-project/\ngemini\n> Write me a Discord bot that answers questions using a FAQ.md file I will provide\n```\n\n#### Analyze existing code\n\n```bash\ngit clone https://github.com/google-gemini/gemini-cli\ncd gemini-cli\ngemini\n> Give me a summary of all of the changes that went in yesterday\n```\n\n## üìö Documentation\n\n### Getting Started\n\n- [**Quickstart Guide**](./docs/get-started/index.md) - Get up and running\n  quickly.\n- [**Authentication Setup**](./docs/get-started/authentication.md) - Detailed\n  auth configuration.\n- [**Configuration Guide**](./docs/get-started/configuration.md) - Settings and\n  customization.\n- [**Keyboard Shortcuts**](./docs/cli/keyboard-shortcuts.md) - Productivity\n  tips.\n\n### Core Features\n\n- [**Commands Reference**](./docs/cli/commands.md) - All slash commands\n  (`/help`, `/chat`, etc).\n- [**Custom Commands**](./docs/cli/custom-commands.md) - Create your own\n  reusable commands.\n- [**Context Files (GEMINI.md)**](./docs/cli/gemini-md.md) - Provide persistent\n  context to Gemini CLI.\n- [**Checkpointing**](./docs/cli/checkpointing.md) - Save and resume\n  conversations.\n- [**Token Caching**](./docs/cli/token-caching.md) - Optimize token usage.\n\n### Tools & Extensions\n\n- [**Built-in Tools Overview**](./docs/tools/index.md)\n  - [File System Operations](./docs/tools/file-system.md)\n  - [Shell Commands](./docs/tools/shell.md)\n  - [Web Fetch & Search](./docs/tools/web-fetch.md)\n- [**MCP Server Integration**](./docs/tools/mcp-server.md) - Extend with custom\n  tools.\n- [**Custom Extensions**](./docs/extensions/index.md) - Build and share your own\n  commands.\n\n### Advanced Topics\n\n- [**Headless Mode (Scripting)**](./docs/cli/headless.md) - Use Gemini CLI in\n  automated workflows.\n- [**Architecture Overview**](./docs/architecture.md) - How Gemini CLI works.\n- [**IDE Integration**](./docs/ide-integration/index.md) - VS Code companion.\n- [**Sandboxing & Security**](./docs/cli/sandbox.md) - Safe execution\n  environments.\n- [**Trusted Folders**](./docs/cli/trusted-folders.md) - Control execution\n  policies by folder.\n- [**Enterprise Guide**](./docs/cli/enterprise.md) - Deploy and manage in a\n  corporate environment.\n- [**Telemetry & Monitoring**](./docs/cli/telemetry.md) - Usage tracking.\n- [**Tools API Development**](./docs/core/tools-api.md) - Create custom tools.\n- [**Local development**](./docs/local-development.md) - Local development\n  tooling.\n\n### Troubleshooting & Support\n\n- [**Troubleshooting Guide**](./docs/troubleshooting.md) - Common issues and\n  solutions.\n- [**FAQ**](./docs/faq.md) - Frequently asked questions.\n- Use `/bug` command to report issues directly from the CLI.\n\n### Using MCP Servers\n\nConfigure MCP servers in `~/.gemini/settings.json` to extend Gemini CLI with\ncustom tools:\n\n```text\n> @github List my open pull requests\n> @slack Send a summary of today's commits to #dev channel\n> @database Run a query to find inactive users\n```\n\nSee the [MCP Server Integration guide](./docs/tools/mcp-server.md) for setup\ninstructions.\n\n## ü§ù Contributing\n\nWe welcome contributions! Gemini CLI is fully open source (Apache 2.0), and we\nencourage the community to:\n\n- Report bugs and suggest features.\n- Improve documentation.\n- Submit code improvements.\n- Share your MCP servers and extensions.\n\nSee our [Contributing Guide](./CONTRIBUTING.md) for development setup, coding\nstandards, and how to submit pull requests.\n\nCheck our [Official Roadmap](https://github.com/orgs/google-gemini/projects/11)\nfor planned features and priorities.\n\n## üìñ Resources\n\n- **[Official Roadmap](./ROADMAP.md)** - See what's coming next.\n- **[Changelog](./docs/changelogs/index.md)** - See recent notable updates.\n- **[NPM Package](https://www.npmjs.com/package/@google/gemini-cli)** - Package\n  registry.\n- **[GitHub Issues](https://github.com/google-gemini/gemini-cli/issues)** -\n  Report bugs or request features.\n- **[Security Advisories](https://github.com/google-gemini/gemini-cli/security/advisories)** -\n  Security updates.\n\n### Uninstall\n\nSee the [Uninstall Guide](docs/cli/uninstall.md) for removal instructions.\n\n## üìÑ Legal\n\n- **License**: [Apache License 2.0](LICENSE)\n- **Terms of Service**: [Terms & Privacy](./docs/tos-privacy.md)\n- **Security**: [Security Policy](SECURITY.md)\n\n---\n\n<p align=\"center\">\n  Built with ‚ù§Ô∏è by Google and the open source community\n</p>\n"}
{"source":"github","repo":"gemini-cli","path":"packages/vscode-ide-companion/README.md","content":"# Gemini CLI Companion\n\nThe Gemini CLI Companion extension pairs with\n[Gemini CLI](https://github.com/google-gemini/gemini-cli). This extension is\ncompatible with both VS Code and VS Code forks.\n\n# Features\n\n- Open Editor File Context: Gemini CLI gains awareness of the files you have\n  open in your editor, providing it with a richer understanding of your\n  project's structure and content.\n\n- Selection Context: Gemini CLI can easily access your cursor's position and\n  selected text within the editor, giving it valuable context directly from your\n  current work.\n\n- Native Diffing: Seamlessly view, modify, and accept code changes suggested by\n  Gemini CLI directly within the editor.\n\n- Launch Gemini CLI: Quickly start a new Gemini CLI session from the Command\n  Palette (Cmd+Shift+P or Ctrl+Shift+P) by running the \"Gemini CLI: Run\"\n  command.\n\n# Requirements\n\nTo use this extension, you'll need:\n\n- VS Code version 1.99.0 or newer\n- Gemini CLI (installed separately) running within the integrated terminal\n\n# Terms of Service and Privacy Notice\n\nBy installing this extension, you agree to the\n[Terms of Service](https://github.com/google-gemini/gemini-cli/blob/main/docs/tos-privacy.md).\n"}
{"source":"github","repo":"gemini-cli","path":"packages/vscode-ide-companion/development.md","content":"# Local Development ‚öôÔ∏è\n\n## Running the Extension\n\nTo run the extension locally for development, we recommend using the automatic\nwatch process for continuous compilation:\n\n1.  **Install Dependencies** (from the root of the repository):\n    ```bash\n    npm install\n    ```\n2.  **Open in VS Code:** Open this directory (`packages/vscode-ide-companion`)\n    in your VS Code editor.\n3.  **Start Watch Mode:** Run the watch script to compile the extension and\n    monitor changes in both **esbuild** and **TypeScript**:\n    ```bash\n    npm run watch\n    ```\n4.  **Launch Host:** Press **`F5`** (or **`fn+F5`** on Mac) to open a new\n    **Extension Development Host** window with the extension running.\n\n### Manual Build\n\nIf you only need to compile the extension once without watching for changes:\n\n```bash\nnpm run build\n```\n"}
{"source":"github","repo":"gemini-cli","path":"packages/cli/src/commands/extensions/examples/context/GEMINI.md","content":"# Ink Library Screen Reader Guidance\n\nWhen building custom components, it's important to keep accessibility in mind.\nWhile Ink provides the building blocks, ensuring your components are accessible\nwill make your CLIs usable by a wider audience.\n\n## General Principles\n\nProvide screen reader-friendly output: Use the useIsScreenReaderEnabled hook to\ndetect if a screen reader is active. You can then render a more descriptive\noutput for screen reader users. Leverage ARIA props: For components that have a\nspecific role (e.g., a checkbox or a button), use the aria-role, aria-state, and\naria-label props on <Box> and <Text> to provide semantic meaning to screen\nreaders.\n"}
{"source":"github","repo":"gemini-cli","path":"packages/a2a-server/README.md","content":"# Gemini CLI A2A Server\n\n## All code in this package is experimental and under active development\n\nThis package contains the A2A server implementation for the Gemini CLI.\n"}
{"source":"github","repo":"gemini-cli","path":"packages/a2a-server/development-extension-rfc.md","content":"# RFC: Gemini CLI A2A Development-Tool Extension\n\n## 1. Introduction\n\n### 1.1 Overview\n\nTo standardize client integrations with the Gemini CLI agent, this document\nproposes the `development-tool` extension for the A2A protocol.\n\nRather than creating a new protocol, this specification builds upon the existing\nA2A protocol. As an open-source standard recently adopted by the Linux\nFoundation, A2A provides a robust foundation for core concepts like tasks,\nmessages, and streaming events. This extension-based approach allows us to\nleverage A2A's proven architecture while defining the specific capabilities\nrequired for rich, interactive workflows with the Gemini CLI agent.\n\n### 1.2 Motivation\n\nRecent work integrating Gemini CLI with clients like Zed and Gemini Code\nAssist‚Äôs agent mode has highlighted the need for a robust, standard\ncommunication protocol. Standardizing on A2A provides several key advantages:\n\n- **Solid Foundation**: Provides a robust, open standard that ensures a stable,\n  predictable, and consistent integration experience across different IDEs and\n  client surfaces.\n- **Extensibility**: Creates a flexible foundation to support new tools and\n  workflows as they emerge.\n- **Ecosystem Alignment**: Aligns Gemini CLI with a growing industry standard,\n  fostering broader interoperability.\n\n## 2. Communication Flow\n\nThe interaction follows A2A‚Äôs task-based, streaming pattern. The client sends a\n`message/stream` request and the agent responds with a `contextId` / `taskId`\nand a stream of events. `TaskStatusUpdateEvent` events are used to convey the\noverall state of the task. The task is complete when the agent sends a final\n`TaskStatusUpdateEvent` with `final: true` and a terminal status like\n`completed` or `failed`.\n\n### 2.1 Asynchronous Responses and Notifications\n\nClients that may disconnect from the agent should supply a\n`PushNotificationConfig` to the agent with the initial `message/stream` method\nor subsequently with the `tasks/pushNotificationConfig/set` method so that the\nagent can call back when updates are ready.\n\n## 3. The `development-tool` extension\n\n### 3.1 Overview\n\nThe `development-tool` extension establishes a communication contract for\nworkflows between a client and the Gemini CLI agent. It consists of a\nspecialized set of schemas, embedded within core A2A data structures, that\nenable the agent to stream real-time updates on its state and thought process.\nThese schemas also provide the mechanism for the agent to request user\npermission before executing tools.\n\n**Sample Agent Card**\n\n```json\n{\n  \"name\": \"Gemini CLI Agent\",\n  \"description\": \"An agent that generates code based on natural language instructions.\",\n  \"capabilities\": {\n    \"streaming\": true,\n    \"extensions\": [\n      {\n        \"uri\": \"https://github.com/google-gemini/gemini-cli/blob/main/docs/a2a/developer-profile/v0/spec.md\",\n        \"description\": \"An extension for interactive development tasks, enabling features like code generation, tool usage, and real-time status updates.\",\n        \"required\": true\n      }\n    ]\n  }\n}\n```\n\n**Versioning**\n\nThe agent card `uri` field contains an embedded semantic version. The client\nmust extract this version to determine compatibility with the agent extension\nusing the compatibility logic defined in Semantic Versioning 2.0.0 spec.\n\n### 3.2 Schema Definitions\n\nThis section defines the schemas for the `development-tool` A2A extension,\norganized by their function within the communication flow. Note that all custom\nobjects included in the `metadata` field (e.g. `Message.metadata`) must be keyed\nby the unique URI that points to that extension‚Äôs spec to prevent naming\ncollisions with other extensions.\n\n**Initialization & Configuration**\n\nThe first message in a session must contain an `AgentSettings` object in its\nmetadata. This object provides the agent with the necessary configuration\ninformation for proper initialization. Additional configuration settings (ex.\nMCP servers, allowed tools, etc.) can be added to this message.\n\n**Schema**\n\n```proto\nsyntax = \"proto3\";\n\n// Configuration settings for the Gemini CLI agent.\nmessage AgentSettings {\n  // The absolute path to the workspace directory where the agent will execute.\n  string workspace_path = 1;\n}\n```\n\n**Agent-to-Client Messages**\n\nAll real-time updates from the agent (including its thoughts, tool calls, and\nsimple text replies) are streamed to the client as `TaskStatusUpdateEvents`.\n\nEach Event contains a `Message` object, which holds the content in one of two\nformats:\n\n- **TextPart**: Used for standard text messages. This part requires no custom\n  schema.\n- **DataPart**: Used for complex, structured objects. Tool Calls and Thoughts\n  are sent this way, each using their respective schemas defined below.\n\n**Tool Calls**\n\nThe `ToolCall` schema is designed to provide a structured representation of a\ntool‚Äôs execution lifecycle. This protocol defines a clear state machine and\nprovides detailed schemas for common development tasks (file edits, shell\ncommands, MCP Tool), ensuring clients can build reliable UIs without being tied\nto a specific agent implementation.\n\nThe core principle is that the agent sends a `ToolCall` object on every update.\nThis makes client-side logic stateless and simple.\n\n**Tool Call Lifecycle**\n\n1.  **Creation**: The agent sends a `ToolCall` object with `status: PENDING`. If\n    user permission is required, the `confirmation_request` field will be\n    populated.\n2.  **Confirmation**: If the client needs to confirm the message, the client\n    will send a `ToolCallConfirmation`. If the client responds with a\n    cancellation, execution will be skipped.\n3.  **Execution**: Once approved (or if no approval is required), the agent\n    sends an update with `status: EXECUTING`. It can stream real-time progress\n    by updating the `live_content` field.\n4.  **Completion**: The agent sends a final update with the status set to\n    `SUCCEEDED`, `FAILED`, or `CANCELLED` and populates the appropriate result\n    field.\n\n**Schema**\n\n```proto\nsyntax = \"proto3\";\n\nimport \"google/protobuf/struct.proto\";\n\n// ToolCall is the central message representing a tool's execution lifecycle.\n// The entire object is sent from the agent to client on every update.\nmessage ToolCall {\n  // A unique identifier, assigned by the agent\n  string tool_call_id = 1;\n\n  // The current state of the tool call in its lifecycle\n  ToolCallStatus status = 2;\n\n  // Name of the tool being called (e.g. 'Edit', 'ShellTool')\n  string tool_name = 3;\n\n  // An optional description of the tool call's purpose to show the user\n  optional string description = 4;\n\n  // The structured input params provided by the LLM for tool invocation.\n  google.protobuf.Struct input_parameters = 5;\n\n  // String containing the real-time output from the tool as it executes (primarily designed for shell output).\n  // During streaming the entire string is replaced on each update\n  optional string live_content = 6;\n\n  // The final result of the tool (used to replace live_content when applicable)\n  oneof result {\n    // The output on tool success\n    ToolOutput output = 7;\n    // The error details if the tool failed\n    ErrorDetails error = 8;\n  }\n\n  // If the tool requires user confirmation, this field will be populated while status is PENDING\n  optional ConfirmationRequest confirmation_request = 9;\n}\n\n// Possible execution status of a ToolCall\nenum ToolCallStatus {\n  STATUS_UNSPECIFIED = 0;\n  PENDING = 1;\n  EXECUTING = 2;\n  SUCCEEDED = 3;\n  FAILED = 4;\n  CANCELLED = 5;\n}\n\n// ToolOutput represents the final, successful, output of a tool\nmessage ToolOutput {\n  oneof result {\n    string text = 1;\n    // For ToolCalls which resulted in a file modification\n    FileDiff diff = 2;\n    // A generic fallback for any other structured JSON data\n    google.protobuf.Struct structured_data = 3;\n  }\n}\n\n// A structured representation of an error\nmessage ErrorDetails {\n  // User facing error message\n  string message = 1;\n  // Optional agent-specific error type or category (e.g. read_content_failure, grep_execution_error, mcp_tool_error)\n  optional string type = 2;\n  // Optional status code\n  optional int32 status_code = 3;\n}\n\n// ConfirmationRequest is sent from the agent to client to request user permission for a ToolCall\nmessage ConfirmationRequest {\n  // A list of choices for the user to select from\n  repeated ConfirmationOption options = 1;\n  // Specific details of the action requiring user confirmation\n  oneof details {\n    ExecuteDetails execute_details = 2;\n    FileDiff file_edit_details = 3;\n    McpDetails mcp_details = 4;\n    GenericDetails generic_details = 5;\n  }\n}\n\n// A single choice presented to the user during a confirmation request\nmessage ConfirmationOption {\n  // Unique ID for the choice (e.g. proceed_once, cancel)\n  string id = 1;\n  // Human-readable choice (e.g. Allow Once, Reject).\n  string name = 2;\n  // An optional longer description for a tooltip\n  optional string description = 3;\n}\n\n// Details for a request to execute a shell command\nmessage ExecuteDetails {\n  // The shell command to be executed\n  string command = 1;\n  // An optional directory in which the command will be run\n  optional string working_directory = 2;\n}\n\n\nmessage FileDiff {\n  string file_name = 1;\n  // The absolute path to the file to modify\n  string file_path = 2;\n  // The original content, if the file exists\n  optional string old_content = 3;\n  string new_content = 4;\n  // Pre-formatted diff string for display\n  optional string formatted_diff = 5;\n}\n\n// Details for an MCP (Model Context Protocol) tool confirmation\nmessage McpDetails {\n  // The name of the MCP server that provides the tool\n  string server_name = 1;\n  // THe name of the tool being called from the MCP Server\n  string tool_name = 2;\n}\n\n// Generic catch-all for ToolCall requests that don't fit other types\nmessage GenericDetails {\n  // Description of the action requiring confirmation\n  string description = 1;\n}\n```\n\n**Agent Thoughts**\n\n**Schema**\n\n```proto\nsyntax = \"proto3\";\n\n// Represents a thought with a subject and a detailed description.\nmessage AgentThought {\n  // A concise subject line or title for the thought.\n  string subject = 1;\n\n  // The description or elaboration of the thought itself.\n  string description = 2;\n}\n```\n\n**Event Metadata**\n\nThe `metadata` object in `TaskStatusUpdateEvent` is used by the A2A client to\ndeserialize the `TaskStatusUpdateEvents` into their appropriate objects.\n\n**Schema**\n\n```proto\nsyntax = \"proto3\";\n\n// A DevelopmentToolEvent event.\nmessage DevelopmentToolEvent {\n  // Enum representing the specific type of development tool event.\n  enum DevelopmentToolEventKind {\n    // The default, unspecified value.\n    DEVELOPMENT_TOOL_EVENT_KIND_UNSPECIFIED = 0;\n    TOOL_CALL_CONFIRMATION = 1;\n    TOOL_CALL_UPDATE = 2;\n    TEXT_CONTENT = 3;\n    STATE_CHANGE = 4;\n    THOUGHT = 5;\n  }\n\n  // The specific kind of event that occurred.\n  DevelopmentToolEventKind kind = 1;\n\n  // The model used for this event.\n  string model = 2;\n\n  // The tier of the user (optional).\n  string user_tier = 3;\n\n  // An unexpected error occurred in the agent execution (optional).\n  string error = 4;\n}\n```\n\n**Client-to-Agent Messages**\n\nWhen the agent sends a `TaskStatusUpdateEvent` with `status.state` set to\n`input-required` and its message contains a `ConfirmationRequest`, the client\nmust respond by sending a new `message/stream` request.\n\nThis new request must include the `contextId` and the `taskId` from the ongoing\ntask and contain a `ToolCallConfirmation` object. This object conveys the user's\ndecision regarding the tool call that was awaiting approval.\n\n**Schema**\n\n```proto\nsyntax = \"proto3\";\n\n// The client's response to a ConfirmationRequest.\nmessage ToolCallConfirmation {\n  // A unique identifier, assigned by the agent\n  string tool_call_id = 1;\n  // The 'id' of the ConfirmationOption chosen by the user.\n  string selected_option_id = 2;\n  // Included if the user modifies the proposed change.\n  // The type should correspond to the original ConfirmationRequest details.\n  oneof modified_details {\n    // Corresponds to a FileDiff confirmation\n    ModifiedFileDetails file_details = 3;\n  }\n}\n\nmessage ModifiedFileDetails {\n  // The new content after user edits.\n  string new_content = 1;\n}\n```\n\n### 3.3 Method Definitions\n\nThis section defines the new methods introduced by the `development-tool`\nextension.\n\n**Method: `commands/get`**\n\nThis method allows the client to discover slash commands supported by Gemini\nCLI. The client should call this method during startup to dynamically populate\nits command list.\n\n```proto\n// Response message containing the list of all top-level slash commands.\nmessage GetAllSlashCommandsResponse {\n  // A list of the top-level slash commands.\n  repeated SlashCommand commands = 1;\n}\n\n// Represents a single slash command, which can contain subcommands.\nmessage SlashCommand {\n  // The primary name of the command.\n  string name = 1;\n  // A detailed description of what the command does.\n  string description = 2;\n  // A list of arguments that the command accepts.\n  repeated SlashCommandArgument arguments = 3;\n  // A list of nested subcommands.\n  repeated SlashCommand sub_commands = 4;\n}\n\n// Defines the structure for a single slash command argument.\nmessage SlashCommandArgument {\n  // The name of the argument.\n  string name = 1;\n  // A brief description of what the argument is for.\n  string description = 2;\n  // Whether the argument is required or optional.\n  bool is_required = 3;\n}\n```\n\n**Method: `command/execute`**\n\nThis method allows the client to execute a slash command. Following the initial\n`ExecuteSlashCommandResponse`, the agent will use the standard streaming\nmechanism to communicate the command's progress and output. All subsequent\nupdates, including textual output, agent thoughts, and any required user\nconfirmations for tool calls (like executing a shell command), will be sent as\n`TaskStatusUpdateEvent` messages, re-using the schemas defined above.\n\n```proto\n// Request to execute a specific slash command.\nmessage ExecuteSlashCommandRequest {\n  // The path to the command, e.g., [\"memory\", \"add\"] for /memory add\n  repeated string command_path = 1;\n  // The arguments for the command as a single string.\n  string args = 2;\n}\n\n// Enum for the initial status of a command execution request.\nenum CommandExecutionStatus {\n  // Default unspecified status.\n  COMMAND_EXECUTION_STATUS_UNSPECIFIED = 0;\n  // The command was successfully received and its execution has started.\n  STARTED = 1;\n  // The command failed to start (e.g., command not found, invalid format).\n  FAILED_TO_START = 2;\n  // The command has been paused and is waiting for the user to confirm\n  // a set of shell commands.\n  AWAITING_SHELL_CONFIRMATION = 3;\n  // The command has been paused and is waiting for the user to confirm\n  // a specific action.\n  AWAITING_ACTION_CONFIRMATION = 4;\n}\n\n// The immediate, async response after requesting a command execution.\nmessage ExecuteSlashCommandResponse {\n  // A unique taskID for this specific command execution.\n  string execution_id = 1;\n  // The initial status of the command execution.\n  CommandExecutionStatus status = 2;\n  // An optional message, particularly useful for explaining why a command\n  // failed to start.\n  string message = 3;\n}\n```\n\n## 4. Separation of Concerns\n\nWe believe that all client-side context (ex., workspace state) and client-side\ntool execution (ex. read active buffers) should be routed through MCP.\n\nThis approach enforces a strict separation of concerns: the A2A\n`development-tool` extension standardizes communication to the agent, while MCP\nserves as the single, authoritative interface for client-side capabilities.\n\n## Appendix\n\n### A. Example Interaction Flow\n\n1.  **Client -> Server**: The client sends a `message/stream` request containing\n    the initial prompt and configuration in an `AgentSettings` object.\n2.  **Server -> Client**: SSE stream begins.\n    - **Event 1**: The server sends a `Task` object with\n      `status.state: 'submitted'` and the new `taskId`.\n    - **Event 2**: The server sends a `TaskStatusUpdateEvent` with the metadata\n      `kind` set to `'STATE_CHANGE'` and `status.state` set to `'working'`.\n3.  **Agent Logic**: The agent processes the prompt and decides to call the\n    `write_file` tool, which requires user confirmation.\n4.  **Server -> Client**:\n    - **Event 3**: The server sends a `TaskStatusUpdateEvent`. The metadata\n      `kind` is `'TOOL_CALL_UPDATE'`, and the `DataPart` contains a `ToolCall`\n      object with its `status` as `'PENDING'` and a populated\n      `confirmation_request`.\n    - **Event 4**: The server sends a final `TaskStatusUpdateEvent` for this\n      exchange. The metadata `kind` is `'STATE_CHANGE'`, the `status.state` is\n      `'input-required'`, and `final` is `true`. The stream for this request\n      ends.\n5.  **Client**: The client UI renders the confirmation prompt based on the\n    `ToolCall` object from Event 3. The user clicks \"Approve.\"\n6.  **Client -> Server**: The client sends a new `message/stream` request. It\n    includes the `taskId` from the ongoing task and a `DataPart` containing a\n    `ToolCallConfirmation` object (e.g.,\n    `{\"tool_call_id\": \"...\", \"selected_option_id\": \"proceed_once\"}`).\n7.  **Server -> Client**: A new SSE stream begins for the second request.\n    - **Event 1**: The server sends a `TaskStatusUpdateEvent` with\n      `kind: 'TOOL_CALL_UPDATE'`, containing the `ToolCall` object with its\n      `status` now set to `'EXECUTING'`.\n    - **Event 2**: After the tool runs, the server sends another\n      `TaskStatusUpdateEvent` with `kind: 'TOOL_CALL_UPDATE'`, containing the\n      `ToolCall` with its `status` as `'SUCCEEDED'`.\n8.  **Agent Logic**: The agent receives the successful tool result and generates\n    a final textual response.\n9.  **Server -> Client**:\n    - **Event 3**: The server sends a `TaskStatusUpdateEvent` with\n      `kind: 'TEXT_CONTENT'` and a `TextPart` containing the agent's final\n      answer.\n    - **Event 4**: The server sends the final `TaskStatusUpdateEvent`. The\n      `kind` is `'STATE_CHANGE'`, the `status.state` is `'completed'`, and\n      `final` is `true`. The stream ends.\n10. **Client**: The client displays the final answer. The task is now complete\n    but can be continued by sending another message with the same `taskId`.\n"}
{"source":"github","repo":"gemini-cli","path":".github/pull_request_template.md","content":"## Summary\n\n<!-- Concisely describe what this PR changes and why. Focus on impact and\nurgency. -->\n\n## Details\n\n<!-- Add any extra context and design decisions. Keep it brief but complete. -->\n\n## Related Issues\n\n<!-- Use keywords to auto-close issues (Closes #123, Fixes #456). If this PR is\nonly related to an issue or is a partial fix, simply reference the issue number\nwithout a keyword (Related to #123). -->\n\n## How to Validate\n\n<!-- List exact steps for reviewers to validate the change. Include commands,\nexpected results, and edge cases. -->\n\n## Pre-Merge Checklist\n\n<!-- Check all that apply before requesting review or merging. -->\n\n- [ ] Updated relevant documentation and README (if needed)\n- [ ] Added/updated tests (if needed)\n- [ ] Noted breaking changes (if any)\n- [ ] Validated on required platforms/methods:\n  - [ ] MacOS\n    - [ ] npm run\n    - [ ] npx\n    - [ ] Docker\n    - [ ] Podman\n    - [ ] Seatbelt\n  - [ ] Windows\n    - [ ] npm run\n    - [ ] npx\n    - [ ] Docker\n  - [ ] Linux\n    - [ ] npm run\n    - [ ] npx\n    - [ ] Docker\n"}
{"source":"github","repo":"gemini-cli","path":"GEMINI.md","content":"## Building and running\n\nBefore submitting any changes, it is crucial to validate them by running the\nfull preflight check. This command will build the repository, run all tests,\ncheck for type errors, and lint the code.\n\nTo run the full suite of checks, execute the following command:\n\n```bash\nnpm run preflight\n```\n\nThis single command ensures that your changes meet all the quality gates of the\nproject. While you can run the individual steps (`build`, `test`, `typecheck`,\n`lint`) separately, it is highly recommended to use `npm run preflight` to\nensure a comprehensive validation.\n\n## Writing Tests\n\nThis project uses **Vitest** as its primary testing framework. When writing\ntests, aim to follow existing patterns. Key conventions include:\n\n### Test Structure and Framework\n\n- **Framework**: All tests are written using Vitest (`describe`, `it`, `expect`,\n  `vi`).\n- **File Location**: Test files (`*.test.ts` for logic, `*.test.tsx` for React\n  components) are co-located with the source files they test.\n- **Configuration**: Test environments are defined in `vitest.config.ts` files.\n- **Setup/Teardown**: Use `beforeEach` and `afterEach`. Commonly,\n  `vi.resetAllMocks()` is called in `beforeEach` and `vi.restoreAllMocks()` in\n  `afterEach`.\n\n### Mocking (`vi` from Vitest)\n\n- **ES Modules**: Mock with\n  `vi.mock('module-name', async (importOriginal) => { ... })`. Use\n  `importOriginal` for selective mocking.\n  - _Example_:\n    `vi.mock('os', async (importOriginal) => { const actual = await importOriginal(); return { ...actual, homedir: vi.fn() }; });`\n- **Mocking Order**: For critical dependencies (e.g., `os`, `fs`) that affect\n  module-level constants, place `vi.mock` at the _very top_ of the test file,\n  before other imports.\n- **Hoisting**: Use `const myMock = vi.hoisted(() => vi.fn());` if a mock\n  function needs to be defined before its use in a `vi.mock` factory.\n- **Mock Functions**: Create with `vi.fn()`. Define behavior with\n  `mockImplementation()`, `mockResolvedValue()`, or `mockRejectedValue()`.\n- **Spying**: Use `vi.spyOn(object, 'methodName')`. Restore spies with\n  `mockRestore()` in `afterEach`.\n\n### Commonly Mocked Modules\n\n- **Node.js built-ins**: `fs`, `fs/promises`, `os` (especially `os.homedir()`),\n  `path`, `child_process` (`execSync`, `spawn`).\n- **External SDKs**: `@google/genai`, `@modelcontextprotocol/sdk`.\n- **Internal Project Modules**: Dependencies from other project packages are\n  often mocked.\n\n### React Component Testing (CLI UI - Ink)\n\n- Use `render()` from `ink-testing-library`.\n- Assert output with `lastFrame()`.\n- Wrap components in necessary `Context.Provider`s.\n- Mock custom React hooks and complex child components using `vi.mock()`.\n\n### Asynchronous Testing\n\n- Use `async/await`.\n- For timers, use `vi.useFakeTimers()`, `vi.advanceTimersByTimeAsync()`,\n  `vi.runAllTimersAsync()`.\n- Test promise rejections with `await expect(promise).rejects.toThrow(...)`.\n\n### General Guidance\n\n- When adding tests, first examine existing tests to understand and conform to\n  established conventions.\n- Pay close attention to the mocks at the top of existing test files; they\n  reveal critical dependencies and how they are managed in a test environment.\n\n## Git Repo\n\nThe main branch for this project is called \"main\"\n\n## JavaScript/TypeScript\n\nWhen contributing to this React, Node, and TypeScript codebase, please\nprioritize the use of plain JavaScript objects with accompanying TypeScript\ninterface or type declarations over JavaScript class syntax. This approach\noffers significant advantages, especially concerning interoperability with React\nand overall code maintainability.\n\n### Preferring Plain Objects over Classes\n\nJavaScript classes, by their nature, are designed to encapsulate internal state\nand behavior. While this can be useful in some object-oriented paradigms, it\noften introduces unnecessary complexity and friction when working with React's\ncomponent-based architecture. Here's why plain objects are preferred:\n\n- Seamless React Integration: React components thrive on explicit props and\n  state management. Classes' tendency to store internal state directly within\n  instances can make prop and state propagation harder to reason about and\n  maintain. Plain objects, on the other hand, are inherently immutable (when\n  used thoughtfully) and can be easily passed as props, simplifying data flow\n  and reducing unexpected side effects.\n\n- Reduced Boilerplate and Increased Conciseness: Classes often promote the use\n  of constructors, this binding, getters, setters, and other boilerplate that\n  can unnecessarily bloat code. TypeScript interface and type declarations\n  provide powerful static type checking without the runtime overhead or\n  verbosity of class definitions. This allows for more succinct and readable\n  code, aligning with JavaScript's strengths in functional programming.\n\n- Enhanced Readability and Predictability: Plain objects, especially when their\n  structure is clearly defined by TypeScript interfaces, are often easier to\n  read and understand. Their properties are directly accessible, and there's no\n  hidden internal state or complex inheritance chains to navigate. This\n  predictability leads to fewer bugs and a more maintainable codebase.\n\n- Simplified Immutability: While not strictly enforced, plain objects encourage\n  an immutable approach to data. When you need to modify an object, you\n  typically create a new one with the desired changes, rather than mutating the\n  original. This pattern aligns perfectly with React's reconciliation process\n  and helps prevent subtle bugs related to shared mutable state.\n\n- Better Serialization and Deserialization: Plain JavaScript objects are\n  naturally easy to serialize to JSON and deserialize back, which is a common\n  requirement in web development (e.g., for API communication or local storage).\n  Classes, with their methods and prototypes, can complicate this process.\n\n### Embracing ES Module Syntax for Encapsulation\n\nRather than relying on Java-esque private or public class members, which can be\nverbose and sometimes limit flexibility, we strongly prefer leveraging ES module\nsyntax (`import`/`export`) for encapsulating private and public APIs.\n\n- Clearer Public API Definition: With ES modules, anything that is exported is\n  part of the public API of that module, while anything not exported is\n  inherently private to that module. This provides a very clear and explicit way\n  to define what parts of your code are meant to be consumed by other modules.\n\n- Enhanced Testability (Without Exposing Internals): By default, unexported\n  functions or variables are not accessible from outside the module. This\n  encourages you to test the public API of your modules, rather than their\n  internal implementation details. If you find yourself needing to spy on or\n  stub an unexported function for testing purposes, it's often a \"code smell\"\n  indicating that the function might be a good candidate for extraction into its\n  own separate, testable module with a well-defined public API. This promotes a\n  more robust and maintainable testing strategy.\n\n- Reduced Coupling: Explicitly defined module boundaries through import/export\n  help reduce coupling between different parts of your codebase. This makes it\n  easier to refactor, debug, and understand individual components in isolation.\n\n### Avoiding `any` Types and Type Assertions; Preferring `unknown`\n\nTypeScript's power lies in its ability to provide static type checking, catching\npotential errors before your code runs. To fully leverage this, it's crucial to\navoid the `any` type and be judicious with type assertions.\n\n- **The Dangers of `any`**: Using any effectively opts out of TypeScript's type\n  checking for that particular variable or expression. While it might seem\n  convenient in the short term, it introduces significant risks:\n  - **Loss of Type Safety**: You lose all the benefits of type checking, making\n    it easy to introduce runtime errors that TypeScript would otherwise have\n    caught.\n  - **Reduced Readability and Maintainability**: Code with `any` types is harder\n    to understand and maintain, as the expected type of data is no longer\n    explicitly defined.\n  - **Masking Underlying Issues**: Often, the need for any indicates a deeper\n    problem in the design of your code or the way you're interacting with\n    external libraries. It's a sign that you might need to refine your types or\n    refactor your code.\n\n- **Preferring `unknown` over `any`**: When you absolutely cannot determine the\n  type of a value at compile time, and you're tempted to reach for any, consider\n  using unknown instead. unknown is a type-safe counterpart to any. While a\n  variable of type unknown can hold any value, you must perform type narrowing\n  (e.g., using typeof or instanceof checks, or a type assertion) before you can\n  perform any operations on it. This forces you to handle the unknown type\n  explicitly, preventing accidental runtime errors.\n\n  ```ts\n  function processValue(value: unknown) {\n    if (typeof value === 'string') {\n      // value is now safely a string\n      console.log(value.toUpperCase());\n    } else if (typeof value === 'number') {\n      // value is now safely a number\n      console.log(value * 2);\n    }\n    // Without narrowing, you cannot access properties or methods on 'value'\n    // console.log(value.someProperty); // Error: Object is of type 'unknown'.\n  }\n  ```\n\n- **Type Assertions (`as Type`) - Use with Caution**: Type assertions tell the\n  TypeScript compiler, \"Trust me, I know what I'm doing; this is definitely of\n  this type.\" While there are legitimate use cases (e.g., when dealing with\n  external libraries that don't have perfect type definitions, or when you have\n  more information than the compiler), they should be used sparingly and with\n  extreme caution.\n  - **Bypassing Type Checking**: Like `any`, type assertions bypass TypeScript's\n    safety checks. If your assertion is incorrect, you introduce a runtime error\n    that TypeScript would not have warned you about.\n  - **Code Smell in Testing**: A common scenario where `any` or type assertions\n    might be tempting is when trying to test \"private\" implementation details\n    (e.g., spying on or stubbing an unexported function within a module). This\n    is a strong indication of a \"code smell\" in your testing strategy and\n    potentially your code structure. Instead of trying to force access to\n    private internals, consider whether those internal details should be\n    refactored into a separate module with a well-defined public API. This makes\n    them inherently testable without compromising encapsulation.\n\n### Type narrowing `switch` clauses\n\nUse the `checkExhaustive` helper in the default clause of a switch statement.\nThis will ensure that all of the possible options within the value or\nenumeration are used.\n\nThis helper method can be found in `packages/cli/src/utils/checks.ts`\n\n### Embracing JavaScript's Array Operators\n\nTo further enhance code cleanliness and promote safe functional programming\npractices, leverage JavaScript's rich set of array operators as much as\npossible. Methods like `.map()`, `.filter()`, `.reduce()`, `.slice()`,\n`.sort()`, and others are incredibly powerful for transforming and manipulating\ndata collections in an immutable and declarative way.\n\nUsing these operators:\n\n- Promotes Immutability: Most array operators return new arrays, leaving the\n  original array untouched. This functional approach helps prevent unintended\n  side effects and makes your code more predictable.\n- Improves Readability: Chaining array operators often lead to more concise and\n  expressive code than traditional for loops or imperative logic. The intent of\n  the operation is clear at a glance.\n- Facilitates Functional Programming: These operators are cornerstones of\n  functional programming, encouraging the creation of pure functions that take\n  inputs and produce outputs without causing side effects. This paradigm is\n  highly beneficial for writing robust and testable code that pairs well with\n  React.\n\nBy consistently applying these principles, we can maintain a codebase that is\nnot only efficient and performant but also a joy to work with, both now and in\nthe future.\n\n## React (mirrored and adjusted from [react-mcp-server](https://github.com/facebook/react/blob/4448b18760d867f9e009e810571e7a3b8930bb19/compiler/packages/react-mcp-server/src/index.ts#L376C1-L441C94))\n\n### Role\n\nYou are a React assistant that helps users write more efficient and optimizable\nReact code. You specialize in identifying patterns that enable React Compiler to\nautomatically apply optimizations, reducing unnecessary re-renders and improving\napplication performance.\n\n### Follow these guidelines in all code you produce and suggest\n\nUse functional components with Hooks: Do not generate class components or use\nold lifecycle methods. Manage state with useState or useReducer, and side\neffects with useEffect (or related Hooks). Always prefer functions and Hooks for\nany new component logic.\n\nKeep components pure and side-effect-free during rendering: Do not produce code\nthat performs side effects (like subscriptions, network requests, or modifying\nexternal variables) directly inside the component's function body. Such actions\nshould be wrapped in useEffect or performed in event handlers. Ensure your\nrender logic is a pure function of props and state.\n\nRespect one-way data flow: Pass data down through props and avoid any global\nmutations. If two components need to share data, lift that state up to a common\nparent or use React Context, rather than trying to sync local state or use\nexternal variables.\n\nNever mutate state directly: Always generate code that updates state immutably.\nFor example, use spread syntax or other methods to create new objects/arrays\nwhen updating state. Do not use assignments like state.someValue = ... or array\nmutations like array.push() on state variables. Use the state setter (setState\nfrom useState, etc.) to update state.\n\nAccurately use useEffect and other effect Hooks: whenever you think you could\nuseEffect, think and reason harder to avoid it. useEffect is primarily only used\nfor synchronization, for example synchronizing React with some external state.\nIMPORTANT - Don't setState (the 2nd value returned by useState) within a\nuseEffect as that will degrade performance. When writing effects, include all\nnecessary dependencies in the dependency array. Do not suppress ESLint rules or\nomit dependencies that the effect's code uses. Structure the effect callbacks to\nhandle changing values properly (e.g., update subscriptions on prop changes,\nclean up on unmount or dependency change). If a piece of logic should only run\nin response to a user action (like a form submission or button click), put that\nlogic in an event handler, not in a useEffect. Where possible, useEffects should\nreturn a cleanup function.\n\nFollow the Rules of Hooks: Ensure that any Hooks (useState, useEffect,\nuseContext, custom Hooks, etc.) are called unconditionally at the top level of\nReact function components or other Hooks. Do not generate code that calls Hooks\ninside loops, conditional statements, or nested helper functions. Do not call\nHooks in non-component functions or outside the React component rendering\ncontext.\n\nUse refs only when necessary: Avoid using useRef unless the task genuinely\nrequires it (such as focusing a control, managing an animation, or integrating\nwith a non-React library). Do not use refs to store application state that\nshould be reactive. If you do use refs, never write to or read from ref.current\nduring the rendering of a component (except for initial setup like lazy\ninitialization). Any ref usage should not affect the rendered output directly.\n\nPrefer composition and small components: Break down UI into small, reusable\ncomponents rather than writing large monolithic components. The code you\ngenerate should promote clarity and reusability by composing components\ntogether. Similarly, abstract repetitive logic into custom Hooks when\nappropriate to avoid duplicating code.\n\nOptimize for concurrency: Assume React may render your components multiple times\nfor scheduling purposes (especially in development with Strict Mode). Write code\nthat remains correct even if the component function runs more than once. For\ninstance, avoid side effects in the component body and use functional state\nupdates (e.g., setCount(c => c + 1)) when updating state based on previous state\nto prevent race conditions. Always include cleanup functions in effects that\nsubscribe to external resources. Don't write useEffects for \"do this when this\nchanges\" side effects. This ensures your generated code will work with React's\nconcurrent rendering features without issues.\n\nOptimize to reduce network waterfalls - Use parallel data fetching wherever\npossible (e.g., start multiple requests at once rather than one after another).\nLeverage Suspense for data loading and keep requests co-located with the\ncomponent that needs the data. In a server-centric approach, fetch related data\ntogether in a single request on the server side (using Server Components, for\nexample) to reduce round trips. Also, consider using caching layers or global\nfetch management to avoid repeating identical requests.\n\nRely on React Compiler - useMemo, useCallback, and React.memo can be omitted if\nReact Compiler is enabled. Avoid premature optimization with manual memoization.\nInstead, focus on writing clear, simple components with direct data flow and\nside-effect-free render functions. Let the React Compiler handle tree-shaking,\ninlining, and other performance enhancements to keep your code base simpler and\nmore maintainable.\n\nDesign for a good user experience - Provide clear, minimal, and non-blocking UI\nstates. When data is loading, show lightweight placeholders (e.g., skeleton\nscreens) rather than intrusive spinners everywhere. Handle errors gracefully\nwith a dedicated error boundary or a friendly inline message. Where possible,\nrender partial data as it becomes available rather than making the user wait for\neverything. Suspense allows you to declare the loading states in your component\ntree in a natural way, preventing ‚Äúflash‚Äù states and improving perceived\nperformance.\n\n### Process\n\n1. Analyze the user's code for optimization opportunities:\n   - Check for React anti-patterns that prevent compiler optimization\n   - Look for component structure issues that limit compiler effectiveness\n   - Think about each suggestion you are making and consult React docs for best\n     practices\n\n2. Provide actionable guidance:\n   - Explain specific code changes with clear reasoning\n   - Show before/after examples when suggesting changes\n   - Only suggest changes that meaningfully improve optimization potential\n\n### Optimization Guidelines\n\n- State updates should be structured to enable granular updates\n- Side effects should be isolated and dependencies clearly defined\n\n## Documentation guidelines\n\nWhen working in the `/docs` directory, follow the guidelines in this section:\n\n- **Role:** You are an expert technical writer and AI assistant for contributors\n  to Gemini CLI. Produce professional, accurate, and consistent documentation to\n  guide users of Gemini CLI.\n- **Technical Accuracy:** Do not invent facts, commands, code, API names, or\n  output. All technical information specific to Gemini CLI must be based on code\n  found within this directory and its subdirectories.\n- **Style Authority:** Your source for writing guidance and style is the\n  \"Documentation contribution process\" section in the root directory's\n  `CONTRIBUTING.md` file, as well as any guidelines provided this section.\n- **Information Architecture Consideration:** Before proposing documentation\n  changes, consider the information architecture. If a change adds significant\n  new content to existing documents, evaluate if creating a new, more focused\n  page or changes to `sidebar.json` would provide a better user experience.\n- **Proactive User Consideration:** The user experience should be a primary\n  concern when making changes to documentation. Aim to fill gaps in existing\n  knowledge whenever possible while keeping documentation concise and easy for\n  users to understand. If changes might hinder user understanding or\n  accessibility, proactively raise these concerns and propose alternatives.\n\n## Comments policy\n\nOnly write high-value comments if at all. Avoid talking to the user through\ncomments.\n\n## General requirements\n\n- If there is something you do not understand or is ambiguous, seek confirmation\n  or clarification from the user before making changes based on assumptions.\n- Use hyphens instead of underscores in flag names (e.g. `my-flag` instead of\n  `my_flag`).\n- Always refer to Gemini CLI as `Gemini CLI`, never `the Gemini CLI`.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/core/tools-api.md","content":"# Gemini CLI core: Tools API\n\nThe Gemini CLI core (`packages/core`) features a robust system for defining,\nregistering, and executing tools. These tools extend the capabilities of the\nGemini model, allowing it to interact with the local environment, fetch web\ncontent, and perform various actions beyond simple text generation.\n\n## Core concepts\n\n- **Tool (`tools.ts`):** An interface and base class (`BaseTool`) that defines\n  the contract for all tools. Each tool must have:\n  - `name`: A unique internal name (used in API calls to Gemini).\n  - `displayName`: A user-friendly name.\n  - `description`: A clear explanation of what the tool does, which is provided\n    to the Gemini model.\n  - `parameterSchema`: A JSON schema defining the parameters that the tool\n    accepts. This is crucial for the Gemini model to understand how to call the\n    tool correctly.\n  - `validateToolParams()`: A method to validate incoming parameters.\n  - `getDescription()`: A method to provide a human-readable description of what\n    the tool will do with specific parameters before execution.\n  - `shouldConfirmExecute()`: A method to determine if user confirmation is\n    required before execution (e.g., for potentially destructive operations).\n  - `execute()`: The core method that performs the tool's action and returns a\n    `ToolResult`.\n\n- **`ToolResult` (`tools.ts`):** An interface defining the structure of a tool's\n  execution outcome:\n  - `llmContent`: The factual content to be included in the history sent back to\n    the LLM for context. This can be a simple string or a `PartListUnion` (an\n    array of `Part` objects and strings) for rich content.\n  - `returnDisplay`: A user-friendly string (often Markdown) or a special object\n    (like `FileDiff`) for display in the CLI.\n\n- **Returning rich content:** Tools are not limited to returning simple text.\n  The `llmContent` can be a `PartListUnion`, which is an array that can contain\n  a mix of `Part` objects (for images, audio, etc.) and `string`s. This allows a\n  single tool execution to return multiple pieces of rich content.\n\n- **Tool registry (`tool-registry.ts`):** A class (`ToolRegistry`) responsible\n  for:\n  - **Registering tools:** Holding a collection of all available built-in tools\n    (e.g., `ReadFileTool`, `ShellTool`).\n  - **Discovering tools:** It can also discover tools dynamically:\n    - **Command-based discovery:** If `tools.discoveryCommand` is configured in\n      settings, this command is executed. It's expected to output JSON\n      describing custom tools, which are then registered as `DiscoveredTool`\n      instances.\n    - **MCP-based discovery:** If `mcp.serverCommand` is configured, the\n      registry can connect to a Model Context Protocol (MCP) server to list and\n      register tools (`DiscoveredMCPTool`).\n  - **Providing schemas:** Exposing the `FunctionDeclaration` schemas of all\n    registered tools to the Gemini model, so it knows what tools are available\n    and how to use them.\n  - **Retrieving tools:** Allowing the core to get a specific tool by name for\n    execution.\n\n## Built-in tools\n\nThe core comes with a suite of pre-defined tools, typically found in\n`packages/core/src/tools/`. These include:\n\n- **File system tools:**\n  - `LSTool` (`ls.ts`): Lists directory contents.\n  - `ReadFileTool` (`read-file.ts`): Reads the content of a single file.\n  - `WriteFileTool` (`write-file.ts`): Writes content to a file.\n  - `GrepTool` (`grep.ts`): Searches for patterns in files.\n  - `GlobTool` (`glob.ts`): Finds files matching glob patterns.\n  - `EditTool` (`edit.ts`): Performs in-place modifications to files (often\n    requiring confirmation).\n  - `ReadManyFilesTool` (`read-many-files.ts`): Reads and concatenates content\n    from multiple files or glob patterns (used by the `@` command in CLI).\n- **Execution tools:**\n  - `ShellTool` (`shell.ts`): Executes arbitrary shell commands (requires\n    careful sandboxing and user confirmation).\n- **Web tools:**\n  - `WebFetchTool` (`web-fetch.ts`): Fetches content from a URL.\n  - `WebSearchTool` (`web-search.ts`): Performs a web search.\n- **Memory tools:**\n  - `MemoryTool` (`memoryTool.ts`): Interacts with the AI's memory.\n\nEach of these tools extends `BaseTool` and implements the required methods for\nits specific functionality.\n\n## Tool execution flow\n\n1.  **Model request:** The Gemini model, based on the user's prompt and the\n    provided tool schemas, decides to use a tool and returns a `FunctionCall`\n    part in its response, specifying the tool name and arguments.\n2.  **Core receives request:** The core parses this `FunctionCall`.\n3.  **Tool retrieval:** It looks up the requested tool in the `ToolRegistry`.\n4.  **Parameter validation:** The tool's `validateToolParams()` method is\n    called.\n5.  **Confirmation (if needed):**\n    - The tool's `shouldConfirmExecute()` method is called.\n    - If it returns details for confirmation, the core communicates this back to\n      the CLI, which prompts the user.\n    - The user's decision (e.g., proceed, cancel) is sent back to the core.\n6.  **Execution:** If validated and confirmed (or if no confirmation is needed),\n    the core calls the tool's `execute()` method with the provided arguments and\n    an `AbortSignal` (for potential cancellation).\n7.  **Result processing:** The `ToolResult` from `execute()` is received by the\n    core.\n8.  **Response to model:** The `llmContent` from the `ToolResult` is packaged as\n    a `FunctionResponse` and sent back to the Gemini model so it can continue\n    generating a user-facing response.\n9.  **Display to user:** The `returnDisplay` from the `ToolResult` is sent to\n    the CLI to show the user what the tool did.\n\n## Extending with custom tools\n\nWhile direct programmatic registration of new tools by users isn't explicitly\ndetailed as a primary workflow in the provided files for typical end-users, the\narchitecture supports extension through:\n\n- **Command-based discovery:** Advanced users or project administrators can\n  define a `tools.discoveryCommand` in `settings.json`. This command, when run\n  by the Gemini CLI core, should output a JSON array of `FunctionDeclaration`\n  objects. The core will then make these available as `DiscoveredTool`\n  instances. The corresponding `tools.callCommand` would then be responsible for\n  actually executing these custom tools.\n- **MCP server(s):** For more complex scenarios, one or more MCP servers can be\n  set up and configured via the `mcpServers` setting in `settings.json`. The\n  Gemini CLI core can then discover and use tools exposed by these servers. As\n  mentioned, if you have multiple MCP servers, the tool names will be prefixed\n  with the server name from your configuration (e.g.,\n  `serverAlias__actualToolName`).\n\nThis tool system provides a flexible and powerful way to augment the Gemini\nmodel's capabilities, making the Gemini CLI a versatile assistant for a wide\nrange of tasks.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/core/policy-engine.md","content":"# Policy engine\n\n:::note This feature is currently in testing. To enable it, set\n`tools.enableMessageBusIntegration` to `true` in your `settings.json` file. :::\n\nThe Gemini CLI includes a powerful policy engine that provides fine-grained\ncontrol over tool execution. It allows users and administrators to define rules\nthat determine whether a tool call should be allowed, denied, or require user\nconfirmation.\n\n## Core concepts\n\nThe policy engine operates on a set of rules. Each rule is a combination of\nconditions and a resulting decision. When a large language model wants to\nexecute a tool, the policy engine evaluates all rules to find the\nhighest-priority rule that matches the tool call.\n\nA rule consists of the following main components:\n\n- **Conditions**: Criteria that a tool call must meet for the rule to apply.\n  This can include the tool's name, the arguments provided to it, or the current\n  approval mode.\n- **Decision**: The action to take if the rule matches (`allow`, `deny`, or\n  `ask_user`).\n- **Priority**: A number that determines the rule's precedence. Higher numbers\n  win.\n\nFor example, this rule will ask for user confirmation before executing any `git`\ncommand.\n\n```toml\n[[rule]]\ntoolName = \"run_shell_command\"\ncommandPrefix = \"git \"\ndecision = \"ask_user\"\npriority = 100\n```\n\n### Conditions\n\nConditions are the criteria that a tool call must meet for a rule to apply. The\nprimary conditions are the tool's name and its arguments.\n\n#### Tool Name\n\nThe `toolName` in the rule must match the name of the tool being called.\n\n- **Wildcards**: For Model-hosting-protocol (MCP) servers, you can use a\n  wildcard. A `toolName` of `my-server__*` will match any tool from the\n  `my-server` MCP.\n\n#### Arguments pattern\n\nIf `argsPattern` is specified, the tool's arguments are converted to a stable\nJSON string, which is then tested against the provided regular expression. If\nthe arguments don't match the pattern, the rule does not apply.\n\n### Decisions\n\nThere are three possible decisions a rule can enforce:\n\n- `allow`: The tool call is executed automatically without user interaction.\n- `deny`: The tool call is blocked and is not executed.\n- `ask_user`: The user is prompted to approve or deny the tool call. (In\n  non-interactive mode, this is treated as `deny`.)\n\n### Priority system and tiers\n\nThe policy engine uses a sophisticated priority system to resolve conflicts when\nmultiple rules match a single tool call. The core principle is simple: **the\nrule with the highest priority wins**.\n\nTo provide a clear hierarchy, policies are organized into three tiers. Each tier\nhas a designated number that forms the base of the final priority calculation.\n\n| Tier    | Base | Description                                                                |\n| :------ | :--- | :------------------------------------------------------------------------- |\n| Default | 1    | Built-in policies that ship with the Gemini CLI.                           |\n| User    | 2    | Custom policies defined by the user.                                       |\n| Admin   | 3    | Policies managed by an administrator (e.g., in an enterprise environment). |\n\nWithin a TOML policy file, you assign a priority value from **0 to 999**. The\nengine transforms this into a final priority using the following formula:\n\n`final_priority = tier_base + (toml_priority / 1000)`\n\nThis system guarantees that:\n\n- Admin policies always override User and Default policies.\n- User policies always override Default policies.\n- You can still order rules within a single tier with fine-grained control.\n\nFor example:\n\n- A `priority: 50` rule in a Default policy file becomes `1.050`.\n- A `priority: 100` rule in a User policy file becomes `2.100`.\n- A `priority: 20` rule in an Admin policy file becomes `3.020`.\n\n### Approval modes\n\nApproval modes allow the policy engine to apply different sets of rules based on\nthe CLI's operational mode. A rule can be associated with one or more modes\n(e.g., `yolo`, `autoEdit`). The rule will only be active if the CLI is running\nin one of its specified modes. If a rule has no modes specified, it is always\nactive.\n\n## Rule matching\n\nWhen a tool call is made, the engine checks it against all active rules,\nstarting from the highest priority. The first rule that matches determines the\noutcome.\n\nA rule matches a tool call if all of its conditions are met:\n\n1.  **Tool name**: The `toolName` in the rule must match the name of the tool\n    being called.\n    - **Wildcards**: For Model-hosting-protocol (MCP) servers, you can use a\n      wildcard. A `toolName` of `my-server__*` will match any tool from the\n      `my-server` MCP.\n2.  **Arguments pattern**: If `argsPattern` is specified, the tool's arguments\n    are converted to a stable JSON string, which is then tested against the\n    provided regular expression. If the arguments don't match the pattern, the\n    rule does not apply.\n\n## Configuration\n\nPolicies are defined in `.toml` files. The CLI loads these files from Default,\nUser, and (if configured) Admin directories.\n\n### TOML rule schema\n\nHere is a breakdown of the fields available in a TOML policy rule:\n\n```toml\n[[rule]]\n# A unique name for the tool, or an array of names.\ntoolName = \"run_shell_command\"\n\n# (Optional) The name of an MCP server. Can be combined with toolName\n# to form a composite name like \"mcpName__toolName\".\nmcpName = \"my-custom-server\"\n\n# (Optional) A regex to match against the tool's arguments.\nargsPattern = '\"command\":\"(git|npm)'\n\n# (Optional) A string or array of strings that a shell command must start with.\n# This is syntactic sugar for `toolName = \"run_shell_command\"` and an `argsPattern`.\ncommandPrefix = \"git \"\n\n# (Optional) A regex to match against the entire shell command.\n# This is also syntactic sugar for `toolName = \"run_shell_command\"`.\n# Note: This pattern is tested against the JSON representation of the arguments (e.g., `{\"command\":\"<your_command>\"}`), so anchors like `^` or `$` will apply to the full JSON string, not just the command text.\n# You cannot use commandPrefix and commandRegex in the same rule.\ncommandRegex = \"^git (commit|push)\"\n\n# The decision to take. Must be \"allow\", \"deny\", or \"ask_user\".\ndecision = \"ask_user\"\n\n# The priority of the rule, from 0 to 999.\npriority = 10\n\n# (Optional) An array of approval modes where this rule is active.\nmodes = [\"autoEdit\"]\n```\n\n### Using arrays (lists)\n\nTo apply the same rule to multiple tools or command prefixes, you can provide an\narray of strings for the `toolName` and `commandPrefix` fields.\n\n**Example:**\n\nThis single rule will apply to both the `write_file` and `replace` tools.\n\n```toml\n[[rule]]\ntoolName = [\"write_file\", \"replace\"]\ndecision = \"ask_user\"\npriority = 10\n```\n\n### Special syntax for `run_shell_command`\n\nTo simplify writing policies for `run_shell_command`, you can use\n`commandPrefix` or `commandRegex` instead of the more complex `argsPattern`.\n\n- `commandPrefix`: Matches if the `command` argument starts with the given\n  string.\n- `commandRegex`: Matches if the `command` argument matches the given regular\n  expression.\n\n**Example:**\n\nThis rule will ask for user confirmation before executing any `git` command.\n\n```toml\n[[rule]]\ntoolName = \"run_shell_command\"\ncommandPrefix = \"git \"\ndecision = \"ask_user\"\npriority = 100\n```\n\n### Special syntax for MCP tools\n\nYou can create rules that target tools from Model-hosting-protocol (MCP) servers\nusing the `mcpName` field or a wildcard pattern.\n\n**1. Using `mcpName`**\n\nTo target a specific tool from a specific server, combine `mcpName` and\n`toolName`.\n\n```toml\n# Allows the `search` tool on the `my-jira-server` MCP\n[[rule]]\nmcpName = \"my-jira-server\"\ntoolName = \"search\"\ndecision = \"allow\"\npriority = 200\n```\n\n**2. Using a wildcard**\n\nTo create a rule that applies to _all_ tools on a specific MCP server, specify\nonly the `mcpName`.\n\n```toml\n# Denies all tools from the `untrusted-server` MCP\n[[rule]]\nmcpName = \"untrusted-server\"\ndecision = \"deny\"\npriority = 500\n```\n\n## Default policies\n\nThe Gemini CLI ships with a set of default policies to provide a safe\nout-of-the-box experience.\n\n- **Read-only tools** (like `read_file`, `glob`) are generally **allowed**.\n- **Agent delegation** (like `delegate_to_agent`) is **allowed** (sub-agent\n  actions are checked individually).\n- **Write tools** (like `write_file`, `run_shell_command`) default to\n  **`ask_user`**.\n- In **`yolo`** mode, a high-priority rule allows all tools.\n- In **`autoEdit`** mode, rules allow certain write operations to happen without\n  prompting.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/core/memport.md","content":"# Memory Import Processor\n\nThe Memory Import Processor is a feature that allows you to modularize your\nGEMINI.md files by importing content from other files using the `@file.md`\nsyntax.\n\n## Overview\n\nThis feature enables you to break down large GEMINI.md files into smaller, more\nmanageable components that can be reused across different contexts. The import\nprocessor supports both relative and absolute paths, with built-in safety\nfeatures to prevent circular imports and ensure file access security.\n\n## Syntax\n\nUse the `@` symbol followed by the path to the file you want to import:\n\n```markdown\n# Main GEMINI.md file\n\nThis is the main content.\n\n@./components/instructions.md\n\nMore content here.\n\n@./shared/configuration.md\n```\n\n## Supported path formats\n\n### Relative paths\n\n- `@./file.md` - Import from the same directory\n- `@../file.md` - Import from parent directory\n- `@./components/file.md` - Import from subdirectory\n\n### Absolute paths\n\n- `@/absolute/path/to/file.md` - Import using absolute path\n\n## Examples\n\n### Basic import\n\n```markdown\n# My GEMINI.md\n\nWelcome to my project!\n\n@./get-started.md\n\n## Features\n\n@./features/overview.md\n```\n\n### Nested imports\n\nThe imported files can themselves contain imports, creating a nested structure:\n\n```markdown\n# main.md\n\n@./header.md @./content.md @./footer.md\n```\n\n```markdown\n# header.md\n\n# Project Header\n\n@./shared/title.md\n```\n\n## Safety features\n\n### Circular import detection\n\nThe processor automatically detects and prevents circular imports:\n\n```markdown\n# file-a.md\n\n@./file-b.md\n\n# file-b.md\n\n@./file-a.md <!-- This will be detected and prevented -->\n```\n\n### File access security\n\nThe `validateImportPath` function ensures that imports are only allowed from\nspecified directories, preventing access to sensitive files outside the allowed\nscope.\n\n### Maximum import depth\n\nTo prevent infinite recursion, there's a configurable maximum import depth\n(default: 5 levels).\n\n## Error handling\n\n### Missing files\n\nIf a referenced file doesn't exist, the import will fail gracefully with an\nerror comment in the output.\n\n### File access errors\n\nPermission issues or other file system errors are handled gracefully with\nappropriate error messages.\n\n## Code region detection\n\nThe import processor uses the `marked` library to detect code blocks and inline\ncode spans, ensuring that `@` imports inside these regions are properly ignored.\nThis provides robust handling of nested code blocks and complex Markdown\nstructures.\n\n## Import tree structure\n\nThe processor returns an import tree that shows the hierarchy of imported files,\nsimilar to Claude's `/memory` feature. This helps users debug problems with\ntheir GEMINI.md files by showing which files were read and their import\nrelationships.\n\nExample tree structure:\n\n```\nMemory Files\n L project: GEMINI.md\n            L a.md\n              L b.md\n                L c.md\n              L d.md\n                L e.md\n                  L f.md\n            L included.md\n```\n\nThe tree preserves the order that files were imported and shows the complete\nimport chain for debugging purposes.\n\n## Comparison to Claude Code's `/memory` (`claude.md`) approach\n\nClaude Code's `/memory` feature (as seen in `claude.md`) produces a flat, linear\ndocument by concatenating all included files, always marking file boundaries\nwith clear comments and path names. It does not explicitly present the import\nhierarchy, but the LLM receives all file contents and paths, which is sufficient\nfor reconstructing the hierarchy if needed.\n\n> [!NOTE] The import tree is mainly for clarity during development and has\n> limited relevance to LLM consumption.\n\n## API reference\n\n### `processImports(content, basePath, debugMode?, importState?)`\n\nProcesses import statements in GEMINI.md content.\n\n**Parameters:**\n\n- `content` (string): The content to process for imports\n- `basePath` (string): The directory path where the current file is located\n- `debugMode` (boolean, optional): Whether to enable debug logging (default:\n  false)\n- `importState` (ImportState, optional): State tracking for circular import\n  prevention\n\n**Returns:** Promise&lt;ProcessImportsResult&gt; - Object containing processed\ncontent and import tree\n\n### `ProcessImportsResult`\n\n```typescript\ninterface ProcessImportsResult {\n  content: string; // The processed content with imports resolved\n  importTree: MemoryFile; // Tree structure showing the import hierarchy\n}\n```\n\n### `MemoryFile`\n\n```typescript\ninterface MemoryFile {\n  path: string; // The file path\n  imports?: MemoryFile[]; // Direct imports, in the order they were imported\n}\n```\n\n### `validateImportPath(importPath, basePath, allowedDirectories)`\n\nValidates import paths to ensure they are safe and within allowed directories.\n\n**Parameters:**\n\n- `importPath` (string): The import path to validate\n- `basePath` (string): The base directory for resolving relative paths\n- `allowedDirectories` (string[]): Array of allowed directory paths\n\n**Returns:** boolean - Whether the import path is valid\n\n### `findProjectRoot(startDir)`\n\nFinds the project root by searching for a `.git` directory upwards from the\ngiven start directory. Implemented as an **async** function using non-blocking\nfile system APIs to avoid blocking the Node.js event loop.\n\n**Parameters:**\n\n- `startDir` (string): The directory to start searching from\n\n**Returns:** Promise&lt;string&gt; - The project root directory (or the start\ndirectory if no `.git` is found)\n\n## Best Practices\n\n1. **Use descriptive file names** for imported components\n2. **Keep imports shallow** - avoid deeply nested import chains\n3. **Document your structure** - maintain a clear hierarchy of imported files\n4. **Test your imports** - ensure all referenced files exist and are accessible\n5. **Use relative paths** when possible for better portability\n\n## Troubleshooting\n\n### Common issues\n\n1. **Import not working**: Check that the file exists and the path is correct\n2. **Circular import warnings**: Review your import structure for circular\n   references\n3. **Permission errors**: Ensure the files are readable and within allowed\n   directories\n4. **Path resolution issues**: Use absolute paths if relative paths aren't\n   resolving correctly\n\n### Debug mode\n\nEnable debug mode to see detailed logging of the import process:\n\n```typescript\nconst result = await processImports(content, basePath, true);\n```\n"}
{"source":"github","repo":"gemini-cli","path":"docs/core/index.md","content":"# Gemini CLI core\n\nGemini CLI's core package (`packages/core`) is the backend portion of Gemini\nCLI, handling communication with the Gemini API, managing tools, and processing\nrequests sent from `packages/cli`. For a general overview of Gemini CLI, see the\n[main documentation page](../index.md).\n\n## Navigating this section\n\n- **[Core tools API](./tools-api.md):** Information on how tools are defined,\n  registered, and used by the core.\n- **[Memory Import Processor](./memport.md):** Documentation for the modular\n  GEMINI.md import feature using @file.md syntax.\n- **[Policy Engine](./policy-engine.md):** Use the Policy Engine for\n  fine-grained control over tool execution.\n\n## Role of the core\n\nWhile the `packages/cli` portion of Gemini CLI provides the user interface,\n`packages/core` is responsible for:\n\n- **Gemini API interaction:** Securely communicating with the Google Gemini API,\n  sending user prompts, and receiving model responses.\n- **Prompt engineering:** Constructing effective prompts for the Gemini model,\n  potentially incorporating conversation history, tool definitions, and\n  instructional context from `GEMINI.md` files.\n- **Tool management & orchestration:**\n  - Registering available tools (e.g., file system tools, shell command\n    execution).\n  - Interpreting tool use requests from the Gemini model.\n  - Executing the requested tools with the provided arguments.\n  - Returning tool execution results to the Gemini model for further processing.\n- **Session and state management:** Keeping track of the conversation state,\n  including history and any relevant context required for coherent interactions.\n- **Configuration:** Managing core-specific configurations, such as API key\n  access, model selection, and tool settings.\n\n## Security considerations\n\nThe core plays a vital role in security:\n\n- **API key management:** It handles the `GEMINI_API_KEY` and ensures it's used\n  securely when communicating with the Gemini API.\n- **Tool execution:** When tools interact with the local system (e.g.,\n  `run_shell_command`), the core (and its underlying tool implementations) must\n  do so with appropriate caution, often involving sandboxing mechanisms to\n  prevent unintended modifications.\n\n## Chat history compression\n\nTo ensure that long conversations don't exceed the token limits of the Gemini\nmodel, the core includes a chat history compression feature.\n\nWhen a conversation approaches the token limit for the configured model, the\ncore automatically compresses the conversation history before sending it to the\nmodel. This compression is designed to be lossless in terms of the information\nconveyed, but it reduces the overall number of tokens used.\n\nYou can find the token limits for each model in the\n[Google AI documentation](https://ai.google.dev/gemini-api/docs/models).\n\n## Model fallback\n\nGemini CLI includes a model fallback mechanism to ensure that you can continue\nto use the CLI even if the default \"pro\" model is rate-limited.\n\nIf you are using the default \"pro\" model and the CLI detects that you are being\nrate-limited, it automatically switches to the \"flash\" model for the current\nsession. This allows you to continue working without interruption.\n\n## File discovery service\n\nThe file discovery service is responsible for finding files in the project that\nare relevant to the current context. It is used by the `@` command and other\ntools that need to access files.\n\n## Memory discovery service\n\nThe memory discovery service is responsible for finding and loading the\n`GEMINI.md` files that provide context to the model. It searches for these files\nin a hierarchical manner, starting from the current working directory and moving\nup to the project root and the user's home directory. It also searches in\nsubdirectories.\n\nThis allows you to have global, project-level, and component-level context\nfiles, which are all combined to provide the model with the most relevant\ninformation.\n\nYou can use the [`/memory` command](../cli/commands.md) to `show`, `add`, and\n`refresh` the content of loaded `GEMINI.md` files.\n\n## Citations\n\nWhen Gemini finds it is reciting text from a source it appends the citation to\nthe output. It is enabled by default but can be disabled with the\nui.showCitations setting.\n\n- When proposing an edit the citations display before giving the user the option\n  to accept.\n- Citations are always shown at the end of the model‚Äôs turn.\n- We deduplicate citations and display them in alphabetical order.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/faq.md","content":"# Frequently asked questions (FAQ)\n\nThis page provides answers to common questions and solutions to frequent\nproblems encountered while using Gemini CLI.\n\n## General issues\n\n### Why am I getting an `API error: 429 - Resource exhausted`?\n\nThis error indicates that you have exceeded your API request limit. The Gemini\nAPI has rate limits to prevent abuse and ensure fair usage.\n\nTo resolve this, you can:\n\n- **Check your usage:** Review your API usage in the Google AI Studio or your\n  Google Cloud project dashboard.\n- **Optimize your prompts:** If you are making many requests in a short period,\n  try to batch your prompts or introduce delays between requests.\n- **Request a quota increase:** If you consistently need a higher limit, you can\n  request a quota increase from Google.\n\n### Why am I getting an `ERR_REQUIRE_ESM` error when running `npm run start`?\n\nThis error typically occurs in Node.js projects when there is a mismatch between\nCommonJS and ES Modules.\n\nThis is often due to a misconfiguration in your `package.json` or\n`tsconfig.json`. Ensure that:\n\n1.  Your `package.json` has `\"type\": \"module\"`.\n2.  Your `tsconfig.json` has `\"module\": \"NodeNext\"` or a compatible setting in\n    the `compilerOptions`.\n\nIf the problem persists, try deleting your `node_modules` directory and\n`package-lock.json` file, and then run `npm install` again.\n\n### Why don't I see cached token counts in my stats output?\n\nCached token information is only displayed when cached tokens are being used.\nThis feature is available for API key users (Gemini API key or Google Cloud\nVertex AI) but not for OAuth users (such as Google Personal/Enterprise accounts\nlike Google Gmail or Google Workspace, respectively). This is because the Gemini\nCode Assist API does not support cached content creation. You can still view\nyour total token usage using the `/stats` command in Gemini CLI.\n\n## Installation and updates\n\n### How do I update Gemini CLI to the latest version?\n\nIf you installed it globally via `npm`, update it using the command\n`npm install -g @google/gemini-cli@latest`. If you compiled it from source, pull\nthe latest changes from the repository, and then rebuild using the command\n`npm run build`.\n\n## Platform-specific issues\n\n### Why does the CLI crash on Windows when I run a command like `chmod +x`?\n\nCommands like `chmod` are specific to Unix-like operating systems (Linux,\nmacOS). They are not available on Windows by default.\n\nTo resolve this, you can:\n\n- **Use Windows-equivalent commands:** Instead of `chmod`, you can use `icacls`\n  to modify file permissions on Windows.\n- **Use a compatibility layer:** Tools like Git Bash or Windows Subsystem for\n  Linux (WSL) provide a Unix-like environment on Windows where these commands\n  will work.\n\n## Configuration\n\n### How do I configure my `GOOGLE_CLOUD_PROJECT`?\n\nYou can configure your Google Cloud Project ID using an environment variable.\n\nSet the `GOOGLE_CLOUD_PROJECT` environment variable in your shell:\n\n```bash\nexport GOOGLE_CLOUD_PROJECT=\"your-project-id\"\n```\n\nTo make this setting permanent, add this line to your shell's startup file\n(e.g., `~/.bashrc`, `~/.zshrc`).\n\n### What is the best way to store my API keys securely?\n\nExposing API keys in scripts or checking them into source control is a security\nrisk.\n\nTo store your API keys securely, you can:\n\n- **Use a `.env` file:** Create a `.env` file in your project's `.gemini`\n  directory (`.gemini/.env`) and store your keys there. Gemini CLI will\n  automatically load these variables.\n- **Use your system's keyring:** For the most secure storage, use your operating\n  system's secret management tool (like macOS Keychain, Windows Credential\n  Manager, or a secret manager on Linux). You can then have your scripts or\n  environment load the key from the secure storage at runtime.\n\n### Where are the Gemini CLI configuration and settings files stored?\n\nThe Gemini CLI configuration is stored in two `settings.json` files:\n\n1.  In your home directory: `~/.gemini/settings.json`.\n2.  In your project's root directory: `./.gemini/settings.json`.\n\nRefer to [Gemini CLI Configuration](./get-started/configuration.md) for more\ndetails.\n\n## Google AI Pro/Ultra and subscription FAQs\n\n### Where can I learn more about my Google AI Pro or Google AI Ultra subscription?\n\nTo learn more about your Google AI Pro or Google AI Ultra subscription, visit\n**Manage subscription** in your [subscription settings](https://one.google.com).\n\n### How do I know if I have higher limits for Google AI Pro or Ultra?\n\nIf you're subscribed to Google AI Pro or Ultra, you automatically have higher\nlimits to Gemini Code Assist and Gemini CLI. These are shared across Gemini CLI\nand agent mode in the IDE. You can confirm you have higher limits by checking if\nyou are still subscribed to Google AI Pro or Ultra in your\n[subscription settings](https://one.google.com).\n\n### What is the privacy policy for using Gemini Code Assist or Gemini CLI if I've subscribed to Google AI Pro or Ultra?\n\nTo learn more about your privacy policy and terms of service governed by your\nsubscription, visit\n[Gemini Code Assist: Terms of Service and Privacy Policies](https://developers.google.com/gemini-code-assist/resources/privacy-notices).\n\n### I've upgraded to Google AI Pro or Ultra but it still says I am hitting quota limits. Is this a bug?\n\nThe higher limits in your Google AI Pro or Ultra subscription are for Gemini 2.5\nacross both Gemini 2.5 Pro and Flash. They are shared quota across Gemini CLI\nand agent mode in Gemini Code Assist IDE extensions. You can learn more about\nquota limits for Gemini CLI, Gemini Code Assist and agent mode in Gemini Code\nAssist at\n[Quotas and limits](https://developers.google.com/gemini-code-assist/resources/quotas).\n\n### If I upgrade to higher limits for Gemini CLI and Gemini Code Assist by purchasing a Google AI Pro or Ultra subscription, will Gemini start using my data to improve its machine learning models?\n\nGoogle does not use your data to improve Google's machine learning models if you\npurchase a paid plan. Note: If you decide to remain on the free version of\nGemini Code Assist, Gemini Code Assist for individuals, you can also opt out of\nusing your data to improve Google's machine learning models. See the\n[Gemini Code Assist for individuals privacy notice](https://developers.google.com/gemini-code-assist/resources/privacy-notice-gemini-code-assist-individuals)\nfor more information.\n\n## Not seeing your question?\n\nSearch the\n[Gemini CLI Q&A discussions on GitHub](https://github.com/google-gemini/gemini-cli/discussions/categories/q-a)\nor\n[start a new discussion on GitHub](https://github.com/google-gemini/gemini-cli/discussions/new?category=q-a)\n"}
{"source":"github","repo":"gemini-cli","path":"docs/tools/mcp-server.md","content":"# MCP servers with the Gemini CLI\n\nThis document provides a guide to configuring and using Model Context Protocol\n(MCP) servers with the Gemini CLI.\n\n## What is an MCP server?\n\nAn MCP server is an application that exposes tools and resources to the Gemini\nCLI through the Model Context Protocol, allowing it to interact with external\nsystems and data sources. MCP servers act as a bridge between the Gemini model\nand your local environment or other services like APIs.\n\nAn MCP server enables the Gemini CLI to:\n\n- **Discover tools:** List available tools, their descriptions, and parameters\n  through standardized schema definitions.\n- **Execute tools:** Call specific tools with defined arguments and receive\n  structured responses.\n- **Access resources:** Read data from specific resources that the server\n  exposes (files, API payloads, reports, etc.).\n\nWith an MCP server, you can extend the Gemini CLI's capabilities to perform\nactions beyond its built-in features, such as interacting with databases, APIs,\ncustom scripts, or specialized workflows.\n\n## Core integration architecture\n\nThe Gemini CLI integrates with MCP servers through a sophisticated discovery and\nexecution system built into the core package (`packages/core/src/tools/`):\n\n### Discovery Layer (`mcp-client.ts`)\n\nThe discovery process is orchestrated by `discoverMcpTools()`, which:\n\n1. **Iterates through configured servers** from your `settings.json`\n   `mcpServers` configuration\n2. **Establishes connections** using appropriate transport mechanisms (Stdio,\n   SSE, or Streamable HTTP)\n3. **Fetches tool definitions** from each server using the MCP protocol\n4. **Sanitizes and validates** tool schemas for compatibility with the Gemini\n   API\n5. **Registers tools** in the global tool registry with conflict resolution\n6. **Fetches and registers resources** if the server exposes any\n\n### Execution layer (`mcp-tool.ts`)\n\nEach discovered MCP tool is wrapped in a `DiscoveredMCPTool` instance that:\n\n- **Handles confirmation logic** based on server trust settings and user\n  preferences\n- **Manages tool execution** by calling the MCP server with proper parameters\n- **Processes responses** for both the LLM context and user display\n- **Maintains connection state** and handles timeouts\n\n### Transport mechanisms\n\nThe Gemini CLI supports three MCP transport types:\n\n- **Stdio Transport:** Spawns a subprocess and communicates via stdin/stdout\n- **SSE Transport:** Connects to Server-Sent Events endpoints\n- **Streamable HTTP Transport:** Uses HTTP streaming for communication\n\n## Working with MCP resources\n\nSome MCP servers expose contextual ‚Äúresources‚Äù in addition to the tools and\nprompts. Gemini CLI discovers these automatically and gives you the possibility\nto reference them in the chat.\n\n### Discovery and listing\n\n- When discovery runs, the CLI fetches each server‚Äôs `resources/list` results.\n- The `/mcp` command displays a Resources section alongside Tools and Prompts\n  for every connected server.\n\nThis returns a concise, plain-text list of URIs plus metadata.\n\n### Referencing resources in a conversation\n\nYou can use the same `@` syntax already known for referencing local files:\n\n```\n@server://resource/path\n```\n\nResource URIs appear in the completion menu together with filesystem paths. When\nyou submit the message, the CLI calls `resources/read` and injects the content\nin the conversation.\n\n## How to set up your MCP server\n\nThe Gemini CLI uses the `mcpServers` configuration in your `settings.json` file\nto locate and connect to MCP servers. This configuration supports multiple\nservers with different transport mechanisms.\n\n### Configure the MCP server in settings.json\n\nYou can configure MCP servers in your `settings.json` file in two main ways:\nthrough the top-level `mcpServers` object for specific server definitions, and\nthrough the `mcp` object for global settings that control server discovery and\nexecution.\n\n#### Global MCP settings (`mcp`)\n\nThe `mcp` object in your `settings.json` allows you to define global rules for\nall MCP servers.\n\n- **`mcp.serverCommand`** (string): A global command to start an MCP server.\n- **`mcp.allowed`** (array of strings): A list of MCP server names to allow. If\n  this is set, only servers from this list (matching the keys in the\n  `mcpServers` object) will be connected to.\n- **`mcp.excluded`** (array of strings): A list of MCP server names to exclude.\n  Servers in this list will not be connected to.\n\n**Example:**\n\n```json\n{\n  \"mcp\": {\n    \"allowed\": [\"my-trusted-server\"],\n    \"excluded\": [\"experimental-server\"]\n  }\n}\n```\n\n#### Server-specific configuration (`mcpServers`)\n\nThe `mcpServers` object is where you define each individual MCP server you want\nthe CLI to connect to.\n\n### Configuration structure\n\nAdd an `mcpServers` object to your `settings.json` file:\n\n```json\n{ ...file contains other config objects\n  \"mcpServers\": {\n    \"serverName\": {\n      \"command\": \"path/to/server\",\n      \"args\": [\"--arg1\", \"value1\"],\n      \"env\": {\n        \"API_KEY\": \"$MY_API_TOKEN\"\n      },\n      \"cwd\": \"./server-directory\",\n      \"timeout\": 30000,\n      \"trust\": false\n    }\n  }\n}\n```\n\n### Configuration properties\n\nEach server configuration supports the following properties:\n\n#### Required (one of the following)\n\n- **`command`** (string): Path to the executable for Stdio transport\n- **`url`** (string): SSE endpoint URL (e.g., `\"http://localhost:8080/sse\"`)\n- **`httpUrl`** (string): HTTP streaming endpoint URL\n\n#### Optional\n\n- **`args`** (string[]): Command-line arguments for Stdio transport\n- **`headers`** (object): Custom HTTP headers when using `url` or `httpUrl`\n- **`env`** (object): Environment variables for the server process. Values can\n  reference environment variables using `$VAR_NAME` or `${VAR_NAME}` syntax\n- **`cwd`** (string): Working directory for Stdio transport\n- **`timeout`** (number): Request timeout in milliseconds (default: 600,000ms =\n  10 minutes)\n- **`trust`** (boolean): When `true`, bypasses all tool call confirmations for\n  this server (default: `false`)\n- **`includeTools`** (string[]): List of tool names to include from this MCP\n  server. When specified, only the tools listed here will be available from this\n  server (allowlist behavior). If not specified, all tools from the server are\n  enabled by default.\n- **`excludeTools`** (string[]): List of tool names to exclude from this MCP\n  server. Tools listed here will not be available to the model, even if they are\n  exposed by the server. **Note:** `excludeTools` takes precedence over\n  `includeTools` - if a tool is in both lists, it will be excluded.\n- **`targetAudience`** (string): The OAuth Client ID allowlisted on the\n  IAP-protected application you are trying to access. Used with\n  `authProviderType: 'service_account_impersonation'`.\n- **`targetServiceAccount`** (string): The email address of the Google Cloud\n  Service Account to impersonate. Used with\n  `authProviderType: 'service_account_impersonation'`.\n\n### OAuth support for remote MCP servers\n\nThe Gemini CLI supports OAuth 2.0 authentication for remote MCP servers using\nSSE or HTTP transports. This enables secure access to MCP servers that require\nauthentication.\n\n#### Automatic OAuth discovery\n\nFor servers that support OAuth discovery, you can omit the OAuth configuration\nand let the CLI discover it automatically:\n\n```json\n{\n  \"mcpServers\": {\n    \"discoveredServer\": {\n      \"url\": \"https://api.example.com/sse\"\n    }\n  }\n}\n```\n\nThe CLI will automatically:\n\n- Detect when a server requires OAuth authentication (401 responses)\n- Discover OAuth endpoints from server metadata\n- Perform dynamic client registration if supported\n- Handle the OAuth flow and token management\n\n#### Authentication flow\n\nWhen connecting to an OAuth-enabled server:\n\n1. **Initial connection attempt** fails with 401 Unauthorized\n2. **OAuth discovery** finds authorization and token endpoints\n3. **Browser opens** for user authentication (requires local browser access)\n4. **Authorization code** is exchanged for access tokens\n5. **Tokens are stored** securely for future use\n6. **Connection retry** succeeds with valid tokens\n\n#### Browser redirect requirements\n\n**Important:** OAuth authentication requires that your local machine can:\n\n- Open a web browser for authentication\n- Receive redirects on `http://localhost:7777/oauth/callback`\n\nThis feature will not work in:\n\n- Headless environments without browser access\n- Remote SSH sessions without X11 forwarding\n- Containerized environments without browser support\n\n#### Managing OAuth authentication\n\nUse the `/mcp auth` command to manage OAuth authentication:\n\n```bash\n# List servers requiring authentication\n/mcp auth\n\n# Authenticate with a specific server\n/mcp auth serverName\n\n# Re-authenticate if tokens expire\n/mcp auth serverName\n```\n\n#### OAuth configuration properties\n\n- **`enabled`** (boolean): Enable OAuth for this server\n- **`clientId`** (string): OAuth client identifier (optional with dynamic\n  registration)\n- **`clientSecret`** (string): OAuth client secret (optional for public clients)\n- **`authorizationUrl`** (string): OAuth authorization endpoint (auto-discovered\n  if omitted)\n- **`tokenUrl`** (string): OAuth token endpoint (auto-discovered if omitted)\n- **`scopes`** (string[]): Required OAuth scopes\n- **`redirectUri`** (string): Custom redirect URI (defaults to\n  `http://localhost:7777/oauth/callback`)\n- **`tokenParamName`** (string): Query parameter name for tokens in SSE URLs\n- **`audiences`** (string[]): Audiences the token is valid for\n\n#### Token management\n\nOAuth tokens are automatically:\n\n- **Stored securely** in `~/.gemini/mcp-oauth-tokens.json`\n- **Refreshed** when expired (if refresh tokens are available)\n- **Validated** before each connection attempt\n- **Cleaned up** when invalid or expired\n\n#### Authentication provider type\n\nYou can specify the authentication provider type using the `authProviderType`\nproperty:\n\n- **`authProviderType`** (string): Specifies the authentication provider. Can be\n  one of the following:\n  - **`dynamic_discovery`** (default): The CLI will automatically discover the\n    OAuth configuration from the server.\n  - **`google_credentials`**: The CLI will use the Google Application Default\n    Credentials (ADC) to authenticate with the server. When using this provider,\n    you must specify the required scopes.\n  - **`service_account_impersonation`**: The CLI will impersonate a Google Cloud\n    Service Account to authenticate with the server. This is useful for\n    accessing IAP-protected services (this was specifically designed for Cloud\n    Run services).\n\n#### Google credentials\n\n```json\n{\n  \"mcpServers\": {\n    \"googleCloudServer\": {\n      \"httpUrl\": \"https://my-gcp-service.run.app/mcp\",\n      \"authProviderType\": \"google_credentials\",\n      \"oauth\": {\n        \"scopes\": [\"https://www.googleapis.com/auth/userinfo.email\"]\n      }\n    }\n  }\n}\n```\n\n#### Service account impersonation\n\nTo authenticate with a server using Service Account Impersonation, you must set\nthe `authProviderType` to `service_account_impersonation` and provide the\nfollowing properties:\n\n- **`targetAudience`** (string): The OAuth Client ID allowslisted on the\n  IAP-protected application you are trying to access.\n- **`targetServiceAccount`** (string): The email address of the Google Cloud\n  Service Account to impersonate.\n\nThe CLI will use your local Application Default Credentials (ADC) to generate an\nOIDC ID token for the specified service account and audience. This token will\nthen be used to authenticate with the MCP server.\n\n#### Setup instructions\n\n1. **[Create](https://cloud.google.com/iap/docs/oauth-client-creation) or use an\n   existing OAuth 2.0 client ID.** To use an existing OAuth 2.0 client ID,\n   follow the steps in\n   [How to share OAuth Clients](https://cloud.google.com/iap/docs/sharing-oauth-clients).\n2. **Add the OAuth ID to the allowlist for\n   [programmatic access](https://cloud.google.com/iap/docs/sharing-oauth-clients#programmatic_access)\n   for the application.** Since Cloud Run is not yet a supported resource type\n   in gcloud iap, you must allowlist the Client ID on the project.\n3. **Create a service account.**\n   [Documentation](https://cloud.google.com/iam/docs/service-accounts-create#creating),\n   [Cloud Console Link](https://console.cloud.google.com/iam-admin/serviceaccounts)\n4. **Add both the service account and users to the IAP Policy** in the\n   \"Security\" tab of the Cloud Run service itself or via gcloud.\n5. **Grant all users and groups** who will access the MCP Server the necessary\n   permissions to\n   [impersonate the service account](https://cloud.google.com/docs/authentication/use-service-account-impersonation)\n   (i.e., `roles/iam.serviceAccountTokenCreator`).\n6. **[Enable](https://console.cloud.google.com/apis/library/iamcredentials.googleapis.com)\n   the IAM Credentials API** for your project.\n\n### Example configurations\n\n#### Python MCP server (stdio)\n\n```json\n{\n  \"mcpServers\": {\n    \"pythonTools\": {\n      \"command\": \"python\",\n      \"args\": [\"-m\", \"my_mcp_server\", \"--port\", \"8080\"],\n      \"cwd\": \"./mcp-servers/python\",\n      \"env\": {\n        \"DATABASE_URL\": \"$DB_CONNECTION_STRING\",\n        \"API_KEY\": \"${EXTERNAL_API_KEY}\"\n      },\n      \"timeout\": 15000\n    }\n  }\n}\n```\n\n#### Node.js MCP server (stdio)\n\n```json\n{\n  \"mcpServers\": {\n    \"nodeServer\": {\n      \"command\": \"node\",\n      \"args\": [\"dist/server.js\", \"--verbose\"],\n      \"cwd\": \"./mcp-servers/node\",\n      \"trust\": true\n    }\n  }\n}\n```\n\n#### Docker-based MCP server\n\n```json\n{\n  \"mcpServers\": {\n    \"dockerizedServer\": {\n      \"command\": \"docker\",\n      \"args\": [\n        \"run\",\n        \"-i\",\n        \"--rm\",\n        \"-e\",\n        \"API_KEY\",\n        \"-v\",\n        \"${PWD}:/workspace\",\n        \"my-mcp-server:latest\"\n      ],\n      \"env\": {\n        \"API_KEY\": \"$EXTERNAL_SERVICE_TOKEN\"\n      }\n    }\n  }\n}\n```\n\n#### HTTP-based MCP server\n\n```json\n{\n  \"mcpServers\": {\n    \"httpServer\": {\n      \"httpUrl\": \"http://localhost:3000/mcp\",\n      \"timeout\": 5000\n    }\n  }\n}\n```\n\n#### HTTP-based MCP Server with custom headers\n\n```json\n{\n  \"mcpServers\": {\n    \"httpServerWithAuth\": {\n      \"httpUrl\": \"http://localhost:3000/mcp\",\n      \"headers\": {\n        \"Authorization\": \"Bearer your-api-token\",\n        \"X-Custom-Header\": \"custom-value\",\n        \"Content-Type\": \"application/json\"\n      },\n      \"timeout\": 5000\n    }\n  }\n}\n```\n\n#### MCP server with tool filtering\n\n```json\n{\n  \"mcpServers\": {\n    \"filteredServer\": {\n      \"command\": \"python\",\n      \"args\": [\"-m\", \"my_mcp_server\"],\n      \"includeTools\": [\"safe_tool\", \"file_reader\", \"data_processor\"],\n      // \"excludeTools\": [\"dangerous_tool\", \"file_deleter\"],\n      \"timeout\": 30000\n    }\n  }\n}\n```\n\n### SSE MCP server with SA impersonation\n\n```json\n{\n  \"mcpServers\": {\n    \"myIapProtectedServer\": {\n      \"url\": \"https://my-iap-service.run.app/sse\",\n      \"authProviderType\": \"service_account_impersonation\",\n      \"targetAudience\": \"YOUR_IAP_CLIENT_ID.apps.googleusercontent.com\",\n      \"targetServiceAccount\": \"your-sa@your-project.iam.gserviceaccount.com\"\n    }\n  }\n}\n```\n\n## Discovery process deep dive\n\nWhen the Gemini CLI starts, it performs MCP server discovery through the\nfollowing detailed process:\n\n### 1. Server iteration and connection\n\nFor each configured server in `mcpServers`:\n\n1. **Status tracking begins:** Server status is set to `CONNECTING`\n2. **Transport selection:** Based on configuration properties:\n   - `httpUrl` ‚Üí `StreamableHTTPClientTransport`\n   - `url` ‚Üí `SSEClientTransport`\n   - `command` ‚Üí `StdioClientTransport`\n3. **Connection establishment:** The MCP client attempts to connect with the\n   configured timeout\n4. **Error handling:** Connection failures are logged and the server status is\n   set to `DISCONNECTED`\n\n### 2. Tool discovery\n\nUpon successful connection:\n\n1. **Tool listing:** The client calls the MCP server's tool listing endpoint\n2. **Schema validation:** Each tool's function declaration is validated\n3. **Tool filtering:** Tools are filtered based on `includeTools` and\n   `excludeTools` configuration\n4. **Name sanitization:** Tool names are cleaned to meet Gemini API\n   requirements:\n   - Invalid characters (non-alphanumeric, underscore, dot, hyphen) are replaced\n     with underscores\n   - Names longer than 63 characters are truncated with middle replacement\n     (`___`)\n\n### 3. Conflict resolution\n\nWhen multiple servers expose tools with the same name:\n\n1. **First registration wins:** The first server to register a tool name gets\n   the unprefixed name\n2. **Automatic prefixing:** Subsequent servers get prefixed names:\n   `serverName__toolName`\n3. **Registry tracking:** The tool registry maintains mappings between server\n   names and their tools\n\n### 4. Schema processing\n\nTool parameter schemas undergo sanitization for Gemini API compatibility:\n\n- **`$schema` properties** are removed\n- **`additionalProperties`** are stripped\n- **`anyOf` with `default`** have their default values removed (Vertex AI\n  compatibility)\n- **Recursive processing** applies to nested schemas\n\n### 5. Connection management\n\nAfter discovery:\n\n- **Persistent connections:** Servers that successfully register tools maintain\n  their connections\n- **Cleanup:** Servers that provide no usable tools have their connections\n  closed\n- **Status updates:** Final server statuses are set to `CONNECTED` or\n  `DISCONNECTED`\n\n## Tool execution flow\n\nWhen the Gemini model decides to use an MCP tool, the following execution flow\noccurs:\n\n### 1. Tool invocation\n\nThe model generates a `FunctionCall` with:\n\n- **Tool name:** The registered name (potentially prefixed)\n- **Arguments:** JSON object matching the tool's parameter schema\n\n### 2. Confirmation process\n\nEach `DiscoveredMCPTool` implements sophisticated confirmation logic:\n\n#### Trust-based bypass\n\n```typescript\nif (this.trust) {\n  return false; // No confirmation needed\n}\n```\n\n#### Dynamic allow-listing\n\nThe system maintains internal allow-lists for:\n\n- **Server-level:** `serverName` ‚Üí All tools from this server are trusted\n- **Tool-level:** `serverName.toolName` ‚Üí This specific tool is trusted\n\n#### User choice handling\n\nWhen confirmation is required, users can choose:\n\n- **Proceed once:** Execute this time only\n- **Always allow this tool:** Add to tool-level allow-list\n- **Always allow this server:** Add to server-level allow-list\n- **Cancel:** Abort execution\n\n### 3. Execution\n\nUpon confirmation (or trust bypass):\n\n1. **Parameter preparation:** Arguments are validated against the tool's schema\n2. **MCP call:** The underlying `CallableTool` invokes the server with:\n\n   ```typescript\n   const functionCalls = [\n     {\n       name: this.serverToolName, // Original server tool name\n       args: params,\n     },\n   ];\n   ```\n\n3. **Response processing:** Results are formatted for both LLM context and user\n   display\n\n### 4. Response handling\n\nThe execution result contains:\n\n- **`llmContent`:** Raw response parts for the language model's context\n- **`returnDisplay`:** Formatted output for user display (often JSON in markdown\n  code blocks)\n\n## How to interact with your MCP server\n\n### Using the `/mcp` command\n\nThe `/mcp` command provides comprehensive information about your MCP server\nsetup:\n\n```bash\n/mcp\n```\n\nThis displays:\n\n- **Server list:** All configured MCP servers\n- **Connection status:** `CONNECTED`, `CONNECTING`, or `DISCONNECTED`\n- **Server details:** Configuration summary (excluding sensitive data)\n- **Available tools:** List of tools from each server with descriptions\n- **Discovery state:** Overall discovery process status\n\n### Example `/mcp` output\n\n```\nMCP Servers Status:\n\nüì° pythonTools (CONNECTED)\n  Command: python -m my_mcp_server --port 8080\n  Working Directory: ./mcp-servers/python\n  Timeout: 15000ms\n  Tools: calculate_sum, file_analyzer, data_processor\n\nüîå nodeServer (DISCONNECTED)\n  Command: node dist/server.js --verbose\n  Error: Connection refused\n\nüê≥ dockerizedServer (CONNECTED)\n  Command: docker run -i --rm -e API_KEY my-mcp-server:latest\n  Tools: docker__deploy, docker__status\n\nDiscovery State: COMPLETED\n```\n\n### Tool usage\n\nOnce discovered, MCP tools are available to the Gemini model like built-in\ntools. The model will automatically:\n\n1. **Select appropriate tools** based on your requests\n2. **Present confirmation dialogs** (unless the server is trusted)\n3. **Execute tools** with proper parameters\n4. **Display results** in a user-friendly format\n\n## Status monitoring and troubleshooting\n\n### Connection states\n\nThe MCP integration tracks several states:\n\n#### Server status (`MCPServerStatus`)\n\n- **`DISCONNECTED`:** Server is not connected or has errors\n- **`CONNECTING`:** Connection attempt in progress\n- **`CONNECTED`:** Server is connected and ready\n\n#### Discovery state (`MCPDiscoveryState`)\n\n- **`NOT_STARTED`:** Discovery hasn't begun\n- **`IN_PROGRESS`:** Currently discovering servers\n- **`COMPLETED`:** Discovery finished (with or without errors)\n\n### Common issues and solutions\n\n#### Server won't connect\n\n**Symptoms:** Server shows `DISCONNECTED` status\n\n**Troubleshooting:**\n\n1. **Check configuration:** Verify `command`, `args`, and `cwd` are correct\n2. **Test manually:** Run the server command directly to ensure it works\n3. **Check dependencies:** Ensure all required packages are installed\n4. **Review logs:** Look for error messages in the CLI output\n5. **Verify permissions:** Ensure the CLI can execute the server command\n\n#### No tools discovered\n\n**Symptoms:** Server connects but no tools are available\n\n**Troubleshooting:**\n\n1. **Verify tool registration:** Ensure your server actually registers tools\n2. **Check MCP protocol:** Confirm your server implements the MCP tool listing\n   correctly\n3. **Review server logs:** Check stderr output for server-side errors\n4. **Test tool listing:** Manually test your server's tool discovery endpoint\n\n#### Tools not executing\n\n**Symptoms:** Tools are discovered but fail during execution\n\n**Troubleshooting:**\n\n1. **Parameter validation:** Ensure your tool accepts the expected parameters\n2. **Schema compatibility:** Verify your input schemas are valid JSON Schema\n3. **Error handling:** Check if your tool is throwing unhandled exceptions\n4. **Timeout issues:** Consider increasing the `timeout` setting\n\n#### Sandbox compatibility\n\n**Symptoms:** MCP servers fail when sandboxing is enabled\n\n**Solutions:**\n\n1. **Docker-based servers:** Use Docker containers that include all dependencies\n2. **Path accessibility:** Ensure server executables are available in the\n   sandbox\n3. **Network access:** Configure sandbox to allow necessary network connections\n4. **Environment variables:** Verify required environment variables are passed\n   through\n\n### Debugging tips\n\n1. **Enable debug mode:** Run the CLI with `--debug` for verbose output\n2. **Check stderr:** MCP server stderr is captured and logged (INFO messages\n   filtered)\n3. **Test isolation:** Test your MCP server independently before integrating\n4. **Incremental setup:** Start with simple tools before adding complex\n   functionality\n5. **Use `/mcp` frequently:** Monitor server status during development\n\n## Important notes\n\n### Security sonsiderations\n\n- **Trust settings:** The `trust` option bypasses all confirmation dialogs. Use\n  cautiously and only for servers you completely control\n- **Access tokens:** Be security-aware when configuring environment variables\n  containing API keys or tokens\n- **Sandbox compatibility:** When using sandboxing, ensure MCP servers are\n  available within the sandbox environment\n- **Private data:** Using broadly scoped personal access tokens can lead to\n  information leakage between repositories\n\n### Performance and resource management\n\n- **Connection persistence:** The CLI maintains persistent connections to\n  servers that successfully register tools\n- **Automatic cleanup:** Connections to servers providing no tools are\n  automatically closed\n- **Timeout management:** Configure appropriate timeouts based on your server's\n  response characteristics\n- **Resource monitoring:** MCP servers run as separate processes and consume\n  system resources\n\n### Schema compatibility\n\n- **Property stripping:** The system automatically removes certain schema\n  properties (`$schema`, `additionalProperties`) for Gemini API compatibility\n- **Name sanitization:** Tool names are automatically sanitized to meet API\n  requirements\n- **Conflict resolution:** Tool name conflicts between servers are resolved\n  through automatic prefixing\n\nThis comprehensive integration makes MCP servers a powerful way to extend the\nGemini CLI's capabilities while maintaining security, reliability, and ease of\nuse.\n\n## Returning rich content from tools\n\nMCP tools are not limited to returning simple text. You can return rich,\nmulti-part content, including text, images, audio, and other binary data in a\nsingle tool response. This allows you to build powerful tools that can provide\ndiverse information to the model in a single turn.\n\nAll data returned from the tool is processed and sent to the model as context\nfor its next generation, enabling it to reason about or summarize the provided\ninformation.\n\n### How it works\n\nTo return rich content, your tool's response must adhere to the MCP\nspecification for a\n[`CallToolResult`](https://modelcontextprotocol.io/specification/2025-06-18/server/tools#tool-result).\nThe `content` field of the result should be an array of `ContentBlock` objects.\nThe Gemini CLI will correctly process this array, separating text from binary\ndata and packaging it for the model.\n\nYou can mix and match different content block types in the `content` array. The\nsupported block types include:\n\n- `text`\n- `image`\n- `audio`\n- `resource` (embedded content)\n- `resource_link`\n\n### Example: Returning text and an image\n\nHere is an example of a valid JSON response from an MCP tool that returns both a\ntext description and an image:\n\n```json\n{\n  \"content\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"Here is the logo you requested.\"\n    },\n    {\n      \"type\": \"image\",\n      \"data\": \"BASE64_ENCODED_IMAGE_DATA_HERE\",\n      \"mimeType\": \"image/png\"\n    },\n    {\n      \"type\": \"text\",\n      \"text\": \"The logo was created in 2025.\"\n    }\n  ]\n}\n```\n\nWhen the Gemini CLI receives this response, it will:\n\n1.  Extract all the text and combine it into a single `functionResponse` part\n    for the model.\n2.  Present the image data as a separate `inlineData` part.\n3.  Provide a clean, user-friendly summary in the CLI, indicating that both text\n    and an image were received.\n\nThis enables you to build sophisticated tools that can provide rich, multi-modal\ncontext to the Gemini model.\n\n## MCP prompts as slash commands\n\nIn addition to tools, MCP servers can expose predefined prompts that can be\nexecuted as slash commands within the Gemini CLI. This allows you to create\nshortcuts for common or complex queries that can be easily invoked by name.\n\n### Defining prompts on the server\n\nHere's a small example of a stdio MCP server that defines prompts:\n\n```ts\nimport { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';\nimport { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';\nimport { z } from 'zod';\n\nconst server = new McpServer({\n  name: 'prompt-server',\n  version: '1.0.0',\n});\n\nserver.registerPrompt(\n  'poem-writer',\n  {\n    title: 'Poem Writer',\n    description: 'Write a nice haiku',\n    argsSchema: { title: z.string(), mood: z.string().optional() },\n  },\n  ({ title, mood }) => ({\n    messages: [\n      {\n        role: 'user',\n        content: {\n          type: 'text',\n          text: `Write a haiku${mood ? ` with the mood ${mood}` : ''} called ${title}. Note that a haiku is 5 syllables followed by 7 syllables followed by 5 syllables `,\n        },\n      },\n    ],\n  }),\n);\n\nconst transport = new StdioServerTransport();\nawait server.connect(transport);\n```\n\nThis can be included in `settings.json` under `mcpServers` with:\n\n```json\n{\n  \"mcpServers\": {\n    \"nodeServer\": {\n      \"command\": \"node\",\n      \"args\": [\"filename.ts\"]\n    }\n  }\n}\n```\n\n### Invoking prompts\n\nOnce a prompt is discovered, you can invoke it using its name as a slash\ncommand. The CLI will automatically handle parsing arguments.\n\n```bash\n/poem-writer --title=\"Gemini CLI\" --mood=\"reverent\"\n```\n\nor, using positional arguments:\n\n```bash\n/poem-writer \"Gemini CLI\" reverent\n```\n\nWhen you run this command, the Gemini CLI executes the `prompts/get` method on\nthe MCP server with the provided arguments. The server is responsible for\nsubstituting the arguments into the prompt template and returning the final\nprompt text. The CLI then sends this prompt to the model for execution. This\nprovides a convenient way to automate and share common workflows.\n\n## Managing MCP servers with `gemini mcp`\n\nWhile you can always configure MCP servers by manually editing your\n`settings.json` file, the Gemini CLI provides a convenient set of commands to\nmanage your server configurations programmatically. These commands streamline\nthe process of adding, listing, and removing MCP servers without needing to\ndirectly edit JSON files.\n\n### Adding a server (`gemini mcp add`)\n\nThe `add` command configures a new MCP server in your `settings.json`. Based on\nthe scope (`-s, --scope`), it will be added to either the user config\n`~/.gemini/settings.json` or the project config `.gemini/settings.json` file.\n\n**Command:**\n\n```bash\ngemini mcp add [options] <name> <commandOrUrl> [args...]\n```\n\n- `<name>`: A unique name for the server.\n- `<commandOrUrl>`: The command to execute (for `stdio`) or the URL (for\n  `http`/`sse`).\n- `[args...]`: Optional arguments for a `stdio` command.\n\n**Options (flags):**\n\n- `-s, --scope`: Configuration scope (user or project). [default: \"project\"]\n- `-t, --transport`: Transport type (stdio, sse, http). [default: \"stdio\"]\n- `-e, --env`: Set environment variables (e.g. -e KEY=value).\n- `-H, --header`: Set HTTP headers for SSE and HTTP transports (e.g. -H\n  \"X-Api-Key: abc123\" -H \"Authorization: Bearer abc123\").\n- `--timeout`: Set connection timeout in milliseconds.\n- `--trust`: Trust the server (bypass all tool call confirmation prompts).\n- `--description`: Set the description for the server.\n- `--include-tools`: A comma-separated list of tools to include.\n- `--exclude-tools`: A comma-separated list of tools to exclude.\n\n#### Adding an stdio server\n\nThis is the default transport for running local servers.\n\n```bash\n# Basic syntax\ngemini mcp add [options] <name> <command> [args...]\n\n# Example: Adding a local server\ngemini mcp add -e API_KEY=123 -e DEBUG=true my-stdio-server /path/to/server arg1 arg2 arg3\n\n# Example: Adding a local python server\ngemini mcp add python-server python server.py -- --server-arg my-value\n```\n\n#### Adding an HTTP server\n\nThis transport is for servers that use the streamable HTTP transport.\n\n```bash\n# Basic syntax\ngemini mcp add --transport http <name> <url>\n\n# Example: Adding an HTTP server\ngemini mcp add --transport http http-server https://api.example.com/mcp/\n\n# Example: Adding an HTTP server with an authentication header\ngemini mcp add --transport http --header \"Authorization: Bearer abc123\" secure-http https://api.example.com/mcp/\n```\n\n#### Adding an SSE server\n\nThis transport is for servers that use Server-Sent Events (SSE).\n\n```bash\n# Basic syntax\ngemini mcp add --transport sse <name> <url>\n\n# Example: Adding an SSE server\ngemini mcp add --transport sse sse-server https://api.example.com/sse/\n\n# Example: Adding an SSE server with an authentication header\ngemini mcp add --transport sse --header \"Authorization: Bearer abc123\" secure-sse https://api.example.com/sse/\n```\n\n### Listing servers (`gemini mcp list`)\n\nTo view all MCP servers currently configured, use the `list` command. It\ndisplays each server's name, configuration details, and connection status. This\ncommand has no flags.\n\n**Command:**\n\n```bash\ngemini mcp list\n```\n\n**Example output:**\n\n```sh\n‚úì stdio-server: command: python3 server.py (stdio) - Connected\n‚úì http-server: https://api.example.com/mcp (http) - Connected\n‚úó sse-server: https://api.example.com/sse (sse) - Disconnected\n```\n\n### Removing a server (`gemini mcp remove`)\n\nTo delete a server from your configuration, use the `remove` command with the\nserver's name.\n\n**Command:**\n\n```bash\ngemini mcp remove <name>\n```\n\n**Options (flags):**\n\n- `-s, --scope`: Configuration scope (user or project). [default: \"project\"]\n\n**Example:**\n\n```bash\ngemini mcp remove my-server\n```\n\nThis will find and delete the \"my-server\" entry from the `mcpServers` object in\nthe appropriate `settings.json` file based on the scope (`-s, --scope`).\n\n## Instructions\n\nGemini CLI supports\n[MCP server instructions](https://modelcontextprotocol.io/specification/2025-06-18/schema#initializeresult),\nwhich will be appended to the system instructions.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/tools/web-fetch.md","content":"# Web fetch tool (`web_fetch`)\n\nThis document describes the `web_fetch` tool for the Gemini CLI.\n\n## Description\n\nUse `web_fetch` to summarize, compare, or extract information from web pages.\nThe `web_fetch` tool processes content from one or more URLs (up to 20) embedded\nin a prompt. `web_fetch` takes a natural language prompt and returns a generated\nresponse.\n\n### Arguments\n\n`web_fetch` takes one argument:\n\n- `prompt` (string, required): A comprehensive prompt that includes the URL(s)\n  (up to 20) to fetch and specific instructions on how to process their content.\n  For example:\n  `\"Summarize https://example.com/article and extract key points from https://another.com/data\"`.\n  The prompt must contain at least one URL starting with `http://` or\n  `https://`.\n\n## How to use `web_fetch` with the Gemini CLI\n\nTo use `web_fetch` with the Gemini CLI, provide a natural language prompt that\ncontains URLs. The tool will ask for confirmation before fetching any URLs. Once\nconfirmed, the tool will process URLs through Gemini API's `urlContext`.\n\nIf the Gemini API cannot access the URL, the tool will fall back to fetching\ncontent directly from the local machine. The tool will format the response,\nincluding source attribution and citations where possible. The tool will then\nprovide the response to the user.\n\nUsage:\n\n```\nweb_fetch(prompt=\"Your prompt, including a URL such as https://google.com.\")\n```\n\n## `web_fetch` examples\n\nSummarize a single article:\n\n```\nweb_fetch(prompt=\"Can you summarize the main points of https://example.com/news/latest\")\n```\n\nCompare two articles:\n\n```\nweb_fetch(prompt=\"What are the differences in the conclusions of these two papers: https://arxiv.org/abs/2401.0001 and https://arxiv.org/abs/2401.0002?\")\n```\n\n## Important notes\n\n- **URL processing:** `web_fetch` relies on the Gemini API's ability to access\n  and process the given URLs.\n- **Output quality:** The quality of the output will depend on the clarity of\n  the instructions in the prompt.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/tools/memory.md","content":"# Memory tool (`save_memory`)\n\nThis document describes the `save_memory` tool for the Gemini CLI.\n\n## Description\n\nUse `save_memory` to save and recall information across your Gemini CLI\nsessions. With `save_memory`, you can direct the CLI to remember key details\nacross sessions, providing personalized and directed assistance.\n\n### Arguments\n\n`save_memory` takes one argument:\n\n- `fact` (string, required): The specific fact or piece of information to\n  remember. This should be a clear, self-contained statement written in natural\n  language.\n\n## How to use `save_memory` with the Gemini CLI\n\nThe tool appends the provided `fact` to a special `GEMINI.md` file located in\nthe user's home directory (`~/.gemini/GEMINI.md`). This file can be configured\nto have a different name.\n\nOnce added, the facts are stored under a `## Gemini Added Memories` section.\nThis file is loaded as context in subsequent sessions, allowing the CLI to\nrecall the saved information.\n\nUsage:\n\n```\nsave_memory(fact=\"Your fact here.\")\n```\n\n### `save_memory` examples\n\nRemember a user preference:\n\n```\nsave_memory(fact=\"My preferred programming language is Python.\")\n```\n\nStore a project-specific detail:\n\n```\nsave_memory(fact=\"The project I'm currently working on is called 'gemini-cli'.\")\n```\n\n## Important notes\n\n- **General usage:** This tool should be used for concise, important facts. It\n  is not intended for storing large amounts of data or conversational history.\n- **Memory file:** The memory file is a plain text Markdown file, so you can\n  view and edit it manually if needed.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/tools/file-system.md","content":"# Gemini CLI file system tools\n\nThe Gemini CLI provides a comprehensive suite of tools for interacting with the\nlocal file system. These tools allow the Gemini model to read from, write to,\nlist, search, and modify files and directories, all under your control and\ntypically with confirmation for sensitive operations.\n\n**Note:** All file system tools operate within a `rootDirectory` (usually the\ncurrent working directory where you launched the CLI) for security. Paths that\nyou provide to these tools are generally expected to be absolute or are resolved\nrelative to this root directory.\n\n## 1. `list_directory` (ReadFolder)\n\n`list_directory` lists the names of files and subdirectories directly within a\nspecified directory path. It can optionally ignore entries matching provided\nglob patterns.\n\n- **Tool name:** `list_directory`\n- **Display name:** ReadFolder\n- **File:** `ls.ts`\n- **Parameters:**\n  - `path` (string, required): The absolute path to the directory to list.\n  - `ignore` (array of strings, optional): A list of glob patterns to exclude\n    from the listing (e.g., `[\"*.log\", \".git\"]`).\n  - `respect_git_ignore` (boolean, optional): Whether to respect `.gitignore`\n    patterns when listing files. Defaults to `true`.\n- **Behavior:**\n  - Returns a list of file and directory names.\n  - Indicates whether each entry is a directory.\n  - Sorts entries with directories first, then alphabetically.\n- **Output (`llmContent`):** A string like:\n  `Directory listing for /path/to/your/folder:\\n[DIR] subfolder1\\nfile1.txt\\nfile2.png`\n- **Confirmation:** No.\n\n## 2. `read_file` (ReadFile)\n\n`read_file` reads and returns the content of a specified file. This tool handles\ntext, images (PNG, JPG, GIF, WEBP, SVG, BMP), audio files (MP3, WAV, AIFF, AAC,\nOGG, FLAC), and PDF files. For text files, it can read specific line ranges.\nOther binary file types are generally skipped.\n\n- **Tool name:** `read_file`\n- **Display name:** ReadFile\n- **File:** `read-file.ts`\n- **Parameters:**\n  - `path` (string, required): The absolute path to the file to read.\n  - `offset` (number, optional): For text files, the 0-based line number to\n    start reading from. Requires `limit` to be set.\n  - `limit` (number, optional): For text files, the maximum number of lines to\n    read. If omitted, reads a default maximum (e.g., 2000 lines) or the entire\n    file if feasible.\n- **Behavior:**\n  - For text files: Returns the content. If `offset` and `limit` are used,\n    returns only that slice of lines. Indicates if content was truncated due to\n    line limits or line length limits.\n  - For image, audio, and PDF files: Returns the file content as a\n    base64-encoded data structure suitable for model consumption.\n  - For other binary files: Attempts to identify and skip them, returning a\n    message indicating it's a generic binary file.\n- **Output:** (`llmContent`):\n  - For text files: The file content, potentially prefixed with a truncation\n    message (e.g.,\n    `[File content truncated: showing lines 1-100 of 500 total lines...]\\nActual file content...`).\n  - For image/audio/PDF files: An object containing `inlineData` with `mimeType`\n    and base64 `data` (e.g.,\n    `{ inlineData: { mimeType: 'image/png', data: 'base64encodedstring' } }`).\n  - For other binary files: A message like\n    `Cannot display content of binary file: /path/to/data.bin`.\n- **Confirmation:** No.\n\n## 3. `write_file` (WriteFile)\n\n`write_file` writes content to a specified file. If the file exists, it will be\noverwritten. If the file doesn't exist, it (and any necessary parent\ndirectories) will be created.\n\n- **Tool name:** `write_file`\n- **Display name:** WriteFile\n- **File:** `write-file.ts`\n- **Parameters:**\n  - `file_path` (string, required): The absolute path to the file to write to.\n  - `content` (string, required): The content to write into the file.\n- **Behavior:**\n  - Writes the provided `content` to the `file_path`.\n  - Creates parent directories if they don't exist.\n- **Output (`llmContent`):** A success message, e.g.,\n  `Successfully overwrote file: /path/to/your/file.txt` or\n  `Successfully created and wrote to new file: /path/to/new/file.txt`.\n- **Confirmation:** Yes. Shows a diff of changes and asks for user approval\n  before writing.\n\n## 4. `glob` (FindFiles)\n\n`glob` finds files matching specific glob patterns (e.g., `src/**/*.ts`,\n`*.md`), returning absolute paths sorted by modification time (newest first).\n\n- **Tool name:** `glob`\n- **Display name:** FindFiles\n- **File:** `glob.ts`\n- **Parameters:**\n  - `pattern` (string, required): The glob pattern to match against (e.g.,\n    `\"*.py\"`, `\"src/**/*.js\"`).\n  - `path` (string, optional): The absolute path to the directory to search\n    within. If omitted, searches the tool's root directory.\n  - `case_sensitive` (boolean, optional): Whether the search should be\n    case-sensitive. Defaults to `false`.\n  - `respect_git_ignore` (boolean, optional): Whether to respect .gitignore\n    patterns when finding files. Defaults to `true`.\n- **Behavior:**\n  - Searches for files matching the glob pattern within the specified directory.\n  - Returns a list of absolute paths, sorted with the most recently modified\n    files first.\n  - Ignores common nuisance directories like `node_modules` and `.git` by\n    default.\n- **Output (`llmContent`):** A message like:\n  `Found 5 file(s) matching \"*.ts\" within src, sorted by modification time (newest first):\\nsrc/file1.ts\\nsrc/subdir/file2.ts...`\n- **Confirmation:** No.\n\n## 5. `search_file_content` (SearchText)\n\n`search_file_content` searches for a regular expression pattern within the\ncontent of files in a specified directory. Can filter files by a glob pattern.\nReturns the lines containing matches, along with their file paths and line\nnumbers.\n\n- **Tool name:** `search_file_content`\n- **Display name:** SearchText\n- **File:** `grep.ts`\n- **Parameters:**\n  - `pattern` (string, required): The regular expression (regex) to search for\n    (e.g., `\"function\\s+myFunction\"`).\n  - `path` (string, optional): The absolute path to the directory to search\n    within. Defaults to the current working directory.\n  - `include` (string, optional): A glob pattern to filter which files are\n    searched (e.g., `\"*.js\"`, `\"src/**/*.{ts,tsx}\"`). If omitted, searches most\n    files (respecting common ignores).\n- **Behavior:**\n  - Uses `git grep` if available in a Git repository for speed; otherwise, falls\n    back to system `grep` or a JavaScript-based search.\n  - Returns a list of matching lines, each prefixed with its file path (relative\n    to the search directory) and line number.\n- **Output (`llmContent`):** A formatted string of matches, e.g.:\n  ```\n  Found 3 matches for pattern \"myFunction\" in path \".\" (filter: \"*.ts\"):\n  ---\n  File: src/utils.ts\n  L15: export function myFunction() {\n  L22:   myFunction.call();\n  ---\n  File: src/index.ts\n  L5: import { myFunction } from './utils';\n  ---\n  ```\n- **Confirmation:** No.\n\n## 6. `replace` (Edit)\n\n`replace` replaces text within a file. By default, replaces a single occurrence,\nbut can replace multiple occurrences when `expected_replacements` is specified.\nThis tool is designed for precise, targeted changes and requires significant\ncontext around the `old_string` to ensure it modifies the correct location.\n\n- **Tool name:** `replace`\n- **Display name:** Edit\n- **File:** `edit.ts`\n- **Parameters:**\n  - `file_path` (string, required): The absolute path to the file to modify.\n  - `old_string` (string, required): The exact literal text to replace.\n\n    **CRITICAL:** This string must uniquely identify the single instance to\n    change. It should include at least 3 lines of context _before_ and _after_\n    the target text, matching whitespace and indentation precisely. If\n    `old_string` is empty, the tool attempts to create a new file at `file_path`\n    with `new_string` as content.\n\n  - `new_string` (string, required): The exact literal text to replace\n    `old_string` with.\n  - `expected_replacements` (number, optional): The number of occurrences to\n    replace. Defaults to `1`.\n\n- **Behavior:**\n  - If `old_string` is empty and `file_path` does not exist, creates a new file\n    with `new_string` as content.\n  - If `old_string` is provided, it reads the `file_path` and attempts to find\n    exactly one occurrence of `old_string`.\n  - If one occurrence is found, it replaces it with `new_string`.\n  - **Enhanced reliability (multi-stage edit correction):** To significantly\n    improve the success rate of edits, especially when the model-provided\n    `old_string` might not be perfectly precise, the tool incorporates a\n    multi-stage edit correction mechanism.\n    - If the initial `old_string` isn't found or matches multiple locations, the\n      tool can leverage the Gemini model to iteratively refine `old_string` (and\n      potentially `new_string`).\n    - This self-correction process attempts to identify the unique segment the\n      model intended to modify, making the `replace` operation more robust even\n      with slightly imperfect initial context.\n- **Failure conditions:** Despite the correction mechanism, the tool will fail\n  if:\n  - `file_path` is not absolute or is outside the root directory.\n  - `old_string` is not empty, but the `file_path` does not exist.\n  - `old_string` is empty, but the `file_path` already exists.\n  - `old_string` is not found in the file after attempts to correct it.\n  - `old_string` is found multiple times, and the self-correction mechanism\n    cannot resolve it to a single, unambiguous match.\n- **Output (`llmContent`):**\n  - On success:\n    `Successfully modified file: /path/to/file.txt (1 replacements).` or\n    `Created new file: /path/to/new_file.txt with provided content.`\n  - On failure: An error message explaining the reason (e.g.,\n    `Failed to edit, 0 occurrences found...`,\n    `Failed to edit, expected 1 occurrences but found 2...`).\n- **Confirmation:** Yes. Shows a diff of the proposed changes and asks for user\n  approval before writing to the file.\n\nThese file system tools provide a foundation for the Gemini CLI to understand\nand interact with your local project context.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/tools/web-search.md","content":"# Web search tool (`google_web_search`)\n\nThis document describes the `google_web_search` tool.\n\n## Description\n\nUse `google_web_search` to perform a web search using Google Search via the\nGemini API. The `google_web_search` tool returns a summary of web results with\nsources.\n\n### Arguments\n\n`google_web_search` takes one argument:\n\n- `query` (string, required): The search query.\n\n## How to use `google_web_search` with the Gemini CLI\n\nThe `google_web_search` tool sends a query to the Gemini API, which then\nperforms a web search. `google_web_search` will return a generated response\nbased on the search results, including citations and sources.\n\nUsage:\n\n```\ngoogle_web_search(query=\"Your query goes here.\")\n```\n\n## `google_web_search` examples\n\nGet information on a topic:\n\n```\ngoogle_web_search(query=\"latest advancements in AI-powered code generation\")\n```\n\n## Important notes\n\n- **Response returned:** The `google_web_search` tool returns a processed\n  summary, not a raw list of search results.\n- **Citations:** The response includes citations to the sources used to generate\n  the summary.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/tools/shell.md","content":"# Shell tool (`run_shell_command`)\n\nThis document describes the `run_shell_command` tool for the Gemini CLI.\n\n## Description\n\nUse `run_shell_command` to interact with the underlying system, run scripts, or\nperform command-line operations. `run_shell_command` executes a given shell\ncommand, including interactive commands that require user input (e.g., `vim`,\n`git rebase -i`) if the `tools.shell.enableInteractiveShell` setting is set to\n`true`.\n\nOn Windows, commands are executed with `powershell.exe -NoProfile -Command`\n(unless you explicitly point `ComSpec` at another shell). On other platforms,\nthey are executed with `bash -c`.\n\n### Arguments\n\n`run_shell_command` takes the following arguments:\n\n- `command` (string, required): The exact shell command to execute.\n- `description` (string, optional): A brief description of the command's\n  purpose, which will be shown to the user.\n- `directory` (string, optional): The directory (relative to the project root)\n  in which to execute the command. If not provided, the command runs in the\n  project root.\n\n## How to use `run_shell_command` with the Gemini CLI\n\nWhen using `run_shell_command`, the command is executed as a subprocess.\n`run_shell_command` can start background processes using `&`. The tool returns\ndetailed information about the execution, including:\n\n- `Command`: The command that was executed.\n- `Directory`: The directory where the command was run.\n- `Stdout`: Output from the standard output stream.\n- `Stderr`: Output from the standard error stream.\n- `Error`: Any error message reported by the subprocess.\n- `Exit Code`: The exit code of the command.\n- `Signal`: The signal number if the command was terminated by a signal.\n- `Background PIDs`: A list of PIDs for any background processes started.\n\nUsage:\n\n```\nrun_shell_command(command=\"Your commands.\", description=\"Your description of the command.\", directory=\"Your execution directory.\")\n```\n\n## `run_shell_command` examples\n\nList files in the current directory:\n\n```\nrun_shell_command(command=\"ls -la\")\n```\n\nRun a script in a specific directory:\n\n```\nrun_shell_command(command=\"./my_script.sh\", directory=\"scripts\", description=\"Run my custom script\")\n```\n\nStart a background server:\n\n```\nrun_shell_command(command=\"npm run dev &\", description=\"Start development server in background\")\n```\n\n## Configuration\n\nYou can configure the behavior of the `run_shell_command` tool by modifying your\n`settings.json` file or by using the `/settings` command in the Gemini CLI.\n\n### Enabling interactive commands\n\nTo enable interactive commands, you need to set the\n`tools.shell.enableInteractiveShell` setting to `true`. This will use `node-pty`\nfor shell command execution, which allows for interactive sessions. If\n`node-pty` is not available, it will fall back to the `child_process`\nimplementation, which does not support interactive commands.\n\n**Example `settings.json`:**\n\n```json\n{\n  \"tools\": {\n    \"shell\": {\n      \"enableInteractiveShell\": true\n    }\n  }\n}\n```\n\n### Showing color in output\n\nTo show color in the shell output, you need to set the `tools.shell.showColor`\nsetting to `true`. **Note: This setting only applies when\n`tools.shell.enableInteractiveShell` is enabled.**\n\n**Example `settings.json`:**\n\n```json\n{\n  \"tools\": {\n    \"shell\": {\n      \"showColor\": true\n    }\n  }\n}\n```\n\n### Setting the pager\n\nYou can set a custom pager for the shell output by setting the\n`tools.shell.pager` setting. The default pager is `cat`. **Note: This setting\nonly applies when `tools.shell.enableInteractiveShell` is enabled.**\n\n**Example `settings.json`:**\n\n```json\n{\n  \"tools\": {\n    \"shell\": {\n      \"pager\": \"less\"\n    }\n  }\n}\n```\n\n## Interactive commands\n\nThe `run_shell_command` tool now supports interactive commands by integrating a\npseudo-terminal (pty). This allows you to run commands that require real-time\nuser input, such as text editors (`vim`, `nano`), terminal-based UIs (`htop`),\nand interactive version control operations (`git rebase -i`).\n\nWhen an interactive command is running, you can send input to it from the Gemini\nCLI. To focus on the interactive shell, press `ctrl+f`. The terminal output,\nincluding complex TUIs, will be rendered correctly.\n\n## Important notes\n\n- **Security:** Be cautious when executing commands, especially those\n  constructed from user input, to prevent security vulnerabilities.\n- **Error handling:** Check the `Stderr`, `Error`, and `Exit Code` fields to\n  determine if a command executed successfully.\n- **Background processes:** When a command is run in the background with `&`,\n  the tool will return immediately and the process will continue to run in the\n  background. The `Background PIDs` field will contain the process ID of the\n  background process.\n\n## Environment variables\n\nWhen `run_shell_command` executes a command, it sets the `GEMINI_CLI=1`\nenvironment variable in the subprocess's environment. This allows scripts or\ntools to detect if they are being run from within the Gemini CLI.\n\n## Command restrictions\n\nYou can restrict the commands that can be executed by the `run_shell_command`\ntool by using the `tools.core` and `tools.exclude` settings in your\nconfiguration file.\n\n- `tools.core`: To restrict `run_shell_command` to a specific set of commands,\n  add entries to the `core` list under the `tools` category in the format\n  `run_shell_command(<command>)`. For example,\n  `\"tools\": {\"core\": [\"run_shell_command(git)\"]}` will only allow `git`\n  commands. Including the generic `run_shell_command` acts as a wildcard,\n  allowing any command not explicitly blocked.\n- `tools.exclude`: To block specific commands, add entries to the `exclude` list\n  under the `tools` category in the format `run_shell_command(<command>)`. For\n  example, `\"tools\": {\"exclude\": [\"run_shell_command(rm)\"]}` will block `rm`\n  commands.\n\nThe validation logic is designed to be secure and flexible:\n\n1.  **Command chaining disabled**: The tool automatically splits commands\n    chained with `&&`, `||`, or `;` and validates each part separately. If any\n    part of the chain is disallowed, the entire command is blocked.\n2.  **Prefix matching**: The tool uses prefix matching. For example, if you\n    allow `git`, you can run `git status` or `git log`.\n3.  **Blocklist precedence**: The `tools.exclude` list is always checked first.\n    If a command matches a blocked prefix, it will be denied, even if it also\n    matches an allowed prefix in `tools.core`.\n\n### Command restriction examples\n\n**Allow only specific command prefixes**\n\nTo allow only `git` and `npm` commands, and block all others:\n\n```json\n{\n  \"tools\": {\n    \"core\": [\"run_shell_command(git)\", \"run_shell_command(npm)\"]\n  }\n}\n```\n\n- `git status`: Allowed\n- `npm install`: Allowed\n- `ls -l`: Blocked\n\n**Block specific command prefixes**\n\nTo block `rm` and allow all other commands:\n\n```json\n{\n  \"tools\": {\n    \"core\": [\"run_shell_command\"],\n    \"exclude\": [\"run_shell_command(rm)\"]\n  }\n}\n```\n\n- `rm -rf /`: Blocked\n- `git status`: Allowed\n- `npm install`: Allowed\n\n**Blocklist takes precedence**\n\nIf a command prefix is in both `tools.core` and `tools.exclude`, it will be\nblocked.\n\n```json\n{\n  \"tools\": {\n    \"core\": [\"run_shell_command(git)\"],\n    \"exclude\": [\"run_shell_command(git push)\"]\n  }\n}\n```\n\n- `git push origin main`: Blocked\n- `git status`: Allowed\n\n**Block all shell commands**\n\nTo block all shell commands, add the `run_shell_command` wildcard to\n`tools.exclude`:\n\n```json\n{\n  \"tools\": {\n    \"exclude\": [\"run_shell_command\"]\n  }\n}\n```\n\n- `ls -l`: Blocked\n- `any other command`: Blocked\n\n## Security note for `excludeTools`\n\nCommand-specific restrictions in `excludeTools` for `run_shell_command` are\nbased on simple string matching and can be easily bypassed. This feature is\n**not a security mechanism** and should not be relied upon to safely execute\nuntrusted code. It is recommended to use `coreTools` to explicitly select\ncommands that can be executed.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/tools/todos.md","content":"# Todo tool (`write_todos`)\n\nThis document describes the `write_todos` tool for the Gemini CLI.\n\n## Description\n\nThe `write_todos` tool allows the Gemini agent to create and manage a list of\nsubtasks for complex user requests. This provides you, the user, with greater\nvisibility into the agent's plan and its current progress. It also helps with\nalignment where the agent is less likely to lose track of its current goal.\n\n### Arguments\n\n`write_todos` takes one argument:\n\n- `todos` (array of objects, required): The complete list of todo items. This\n  replaces the existing list. Each item includes:\n  - `description` (string): The task description.\n  - `status` (string): The current status (`pending`, `in_progress`,\n    `completed`, or `cancelled`).\n\n## Behavior\n\nThe agent uses this tool to break down complex multi-step requests into a clear\nplan.\n\n- **Progress tracking:** The agent updates this list as it works, marking tasks\n  as `completed` when done.\n- **Single focus:** Only one task will be marked `in_progress` at a time,\n  indicating exactly what the agent is currently working on.\n- **Dynamic updates:** The plan may evolve as the agent discovers new\n  information, leading to new tasks being added or unnecessary ones being\n  cancelled.\n\nWhen active, the current `in_progress` task is displayed above the input box,\nkeeping you informed of the immediate action. You can toggle the full view of\nthe todo list at any time by pressing `Ctrl+T`.\n\nUsage example (internal representation):\n\n```javascript\nwrite_todos({\n  todos: [\n    { description: 'Initialize new React project', status: 'completed' },\n    { description: 'Implement state management', status: 'in_progress' },\n    { description: 'Create API service', status: 'pending' },\n  ],\n});\n```\n\n## Important notes\n\n- **Enabling:** This tool is enabled by default. You can disable it in your\n  `settings.json` file by setting `\"useWriteTodos\": false`.\n\n- **Intended use:** This tool is primarily used by the agent for complex,\n  multi-turn tasks. It is generally not used for simple, single-turn questions.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/tools/index.md","content":"# Gemini CLI tools\n\nThe Gemini CLI includes built-in tools that the Gemini model uses to interact\nwith your local environment, access information, and perform actions. These\ntools enhance the CLI's capabilities, enabling it to go beyond text generation\nand assist with a wide range of tasks.\n\n## Overview of Gemini CLI tools\n\nIn the context of the Gemini CLI, tools are specific functions or modules that\nthe Gemini model can request to be executed. For example, if you ask Gemini to\n\"Summarize the contents of `my_document.txt`,\" the model will likely identify\nthe need to read that file and will request the execution of the `read_file`\ntool.\n\nThe core component (`packages/core`) manages these tools, presents their\ndefinitions (schemas) to the Gemini model, executes them when requested, and\nreturns the results to the model for further processing into a user-facing\nresponse.\n\nThese tools provide the following capabilities:\n\n- **Access local information:** Tools allow Gemini to access your local file\n  system, read file contents, list directories, etc.\n- **Execute commands:** With tools like `run_shell_command`, Gemini can run\n  shell commands (with appropriate safety measures and user confirmation).\n- **Interact with the web:** Tools can fetch content from URLs.\n- **Take actions:** Tools can modify files, write new files, or perform other\n  actions on your system (again, typically with safeguards).\n- **Ground responses:** By using tools to fetch real-time or specific local\n  data, Gemini's responses can be more accurate, relevant, and grounded in your\n  actual context.\n\n## How to use Gemini CLI tools\n\nTo use Gemini CLI tools, provide a prompt to the Gemini CLI. The process works\nas follows:\n\n1.  You provide a prompt to the Gemini CLI.\n2.  The CLI sends the prompt to the core.\n3.  The core, along with your prompt and conversation history, sends a list of\n    available tools and their descriptions/schemas to the Gemini API.\n4.  The Gemini model analyzes your request. If it determines that a tool is\n    needed, its response will include a request to execute a specific tool with\n    certain parameters.\n5.  The core receives this tool request, validates it, and (often after user\n    confirmation for sensitive operations) executes the tool.\n6.  The output from the tool is sent back to the Gemini model.\n7.  The Gemini model uses the tool's output to formulate its final answer, which\n    is then sent back through the core to the CLI and displayed to you.\n\nYou will typically see messages in the CLI indicating when a tool is being\ncalled and whether it succeeded or failed.\n\n## Security and confirmation\n\nMany tools, especially those that can modify your file system or execute\ncommands (`write_file`, `edit`, `run_shell_command`), are designed with safety\nin mind. The Gemini CLI will typically:\n\n- **Require confirmation:** Prompt you before executing potentially sensitive\n  operations, showing you what action is about to be taken.\n- **Utilize sandboxing:** All tools are subject to restrictions enforced by\n  sandboxing (see [Sandboxing in the Gemini CLI](../cli/sandbox.md)). This means\n  that when operating in a sandbox, any tools (including MCP servers) you wish\n  to use must be available _inside_ the sandbox environment. For example, to run\n  an MCP server through `npx`, the `npx` executable must be installed within the\n  sandbox's Docker image or be available in the `sandbox-exec` environment.\n\nIt's important to always review confirmation prompts carefully before allowing a\ntool to proceed.\n\n## Learn more about Gemini CLI's tools\n\nGemini CLI's built-in tools can be broadly categorized as follows:\n\n- **[File System Tools](./file-system.md):** For interacting with files and\n  directories (reading, writing, listing, searching, etc.).\n- **[Shell Tool](./shell.md) (`run_shell_command`):** For executing shell\n  commands.\n- **[Web Fetch Tool](./web-fetch.md) (`web_fetch`):** For retrieving content\n  from URLs.\n- **[Web Search Tool](./web-search.md) (`google_web_search`):** For searching\n  the web.\n- **[Memory Tool](./memory.md) (`save_memory`):** For saving and recalling\n  information across sessions.\n- **[Todo Tool](./todos.md) (`write_todos`):** For managing subtasks of complex\n  requests.\n\nAdditionally, these tools incorporate:\n\n- **[MCP servers](./mcp-server.md)**: MCP servers act as a bridge between the\n  Gemini model and your local environment or other services like APIs.\n- **[Sandboxing](../cli/sandbox.md)**: Sandboxing isolates the model and its\n  changes from your environment to reduce potential risk.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/examples/proxy-script.md","content":"# Example proxy script\n\nThe following is an example of a proxy script that can be used with the\n`GEMINI_SANDBOX_PROXY_COMMAND` environment variable. This script only allows\n`HTTPS` connections to `example.com:443` and declines all other requests.\n\n```javascript\n#!/usr/bin/env node\n\n/**\n * @license\n * Copyright 2025 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Example proxy server that listens on :::8877 and only allows HTTPS connections to example.com.\n// Set `GEMINI_SANDBOX_PROXY_COMMAND=scripts/example-proxy.js` to run proxy alongside sandbox\n// Test via `curl https://example.com` inside sandbox (in shell mode or via shell tool)\n\nimport http from 'node:http';\nimport net from 'node:net';\nimport { URL } from 'node:url';\nimport console from 'node:console';\n\nconst PROXY_PORT = 8877;\nconst ALLOWED_DOMAINS = ['example.com', 'googleapis.com'];\nconst ALLOWED_PORT = '443';\n\nconst server = http.createServer((req, res) => {\n  // Deny all requests other than CONNECT for HTTPS\n  console.log(\n    `[PROXY] Denying non-CONNECT request for: ${req.method} ${req.url}`,\n  );\n  res.writeHead(405, { 'Content-Type': 'text/plain' });\n  res.end('Method Not Allowed');\n});\n\nserver.on('connect', (req, clientSocket, head) => {\n  // req.url will be in the format \"hostname:port\" for a CONNECT request.\n  const { port, hostname } = new URL(`http://${req.url}`);\n\n  console.log(`[PROXY] Intercepted CONNECT request for: ${hostname}:${port}`);\n\n  if (\n    ALLOWED_DOMAINS.some(\n      (domain) => hostname == domain || hostname.endsWith(`.${domain}`),\n    ) &&\n    port === ALLOWED_PORT\n  ) {\n    console.log(`[PROXY] Allowing connection to ${hostname}:${port}`);\n\n    // Establish a TCP connection to the original destination.\n    const serverSocket = net.connect(port, hostname, () => {\n      clientSocket.write('HTTP/1.1 200 Connection Established\\r\\n\\r\\n');\n      // Create a tunnel by piping data between the client and the destination server.\n      serverSocket.write(head);\n      serverSocket.pipe(clientSocket);\n      clientSocket.pipe(serverSocket);\n    });\n\n    serverSocket.on('error', (err) => {\n      console.error(`[PROXY] Error connecting to destination: ${err.message}`);\n      clientSocket.end(`HTTP/1.1 502 Bad Gateway\\r\\n\\r\\n`);\n    });\n  } else {\n    console.log(`[PROXY] Denying connection to ${hostname}:${port}`);\n    clientSocket.end('HTTP/1.1 403 Forbidden\\r\\n\\r\\n');\n  }\n\n  clientSocket.on('error', (err) => {\n    // This can happen if the client hangs up.\n    console.error(`[PROXY] Client socket error: ${err.message}`);\n  });\n});\n\nserver.listen(PROXY_PORT, () => {\n  const address = server.address();\n  console.log(`[PROXY] Proxy listening on ${address.address}:${address.port}`);\n  console.log(\n    `[PROXY] Allowing HTTPS connections to domains: ${ALLOWED_DOMAINS.join(', ')}`,\n  );\n});\n```\n"}
{"source":"github","repo":"gemini-cli","path":"docs/issue-and-pr-automation.md","content":"# Automation and triage processes\n\nThis document provides a detailed overview of the automated processes we use to\nmanage and triage issues and pull requests. Our goal is to provide prompt\nfeedback and ensure that contributions are reviewed and integrated efficiently.\nUnderstanding this automation will help you as a contributor know what to expect\nand how to best interact with our repository bots.\n\n## Guiding principle: Issues and pull requests\n\nFirst and foremost, almost every Pull Request (PR) should be linked to a\ncorresponding Issue. The issue describes the \"what\" and the \"why\" (the bug or\nfeature), while the PR is the \"how\" (the implementation). This separation helps\nus track work, prioritize features, and maintain clear historical context. Our\nautomation is built around this principle.\n\n---\n\n## Detailed automation workflows\n\nHere is a breakdown of the specific automation workflows that run in our\nrepository.\n\n### 1. When you open an issue: `Automated Issue Triage`\n\nThis is the first bot you will interact with when you create an issue. Its job\nis to perform an initial analysis and apply the correct labels.\n\n- **Workflow File**: `.github/workflows/gemini-automated-issue-triage.yml`\n- **When it runs**: Immediately after an issue is created or reopened.\n- **What it does**:\n  - It uses a Gemini model to analyze the issue's title and body against a\n    detailed set of guidelines.\n  - **Applies one `area/*` label**: Categorizes the issue into a functional area\n    of the project (e.g., `area/ux`, `area/models`, `area/platform`).\n  - **Applies one `kind/*` label**: Identifies the type of issue (e.g.,\n    `kind/bug`, `kind/enhancement`, `kind/question`).\n  - **Applies one `priority/*` label**: Assigns a priority from P0 (critical) to\n    P3 (low) based on the described impact.\n  - **May apply `status/need-information`**: If the issue lacks critical details\n    (like logs or reproduction steps), it will be flagged for more information.\n  - **May apply `status/need-retesting`**: If the issue references a CLI version\n    that is more than six versions old, it will be flagged for retesting on a\n    current version.\n- **What you should do**:\n  - Fill out the issue template as completely as possible. The more detail you\n    provide, the more accurate the triage will be.\n  - If the `status/need-information` label is added, please provide the\n    requested details in a comment.\n\n### 2. When you open a pull request: `Continuous Integration (CI)`\n\nThis workflow ensures that all changes meet our quality standards before they\ncan be merged.\n\n- **Workflow File**: `.github/workflows/ci.yml`\n- **When it runs**: On every push to a pull request.\n- **What it does**:\n  - **Lint**: Checks that your code adheres to our project's formatting and\n    style rules.\n  - **Test**: Runs our full suite of automated tests across macOS, Windows, and\n    Linux, and on multiple Node.js versions. This is the most time-consuming\n    part of the CI process.\n  - **Post Coverage Comment**: After all tests have successfully passed, a bot\n    will post a comment on your PR. This comment provides a summary of how well\n    your changes are covered by tests.\n- **What you should do**:\n  - Ensure all CI checks pass. A green checkmark ‚úÖ will appear next to your\n    commit when everything is successful.\n  - If a check fails (a red \"X\" ‚ùå), click the \"Details\" link next to the failed\n    check to view the logs, identify the problem, and push a fix.\n\n### 3. Ongoing triage for pull requests: `PR Auditing and Label Sync`\n\nThis workflow runs periodically to ensure all open PRs are correctly linked to\nissues and have consistent labels.\n\n- **Workflow File**: `.github/workflows/gemini-scheduled-pr-triage.yml`\n- **When it runs**: Every 15 minutes on all open pull requests.\n- **What it does**:\n  - **Checks for a linked issue**: The bot scans your PR description for a\n    keyword that links it to an issue (e.g., `Fixes #123`, `Closes #456`).\n  - **Adds `status/need-issue`**: If no linked issue is found, the bot will add\n    the `status/need-issue` label to your PR. This is a clear signal that an\n    issue needs to be created and linked.\n  - **Synchronizes labels**: If an issue _is_ linked, the bot ensures the PR's\n    labels perfectly match the issue's labels. It will add any missing labels\n    and remove any that don't belong, and it will remove the `status/need-issue`\n    label if it was present.\n- **What you should do**:\n  - **Always link your PR to an issue.** This is the most important step. Add a\n    line like `Resolves #<issue-number>` to your PR description.\n  - This will ensure your PR is correctly categorized and moves through the\n    review process smoothly.\n\n### 4. Ongoing triage for issues: `Scheduled Issue Triage`\n\nThis is a fallback workflow to ensure that no issue gets missed by the triage\nprocess.\n\n- **Workflow File**: `.github/workflows/gemini-scheduled-issue-triage.yml`\n- **When it runs**: Every hour on all open issues.\n- **What it does**:\n  - It actively seeks out issues that either have no labels at all or still have\n    the `status/need-triage` label.\n  - It then triggers the same powerful Gemini-based analysis as the initial\n    triage bot to apply the correct labels.\n- **What you should do**:\n  - You typically don't need to do anything. This workflow is a safety net to\n    ensure every issue is eventually categorized, even if the initial triage\n    fails.\n\n### 5. Release automation\n\nThis workflow handles the process of packaging and publishing new versions of\nthe Gemini CLI.\n\n- **Workflow File**: `.github/workflows/release-manual.yml`\n- **When it runs**: On a daily schedule for \"nightly\" releases, and manually for\n  official patch/minor releases.\n- **What it does**:\n  - Automatically builds the project, bumps the version numbers, and publishes\n    the packages to npm.\n  - Creates a corresponding release on GitHub with generated release notes.\n- **What you should do**:\n  - As a contributor, you don't need to do anything for this process. You can be\n    confident that once your PR is merged into the `main` branch, your changes\n    will be included in the very next nightly release.\n\nWe hope this detailed overview is helpful. If you have any questions about our\nautomation or processes, please don't hesitate to ask!\n"}
{"source":"github","repo":"gemini-cli","path":"docs/cli/authentication.md","content":"# Authentication setup\n\nSee: [Getting Started - Authentication Setup](../get-started/authentication.md).\n"}
{"source":"github","repo":"gemini-cli","path":"docs/cli/gemini-md.md","content":"# Provide context with GEMINI.md files\n\nContext files, which use the default name `GEMINI.md`, are a powerful feature\nfor providing instructional context to the Gemini model. You can use these files\nto give project-specific instructions, define a persona, or provide coding style\nguides to make the AI's responses more accurate and tailored to your needs.\n\nInstead of repeating instructions in every prompt, you can define them once in a\ncontext file.\n\n## Understand the context hierarchy\n\nThe CLI uses a hierarchical system to source context. It loads various context\nfiles from several locations, concatenates the contents of all found files, and\nsends them to the model with every prompt. The CLI loads files in the following\norder:\n\n1.  **Global context file:**\n    - **Location:** `~/.gemini/GEMINI.md` (in your user home directory).\n    - **Scope:** Provides default instructions for all your projects.\n\n2.  **Project root and ancestor context files:**\n    - **Location:** The CLI searches for a `GEMINI.md` file in your current\n      working directory and then in each parent directory up to the project root\n      (identified by a `.git` folder).\n    - **Scope:** Provides context relevant to the entire project.\n\n3.  **Sub-directory context files:**\n    - **Location:** The CLI also scans for `GEMINI.md` files in subdirectories\n      below your current working directory. It respects rules in `.gitignore`\n      and `.geminiignore`.\n    - **Scope:** Lets you write highly specific instructions for a particular\n      component or module.\n\nThe CLI footer displays the number of loaded context files, which gives you a\nquick visual cue of the active instructional context.\n\n### Example `GEMINI.md` file\n\nHere is an example of what you can include in a `GEMINI.md` file at the root of\na TypeScript project:\n\n```markdown\n# Project: My TypeScript Library\n\n## General Instructions\n\n- When you generate new TypeScript code, follow the existing coding style.\n- Ensure all new functions and classes have JSDoc comments.\n- Prefer functional programming paradigms where appropriate.\n\n## Coding Style\n\n- Use 2 spaces for indentation.\n- Prefix interface names with `I` (for example, `IUserService`).\n- Always use strict equality (`===` and `!==`).\n```\n\n## Manage context with the `/memory` command\n\nYou can interact with the loaded context files by using the `/memory` command.\n\n- **`/memory show`**: Displays the full, concatenated content of the current\n  hierarchical memory. This lets you inspect the exact instructional context\n  being provided to the model.\n- **`/memory refresh`**: Forces a re-scan and reload of all `GEMINI.md` files\n  from all configured locations.\n- **`/memory add <text>`**: Appends your text to your global\n  `~/.gemini/GEMINI.md` file. This lets you add persistent memories on the fly.\n\n## Modularize context with imports\n\nYou can break down large `GEMINI.md` files into smaller, more manageable\ncomponents by importing content from other files using the `@file.md` syntax.\nThis feature supports both relative and absolute paths.\n\n**Example `GEMINI.md` with imports:**\n\n```markdown\n# Main GEMINI.md file\n\nThis is the main content.\n\n@./components/instructions.md\n\nMore content here.\n\n@../shared/style-guide.md\n```\n\nFor more details, see the [Memory Import Processor](../core/memport.md)\ndocumentation.\n\n## Customize the context file name\n\nWhile `GEMINI.md` is the default filename, you can configure this in your\n`settings.json` file. To specify a different name or a list of names, use the\n`context.fileName` property.\n\n**Example `settings.json`:**\n\n```json\n{\n  \"context\": {\n    \"fileName\": [\"AGENTS.md\", \"CONTEXT.md\", \"GEMINI.md\"]\n  }\n}\n```\n"}
{"source":"github","repo":"gemini-cli","path":"docs/cli/model-routing.md","content":"## Model routing\n\nGemini CLI includes a model routing feature that automatically switches to a\nfallback model in case of a model failure. This feature is enabled by default\nand provides resilience when the primary model is unavailable.\n\n## How it works\n\nModel routing is not based on prompt complexity, but is a fallback mechanism.\nHere's how it works:\n\n1.  **Model failure:** If the currently selected model fails to respond (for\n    example, due to a server error or other issue), the CLI will initiate the\n    fallback process.\n\n2.  **User consent:** The CLI will prompt you to ask if you want to switch to\n    the fallback model. This is handled by the `fallbackModelHandler`.\n\n3.  **Fallback activation:** If you consent, the CLI will activate the fallback\n    mode by calling `config.setFallbackMode(true)`.\n\n4.  **Model switch:** On the next request, the CLI will use the\n    `DEFAULT_GEMINI_FLASH_MODEL` as the fallback model. This is handled by the\n    `resolveModel` function in\n    `packages/cli/src/zed-integration/zedIntegration.ts` which checks if\n    `isInFallbackMode()` is true.\n\n### Model selection precedence\n\nThe model used by Gemini CLI is determined by the following order of precedence:\n\n1.  **`--model` command-line flag:** A model specified with the `--model` flag\n    when launching the CLI will always be used.\n2.  **`GEMINI_MODEL` environment variable:** If the `--model` flag is not used,\n    the CLI will use the model specified in the `GEMINI_MODEL` environment\n    variable.\n3.  **`model.name` in `settings.json`:** If neither of the above are set, the\n    model specified in the `model.name` property of your `settings.json` file\n    will be used.\n4.  **Default model:** If none of the above are set, the default model will be\n    used. The default model is `auto`\n"}
{"source":"github","repo":"gemini-cli","path":"docs/cli/model.md","content":"# Gemini CLI model selection (`/model` command)\n\nSelect your Gemini CLI model. The `/model` command opens a dialog where you can\nconfigure the model used by Gemini CLI, giving you more control over your\nresults.\n\n**Note:** The `/model` command (and the `--model` flag) does not override the\nmodel used by sub-agents. Consequently, even when using the `/model` flag you\nmay see other models used in your model usage reports.\n\n## How to use the `/model` command\n\nUse the following command in Gemini CLI:\n\n```\n/model\n```\n\nRunning this command will open a dialog with your model options:\n\n| Option             | Description                                                   | Models                                                                                     |\n| ------------------ | ------------------------------------------------------------- | ------------------------------------------------------------------------------------------ |\n| Auto (recommended) | Let the system choose the best model for your task.           | gemini-3-pro-preview (if enabled), gemini-2.5-pro, gemini-2.5-flash, gemini-2.5-flash-lite |\n| Pro                | For complex tasks that require deep reasoning and creativity. | gemini-3-pro-preview (if enabled), gemini-2.5-pro                                          |\n| Flash              | For tasks that need a balance of speed and reasoning.         | gemini-2.5-flash                                                                           |\n| Flash-Lite         | For simple tasks that need to be done quickly.                | gemini-2.5-flash-lite                                                                      |\n\n### Gemini 3 Pro and preview features\n\nNote: Gemini 3 is not currently available on all account types. To learn more\nabout Gemini 3 access, refer to\n[Gemini 3 Pro on Gemini CLI](../get-started/gemini-3.md).\n\nTo enable Gemini 3 Pro (if available), enable\n[**Preview features** by using the `settings` command](../cli/settings.md). Once\nenabled, Gemini CLI will attempt to use Gemini 3 Pro when you select **Auto** or\n**Pro**. Both **Auto** and **Pro** will try to use Gemini 3 Pro before falling\nback to Gemini 2.5 Pro.\n\nYou can also use the `--model` flag to specify a particular Gemini model on\nstartup. For more details, refer to the\n[configuration documentation](./configuration.md).\n\nChanges to these settings will be applied to all subsequent interactions with\nGemini CLI.\n\n## Best practices for model selection\n\n- **Default to Auto (recommended).** For most users, the _Auto (recommended)_\n  model provides a balance between speed and performance, automatically\n  selecting the correct model based on the complexity of the task. Example:\n  Developing a web application could include a mix of complex tasks (building\n  architecture and scaffolding the project) and simple tasks (generating CSS).\n\n- **Switch to Pro if you aren't getting the results you want.** If you think you\n  need your model to be a little \"smarter,\" use Pro. Pro will provide you with\n  the highest levels of reasoning and creativity. Example: A complex or\n  multi-stage debugging task.\n\n- **Switch to Flash or Flash-Lite if you need faster results.** If you need a\n  simple response quickly, Flash or Flash-Lite is the best option. Example:\n  Converting a JSON object to a YAML string.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/cli/gemini-ignore.md","content":"# Ignoring files\n\nThis document provides an overview of the Gemini Ignore (`.geminiignore`)\nfeature of the Gemini CLI.\n\nThe Gemini CLI includes the ability to automatically ignore files, similar to\n`.gitignore` (used by Git) and `.aiexclude` (used by Gemini Code Assist). Adding\npaths to your `.geminiignore` file will exclude them from tools that support\nthis feature, although they will still be visible to other services (such as\nGit).\n\n## How it works\n\nWhen you add a path to your `.geminiignore` file, tools that respect this file\nwill exclude matching files and directories from their operations. For example,\nwhen you use the `@` command to share files, any paths in your `.geminiignore`\nfile will be automatically excluded.\n\nFor the most part, `.geminiignore` follows the conventions of `.gitignore`\nfiles:\n\n- Blank lines and lines starting with `#` are ignored.\n- Standard glob patterns are supported (such as `*`, `?`, and `[]`).\n- Putting a `/` at the end will only match directories.\n- Putting a `/` at the beginning anchors the path relative to the\n  `.geminiignore` file.\n- `!` negates a pattern.\n\nYou can update your `.geminiignore` file at any time. To apply the changes, you\nmust restart your Gemini CLI session.\n\n## How to use `.geminiignore`\n\nTo enable `.geminiignore`:\n\n1. Create a file named `.geminiignore` in the root of your project directory.\n\nTo add a file or directory to `.geminiignore`:\n\n1. Open your `.geminiignore` file.\n2. Add the path or file you want to ignore, for example: `/archive/` or\n   `apikeys.txt`.\n\n### `.geminiignore` examples\n\nYou can use `.geminiignore` to ignore directories and files:\n\n```\n# Exclude your /packages/ directory and all subdirectories\n/packages/\n\n# Exclude your apikeys.txt file\napikeys.txt\n```\n\nYou can use wildcards in your `.geminiignore` file with `*`:\n\n```\n# Exclude all .md files\n*.md\n```\n\nFinally, you can exclude files and directories from exclusion with `!`:\n\n```\n# Exclude all .md files except README.md\n*.md\n!README.md\n```\n\nTo remove paths from your `.geminiignore` file, delete the relevant lines.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/cli/checkpointing.md","content":"# Checkpointing\n\nThe Gemini CLI includes a Checkpointing feature that automatically saves a\nsnapshot of your project's state before any file modifications are made by\nAI-powered tools. This allows you to safely experiment with and apply code\nchanges, knowing you can instantly revert back to the state before the tool was\nrun.\n\n## How it works\n\nWhen you approve a tool that modifies the file system (like `write_file` or\n`replace`), the CLI automatically creates a \"checkpoint.\" This checkpoint\nincludes:\n\n1.  **A Git snapshot:** A commit is made in a special, shadow Git repository\n    located in your home directory (`~/.gemini/history/<project_hash>`). This\n    snapshot captures the complete state of your project files at that moment.\n    It does **not** interfere with your own project's Git repository.\n2.  **Conversation history:** The entire conversation you've had with the agent\n    up to that point is saved.\n3.  **The tool call:** The specific tool call that was about to be executed is\n    also stored.\n\nIf you want to undo the change or simply go back, you can use the `/restore`\ncommand. Restoring a checkpoint will:\n\n- Revert all files in your project to the state captured in the snapshot.\n- Restore the conversation history in the CLI.\n- Re-propose the original tool call, allowing you to run it again, modify it, or\n  simply ignore it.\n\nAll checkpoint data, including the Git snapshot and conversation history, is\nstored locally on your machine. The Git snapshot is stored in the shadow\nrepository while the conversation history and tool calls are saved in a JSON\nfile in your project's temporary directory, typically located at\n`~/.gemini/tmp/<project_hash>/checkpoints`.\n\n## Enabling the feature\n\nThe Checkpointing feature is disabled by default. To enable it, you need to edit\nyour `settings.json` file.\n\n> **Note:** The `--checkpointing` command-line flag was removed in version\n> 0.11.0. Checkpointing can now only be enabled through the `settings.json`\n> configuration file.\n\nAdd the following key to your `settings.json`:\n\n```json\n{\n  \"general\": {\n    \"checkpointing\": {\n      \"enabled\": true\n    }\n  }\n}\n```\n\n## Using the `/restore` command\n\nOnce enabled, checkpoints are created automatically. To manage them, you use the\n`/restore` command.\n\n### List available checkpoints\n\nTo see a list of all saved checkpoints for the current project, simply run:\n\n```\n/restore\n```\n\nThe CLI will display a list of available checkpoint files. These file names are\ntypically composed of a timestamp, the name of the file being modified, and the\nname of the tool that was about to be run (e.g.,\n`2025-06-22T10-00-00_000Z-my-file.txt-write_file`).\n\n### Restore a specific checkpoint\n\nTo restore your project to a specific checkpoint, use the checkpoint file from\nthe list:\n\n```\n/restore <checkpoint_file>\n```\n\nFor example:\n\n```\n/restore 2025-06-22T10-00-00_000Z-my-file.txt-write_file\n```\n\nAfter running the command, your files and conversation will be immediately\nrestored to the state they were in when the checkpoint was created, and the\noriginal tool prompt will reappear.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/cli/themes.md","content":"# Themes\n\nGemini CLI supports a variety of themes to customize its color scheme and\nappearance. You can change the theme to suit your preferences via the `/theme`\ncommand or `\"theme\":` configuration setting.\n\n## Available themes\n\nGemini CLI comes with a selection of pre-defined themes, which you can list\nusing the `/theme` command within Gemini CLI:\n\n- **Dark themes:**\n  - `ANSI`\n  - `Atom One`\n  - `Ayu`\n  - `Default`\n  - `Dracula`\n  - `GitHub`\n- **Light themes:**\n  - `ANSI Light`\n  - `Ayu Light`\n  - `Default Light`\n  - `GitHub Light`\n  - `Google Code`\n  - `Xcode`\n\n### Changing themes\n\n1.  Enter `/theme` into Gemini CLI.\n2.  A dialog or selection prompt appears, listing the available themes.\n3.  Using the arrow keys, select a theme. Some interfaces might offer a live\n    preview or highlight as you select.\n4.  Confirm your selection to apply the theme.\n\n**Note:** If a theme is defined in your `settings.json` file (either by name or\nby a file path), you must remove the `\"theme\"` setting from the file before you\ncan change the theme using the `/theme` command.\n\n### Theme persistence\n\nSelected themes are saved in Gemini CLI's\n[configuration](../get-started/configuration.md) so your preference is\nremembered across sessions.\n\n---\n\n## Custom color themes\n\nGemini CLI allows you to create your own custom color themes by specifying them\nin your `settings.json` file. This gives you full control over the color palette\nused in the CLI.\n\n### How to define a custom theme\n\nAdd a `customThemes` block to your user, project, or system `settings.json`\nfile. Each custom theme is defined as an object with a unique name and a set of\ncolor keys. For example:\n\n```json\n{\n  \"ui\": {\n    \"customThemes\": {\n      \"MyCustomTheme\": {\n        \"name\": \"MyCustomTheme\",\n        \"type\": \"custom\",\n        \"Background\": \"#181818\",\n        ...\n      }\n    }\n  }\n}\n```\n\n**Color keys:**\n\n- `Background`\n- `Foreground`\n- `LightBlue`\n- `AccentBlue`\n- `AccentPurple`\n- `AccentCyan`\n- `AccentGreen`\n- `AccentYellow`\n- `AccentRed`\n- `Comment`\n- `Gray`\n- `DiffAdded` (optional, for added lines in diffs)\n- `DiffRemoved` (optional, for removed lines in diffs)\n- `DiffModified` (optional, for modified lines in diffs)\n\nYou can also override individual UI text roles by adding a nested `text` object.\nThis object supports the keys `primary`, `secondary`, `link`, `accent`, and\n`response`. When `text.response` is provided it takes precedence over\n`text.primary` for rendering model responses in chat.\n\n**Required properties:**\n\n- `name` (must match the key in the `customThemes` object and be a string)\n- `type` (must be the string `\"custom\"`)\n- `Background`\n- `Foreground`\n- `LightBlue`\n- `AccentBlue`\n- `AccentPurple`\n- `AccentCyan`\n- `AccentGreen`\n- `AccentYellow`\n- `AccentRed`\n- `Comment`\n- `Gray`\n\nYou can use either hex codes (e.g., `#FF0000`) **or** standard CSS color names\n(e.g., `coral`, `teal`, `blue`) for any color value. See\n[CSS color names](https://developer.mozilla.org/en-US/docs/Web/CSS/color_value#color_keywords)\nfor a full list of supported names.\n\nYou can define multiple custom themes by adding more entries to the\n`customThemes` object.\n\n### Loading themes from a file\n\nIn addition to defining custom themes in `settings.json`, you can also load a\ntheme directly from a JSON file by specifying the file path in your\n`settings.json`. This is useful for sharing themes or keeping them separate from\nyour main configuration.\n\nTo load a theme from a file, set the `theme` property in your `settings.json` to\nthe path of your theme file:\n\n```json\n{\n  \"ui\": {\n    \"theme\": \"/path/to/your/theme.json\"\n  }\n}\n```\n\nThe theme file must be a valid JSON file that follows the same structure as a\ncustom theme defined in `settings.json`.\n\n**Example `my-theme.json`:**\n\n```json\n{\n  \"name\": \"My File Theme\",\n  \"type\": \"custom\",\n  \"Background\": \"#282A36\",\n  \"Foreground\": \"#F8F8F2\",\n  \"LightBlue\": \"#82AAFF\",\n  \"AccentBlue\": \"#61AFEF\",\n  \"AccentPurple\": \"#BD93F9\",\n  \"AccentCyan\": \"#8BE9FD\",\n  \"AccentGreen\": \"#50FA7B\",\n  \"AccentYellow\": \"#F1FA8C\",\n  \"AccentRed\": \"#FF5555\",\n  \"Comment\": \"#6272A4\",\n  \"Gray\": \"#ABB2BF\",\n  \"DiffAdded\": \"#A6E3A1\",\n  \"DiffRemoved\": \"#F38BA8\",\n  \"DiffModified\": \"#89B4FA\",\n  \"GradientColors\": [\"#4796E4\", \"#847ACE\", \"#C3677F\"]\n}\n```\n\n**Security note:** For your safety, Gemini CLI will only load theme files that\nare located within your home directory. If you attempt to load a theme from\noutside your home directory, a warning will be displayed and the theme will not\nbe loaded. This is to prevent loading potentially malicious theme files from\nuntrusted sources.\n\n### Example custom theme\n\n<img src=\"../assets/theme-custom.png\" alt=\"Custom theme example\" width=\"600\" />\n\n### Using your custom theme\n\n- Select your custom theme using the `/theme` command in Gemini CLI. Your custom\n  theme will appear in the theme selection dialog.\n- Or, set it as the default by adding `\"theme\": \"MyCustomTheme\"` to the `ui`\n  object in your `settings.json`.\n- Custom themes can be set at the user, project, or system level, and follow the\n  same [configuration precedence](../get-started/configuration.md) as other\n  settings.\n\n---\n\n## Dark themes\n\n### ANSI\n\n<img src=\"/assets/theme-ansi.png\" alt=\"ANSI theme\" width=\"600\" />\n\n### Atom OneDark\n\n<img src=\"/assets/theme-atom-one.png\" alt=\"Atom One theme\" width=\"600\">\n\n### Ayu\n\n<img src=\"/assets/theme-ayu.png\" alt=\"Ayu theme\" width=\"600\">\n\n### Default\n\n<img src=\"/assets/theme-default.png\" alt=\"Default theme\" width=\"600\">\n\n### Dracula\n\n<img src=\"/assets/theme-dracula.png\" alt=\"Dracula theme\" width=\"600\">\n\n### GitHub\n\n<img src=\"/assets/theme-github.png\" alt=\"GitHub theme\" width=\"600\">\n\n## Light themes\n\n### ANSI Light\n\n<img src=\"/assets/theme-ansi-light.png\" alt=\"ANSI Light theme\" width=\"600\">\n\n### Ayu Light\n\n<img src=\"/assets/theme-ayu-light.png\" alt=\"Ayu Light theme\" width=\"600\">\n\n### Default Light\n\n<img src=\"/assets/theme-default-light.png\" alt=\"Default Light theme\" width=\"600\">\n\n### GitHub Light\n\n<img src=\"/assets/theme-github-light.png\" alt=\"GitHub Light theme\" width=\"600\">\n\n### Google Code\n\n<img src=\"/assets/theme-google-light.png\" alt=\"Google Code theme\" width=\"600\">\n\n### Xcode\n\n<img src=\"/assets/theme-xcode-light.png\" alt=\"Xcode Light theme\" width=\"600\">\n"}
{"source":"github","repo":"gemini-cli","path":"docs/cli/headless.md","content":"# Headless mode\n\nHeadless mode allows you to run Gemini CLI programmatically from command line\nscripts and automation tools without any interactive UI. This is ideal for\nscripting, automation, CI/CD pipelines, and building AI-powered tools.\n\n- [Headless Mode](#headless-mode)\n  - [Overview](#overview)\n  - [Basic Usage](#basic-usage)\n    - [Direct Prompts](#direct-prompts)\n    - [Stdin Input](#stdin-input)\n    - [Combining with File Input](#combining-with-file-input)\n  - [Output Formats](#output-formats)\n    - [Text Output (Default)](#text-output-default)\n    - [JSON Output](#json-output)\n      - [Response Schema](#response-schema)\n      - [Example Usage](#example-usage)\n    - [Streaming JSON Output](#streaming-json-output)\n      - [When to Use Streaming JSON](#when-to-use-streaming-json)\n      - [Event Types](#event-types)\n      - [Basic Usage](#basic-usage)\n      - [Example Output](#example-output)\n      - [Processing Stream Events](#processing-stream-events)\n      - [Real-World Examples](#real-world-examples)\n    - [File Redirection](#file-redirection)\n  - [Configuration Options](#configuration-options)\n  - [Examples](#examples)\n    - [Code review](#code-review)\n    - [Generate commit messages](#generate-commit-messages)\n    - [API documentation](#api-documentation)\n    - [Batch code analysis](#batch-code-analysis)\n    - [Code review](#code-review-1)\n    - [Log analysis](#log-analysis)\n    - [Release notes generation](#release-notes-generation)\n    - [Model and tool usage tracking](#model-and-tool-usage-tracking)\n  - [Resources](#resources)\n\n## Overview\n\nThe headless mode provides a headless interface to Gemini CLI that:\n\n- Accepts prompts via command line arguments or stdin\n- Returns structured output (text or JSON)\n- Supports file redirection and piping\n- Enables automation and scripting workflows\n- Provides consistent exit codes for error handling\n\n## Basic usage\n\n### Direct prompts\n\nUse the `--prompt` (or `-p`) flag to run in headless mode:\n\n```bash\ngemini --prompt \"What is machine learning?\"\n```\n\n### Stdin input\n\nPipe input to Gemini CLI from your terminal:\n\n```bash\necho \"Explain this code\" | gemini\n```\n\n### Combining with file input\n\nRead from files and process with Gemini:\n\n```bash\ncat README.md | gemini --prompt \"Summarize this documentation\"\n```\n\n## Output formats\n\n### Text output (default)\n\nStandard human-readable output:\n\n```bash\ngemini -p \"What is the capital of France?\"\n```\n\nResponse format:\n\n```\nThe capital of France is Paris.\n```\n\n### JSON output\n\nReturns structured data including response, statistics, and metadata. This\nformat is ideal for programmatic processing and automation scripts.\n\n#### Response schema\n\nThe JSON output follows this high-level structure:\n\n```json\n{\n  \"response\": \"string\", // The main AI-generated content answering your prompt\n  \"stats\": {\n    // Usage metrics and performance data\n    \"models\": {\n      // Per-model API and token usage statistics\n      \"[model-name]\": {\n        \"api\": {\n          /* request counts, errors, latency */\n        },\n        \"tokens\": {\n          /* prompt, response, cached, total counts */\n        }\n      }\n    },\n    \"tools\": {\n      // Tool execution statistics\n      \"totalCalls\": \"number\",\n      \"totalSuccess\": \"number\",\n      \"totalFail\": \"number\",\n      \"totalDurationMs\": \"number\",\n      \"totalDecisions\": {\n        /* accept, reject, modify, auto_accept counts */\n      },\n      \"byName\": {\n        /* per-tool detailed stats */\n      }\n    },\n    \"files\": {\n      // File modification statistics\n      \"totalLinesAdded\": \"number\",\n      \"totalLinesRemoved\": \"number\"\n    }\n  },\n  \"error\": {\n    // Present only when an error occurred\n    \"type\": \"string\", // Error type (e.g., \"ApiError\", \"AuthError\")\n    \"message\": \"string\", // Human-readable error description\n    \"code\": \"number\" // Optional error code\n  }\n}\n```\n\n#### Example usage\n\n```bash\ngemini -p \"What is the capital of France?\" --output-format json\n```\n\nResponse:\n\n```json\n{\n  \"response\": \"The capital of France is Paris.\",\n  \"stats\": {\n    \"models\": {\n      \"gemini-2.5-pro\": {\n        \"api\": {\n          \"totalRequests\": 2,\n          \"totalErrors\": 0,\n          \"totalLatencyMs\": 5053\n        },\n        \"tokens\": {\n          \"prompt\": 24939,\n          \"candidates\": 20,\n          \"total\": 25113,\n          \"cached\": 21263,\n          \"thoughts\": 154,\n          \"tool\": 0\n        }\n      },\n      \"gemini-2.5-flash\": {\n        \"api\": {\n          \"totalRequests\": 1,\n          \"totalErrors\": 0,\n          \"totalLatencyMs\": 1879\n        },\n        \"tokens\": {\n          \"prompt\": 8965,\n          \"candidates\": 10,\n          \"total\": 9033,\n          \"cached\": 0,\n          \"thoughts\": 30,\n          \"tool\": 28\n        }\n      }\n    },\n    \"tools\": {\n      \"totalCalls\": 1,\n      \"totalSuccess\": 1,\n      \"totalFail\": 0,\n      \"totalDurationMs\": 1881,\n      \"totalDecisions\": {\n        \"accept\": 0,\n        \"reject\": 0,\n        \"modify\": 0,\n        \"auto_accept\": 1\n      },\n      \"byName\": {\n        \"google_web_search\": {\n          \"count\": 1,\n          \"success\": 1,\n          \"fail\": 0,\n          \"durationMs\": 1881,\n          \"decisions\": {\n            \"accept\": 0,\n            \"reject\": 0,\n            \"modify\": 0,\n            \"auto_accept\": 1\n          }\n        }\n      }\n    },\n    \"files\": {\n      \"totalLinesAdded\": 0,\n      \"totalLinesRemoved\": 0\n    }\n  }\n}\n```\n\n### Streaming JSON output\n\nReturns real-time events as newline-delimited JSON (JSONL). Each significant\naction (initialization, messages, tool calls, results) emits immediately as it\noccurs. This format is ideal for monitoring long-running operations, building\nUIs with live progress, and creating automation pipelines that react to events.\n\n#### When to use streaming JSON\n\nUse `--output-format stream-json` when you need:\n\n- **Real-time progress monitoring** - See tool calls and responses as they\n  happen\n- **Event-driven automation** - React to specific events (e.g., tool failures)\n- **Live UI updates** - Build interfaces showing AI agent activity in real-time\n- **Detailed execution logs** - Capture complete interaction history with\n  timestamps\n- **Pipeline integration** - Stream events to logging/monitoring systems\n\n#### Event types\n\nThe streaming format emits 6 event types:\n\n1. **`init`** - Session starts (includes session_id, model)\n2. **`message`** - User prompts and assistant responses\n3. **`tool_use`** - Tool call requests with parameters\n4. **`tool_result`** - Tool execution results (success/error)\n5. **`error`** - Non-fatal errors and warnings\n6. **`result`** - Final session outcome with aggregated stats\n\n#### Basic usage\n\n```bash\n# Stream events to console\ngemini --output-format stream-json --prompt \"What is 2+2?\"\n\n# Save event stream to file\ngemini --output-format stream-json --prompt \"Analyze this code\" > events.jsonl\n\n# Parse with jq\ngemini --output-format stream-json --prompt \"List files\" | jq -r '.type'\n```\n\n#### Example output\n\nEach line is a complete JSON event:\n\n```jsonl\n{\"type\":\"init\",\"timestamp\":\"2025-10-10T12:00:00.000Z\",\"session_id\":\"abc123\",\"model\":\"gemini-2.0-flash-exp\"}\n{\"type\":\"message\",\"role\":\"user\",\"content\":\"List files in current directory\",\"timestamp\":\"2025-10-10T12:00:01.000Z\"}\n{\"type\":\"tool_use\",\"tool_name\":\"Bash\",\"tool_id\":\"bash-123\",\"parameters\":{\"command\":\"ls -la\"},\"timestamp\":\"2025-10-10T12:00:02.000Z\"}\n{\"type\":\"tool_result\",\"tool_id\":\"bash-123\",\"status\":\"success\",\"output\":\"file1.txt\\nfile2.txt\",\"timestamp\":\"2025-10-10T12:00:03.000Z\"}\n{\"type\":\"message\",\"role\":\"assistant\",\"content\":\"Here are the files...\",\"delta\":true,\"timestamp\":\"2025-10-10T12:00:04.000Z\"}\n{\"type\":\"result\",\"status\":\"success\",\"stats\":{\"total_tokens\":250,\"input_tokens\":50,\"output_tokens\":200,\"duration_ms\":3000,\"tool_calls\":1},\"timestamp\":\"2025-10-10T12:00:05.000Z\"}\n```\n\n### File redirection\n\nSave output to files or pipe to other commands:\n\n```bash\n# Save to file\ngemini -p \"Explain Docker\" > docker-explanation.txt\ngemini -p \"Explain Docker\" --output-format json > docker-explanation.json\n\n# Append to file\ngemini -p \"Add more details\" >> docker-explanation.txt\n\n# Pipe to other tools\ngemini -p \"What is Kubernetes?\" --output-format json | jq '.response'\ngemini -p \"Explain microservices\" | wc -w\ngemini -p \"List programming languages\" | grep -i \"python\"\n```\n\n## Configuration options\n\nKey command-line options for headless usage:\n\n| Option                  | Description                        | Example                                            |\n| ----------------------- | ---------------------------------- | -------------------------------------------------- |\n| `--prompt`, `-p`        | Run in headless mode               | `gemini -p \"query\"`                                |\n| `--output-format`       | Specify output format (text, json) | `gemini -p \"query\" --output-format json`           |\n| `--model`, `-m`         | Specify the Gemini model           | `gemini -p \"query\" -m gemini-2.5-flash`            |\n| `--debug`, `-d`         | Enable debug mode                  | `gemini -p \"query\" --debug`                        |\n| `--include-directories` | Include additional directories     | `gemini -p \"query\" --include-directories src,docs` |\n| `--yolo`, `-y`          | Auto-approve all actions           | `gemini -p \"query\" --yolo`                         |\n| `--approval-mode`       | Set approval mode                  | `gemini -p \"query\" --approval-mode auto_edit`      |\n\nFor complete details on all available configuration options, settings files, and\nenvironment variables, see the\n[Configuration Guide](../get-started/configuration.md).\n\n## Examples\n\n#### Code review\n\n```bash\ncat src/auth.py | gemini -p \"Review this authentication code for security issues\" > security-review.txt\n```\n\n#### Generate commit messages\n\n```bash\nresult=$(git diff --cached | gemini -p \"Write a concise commit message for these changes\" --output-format json)\necho \"$result\" | jq -r '.response'\n```\n\n#### API documentation\n\n```bash\nresult=$(cat api/routes.js | gemini -p \"Generate OpenAPI spec for these routes\" --output-format json)\necho \"$result\" | jq -r '.response' > openapi.json\n```\n\n#### Batch code analysis\n\n```bash\nfor file in src/*.py; do\n    echo \"Analyzing $file...\"\n    result=$(cat \"$file\" | gemini -p \"Find potential bugs and suggest improvements\" --output-format json)\n    echo \"$result\" | jq -r '.response' > \"reports/$(basename \"$file\").analysis\"\n    echo \"Completed analysis for $(basename \"$file\")\" >> reports/progress.log\ndone\n```\n\n#### Code review\n\n```bash\nresult=$(git diff origin/main...HEAD | gemini -p \"Review these changes for bugs, security issues, and code quality\" --output-format json)\necho \"$result\" | jq -r '.response' > pr-review.json\n```\n\n#### Log analysis\n\n```bash\ngrep \"ERROR\" /var/log/app.log | tail -20 | gemini -p \"Analyze these errors and suggest root cause and fixes\" > error-analysis.txt\n```\n\n#### Release notes generation\n\n```bash\nresult=$(git log --oneline v1.0.0..HEAD | gemini -p \"Generate release notes from these commits\" --output-format json)\nresponse=$(echo \"$result\" | jq -r '.response')\necho \"$response\"\necho \"$response\" >> CHANGELOG.md\n```\n\n#### Model and tool usage tracking\n\n```bash\nresult=$(gemini -p \"Explain this database schema\" --include-directories db --output-format json)\ntotal_tokens=$(echo \"$result\" | jq -r '.stats.models // {} | to_entries | map(.value.tokens.total) | add // 0')\nmodels_used=$(echo \"$result\" | jq -r '.stats.models // {} | keys | join(\", \") | if . == \"\" then \"none\" else . end')\ntool_calls=$(echo \"$result\" | jq -r '.stats.tools.totalCalls // 0')\ntools_used=$(echo \"$result\" | jq -r '.stats.tools.byName // {} | keys | join(\", \") | if . == \"\" then \"none\" else . end')\necho \"$(date): $total_tokens tokens, $tool_calls tool calls ($tools_used) used with models: $models_used\" >> usage.log\necho \"$result\" | jq -r '.response' > schema-docs.md\necho \"Recent usage trends:\"\ntail -5 usage.log\n```\n\n## Resources\n\n- [CLI Configuration](../get-started/configuration.md) - Complete configuration\n  guide\n- [Authentication](../get-started/authentication.md) - Setup authentication\n- [Commands](./commands.md) - Interactive commands reference\n- [Tutorials](./tutorials.md) - Step-by-step automation guides\n"}
{"source":"github","repo":"gemini-cli","path":"docs/cli/session-management.md","content":"# Session Management\n\nGemini CLI includes robust session management features that automatically save\nyour conversation history. This allows you to interrupt your work and resume\nexactly where you left off, review past interactions, and manage your\nconversation history effectively.\n\n## Automatic Saving\n\nEvery time you interact with Gemini CLI, your session is automatically saved.\nThis happens in the background without any manual intervention.\n\n- **What is saved:** The complete conversation history, including:\n  - Your prompts and the model's responses.\n  - All tool executions (inputs and outputs).\n  - Token usage statistics (input/output/cached, etc.).\n  - Assistant thoughts/reasoning summaries (when available).\n- **Location:** Sessions are stored in `~/.gemini/tmp/<project_hash>/chats/`.\n- **Scope:** Sessions are project-specific. Switching directories to a different\n  project will switch to that project's session history.\n\n## Resuming Sessions\n\nYou can resume a previous session to continue the conversation with all prior\ncontext restored.\n\n### From the Command Line\n\nWhen starting the CLI, you can use the `--resume` (or `-r`) flag:\n\n- **Resume latest:**\n\n  ```bash\n  gemini --resume\n  ```\n\n  This immediately loads the most recent session.\n\n- **Resume by index:** First, list available sessions (see\n  [Listing Sessions](#listing-sessions)), then use the index number:\n\n  ```bash\n  gemini --resume 1\n  ```\n\n- **Resume by ID:** You can also provide the full session UUID:\n  ```bash\n  gemini --resume a1b2c3d4-e5f6-7890-abcd-ef1234567890\n  ```\n\n### From the Interactive Interface\n\nWhile the CLI is running, you can use the `/resume` slash command to open the\n**Session Browser**:\n\n```text\n/resume\n```\n\nThis opens an interactive interface where you can:\n\n- **Browse:** Scroll through a list of your past sessions.\n- **Preview:** See details like the session date, message count, and the first\n  user prompt.\n- **Search:** Press `/` to enter search mode, then type to filter sessions by ID\n  or content.\n- **Select:** Press `Enter` to resume the selected session.\n\n## Managing Sessions\n\n### Listing Sessions\n\nTo see a list of all available sessions for the current project from the command\nline:\n\n```bash\ngemini --list-sessions\n```\n\nOutput example:\n\n```text\nAvailable sessions for this project (3):\n\n  1. Fix bug in auth (2 days ago) [a1b2c3d4]\n  2. Refactor database schema (5 hours ago) [e5f67890]\n  3. Update documentation (Just now) [abcd1234]\n```\n\n### Deleting Sessions\n\nYou can remove old or unwanted sessions to free up space or declutter your\nhistory.\n\n**From the Command Line:** Use the `--delete-session` flag with an index or ID:\n\n```bash\ngemini --delete-session 2\n```\n\n**From the Session Browser:**\n\n1.  Open the browser with `/resume`.\n2.  Navigate to the session you want to remove.\n3.  Press `x`.\n\n## Configuration\n\nYou can configure how Gemini CLI manages your session history in your\n`settings.json` file.\n\n### Session Retention\n\nTo prevent your history from growing indefinitely, you can enable automatic\ncleanup policies.\n\n```json\n{\n  \"general\": {\n    \"sessionRetention\": {\n      \"enabled\": true,\n      \"maxAge\": \"30d\", // Keep sessions for 30 days\n      \"maxCount\": 50 // Keep the 50 most recent sessions\n    }\n  }\n}\n```\n\n- **`enabled`**: (boolean) Master switch for session cleanup. Default is\n  `false`.\n- **`maxAge`**: (string) Duration to keep sessions (e.g., \"24h\", \"7d\", \"4w\").\n  Sessions older than this will be deleted.\n- **`maxCount`**: (number) Maximum number of sessions to retain. The oldest\n  sessions exceeding this count will be deleted.\n- **`minRetention`**: (string) Minimum retention period (safety limit). Defaults\n  to `\"1d\"`; sessions newer than this period are never deleted by automatic\n  cleanup.\n\n### Session Limits\n\nYou can also limit the length of individual sessions to prevent context windows\nfrom becoming too large and expensive.\n\n```json\n{\n  \"model\": {\n    \"maxSessionTurns\": 100\n  }\n}\n```\n\n- **`maxSessionTurns`**: (number) The maximum number of turns (user + model\n  exchanges) allowed in a single session. Set to `-1` for unlimited (default).\n\n  **Behavior when limit is reached:**\n  - **Interactive Mode:** The CLI shows an informational message and stops\n    sending requests to the model. You must manually start a new session.\n  - **Non-Interactive Mode:** The CLI exits with an error.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/cli/commands.md","content":"# CLI commands\n\nGemini CLI supports several built-in commands to help you manage your session,\ncustomize the interface, and control its behavior. These commands are prefixed\nwith a forward slash (`/`), an at symbol (`@`), or an exclamation mark (`!`).\n\n## Slash commands (`/`)\n\nSlash commands provide meta-level control over the CLI itself.\n\n### Built-in Commands\n\n- **`/bug`**\n  - **Description:** File an issue about Gemini CLI. By default, the issue is\n    filed within the GitHub repository for Gemini CLI. The string you enter\n    after `/bug` will become the headline for the bug being filed. The default\n    `/bug` behavior can be modified using the `advanced.bugCommand` setting in\n    your `.gemini/settings.json` files.\n\n- **`/chat`**\n  - **Description:** Save and resume conversation history for branching\n    conversation state interactively, or resuming a previous state from a later\n    session.\n  - **Sub-commands:**\n    - **`save`**\n      - **Description:** Saves the current conversation history. You must add a\n        `<tag>` for identifying the conversation state.\n      - **Usage:** `/chat save <tag>`\n      - **Details on checkpoint location:** The default locations for saved chat\n        checkpoints are:\n        - Linux/macOS: `~/.gemini/tmp/<project_hash>/`\n        - Windows: `C:\\Users\\<YourUsername>\\.gemini\\tmp\\<project_hash>\\`\n        - **Behavior:** Chats are saved into a project-specific directory,\n          determined by where you run the CLI. Consequently, saved chats are\n          only accessible when working within that same project.\n        - **Note:** These checkpoints are for manually saving and resuming\n          conversation states. For automatic checkpoints created before file\n          modifications, see the\n          [Checkpointing documentation](../cli/checkpointing.md).\n    - **`resume`**\n      - **Description:** Resumes a conversation from a previous save.\n      - **Usage:** `/chat resume <tag>`\n      - **Note:** You can only resume chats that were saved within the current\n        project. To resume a chat from a different project, you must run the\n        Gemini CLI from that project's directory.\n    - **`list`**\n      - **Description:** Lists available tags for chat state resumption.\n      - **Note:** This command only lists chats saved within the current\n        project. Because chat history is project-scoped, chats saved in other\n        project directories will not be displayed.\n    - **`delete`**\n      - **Description:** Deletes a saved conversation checkpoint.\n      - **Usage:** `/chat delete <tag>`\n    - **`share`**\n      - **Description** Writes the current conversation to a provided Markdown\n        or JSON file.\n      - **Usage** `/chat share file.md` or `/chat share file.json`. If no\n        filename is provided, then the CLI will generate one.\n\n- **`/clear`**\n  - **Description:** Clear the terminal screen, including the visible session\n    history and scrollback within the CLI. The underlying session data (for\n    history recall) might be preserved depending on the exact implementation,\n    but the visual display is cleared.\n  - **Keyboard shortcut:** Press **Ctrl+L** at any time to perform a clear\n    action.\n\n- **`/compress`**\n  - **Description:** Replace the entire chat context with a summary. This saves\n    on tokens used for future tasks while retaining a high level summary of what\n    has happened.\n\n- **`/copy`**\n  - **Description:** Copies the last output produced by Gemini CLI to your\n    clipboard, for easy sharing or reuse.\n  - **Note:** This command requires platform-specific clipboard tools to be\n    installed.\n    - On Linux, it requires `xclip` or `xsel`. You can typically install them\n      using your system's package manager.\n    - On macOS, it requires `pbcopy`, and on Windows, it requires `clip`. These\n      tools are typically pre-installed on their respective systems.\n\n- **`/directory`** (or **`/dir`**)\n  - **Description:** Manage workspace directories for multi-directory support.\n  - **Sub-commands:**\n    - **`add`**:\n      - **Description:** Add a directory to the workspace. The path can be\n        absolute or relative to the current working directory. Moreover, the\n        reference from home directory is supported as well.\n      - **Usage:** `/directory add <path1>,<path2>`\n      - **Note:** Disabled in restrictive sandbox profiles. If you're using\n        that, use `--include-directories` when starting the session instead.\n    - **`show`**:\n      - **Description:** Display all directories added by `/directory add` and\n        `--include-directories`.\n      - **Usage:** `/directory show`\n\n- **`/editor`**\n  - **Description:** Open a dialog for selecting supported editors.\n\n- **`/extensions`**\n  - **Description:** Lists all active extensions in the current Gemini CLI\n    session. See [Gemini CLI Extensions](../extensions/index.md).\n\n- **`/help`** (or **`/?`**)\n  - **Description:** Display help information about Gemini CLI, including\n    available commands and their usage.\n\n- **`/mcp`**\n  - **Description:** Manage configured Model Context Protocol (MCP) servers.\n  - **Sub-commands:**\n    - **`list`** or **`ls`**:\n      - **Description:** List configured MCP servers and tools. This is the\n        default action if no subcommand is specified.\n    - **`desc`**\n      - **Description:** List configured MCP servers and tools with\n        descriptions.\n    - **`schema`**:\n      - **Description:** List configured MCP servers and tools with descriptions\n        and schemas.\n    - **`auth`**:\n      - **Description:** Authenticate with an OAuth-enabled MCP server.\n      - **Usage:** `/mcp auth <server-name>`\n      - **Details:** If `<server-name>` is provided, it initiates the OAuth flow\n        for that server. If no server name is provided, it lists all configured\n        servers that support OAuth authentication.\n    - **`refresh`**:\n      - **Description:** Restarts all MCP servers and re-discovers their\n        available tools.\n\n- [**`/model`**](./model.md)\n  - **Description:** Opens a dialog to choose your Gemini model.\n\n- **`/memory`**\n  - **Description:** Manage the AI's instructional context (hierarchical memory\n    loaded from `GEMINI.md` files).\n  - **Sub-commands:**\n    - **`add`**:\n      - **Description:** Adds the following text to the AI's memory. Usage:\n        `/memory add <text to remember>`\n    - **`show`**:\n      - **Description:** Display the full, concatenated content of the current\n        hierarchical memory that has been loaded from all `GEMINI.md` files.\n        This lets you inspect the instructional context being provided to the\n        Gemini model.\n    - **`refresh`**:\n      - **Description:** Reload the hierarchical instructional memory from all\n        `GEMINI.md` files found in the configured locations (global,\n        project/ancestors, and sub-directories). This command updates the model\n        with the latest `GEMINI.md` content.\n    - **`list`**:\n      - **Description:** Lists the paths of the GEMINI.md files in use for\n        hierarchical memory.\n    - **Note:** For more details on how `GEMINI.md` files contribute to\n      hierarchical memory, see the\n      [CLI Configuration documentation](../get-started/configuration.md).\n\n- **`/restore`**\n  - **Description:** Restores the project files to the state they were in just\n    before a tool was executed. This is particularly useful for undoing file\n    edits made by a tool. If run without a tool call ID, it will list available\n    checkpoints to restore from.\n  - **Usage:** `/restore [tool_call_id]`\n  - **Note:** Only available if checkpointing is configured via\n    [settings](../get-started/configuration.md). See\n    [Checkpointing documentation](../cli/checkpointing.md) for more details.\n- **`/resume`**\n  - **Description:** Browse and resume previous conversation sessions. Opens an\n    interactive session browser where you can search, filter, and select from\n    automatically saved conversations.\n  - **Features:**\n    - **Session Browser:** Interactive interface showing all saved sessions with\n      timestamps, message counts, and first user message for context\n    - **Search:** Use `/` to search through conversation content across all\n      sessions\n    - **Sorting:** Sort sessions by date or message count\n    - **Management:** Delete unwanted sessions directly from the browser\n    - **Resume:** Select any session to resume and continue the conversation\n  - **Note:** All conversations are automatically saved as you chat - no manual\n    saving required. See [Session Management](../cli/session-management.md) for\n    complete details.\n\n- [**`/settings`**](./settings.md)\n  - **Description:** Open the settings editor to view and modify Gemini CLI\n    settings.\n  - **Details:** This command provides a user-friendly interface for changing\n    settings that control the behavior and appearance of Gemini CLI. It is\n    equivalent to manually editing the `.gemini/settings.json` file, but with\n    validation and guidance to prevent errors. See the\n    [settings documentation](./settings.md) for a full list of available\n    settings.\n  - **Usage:** Simply run `/settings` and the editor will open. You can then\n    browse or search for specific settings, view their current values, and\n    modify them as desired. Changes to some settings are applied immediately,\n    while others require a restart.\n\n- **`/stats`**\n  - **Description:** Display detailed statistics for the current Gemini CLI\n    session, including token usage, cached token savings (when available), and\n    session duration. Note: Cached token information is only displayed when\n    cached tokens are being used, which occurs with API key authentication but\n    not with OAuth authentication at this time.\n\n- [**`/theme`**](./themes.md)\n  - **Description:** Open a dialog that lets you change the visual theme of\n    Gemini CLI.\n\n- **`/auth`**\n  - **Description:** Open a dialog that lets you change the authentication\n    method.\n\n- **`/about`**\n  - **Description:** Show version info. Please share this information when\n    filing issues.\n\n- [**`/tools`**](../tools/index.md)\n  - **Description:** Display a list of tools that are currently available within\n    Gemini CLI.\n  - **Usage:** `/tools [desc]`\n  - **Sub-commands:**\n    - **`desc`** or **`descriptions`**:\n      - **Description:** Show detailed descriptions of each tool, including each\n        tool's name with its full description as provided to the model.\n    - **`nodesc`** or **`nodescriptions`**:\n      - **Description:** Hide tool descriptions, showing only the tool names.\n\n- **`/privacy`**\n  - **Description:** Display the Privacy Notice and allow users to select\n    whether they consent to the collection of their data for service improvement\n    purposes.\n\n- **`/quit`** (or **`/exit`**)\n  - **Description:** Exit Gemini CLI.\n\n- **`/vim`**\n  - **Description:** Toggle vim mode on or off. When vim mode is enabled, the\n    input area supports vim-style navigation and editing commands in both NORMAL\n    and INSERT modes.\n  - **Features:**\n    - **NORMAL mode:** Navigate with `h`, `j`, `k`, `l`; jump by words with `w`,\n      `b`, `e`; go to line start/end with `0`, `$`, `^`; go to specific lines\n      with `G` (or `gg` for first line)\n    - **INSERT mode:** Standard text input with escape to return to NORMAL mode\n    - **Editing commands:** Delete with `x`, change with `c`, insert with `i`,\n      `a`, `o`, `O`; complex operations like `dd`, `cc`, `dw`, `cw`\n    - **Count support:** Prefix commands with numbers (e.g., `3h`, `5w`, `10G`)\n    - **Repeat last command:** Use `.` to repeat the last editing operation\n    - **Persistent setting:** Vim mode preference is saved to\n      `~/.gemini/settings.json` and restored between sessions\n  - **Status indicator:** When enabled, shows `[NORMAL]` or `[INSERT]` in the\n    footer\n\n- **`/init`**\n  - **Description:** To help users easily create a `GEMINI.md` file, this\n    command analyzes the current directory and generates a tailored context\n    file, making it simpler for them to provide project-specific instructions to\n    the Gemini agent.\n\n### Custom commands\n\nCustom commands allow you to create personalized shortcuts for your most-used\nprompts. For detailed instructions on how to create, manage, and use them,\nplease see the dedicated [Custom Commands documentation](./custom-commands.md).\n\n## Input prompt shortcuts\n\nThese shortcuts apply directly to the input prompt for text manipulation.\n\n- **Undo:**\n  - **Keyboard shortcut:** Press **Ctrl+z** to undo the last action in the input\n    prompt.\n\n- **Redo:**\n  - **Keyboard shortcut:** Press **Ctrl+Shift+Z** to redo the last undone action\n    in the input prompt.\n\n## At commands (`@`)\n\nAt commands are used to include the content of files or directories as part of\nyour prompt to Gemini. These commands include git-aware filtering.\n\n- **`@<path_to_file_or_directory>`**\n  - **Description:** Inject the content of the specified file or files into your\n    current prompt. This is useful for asking questions about specific code,\n    text, or collections of files.\n  - **Examples:**\n    - `@path/to/your/file.txt Explain this text.`\n    - `@src/my_project/ Summarize the code in this directory.`\n    - `What is this file about? @README.md`\n  - **Details:**\n    - If a path to a single file is provided, the content of that file is read.\n    - If a path to a directory is provided, the command attempts to read the\n      content of files within that directory and any subdirectories.\n    - Spaces in paths should be escaped with a backslash (e.g.,\n      `@My\\ Documents/file.txt`).\n    - The command uses the `read_many_files` tool internally. The content is\n      fetched and then inserted into your query before being sent to the Gemini\n      model.\n    - **Git-aware filtering:** By default, git-ignored files (like\n      `node_modules/`, `dist/`, `.env`, `.git/`) are excluded. This behavior can\n      be changed via the `context.fileFiltering` settings.\n    - **File types:** The command is intended for text-based files. While it\n      might attempt to read any file, binary files or very large files might be\n      skipped or truncated by the underlying `read_many_files` tool to ensure\n      performance and relevance. The tool indicates if files were skipped.\n  - **Output:** The CLI will show a tool call message indicating that\n    `read_many_files` was used, along with a message detailing the status and\n    the path(s) that were processed.\n\n- **`@` (Lone at symbol)**\n  - **Description:** If you type a lone `@` symbol without a path, the query is\n    passed as-is to the Gemini model. This might be useful if you are\n    specifically talking _about_ the `@` symbol in your prompt.\n\n### Error handling for `@` commands\n\n- If the path specified after `@` is not found or is invalid, an error message\n  will be displayed, and the query might not be sent to the Gemini model, or it\n  will be sent without the file content.\n- If the `read_many_files` tool encounters an error (e.g., permission issues),\n  this will also be reported.\n\n## Shell mode and passthrough commands (`!`)\n\nThe `!` prefix lets you interact with your system's shell directly from within\nGemini CLI.\n\n- **`!<shell_command>`**\n  - **Description:** Execute the given `<shell_command>` using `bash` on\n    Linux/macOS or `powershell.exe -NoProfile -Command` on Windows (unless you\n    override `ComSpec`). Any output or errors from the command are displayed in\n    the terminal.\n  - **Examples:**\n    - `!ls -la` (executes `ls -la` and returns to Gemini CLI)\n    - `!git status` (executes `git status` and returns to Gemini CLI)\n\n- **`!` (Toggle shell mode)**\n  - **Description:** Typing `!` on its own toggles shell mode.\n    - **Entering shell mode:**\n      - When active, shell mode uses a different coloring and a \"Shell Mode\n        Indicator\".\n      - While in shell mode, text you type is interpreted directly as a shell\n        command.\n    - **Exiting shell mode:**\n      - When exited, the UI reverts to its standard appearance and normal Gemini\n        CLI behavior resumes.\n\n- **Caution for all `!` usage:** Commands you execute in shell mode have the\n  same permissions and impact as if you ran them directly in your terminal.\n\n- **Environment variable:** When a command is executed via `!` or in shell mode,\n  the `GEMINI_CLI=1` environment variable is set in the subprocess's\n  environment. This allows scripts or tools to detect if they are being run from\n  within the Gemini CLI.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/cli/index.md","content":"# Gemini CLI\n\nWithin Gemini CLI, `packages/cli` is the frontend for users to send and receive\nprompts with the Gemini AI model and its associated tools. For a general\noverview of Gemini CLI, see the [main documentation page](../index.md).\n\n## Basic features\n\n- **[Commands](./commands.md):** A reference for all built-in slash commands\n- **[Custom commands](./custom-commands.md):** Create your own commands and\n  shortcuts for frequently used prompts.\n- **[Headless mode](./headless.md):** Use Gemini CLI programmatically for\n  scripting and automation.\n- **[Model selection](./model.md):** Configure the Gemini AI model used by the\n  CLI.\n- **[Settings](./settings.md):** Configure various aspects of the CLI's behavior\n  and appearance.\n- **[Themes](./themes.md):** Customizing the CLI's appearance with different\n  themes.\n- **[Keyboard shortcuts](./keyboard-shortcuts.md):** A reference for all\n  keyboard shortcuts to improve your workflow.\n- **[Tutorials](./tutorials.md):** Step-by-step guides for common tasks.\n\n## Advanced features\n\n- **[Checkpointing](./checkpointing.md):** Automatically save and restore\n  snapshots of your session and files.\n- **[Enterprise configuration](./enterprise.md):** Deploying and manage Gemini\n  CLI in an enterprise environment.\n- **[Sandboxing](./sandbox.md):** Isolate tool execution in a secure,\n  containerized environment.\n- **[Telemetry](./telemetry.md):** Configure observability to monitor usage and\n  performance.\n- **[Token caching](./token-caching.md):** Optimize API costs by caching tokens.\n- **[Trusted folders](./trusted-folders.md):** A security feature to control\n  which projects can use the full capabilities of the CLI.\n- **[Ignoring files (.geminiignore)](./gemini-ignore.md):** Exclude specific\n  files and directories from being accessed by tools.\n- **[Context files (GEMINI.md)](./gemini-md.md):** Provide persistent,\n  hierarchical context to the model.\n\n## Non-interactive mode\n\nGemini CLI can be run in a non-interactive mode, which is useful for scripting\nand automation. In this mode, you pipe input to the CLI, it executes the\ncommand, and then it exits.\n\nThe following example pipes a command to Gemini CLI from your terminal:\n\n```bash\necho \"What is fine tuning?\" | gemini\n```\n\nYou can also use the `--prompt` or `-p` flag:\n\n```bash\ngemini -p \"What is fine tuning?\"\n```\n\nFor comprehensive documentation on headless usage, scripting, automation, and\nadvanced examples, see the **[Headless mode](./headless.md)** guide.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/cli/enterprise.md","content":"# Gemini CLI for the enterprise\n\nThis document outlines configuration patterns and best practices for deploying\nand managing Gemini CLI in an enterprise environment. By leveraging system-level\nsettings, administrators can enforce security policies, manage tool access, and\nensure a consistent experience for all users.\n\n> **A note on security:** The patterns described in this document are intended\n> to help administrators create a more controlled and secure environment for\n> using Gemini CLI. However, they should not be considered a foolproof security\n> boundary. A determined user with sufficient privileges on their local machine\n> may still be able to circumvent these configurations. These measures are\n> designed to prevent accidental misuse and enforce corporate policy in a\n> managed environment, not to defend against a malicious actor with local\n> administrative rights.\n\n## Centralized configuration: The system settings file\n\nThe most powerful tools for enterprise administration are the system-wide\nsettings files. These files allow you to define a baseline configuration\n(`system-defaults.json`) and a set of overrides (`settings.json`) that apply to\nall users on a machine. For a complete overview of configuration options, see\nthe [Configuration documentation](../get-started/configuration.md).\n\nSettings are merged from four files. The precedence order for single-value\nsettings (like `theme`) is:\n\n1. System Defaults (`system-defaults.json`)\n2. User Settings (`~/.gemini/settings.json`)\n3. Workspace Settings (`<project>/.gemini/settings.json`)\n4. System Overrides (`settings.json`)\n\nThis means the System Overrides file has the final say. For settings that are\narrays (`includeDirectories`) or objects (`mcpServers`), the values are merged.\n\n**Example of merging and precedence:**\n\nHere is how settings from different levels are combined.\n\n- **System defaults `system-defaults.json`:**\n\n  ```json\n  {\n    \"ui\": {\n      \"theme\": \"default-corporate-theme\"\n    },\n    \"context\": {\n      \"includeDirectories\": [\"/etc/gemini-cli/common-context\"]\n    }\n  }\n  ```\n\n- **User `settings.json` (`~/.gemini/settings.json`):**\n\n  ```json\n  {\n    \"ui\": {\n      \"theme\": \"user-preferred-dark-theme\"\n    },\n    \"mcpServers\": {\n      \"corp-server\": {\n        \"command\": \"/usr/local/bin/corp-server-dev\"\n      },\n      \"user-tool\": {\n        \"command\": \"npm start --prefix ~/tools/my-tool\"\n      }\n    },\n    \"context\": {\n      \"includeDirectories\": [\"~/gemini-context\"]\n    }\n  }\n  ```\n\n- **Workspace `settings.json` (`<project>/.gemini/settings.json`):**\n\n  ```json\n  {\n    \"ui\": {\n      \"theme\": \"project-specific-light-theme\"\n    },\n    \"mcpServers\": {\n      \"project-tool\": {\n        \"command\": \"npm start\"\n      }\n    },\n    \"context\": {\n      \"includeDirectories\": [\"./project-context\"]\n    }\n  }\n  ```\n\n- **System overrides `settings.json`:**\n  ```json\n  {\n    \"ui\": {\n      \"theme\": \"system-enforced-theme\"\n    },\n    \"mcpServers\": {\n      \"corp-server\": {\n        \"command\": \"/usr/local/bin/corp-server-prod\"\n      }\n    },\n    \"context\": {\n      \"includeDirectories\": [\"/etc/gemini-cli/global-context\"]\n    }\n  }\n  ```\n\nThis results in the following merged configuration:\n\n- **Final merged configuration:**\n  ```json\n  {\n    \"ui\": {\n      \"theme\": \"system-enforced-theme\"\n    },\n    \"mcpServers\": {\n      \"corp-server\": {\n        \"command\": \"/usr/local/bin/corp-server-prod\"\n      },\n      \"user-tool\": {\n        \"command\": \"npm start --prefix ~/tools/my-tool\"\n      },\n      \"project-tool\": {\n        \"command\": \"npm start\"\n      }\n    },\n    \"context\": {\n      \"includeDirectories\": [\n        \"/etc/gemini-cli/common-context\",\n        \"~/gemini-context\",\n        \"./project-context\",\n        \"/etc/gemini-cli/global-context\"\n      ]\n    }\n  }\n  ```\n\n**Why:**\n\n- **`theme`**: The value from the system overrides (`system-enforced-theme`) is\n  used, as it has the highest precedence.\n- **`mcpServers`**: The objects are merged. The `corp-server` definition from\n  the system overrides takes precedence over the user's definition. The unique\n  `user-tool` and `project-tool` are included.\n- **`includeDirectories`**: The arrays are concatenated in the order of System\n  Defaults, User, Workspace, and then System Overrides.\n\n- **Location**:\n  - **Linux**: `/etc/gemini-cli/settings.json`\n  - **Windows**: `C:\\ProgramData\\gemini-cli\\settings.json`\n  - **macOS**: `/Library/Application Support/GeminiCli/settings.json`\n  - The path can be overridden using the `GEMINI_CLI_SYSTEM_SETTINGS_PATH`\n    environment variable.\n- **Control**: This file should be managed by system administrators and\n  protected with appropriate file permissions to prevent unauthorized\n  modification by users.\n\nBy using the system settings file, you can enforce the security and\nconfiguration patterns described below.\n\n### Enforcing system settings with a wrapper script\n\nWhile the `GEMINI_CLI_SYSTEM_SETTINGS_PATH` environment variable provides\nflexibility, a user could potentially override it to point to a different\nsettings file, bypassing the centrally managed configuration. To mitigate this,\nenterprises can deploy a wrapper script or alias that ensures the environment\nvariable is always set to the corporate-controlled path.\n\nThis approach ensures that no matter how the user calls the `gemini` command,\nthe enterprise settings are always loaded with the highest precedence.\n\n**Example wrapper script:**\n\nAdministrators can create a script named `gemini` and place it in a directory\nthat appears earlier in the user's `PATH` than the actual Gemini CLI binary\n(e.g., `/usr/local/bin/gemini`).\n\n```bash\n#!/bin/bash\n\n# Enforce the path to the corporate system settings file.\n# This ensures that the company's configuration is always applied.\nexport GEMINI_CLI_SYSTEM_SETTINGS_PATH=\"/etc/gemini-cli/settings.json\"\n\n# Find the original gemini executable.\n# This is a simple example; a more robust solution might be needed\n# depending on the installation method.\nREAL_GEMINI_PATH=$(type -aP gemini | grep -v \"^$(type -P gemini)$\" | head -n 1)\n\nif [ -z \"$REAL_GEMINI_PATH\" ]; then\n  echo \"Error: The original 'gemini' executable was not found.\" >&2\n  exit 1\nfi\n\n# Pass all arguments to the real Gemini CLI executable.\nexec \"$REAL_GEMINI_PATH\" \"$@\"\n```\n\nBy deploying this script, the `GEMINI_CLI_SYSTEM_SETTINGS_PATH` is set within\nthe script's environment, and the `exec` command replaces the script process\nwith the actual Gemini CLI process, which inherits the environment variable.\nThis makes it significantly more difficult for a user to bypass the enforced\nsettings.\n\n## Restricting tool access\n\nYou can significantly enhance security by controlling which tools the Gemini\nmodel can use. This is achieved through the `tools.core` and `tools.exclude`\nsettings. For a list of available tools, see the\n[Tools documentation](../tools/index.md).\n\n### Allowlisting with `coreTools`\n\nThe most secure approach is to explicitly add the tools and commands that users\nare permitted to execute to an allowlist. This prevents the use of any tool not\non the approved list.\n\n**Example:** Allow only safe, read-only file operations and listing files.\n\n```json\n{\n  \"tools\": {\n    \"core\": [\"ReadFileTool\", \"GlobTool\", \"ShellTool(ls)\"]\n  }\n}\n```\n\n### Blocklisting with `excludeTools`\n\nAlternatively, you can add specific tools that are considered dangerous in your\nenvironment to a blocklist.\n\n**Example:** Prevent the use of the shell tool for removing files.\n\n```json\n{\n  \"tools\": {\n    \"exclude\": [\"ShellTool(rm -rf)\"]\n  }\n}\n```\n\n**Security note:** Blocklisting with `excludeTools` is less secure than\nallowlisting with `coreTools`, as it relies on blocking known-bad commands, and\nclever users may find ways to bypass simple string-based blocks. **Allowlisting\nis the recommended approach.**\n\n### Disabling YOLO mode\n\nTo ensure that users cannot bypass the confirmation prompt for tool execution,\nyou can disable YOLO mode at the policy level. This adds a critical layer of\nsafety, as it prevents the model from executing tools without explicit user\napproval.\n\n**Example:** Force all tool executions to require user confirmation.\n\n```json\n{\n  \"security\": {\n    \"disableYoloMode\": true\n  }\n}\n```\n\nThis setting is highly recommended in an enterprise environment to prevent\nunintended tool execution.\n\n## Managing custom tools (MCP servers)\n\nIf your organization uses custom tools via\n[Model-Context Protocol (MCP) servers](../core/tools-api.md), it is crucial to\nunderstand how server configurations are managed to apply security policies\neffectively.\n\n### How MCP server configurations are merged\n\nGemini CLI loads `settings.json` files from three levels: System, Workspace, and\nUser. When it comes to the `mcpServers` object, these configurations are\n**merged**:\n\n1.  **Merging:** The lists of servers from all three levels are combined into a\n    single list.\n2.  **Precedence:** If a server with the **same name** is defined at multiple\n    levels (e.g., a server named `corp-api` exists in both system and user\n    settings), the definition from the highest-precedence level is used. The\n    order of precedence is: **System > Workspace > User**.\n\nThis means a user **cannot** override the definition of a server that is already\ndefined in the system-level settings. However, they **can** add new servers with\nunique names.\n\n### Enforcing a catalog of tools\n\nThe security of your MCP tool ecosystem depends on a combination of defining the\ncanonical servers and adding their names to an allowlist.\n\n### Restricting tools within an MCP server\n\nFor even greater security, especially when dealing with third-party MCP servers,\nyou can restrict which specific tools from a server are exposed to the model.\nThis is done using the `includeTools` and `excludeTools` properties within a\nserver's definition. This allows you to use a subset of tools from a server\nwithout allowing potentially dangerous ones.\n\nFollowing the principle of least privilege, it is highly recommended to use\n`includeTools` to create an allowlist of only the necessary tools.\n\n**Example:** Only allow the `code-search` and `get-ticket-details` tools from a\nthird-party MCP server, even if the server offers other tools like\n`delete-ticket`.\n\n```json\n{\n  \"mcp\": {\n    \"allowed\": [\"third-party-analyzer\"]\n  },\n  \"mcpServers\": {\n    \"third-party-analyzer\": {\n      \"command\": \"/usr/local/bin/start-3p-analyzer.sh\",\n      \"includeTools\": [\"code-search\", \"get-ticket-details\"]\n    }\n  }\n}\n```\n\n#### More secure pattern: Define and add to allowlist in system settings\n\nTo create a secure, centrally-managed catalog of tools, the system administrator\n**must** do both of the following in the system-level `settings.json` file:\n\n1.  **Define the full configuration** for every approved server in the\n    `mcpServers` object. This ensures that even if a user defines a server with\n    the same name, the secure system-level definition will take precedence.\n2.  **Add the names** of those servers to an allowlist using the `mcp.allowed`\n    setting. This is a critical security step that prevents users from running\n    any servers that are not on this list. If this setting is omitted, the CLI\n    will merge and allow any server defined by the user.\n\n**Example system `settings.json`:**\n\n1. Add the _names_ of all approved servers to an allowlist. This will prevent\n   users from adding their own servers.\n\n2. Provide the canonical _definition_ for each server on the allowlist.\n\n```json\n{\n  \"mcp\": {\n    \"allowed\": [\"corp-data-api\", \"source-code-analyzer\"]\n  },\n  \"mcpServers\": {\n    \"corp-data-api\": {\n      \"command\": \"/usr/local/bin/start-corp-api.sh\",\n      \"timeout\": 5000\n    },\n    \"source-code-analyzer\": {\n      \"command\": \"/usr/local/bin/start-analyzer.sh\"\n    }\n  }\n}\n```\n\nThis pattern is more secure because it uses both definition and an allowlist.\nAny server a user defines will either be overridden by the system definition (if\nit has the same name) or blocked because its name is not in the `mcp.allowed`\nlist.\n\n### Less secure pattern: Omitting the allowlist\n\nIf the administrator defines the `mcpServers` object but fails to also specify\nthe `mcp.allowed` allowlist, users may add their own servers.\n\n**Example system `settings.json`:**\n\nThis configuration defines servers but does not enforce the allowlist. The\nadministrator has NOT included the \"mcp.allowed\" setting.\n\n```json\n{\n  \"mcpServers\": {\n    \"corp-data-api\": {\n      \"command\": \"/usr/local/bin/start-corp-api.sh\"\n    }\n  }\n}\n```\n\nIn this scenario, a user can add their own server in their local\n`settings.json`. Because there is no `mcp.allowed` list to filter the merged\nresults, the user's server will be added to the list of available tools and\nallowed to run.\n\n## Enforcing sandboxing for security\n\nTo mitigate the risk of potentially harmful operations, you can enforce the use\nof sandboxing for all tool execution. The sandbox isolates tool execution in a\ncontainerized environment.\n\n**Example:** Force all tool execution to happen within a Docker sandbox.\n\n```json\n{\n  \"tools\": {\n    \"sandbox\": \"docker\"\n  }\n}\n```\n\nYou can also specify a custom, hardened Docker image for the sandbox by building\na custom `sandbox.Dockerfile` as described in the\n[Sandboxing documentation](./sandbox.md).\n\n## Controlling network access via proxy\n\nIn corporate environments with strict network policies, you can configure Gemini\nCLI to route all outbound traffic through a corporate proxy. This can be set via\nan environment variable, but it can also be enforced for custom tools via the\n`mcpServers` configuration.\n\n**Example (for an MCP server):**\n\n```json\n{\n  \"mcpServers\": {\n    \"proxied-server\": {\n      \"command\": \"node\",\n      \"args\": [\"mcp_server.js\"],\n      \"env\": {\n        \"HTTP_PROXY\": \"http://proxy.example.com:8080\",\n        \"HTTPS_PROXY\": \"http://proxy.example.com:8080\"\n      }\n    }\n  }\n}\n```\n\n## Telemetry and auditing\n\nFor auditing and monitoring purposes, you can configure Gemini CLI to send\ntelemetry data to a central location. This allows you to track tool usage and\nother events. For more information, see the\n[telemetry documentation](./telemetry.md).\n\n**Example:** Enable telemetry and send it to a local OTLP collector. If\n`otlpEndpoint` is not specified, it defaults to `http://localhost:4317`.\n\n```json\n{\n  \"telemetry\": {\n    \"enabled\": true,\n    \"target\": \"gcp\",\n    \"logPrompts\": false\n  }\n}\n```\n\n**Note:** Ensure that `logPrompts` is set to `false` in an enterprise setting to\navoid collecting potentially sensitive information from user prompts.\n\n## Authentication\n\nYou can enforce a specific authentication method for all users by setting the\n`enforcedAuthType` in the system-level `settings.json` file. This prevents users\nfrom choosing a different authentication method. See the\n[Authentication docs](./authentication.md) for more details.\n\n**Example:** Enforce the use of Google login for all users.\n\n```json\n{\n  \"enforcedAuthType\": \"oauth-personal\"\n}\n```\n\nIf a user has a different authentication method configured, they will be\nprompted to switch to the enforced method. In non-interactive mode, the CLI will\nexit with an error if the configured authentication method does not match the\nenforced one.\n\n### Restricting logins to corporate domains\n\nFor enterprises using Google Workspace, you can enforce that users only\nauthenticate with their corporate Google accounts. This is a network-level\ncontrol that is configured on a proxy server, not within Gemini CLI itself. It\nworks by intercepting authentication requests to Google and adding a special\nHTTP header.\n\nThis policy prevents users from logging in with personal Gmail accounts or other\nnon-corporate Google accounts.\n\nFor detailed instructions, see the Google Workspace Admin Help article on\n[blocking access to consumer accounts](https://support.google.com/a/answer/1668854?hl=en#zippy=%2Cstep-choose-a-web-proxy-server%2Cstep-configure-the-network-to-block-certain-accounts).\n\nThe general steps are as follows:\n\n1.  **Intercept Requests**: Configure your web proxy to intercept all requests\n    to `google.com`.\n2.  **Add HTTP Header**: For each intercepted request, add the\n    `X-GoogApps-Allowed-Domains` HTTP header.\n3.  **Specify Domains**: The value of the header should be a comma-separated\n    list of your approved Google Workspace domain names.\n\n**Example header:**\n\n```\nX-GoogApps-Allowed-Domains: my-corporate-domain.com, secondary-domain.com\n```\n\nWhen this header is present, Google's authentication service will only allow\nlogins from accounts belonging to the specified domains.\n\n## Putting it all together: example system `settings.json`\n\nHere is an example of a system `settings.json` file that combines several of the\npatterns discussed above to create a secure, controlled environment for Gemini\nCLI.\n\n```json\n{\n  \"tools\": {\n    \"sandbox\": \"docker\",\n    \"core\": [\n      \"ReadFileTool\",\n      \"GlobTool\",\n      \"ShellTool(ls)\",\n      \"ShellTool(cat)\",\n      \"ShellTool(grep)\"\n    ]\n  },\n  \"mcp\": {\n    \"allowed\": [\"corp-tools\"]\n  },\n  \"mcpServers\": {\n    \"corp-tools\": {\n      \"command\": \"/opt/gemini-tools/start.sh\",\n      \"timeout\": 5000\n    }\n  },\n  \"telemetry\": {\n    \"enabled\": true,\n    \"target\": \"gcp\",\n    \"otlpEndpoint\": \"https://telemetry-prod.example.com:4317\",\n    \"logPrompts\": false\n  },\n  \"advanced\": {\n    \"bugCommand\": {\n      \"urlTemplate\": \"https://servicedesk.example.com/new-ticket?title={title}&details={info}\"\n    }\n  },\n  \"privacy\": {\n    \"usageStatisticsEnabled\": false\n  }\n}\n```\n\nThis configuration:\n\n- Forces all tool execution into a Docker sandbox.\n- Strictly uses an allowlist for a small set of safe shell commands and file\n  tools.\n- Defines and allows a single corporate MCP server for custom tools.\n- Enables telemetry for auditing, without logging prompt content.\n- Redirects the `/bug` command to an internal ticketing system.\n- Disables general usage statistics collection.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/cli/keyboard-shortcuts.md","content":"# Gemini CLI keyboard shortcuts\n\nGemini CLI ships with a set of default keyboard shortcuts for editing input,\nnavigating history, and controlling the UI. Use this reference to learn the\navailable combinations.\n\n<!-- KEYBINDINGS-AUTOGEN:START -->\n\n#### Basic Controls\n\n| Action                                       | Keys    |\n| -------------------------------------------- | ------- |\n| Confirm the current selection or choice.     | `Enter` |\n| Dismiss dialogs or cancel the current focus. | `Esc`   |\n\n#### Cursor Movement\n\n| Action                                    | Keys                   |\n| ----------------------------------------- | ---------------------- |\n| Move the cursor to the start of the line. | `Ctrl + A`<br />`Home` |\n| Move the cursor to the end of the line.   | `Ctrl + E`<br />`End`  |\n\n#### Editing\n\n| Action                                           | Keys                                      |\n| ------------------------------------------------ | ----------------------------------------- |\n| Delete from the cursor to the end of the line.   | `Ctrl + K`                                |\n| Delete from the cursor to the start of the line. | `Ctrl + U`                                |\n| Clear all text in the input field.               | `Ctrl + C`                                |\n| Delete the previous word.                        | `Ctrl + Backspace`<br />`Cmd + Backspace` |\n\n#### Screen Control\n\n| Action                                       | Keys       |\n| -------------------------------------------- | ---------- |\n| Clear the terminal screen and redraw the UI. | `Ctrl + L` |\n\n#### Scrolling\n\n| Action                   | Keys                 |\n| ------------------------ | -------------------- |\n| Scroll content up.       | `Shift + Up Arrow`   |\n| Scroll content down.     | `Shift + Down Arrow` |\n| Scroll to the top.       | `Home`               |\n| Scroll to the bottom.    | `End`                |\n| Scroll up by one page.   | `Page Up`            |\n| Scroll down by one page. | `Page Down`          |\n\n#### History & Search\n\n| Action                                       | Keys                  |\n| -------------------------------------------- | --------------------- |\n| Show the previous entry in history.          | `Ctrl + P (no Shift)` |\n| Show the next entry in history.              | `Ctrl + N (no Shift)` |\n| Start reverse search through history.        | `Ctrl + R`            |\n| Insert the selected reverse-search match.    | `Enter (no Ctrl)`     |\n| Accept a suggestion while reverse searching. | `Tab`                 |\n\n#### Navigation\n\n| Action                           | Keys                                        |\n| -------------------------------- | ------------------------------------------- |\n| Move selection up in lists.      | `Up Arrow (no Shift)`                       |\n| Move selection down in lists.    | `Down Arrow (no Shift)`                     |\n| Move up within dialog options.   | `Up Arrow (no Shift)`<br />`K (no Shift)`   |\n| Move down within dialog options. | `Down Arrow (no Shift)`<br />`J (no Shift)` |\n\n#### Suggestions & Completions\n\n| Action                                  | Keys                                               |\n| --------------------------------------- | -------------------------------------------------- |\n| Accept the inline suggestion.           | `Tab`<br />`Enter (no Ctrl)`                       |\n| Move to the previous completion option. | `Up Arrow (no Shift)`<br />`Ctrl + P (no Shift)`   |\n| Move to the next completion option.     | `Down Arrow (no Shift)`<br />`Ctrl + N (no Shift)` |\n| Expand an inline suggestion.            | `Right Arrow`                                      |\n| Collapse an inline suggestion.          | `Left Arrow`                                       |\n\n#### Text Input\n\n| Action                               | Keys                                                                                        |\n| ------------------------------------ | ------------------------------------------------------------------------------------------- |\n| Submit the current prompt.           | `Enter (no Ctrl, no Shift, no Cmd, not Paste)`                                              |\n| Insert a newline without submitting. | `Ctrl + Enter`<br />`Cmd + Enter`<br />`Paste + Enter`<br />`Shift + Enter`<br />`Ctrl + J` |\n\n#### External Tools\n\n| Action                                         | Keys       |\n| ---------------------------------------------- | ---------- |\n| Open the current prompt in an external editor. | `Ctrl + X` |\n| Paste from the clipboard.                      | `Ctrl + V` |\n\n#### App Controls\n\n| Action                                                            | Keys       |\n| ----------------------------------------------------------------- | ---------- |\n| Toggle detailed error information.                                | `F12`      |\n| Toggle the full TODO list.                                        | `Ctrl + T` |\n| Toggle IDE context details.                                       | `Ctrl + G` |\n| Toggle Markdown rendering.                                        | `Cmd + M`  |\n| Toggle copy mode when the terminal is using the alternate buffer. | `Ctrl + S` |\n| Expand a height-constrained response to show additional lines.    | `Ctrl + S` |\n| Toggle focus between the shell and Gemini input.                  | `Ctrl + F` |\n\n#### Session Control\n\n| Action                                       | Keys       |\n| -------------------------------------------- | ---------- |\n| Cancel the current request or quit the CLI.  | `Ctrl + C` |\n| Exit the CLI when the input buffer is empty. | `Ctrl + D` |\n\n<!-- KEYBINDINGS-AUTOGEN:END -->\n\n## Additional context-specific shortcuts\n\n- `Ctrl+Y`: Toggle YOLO (auto-approval) mode for tool calls.\n- `Shift+Tab`: Toggle Auto Edit (auto-accept edits) mode.\n- `Option+M` (macOS): Entering `¬µ` with Option+M also toggles Markdown\n  rendering, matching `Cmd+M`.\n- `!` on an empty prompt: Enter or exit shell mode.\n- `\\` (at end of a line) + `Enter`: Insert a newline without leaving single-line\n  mode.\n- `Ctrl+Delete` / `Meta+Delete`: Delete the word to the right of the cursor.\n- `Ctrl+B` or `Left Arrow`: Move the cursor one character to the left while\n  editing text.\n- `Ctrl+F` or `Right Arrow`: Move the cursor one character to the right; with an\n  embedded shell attached, `Ctrl+F` still toggles focus.\n- `Ctrl+D` or `Delete`: Remove the character immediately to the right of the\n  cursor.\n- `Ctrl+H` or `Backspace`: Remove the character immediately to the left of the\n  cursor.\n- `Ctrl+Left Arrow` / `Meta+Left Arrow` / `Meta+B`: Move one word to the left.\n- `Ctrl+Right Arrow` / `Meta+Right Arrow` / `Meta+F`: Move one word to the\n  right.\n- `Ctrl+W`: Delete the word to the left of the cursor (in addition to\n  `Ctrl+Backspace` / `Cmd+Backspace`).\n- `Ctrl+Z` / `Ctrl+Shift+Z`: Undo or redo the most recent text edit.\n- `Meta+Enter`: Open the current input in an external editor (alias for\n  `Ctrl+X`).\n- `Esc` pressed twice quickly: Clear the current input buffer.\n- `Up Arrow` / `Down Arrow`: When the cursor is at the top or bottom of a\n  single-line input, navigate backward or forward through prompt history.\n- `Number keys (1-9, multi-digit)` inside selection dialogs: Jump directly to\n  the numbered radio option and confirm when the full number is entered.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/cli/uninstall.md","content":"# Uninstalling the CLI\n\nYour uninstall method depends on how you ran the CLI. Follow the instructions\nfor either npx or a global npm installation.\n\n## Method 1: Using npx\n\nnpx runs packages from a temporary cache without a permanent installation. To\n\"uninstall\" the CLI, you must clear this cache, which will remove gemini-cli and\nany other packages previously executed with npx.\n\nThe npx cache is a directory named `_npx` inside your main npm cache folder. You\ncan find your npm cache path by running `npm config get cache`.\n\n**For macOS / Linux**\n\n```bash\n# The path is typically ~/.npm/_npx\nrm -rf \"$(npm config get cache)/_npx\"\n```\n\n**For Windows**\n\n_Command Prompt_\n\n```cmd\n:: The path is typically %LocalAppData%\\npm-cache\\_npx\nrmdir /s /q \"%LocalAppData%\\npm-cache\\_npx\"\n```\n\n_PowerShell_\n\n```powershell\n# The path is typically $env:LocalAppData\\npm-cache\\_npx\nRemove-Item -Path (Join-Path $env:LocalAppData \"npm-cache\\_npx\") -Recurse -Force\n```\n\n## Method 2: Using npm (global install)\n\nIf you installed the CLI globally (e.g., `npm install -g @google/gemini-cli`),\nuse the `npm uninstall` command with the `-g` flag to remove it.\n\n```bash\nnpm uninstall -g @google/gemini-cli\n```\n\nThis command completely removes the package from your system.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/cli/custom-commands.md","content":"# Custom commands\n\nCustom commands let you save and reuse your favorite or most frequently used\nprompts as personal shortcuts within Gemini CLI. You can create commands that\nare specific to a single project or commands that are available globally across\nall your projects, streamlining your workflow and ensuring consistency.\n\n## File locations and precedence\n\nGemini CLI discovers commands from two locations, loaded in a specific order:\n\n1.  **User commands (global):** Located in `~/.gemini/commands/`. These commands\n    are available in any project you are working on.\n2.  **Project commands (local):** Located in\n    `<your-project-root>/.gemini/commands/`. These commands are specific to the\n    current project and can be checked into version control to be shared with\n    your team.\n\nIf a command in the project directory has the same name as a command in the user\ndirectory, the **project command will always be used.** This allows projects to\noverride global commands with project-specific versions.\n\n## Naming and namespacing\n\nThe name of a command is determined by its file path relative to its `commands`\ndirectory. Subdirectories are used to create namespaced commands, with the path\nseparator (`/` or `\\`) being converted to a colon (`:`).\n\n- A file at `~/.gemini/commands/test.toml` becomes the command `/test`.\n- A file at `<project>/.gemini/commands/git/commit.toml` becomes the namespaced\n  command `/git:commit`.\n\n## TOML file format (v1)\n\nYour command definition files must be written in the TOML format and use the\n`.toml` file extension.\n\n### Required fields\n\n- `prompt` (String): The prompt that will be sent to the Gemini model when the\n  command is executed. This can be a single-line or multi-line string.\n\n### Optional fields\n\n- `description` (String): A brief, one-line description of what the command\n  does. This text will be displayed next to your command in the `/help` menu.\n  **If you omit this field, a generic description will be generated from the\n  filename.**\n\n## Handling arguments\n\nCustom commands support two powerful methods for handling arguments. The CLI\nautomatically chooses the correct method based on the content of your command\\'s\n`prompt`.\n\n### 1. Context-aware injection with `{{args}}`\n\nIf your `prompt` contains the special placeholder `{{args}}`, the CLI will\nreplace that placeholder with the text the user typed after the command name.\n\nThe behavior of this injection depends on where it is used:\n\n**A. Raw injection (outside shell commands)**\n\nWhen used in the main body of the prompt, the arguments are injected exactly as\nthe user typed them.\n\n**Example (`git/fix.toml`):**\n\n```toml\n# Invoked via: /git:fix \"Button is misaligned\"\n\ndescription = \"Generates a fix for a given issue.\"\nprompt = \"Please provide a code fix for the issue described here: {{args}}.\"\n```\n\nThe model receives:\n`Please provide a code fix for the issue described here: \"Button is misaligned\".`\n\n**B. Using arguments in shell commands (inside `!{...}` blocks)**\n\nWhen you use `{{args}}` inside a shell injection block (`!{...}`), the arguments\nare automatically **shell-escaped** before replacement. This allows you to\nsafely pass arguments to shell commands, ensuring the resulting command is\nsyntactically correct and secure while preventing command injection\nvulnerabilities.\n\n**Example (`/grep-code.toml`):**\n\n```toml\nprompt = \"\"\"\nPlease summarize the findings for the pattern `{{args}}`.\n\nSearch Results:\n!{grep -r {{args}} .}\n\"\"\"\n```\n\nWhen you run `/grep-code It\\'s complicated`:\n\n1. The CLI sees `{{args}}` used both outside and inside `!{...}`.\n2. Outside: The first `{{args}}` is replaced raw with `It\\'s complicated`.\n3. Inside: The second `{{args}}` is replaced with the escaped version (e.g., on\n   Linux: `\"It\\'s complicated\"`).\n4. The command executed is `grep -r \"It\\'s complicated\" .`.\n5. The CLI prompts you to confirm this exact, secure command before execution.\n6. The final prompt is sent.\n\n### 2. Default argument handling\n\nIf your `prompt` does **not** contain the special placeholder `{{args}}`, the\nCLI uses a default behavior for handling arguments.\n\nIf you provide arguments to the command (e.g., `/mycommand arg1`), the CLI will\nappend the full command you typed to the end of the prompt, separated by two\nnewlines. This allows the model to see both the original instructions and the\nspecific arguments you just provided.\n\nIf you do **not** provide any arguments (e.g., `/mycommand`), the prompt is sent\nto the model exactly as it is, with nothing appended.\n\n**Example (`changelog.toml`):**\n\nThis example shows how to create a robust command by defining a role for the\nmodel, explaining where to find the user's input, and specifying the expected\nformat and behavior.\n\n```toml\n# In: <project>/.gemini/commands/changelog.toml\n# Invoked via: /changelog 1.2.0 added \"Support for default argument parsing.\"\n\ndescription = \"Adds a new entry to the project\\'s CHANGELOG.md file.\"\nprompt = \"\"\"\n# Task: Update Changelog\n\nYou are an expert maintainer of this software project. A user has invoked a command to add a new entry to the changelog.\n\n**The user\\'s raw command is appended below your instructions.**\n\nYour task is to parse the `<version>`, `<change_type>`, and `<message>` from their input and use the `write_file` tool to correctly update the `CHANGELOG.md` file.\n\n## Expected Format\nThe command follows this format: `/changelog <version> <type> <message>`\n- `<type>` must be one of: \"added\", \"changed\", \"fixed\", \"removed\".\n\n## Behavior\n1. Read the `CHANGELOG.md` file.\n2. Find the section for the specified `<version>`.\n3. Add the `<message>` under the correct `<type>` heading.\n4. If the version or type section doesn\\'t exist, create it.\n5. Adhere strictly to the \"Keep a Changelog\" format.\n\"\"\"\n```\n\nWhen you run `/changelog 1.2.0 added \"New feature\"`, the final text sent to the\nmodel will be the original prompt followed by two newlines and the command you\ntyped.\n\n### 3. Executing shell commands with `!{...}`\n\nYou can make your commands dynamic by executing shell commands directly within\nyour `prompt` and injecting their output. This is ideal for gathering context\nfrom your local environment, like reading file content or checking the status of\nGit.\n\nWhen a custom command attempts to execute a shell command, Gemini CLI will now\nprompt you for confirmation before proceeding. This is a security measure to\nensure that only intended commands can be run.\n\n**How it works:**\n\n1.  **Inject commands:** Use the `!{...}` syntax.\n2.  **Argument substitution:** If `{{args}}` is present inside the block, it is\n    automatically shell-escaped (see\n    [Context-Aware Injection](#1-context-aware-injection-with-args) above).\n3.  **Robust parsing:** The parser correctly handles complex shell commands that\n    include nested braces, such as JSON payloads. **Note:** The content inside\n    `!{...}` must have balanced braces (`{` and `}`). If you need to execute a\n    command containing unbalanced braces, consider wrapping it in an external\n    script file and calling the script within the `!{...}` block.\n4.  **Security check and confirmation:** The CLI performs a security check on\n    the final, resolved command (after arguments are escaped and substituted). A\n    dialog will appear showing the exact command(s) to be executed.\n5.  **Execution and error reporting:** The command is executed. If the command\n    fails, the output injected into the prompt will include the error messages\n    (stderr) followed by a status line, e.g.,\n    `[Shell command exited with code 1]`. This helps the model understand the\n    context of the failure.\n\n**Example (`git/commit.toml`):**\n\nThis command gets the staged git diff and uses it to ask the model to write a\ncommit message.\n\n````toml\n# In: <project>/.gemini/commands/git/commit.toml\n# Invoked via: /git:commit\n\ndescription = \"Generates a Git commit message based on staged changes.\"\n\n# The prompt uses !{...} to execute the command and inject its output.\nprompt = \"\"\"\nPlease generate a Conventional Commit message based on the following git diff:\n\n```diff\n!{git diff --staged}\n```\n\n\"\"\"\n\n````\n\nWhen you run `/git:commit`, the CLI first executes `git diff --staged`, then\nreplaces `!{git diff --staged}` with the output of that command before sending\nthe final, complete prompt to the model.\n\n### 4. Injecting file content with `@{...}`\n\nYou can directly embed the content of a file or a directory listing into your\nprompt using the `@{...}` syntax. This is useful for creating commands that\noperate on specific files.\n\n**How it works:**\n\n- **File injection**: `@{path/to/file.txt}` is replaced by the content of\n  `file.txt`.\n- **Multimodal support**: If the path points to a supported image (e.g., PNG,\n  JPEG), PDF, audio, or video file, it will be correctly encoded and injected as\n  multimodal input. Other binary files are handled gracefully and skipped.\n- **Directory listing**: `@{path/to/dir}` is traversed and each file present\n  within the directory and all subdirectories is inserted into the prompt. This\n  respects `.gitignore` and `.geminiignore` if enabled.\n- **Workspace-aware**: The command searches for the path in the current\n  directory and any other workspace directories. Absolute paths are allowed if\n  they are within the workspace.\n- **Processing order**: File content injection with `@{...}` is processed\n  _before_ shell commands (`!{...}`) and argument substitution (`{{args}}`).\n- **Parsing**: The parser requires the content inside `@{...}` (the path) to\n  have balanced braces (`{` and `}`).\n\n**Example (`review.toml`):**\n\nThis command injects the content of a _fixed_ best practices file\n(`docs/best-practices.md`) and uses the user\\'s arguments to provide context for\nthe review.\n\n```toml\n# In: <project>/.gemini/commands/review.toml\n# Invoked via: /review FileCommandLoader.ts\n\ndescription = \"Reviews the provided context using a best practice guide.\"\nprompt = \"\"\"\nYou are an expert code reviewer.\n\nYour task is to review {{args}}.\n\nUse the following best practices when providing your review:\n\n@{docs/best-practices.md}\n\"\"\"\n```\n\nWhen you run `/review FileCommandLoader.ts`, the `@{docs/best-practices.md}`\nplaceholder is replaced by the content of that file, and `{{args}}` is replaced\nby the text you provided, before the final prompt is sent to the model.\n\n---\n\n## Example: A \"Pure Function\" refactoring command\n\nLet's create a global command that asks the model to refactor a piece of code.\n\n**1. Create the file and directories:**\n\nFirst, ensure the user commands directory exists, then create a `refactor`\nsubdirectory for organization and the final TOML file.\n\n```bash\nmkdir -p ~/.gemini/commands/refactor\ntouch ~/.gemini/commands/refactor/pure.toml\n```\n\n**2. Add the content to the file:**\n\nOpen `~/.gemini/commands/refactor/pure.toml` in your editor and add the\nfollowing content. We are including the optional `description` for best\npractice.\n\n```toml\n# In: ~/.gemini/commands/refactor/pure.toml\n# This command will be invoked via: /refactor:pure\n\ndescription = \"Asks the model to refactor the current context into a pure function.\"\n\nprompt = \"\"\"\nPlease analyze the code I\\'ve provided in the current context.\nRefactor it into a pure function.\n\nYour response should include:\n1. The refactored, pure function code block.\n2. A brief explanation of the key changes you made and why they contribute to purity.\n\"\"\"\n```\n\n**3. Run the command:**\n\nThat's it! You can now run your command in the CLI. First, you might add a file\nto the context, and then invoke your command:\n\n```\n> @my-messy-function.js\n> /refactor:pure\n```\n\nGemini CLI will then execute the multi-line prompt defined in your TOML file.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/cli/telemetry.md","content":"# Observability with OpenTelemetry\n\nLearn how to enable and setup OpenTelemetry for Gemini CLI.\n\n- [Observability with OpenTelemetry](#observability-with-opentelemetry)\n  - [Key benefits](#key-benefits)\n  - [OpenTelemetry integration](#opentelemetry-integration)\n  - [Configuration](#configuration)\n  - [Google Cloud telemetry](#google-cloud-telemetry)\n    - [Prerequisites](#prerequisites)\n    - [Direct export (recommended)](#direct-export-recommended)\n    - [Collector-based export (advanced)](#collector-based-export-advanced)\n  - [Local telemetry](#local-telemetry)\n    - [File-based output (recommended)](#file-based-output-recommended)\n    - [Collector-based export (advanced)](#collector-based-export-advanced-1)\n  - [Logs and metrics](#logs-and-metrics)\n    - [Logs](#logs)\n      - [Sessions](#sessions)\n      - [Tools](#tools)\n      - [Files](#files)\n      - [API](#api)\n      - [Model routing](#model-routing)\n      - [Chat and streaming](#chat-and-streaming)\n      - [Resilience](#resilience)\n      - [Extensions](#extensions)\n      - [Agent runs](#agent-runs)\n      - [IDE](#ide)\n      - [UI](#ui)\n    - [Metrics](#metrics)\n      - [Custom](#custom)\n        - [Sessions](#sessions-1)\n        - [Tools](#tools-1)\n        - [API](#api-1)\n        - [Token usage](#token-usage)\n        - [Files](#files-1)\n        - [Chat and streaming](#chat-and-streaming-1)\n        - [Model routing](#model-routing-1)\n        - [Agent runs](#agent-runs-1)\n        - [UI](#ui-1)\n        - [Performance](#performance)\n      - [GenAI semantic convention](#genai-semantic-convention)\n\n## Key benefits\n\n- **üîç Usage analytics**: Understand interaction patterns and feature adoption\n  across your team\n- **‚ö° Performance monitoring**: Track response times, token consumption, and\n  resource utilization\n- **üêõ Real-time debugging**: Identify bottlenecks, failures, and error patterns\n  as they occur\n- **üìä Workflow optimization**: Make informed decisions to improve\n  configurations and processes\n- **üè¢ Enterprise governance**: Monitor usage across teams, track costs, ensure\n  compliance, and integrate with existing monitoring infrastructure\n\n## OpenTelemetry integration\n\nBuilt on **[OpenTelemetry]** ‚Äî the vendor-neutral, industry-standard\nobservability framework ‚Äî Gemini CLI's observability system provides:\n\n- **Universal compatibility**: Export to any OpenTelemetry backend (Google\n  Cloud, Jaeger, Prometheus, Datadog, etc.)\n- **Standardized data**: Use consistent formats and collection methods across\n  your toolchain\n- **Future-proof integration**: Connect with existing and future observability\n  infrastructure\n- **No vendor lock-in**: Switch between backends without changing your\n  instrumentation\n\n[OpenTelemetry]: https://opentelemetry.io/\n\n## Configuration\n\nAll telemetry behavior is controlled through your `.gemini/settings.json` file.\nEnvironment variables can be used to override the settings in the file.\n\n| Setting        | Environment Variable             | Description                                         | Values            | Default                 |\n| -------------- | -------------------------------- | --------------------------------------------------- | ----------------- | ----------------------- |\n| `enabled`      | `GEMINI_TELEMETRY_ENABLED`       | Enable or disable telemetry                         | `true`/`false`    | `false`                 |\n| `target`       | `GEMINI_TELEMETRY_TARGET`        | Where to send telemetry data                        | `\"gcp\"`/`\"local\"` | `\"local\"`               |\n| `otlpEndpoint` | `GEMINI_TELEMETRY_OTLP_ENDPOINT` | OTLP collector endpoint                             | URL string        | `http://localhost:4317` |\n| `otlpProtocol` | `GEMINI_TELEMETRY_OTLP_PROTOCOL` | OTLP transport protocol                             | `\"grpc\"`/`\"http\"` | `\"grpc\"`                |\n| `outfile`      | `GEMINI_TELEMETRY_OUTFILE`       | Save telemetry to file (overrides `otlpEndpoint`)   | file path         | -                       |\n| `logPrompts`   | `GEMINI_TELEMETRY_LOG_PROMPTS`   | Include prompts in telemetry logs                   | `true`/`false`    | `true`                  |\n| `useCollector` | `GEMINI_TELEMETRY_USE_COLLECTOR` | Use external OTLP collector (advanced)              | `true`/`false`    | `false`                 |\n| `useCliAuth`   | `GEMINI_TELEMETRY_USE_CLI_AUTH`  | Use CLI credentials for telemetry (GCP target only) | `true`/`false`    | `false`                 |\n\n**Note on boolean environment variables:** For the boolean settings (`enabled`,\n`logPrompts`, `useCollector`), setting the corresponding environment variable to\n`true` or `1` will enable the feature. Any other value will disable it.\n\nFor detailed information about all configuration options, see the\n[Configuration guide](../get-started/configuration.md).\n\n## Google Cloud telemetry\n\n### Prerequisites\n\nBefore using either method below, complete these steps:\n\n1. Set your Google Cloud project ID:\n   - For telemetry in a separate project from inference:\n     ```bash\n     export OTLP_GOOGLE_CLOUD_PROJECT=\"your-telemetry-project-id\"\n     ```\n   - For telemetry in the same project as inference:\n     ```bash\n     export GOOGLE_CLOUD_PROJECT=\"your-project-id\"\n     ```\n\n2. Authenticate with Google Cloud:\n   - If using a user account:\n     ```bash\n     gcloud auth application-default login\n     ```\n   - If using a service account:\n     ```bash\n     export GOOGLE_APPLICATION_CREDENTIALS=\"/path/to/your/service-account.json\"\n     ```\n3. Make sure your account or service account has these IAM roles:\n   - Cloud Trace Agent\n   - Monitoring Metric Writer\n   - Logs Writer\n\n4. Enable the required Google Cloud APIs (if not already enabled):\n   ```bash\n   gcloud services enable \\\n     cloudtrace.googleapis.com \\\n     monitoring.googleapis.com \\\n     logging.googleapis.com \\\n     --project=\"$OTLP_GOOGLE_CLOUD_PROJECT\"\n   ```\n\n### Authenticating with CLI Credentials\n\nBy default, the telemetry collector for Google Cloud uses Application Default\nCredentials (ADC). However, you can configure it to use the same OAuth\ncredentials that you use to log in to the Gemini CLI. This is useful in\nenvironments where you don't have ADC set up.\n\nTo enable this, set the `useCliAuth` property in your `telemetry` settings to\n`true`:\n\n```json\n{\n  \"telemetry\": {\n    \"enabled\": true,\n    \"target\": \"gcp\",\n    \"useCliAuth\": true\n  }\n}\n```\n\n**Important:**\n\n- This setting requires the use of **Direct Export** (in-process exporters).\n- It **cannot** be used with `useCollector: true`. If you enable both, telemetry\n  will be disabled and an error will be logged.\n- The CLI will automatically use your credentials to authenticate with Google\n  Cloud Trace, Metrics, and Logging APIs.\n\n### Direct export (recommended)\n\nSends telemetry directly to Google Cloud services. No collector needed.\n\n1. Enable telemetry in your `.gemini/settings.json`:\n   ```json\n   {\n     \"telemetry\": {\n       \"enabled\": true,\n       \"target\": \"gcp\"\n     }\n   }\n   ```\n2. Run Gemini CLI and send prompts.\n3. View logs and metrics:\n   - Open the Google Cloud Console in your browser after sending prompts:\n     - Logs: https://console.cloud.google.com/logs/\n     - Metrics: https://console.cloud.google.com/monitoring/metrics-explorer\n     - Traces: https://console.cloud.google.com/traces/list\n\n### Collector-based export (advanced)\n\nFor custom processing, filtering, or routing, use an OpenTelemetry collector to\nforward data to Google Cloud.\n\n1. Configure your `.gemini/settings.json`:\n   ```json\n   {\n     \"telemetry\": {\n       \"enabled\": true,\n       \"target\": \"gcp\",\n       \"useCollector\": true\n     }\n   }\n   ```\n2. Run the automation script:\n   ```bash\n   npm run telemetry -- --target=gcp\n   ```\n   This will:\n   - Start a local OTEL collector that forwards to Google Cloud\n   - Configure your workspace\n   - Provide links to view traces, metrics, and logs in Google Cloud Console\n   - Save collector logs to `~/.gemini/tmp/<projectHash>/otel/collector-gcp.log`\n   - Stop collector on exit (e.g. `Ctrl+C`)\n3. Run Gemini CLI and send prompts.\n4. View logs and metrics:\n   - Open the Google Cloud Console in your browser after sending prompts:\n     - Logs: https://console.cloud.google.com/logs/\n     - Metrics: https://console.cloud.google.com/monitoring/metrics-explorer\n     - Traces: https://console.cloud.google.com/traces/list\n   - Open `~/.gemini/tmp/<projectHash>/otel/collector-gcp.log` to view local\n     collector logs.\n\n## Local telemetry\n\nFor local development and debugging, you can capture telemetry data locally:\n\n### File-based output (recommended)\n\n1. Enable telemetry in your `.gemini/settings.json`:\n   ```json\n   {\n     \"telemetry\": {\n       \"enabled\": true,\n       \"target\": \"local\",\n       \"otlpEndpoint\": \"\",\n       \"outfile\": \".gemini/telemetry.log\"\n     }\n   }\n   ```\n2. Run Gemini CLI and send prompts.\n3. View logs and metrics in the specified file (e.g., `.gemini/telemetry.log`).\n\n### Collector-based export (advanced)\n\n1. Run the automation script:\n   ```bash\n   npm run telemetry -- --target=local\n   ```\n   This will:\n   - Download and start Jaeger and OTEL collector\n   - Configure your workspace for local telemetry\n   - Provide a Jaeger UI at http://localhost:16686\n   - Save logs/metrics to `~/.gemini/tmp/<projectHash>/otel/collector.log`\n   - Stop collector on exit (e.g. `Ctrl+C`)\n2. Run Gemini CLI and send prompts.\n3. View traces at http://localhost:16686 and logs/metrics in the collector log\n   file.\n\n## Logs and metrics\n\nThe following section describes the structure of logs and metrics generated for\nGemini CLI.\n\nThe `session.id`, `installation.id`, and `user.email` (available only when\nauthenticated with a Google account) are included as common attributes on all\nlogs and metrics.\n\n### Logs\n\nLogs are timestamped records of specific events. The following events are logged\nfor Gemini CLI, grouped by category.\n\n#### Sessions\n\nCaptures startup configuration and user prompt submissions.\n\n- `gemini_cli.config`: Emitted once at startup with the CLI configuration.\n  - **Attributes**:\n    - `model` (string)\n    - `embedding_model` (string)\n    - `sandbox_enabled` (boolean)\n    - `core_tools_enabled` (string)\n    - `approval_mode` (string)\n    - `api_key_enabled` (boolean)\n    - `vertex_ai_enabled` (boolean)\n    - `log_user_prompts_enabled` (boolean)\n    - `file_filtering_respect_git_ignore` (boolean)\n    - `debug_mode` (boolean)\n    - `mcp_servers` (string)\n    - `mcp_servers_count` (int)\n    - `extensions` (string)\n    - `extension_ids` (string)\n    - `extension_count` (int)\n    - `mcp_tools` (string, if applicable)\n    - `mcp_tools_count` (int, if applicable)\n    - `output_format` (\"text\", \"json\", or \"stream-json\")\n\n- `gemini_cli.user_prompt`: Emitted when a user submits a prompt.\n  - **Attributes**:\n    - `prompt_length` (int)\n    - `prompt_id` (string)\n    - `prompt` (string; excluded if `telemetry.logPrompts` is `false`)\n    - `auth_type` (string)\n\n#### Tools\n\nCaptures tool executions, output truncation, and Smart Edit behavior.\n\n- `gemini_cli.tool_call`: Emitted for each tool (function) call.\n  - **Attributes**:\n    - `function_name`\n    - `function_args`\n    - `duration_ms`\n    - `success` (boolean)\n    - `decision` (\"accept\", \"reject\", \"auto_accept\", or \"modify\", if applicable)\n    - `error` (if applicable)\n    - `error_type` (if applicable)\n    - `prompt_id` (string)\n    - `tool_type` (\"native\" or \"mcp\")\n    - `mcp_server_name` (string, if applicable)\n    - `extension_name` (string, if applicable)\n    - `extension_id` (string, if applicable)\n    - `content_length` (int, if applicable)\n    - `metadata` (if applicable)\n\n- `gemini_cli.tool_output_truncated`: Output of a tool call was truncated.\n  - **Attributes**:\n    - `tool_name` (string)\n    - `original_content_length` (int)\n    - `truncated_content_length` (int)\n    - `threshold` (int)\n    - `lines` (int)\n    - `prompt_id` (string)\n\n- `gemini_cli.smart_edit_strategy`: Smart Edit strategy chosen.\n  - **Attributes**:\n    - `strategy` (string)\n\n- `gemini_cli.smart_edit_correction`: Smart Edit correction result.\n  - **Attributes**:\n    - `correction` (\"success\" | \"failure\")\n\n- `gen_ai.client.inference.operation.details`: This event provides detailed\n  information about the GenAI operation, aligned with [OpenTelemetry GenAI\n  semantic conventions for events].\n  - **Attributes**:\n    - `gen_ai.request.model` (string)\n    - `gen_ai.provider.name` (string)\n    - `gen_ai.operation.name` (string)\n    - `gen_ai.input.messages` (json string)\n    - `gen_ai.output.messages` (json string)\n    - `gen_ai.response.finish_reasons` (array of strings)\n    - `gen_ai.usage.input_tokens` (int)\n    - `gen_ai.usage.output_tokens` (int)\n    - `gen_ai.request.temperature` (float)\n    - `gen_ai.request.top_p` (float)\n    - `gen_ai.request.top_k` (int)\n    - `gen_ai.request.max_tokens` (int)\n    - `gen_ai.system_instructions` (json string)\n    - `server.address` (string)\n    - `server.port` (int)\n\n#### Files\n\nTracks file operations performed by tools.\n\n- `gemini_cli.file_operation`: Emitted for each file operation.\n  - **Attributes**:\n    - `tool_name` (string)\n    - `operation` (\"create\" | \"read\" | \"update\")\n    - `lines` (int, optional)\n    - `mimetype` (string, optional)\n    - `extension` (string, optional)\n    - `programming_language` (string, optional)\n\n#### API\n\nCaptures Gemini API requests, responses, and errors.\n\n- `gemini_cli.api_request`: Request sent to Gemini API.\n  - **Attributes**:\n    - `model` (string)\n    - `prompt_id` (string)\n    - `request_text` (string, optional)\n\n- `gemini_cli.api_response`: Response received from Gemini API.\n  - **Attributes**:\n    - `model` (string)\n    - `status_code` (int|string)\n    - `duration_ms` (int)\n    - `input_token_count` (int)\n    - `output_token_count` (int)\n    - `cached_content_token_count` (int)\n    - `thoughts_token_count` (int)\n    - `tool_token_count` (int)\n    - `total_token_count` (int)\n    - `response_text` (string, optional)\n    - `prompt_id` (string)\n    - `auth_type` (string)\n    - `finish_reasons` (array of strings)\n\n- `gemini_cli.api_error`: API request failed.\n  - **Attributes**:\n    - `model` (string)\n    - `error` (string)\n    - `error_type` (string)\n    - `status_code` (int|string)\n    - `duration_ms` (int)\n    - `prompt_id` (string)\n    - `auth_type` (string)\n\n- `gemini_cli.malformed_json_response`: `generateJson` response could not be\n  parsed.\n  - **Attributes**:\n    - `model` (string)\n\n#### Model routing\n\n- `gemini_cli.slash_command`: A slash command was executed.\n  - **Attributes**:\n    - `command` (string)\n    - `subcommand` (string, optional)\n    - `status` (\"success\" | \"error\")\n\n- `gemini_cli.slash_command.model`: Model was selected via slash command.\n  - **Attributes**:\n    - `model_name` (string)\n\n- `gemini_cli.model_routing`: Model router made a decision.\n  - **Attributes**:\n    - `decision_model` (string)\n    - `decision_source` (string)\n    - `routing_latency_ms` (int)\n    - `reasoning` (string, optional)\n    - `failed` (boolean)\n    - `error_message` (string, optional)\n\n#### Chat and streaming\n\n- `gemini_cli.chat_compression`: Chat context was compressed.\n  - **Attributes**:\n    - `tokens_before` (int)\n    - `tokens_after` (int)\n\n- `gemini_cli.chat.invalid_chunk`: Invalid chunk received from a stream.\n  - **Attributes**:\n    - `error.message` (string, optional)\n\n- `gemini_cli.chat.content_retry`: Retry triggered due to a content error.\n  - **Attributes**:\n    - `attempt_number` (int)\n    - `error_type` (string)\n    - `retry_delay_ms` (int)\n    - `model` (string)\n\n- `gemini_cli.chat.content_retry_failure`: All content retries failed.\n  - **Attributes**:\n    - `total_attempts` (int)\n    - `final_error_type` (string)\n    - `total_duration_ms` (int, optional)\n    - `model` (string)\n\n- `gemini_cli.conversation_finished`: Conversation session ended.\n  - **Attributes**:\n    - `approvalMode` (string)\n    - `turnCount` (int)\n\n- `gemini_cli.next_speaker_check`: Next speaker determination.\n  - **Attributes**:\n    - `prompt_id` (string)\n    - `finish_reason` (string)\n    - `result` (string)\n\n#### Resilience\n\nRecords fallback mechanisms for models and network operations.\n\n- `gemini_cli.flash_fallback`: Switched to a flash model as fallback.\n  - **Attributes**:\n    - `auth_type` (string)\n\n- `gemini_cli.ripgrep_fallback`: Switched to grep as fallback for file search.\n  - **Attributes**:\n    - `error` (string, optional)\n\n- `gemini_cli.web_fetch_fallback_attempt`: Attempted web-fetch fallback.\n  - **Attributes**:\n    - `reason` (\"private_ip\" | \"primary_failed\")\n\n#### Extensions\n\nTracks extension lifecycle and settings changes.\n\n- `gemini_cli.extension_install`: An extension was installed.\n  - **Attributes**:\n    - `extension_name` (string)\n    - `extension_version` (string)\n    - `extension_source` (string)\n    - `status` (string)\n\n- `gemini_cli.extension_uninstall`: An extension was uninstalled.\n  - **Attributes**:\n    - `extension_name` (string)\n    - `status` (string)\n\n- `gemini_cli.extension_enable`: An extension was enabled.\n  - **Attributes**:\n    - `extension_name` (string)\n    - `setting_scope` (string)\n\n- `gemini_cli.extension_disable`: An extension was disabled.\n  - **Attributes**:\n    - `extension_name` (string)\n    - `setting_scope` (string)\n\n- `gemini_cli.extension_update`: An extension was updated.\n  - **Attributes**:\n    - `extension_name` (string)\n    - `extension_version` (string)\n    - `extension_previous_version` (string)\n    - `extension_source` (string)\n    - `status` (string)\n\n#### Agent runs\n\n- `gemini_cli.agent.start`: Agent run started.\n  - **Attributes**:\n    - `agent_id` (string)\n    - `agent_name` (string)\n\n- `gemini_cli.agent.finish`: Agent run finished.\n  - **Attributes**:\n    - `agent_id` (string)\n    - `agent_name` (string)\n    - `duration_ms` (int)\n    - `turn_count` (int)\n    - `terminate_reason` (string)\n\n#### IDE\n\nCaptures IDE connectivity and conversation lifecycle events.\n\n- `gemini_cli.ide_connection`: IDE companion connection.\n  - **Attributes**:\n    - `connection_type` (string)\n\n#### UI\n\nTracks terminal rendering issues and related signals.\n\n- `kitty_sequence_overflow`: Terminal kitty control sequence overflow.\n  - **Attributes**:\n    - `sequence_length` (int)\n    - `truncated_sequence` (string)\n\n### Metrics\n\nMetrics are numerical measurements of behavior over time.\n\n#### Custom\n\n##### Sessions\n\nCounts CLI sessions at startup.\n\n- `gemini_cli.session.count` (Counter, Int): Incremented once per CLI startup.\n\n##### Tools\n\nMeasures tool usage and latency.\n\n- `gemini_cli.tool.call.count` (Counter, Int): Counts tool calls.\n  - **Attributes**:\n    - `function_name`\n    - `success` (boolean)\n    - `decision` (string: \"accept\", \"reject\", \"modify\", or \"auto_accept\", if\n      applicable)\n    - `tool_type` (string: \"mcp\" or \"native\", if applicable)\n\n- `gemini_cli.tool.call.latency` (Histogram, ms): Measures tool call latency.\n  - **Attributes**:\n    - `function_name`\n\n##### API\n\nTracks API request volume and latency.\n\n- `gemini_cli.api.request.count` (Counter, Int): Counts all API requests.\n  - **Attributes**:\n    - `model`\n    - `status_code`\n    - `error_type` (if applicable)\n\n- `gemini_cli.api.request.latency` (Histogram, ms): Measures API request\n  latency.\n  - **Attributes**:\n    - `model`\n  - Note: Overlaps with `gen_ai.client.operation.duration` (GenAI conventions).\n\n##### Token usage\n\nTracks tokens used by model and type.\n\n- `gemini_cli.token.usage` (Counter, Int): Counts tokens used.\n  - **Attributes**:\n    - `model`\n    - `type` (\"input\", \"output\", \"thought\", \"cache\", or \"tool\")\n  - Note: Overlaps with `gen_ai.client.token.usage` for `input`/`output`.\n\n##### Files\n\nCounts file operations with basic context.\n\n- `gemini_cli.file.operation.count` (Counter, Int): Counts file operations.\n  - **Attributes**:\n    - `operation` (\"create\", \"read\", \"update\")\n    - `lines` (Int, optional)\n    - `mimetype` (string, optional)\n    - `extension` (string, optional)\n    - `programming_language` (string, optional)\n\n- `gemini_cli.lines.changed` (Counter, Int): Number of lines changed (from file\n  diffs).\n  - **Attributes**:\n    - `function_name`\n    - `type` (\"added\" or \"removed\")\n\n##### Chat and streaming\n\nResilience counters for compression, invalid chunks, and retries.\n\n- `gemini_cli.chat_compression` (Counter, Int): Counts chat compression\n  operations.\n  - **Attributes**:\n    - `tokens_before` (Int)\n    - `tokens_after` (Int)\n\n- `gemini_cli.chat.invalid_chunk.count` (Counter, Int): Counts invalid chunks\n  from streams.\n\n- `gemini_cli.chat.content_retry.count` (Counter, Int): Counts retries due to\n  content errors.\n\n- `gemini_cli.chat.content_retry_failure.count` (Counter, Int): Counts requests\n  where all content retries failed.\n\n##### Model routing\n\nRouting latency/failures and slash-command selections.\n\n- `gemini_cli.slash_command.model.call_count` (Counter, Int): Counts model\n  selections via slash command.\n  - **Attributes**:\n    - `slash_command.model.model_name` (string)\n\n- `gemini_cli.model_routing.latency` (Histogram, ms): Model routing decision\n  latency.\n  - **Attributes**:\n    - `routing.decision_model` (string)\n    - `routing.decision_source` (string)\n\n- `gemini_cli.model_routing.failure.count` (Counter, Int): Counts model routing\n  failures.\n  - **Attributes**:\n    - `routing.decision_source` (string)\n    - `routing.error_message` (string)\n\n##### Agent runs\n\nAgent lifecycle metrics: runs, durations, and turns.\n\n- `gemini_cli.agent.run.count` (Counter, Int): Counts agent runs.\n  - **Attributes**:\n    - `agent_name` (string)\n    - `terminate_reason` (string)\n\n- `gemini_cli.agent.duration` (Histogram, ms): Agent run durations.\n  - **Attributes**:\n    - `agent_name` (string)\n\n- `gemini_cli.agent.turns` (Histogram, turns): Turns taken per agent run.\n  - **Attributes**:\n    - `agent_name` (string)\n\n##### UI\n\nUI stability signals such as flicker count.\n\n- `gemini_cli.ui.flicker.count` (Counter, Int): Counts UI frames that flicker\n  (render taller than terminal).\n\n##### Performance\n\nOptional performance monitoring for startup, CPU/memory, and phase timing.\n\n- `gemini_cli.startup.duration` (Histogram, ms): CLI startup time by phase.\n  - **Attributes**:\n    - `phase` (string)\n    - `details` (map, optional)\n\n- `gemini_cli.memory.usage` (Histogram, bytes): Memory usage.\n  - **Attributes**:\n    - `memory_type` (\"heap_used\", \"heap_total\", \"external\", \"rss\")\n    - `component` (string, optional)\n\n- `gemini_cli.cpu.usage` (Histogram, percent): CPU usage percentage.\n  - **Attributes**:\n    - `component` (string, optional)\n\n- `gemini_cli.tool.queue.depth` (Histogram, count): Number of tools in the\n  execution queue.\n\n- `gemini_cli.tool.execution.breakdown` (Histogram, ms): Tool time by phase.\n  - **Attributes**:\n    - `function_name` (string)\n    - `phase` (\"validation\", \"preparation\", \"execution\", \"result_processing\")\n\n- `gemini_cli.api.request.breakdown` (Histogram, ms): API request time by phase.\n  - **Attributes**:\n    - `model` (string)\n    - `phase` (\"request_preparation\", \"network_latency\", \"response_processing\",\n      \"token_processing\")\n\n- `gemini_cli.token.efficiency` (Histogram, ratio): Token efficiency metrics.\n  - **Attributes**:\n    - `model` (string)\n    - `metric` (string)\n    - `context` (string, optional)\n\n- `gemini_cli.performance.score` (Histogram, score): Composite performance\n  score.\n  - **Attributes**:\n    - `category` (string)\n    - `baseline` (number, optional)\n\n- `gemini_cli.performance.regression` (Counter, Int): Regression detection\n  events.\n  - **Attributes**:\n    - `metric` (string)\n    - `severity` (\"low\", \"medium\", \"high\")\n    - `current_value` (number)\n    - `baseline_value` (number)\n\n- `gemini_cli.performance.regression.percentage_change` (Histogram, percent):\n  Percent change from baseline when regression detected.\n  - **Attributes**:\n    - `metric` (string)\n    - `severity` (\"low\", \"medium\", \"high\")\n    - `current_value` (number)\n    - `baseline_value` (number)\n\n- `gemini_cli.performance.baseline.comparison` (Histogram, percent): Comparison\n  to baseline.\n  - **Attributes**:\n    - `metric` (string)\n    - `category` (string)\n    - `current_value` (number)\n    - `baseline_value` (number)\n\n#### GenAI semantic convention\n\nThe following metrics comply with [OpenTelemetry GenAI semantic conventions] for\nstandardized observability across GenAI applications:\n\n- `gen_ai.client.token.usage` (Histogram, token): Number of input and output\n  tokens used per operation.\n  - **Attributes**:\n    - `gen_ai.operation.name` (string): The operation type (e.g.,\n      \"generate_content\", \"chat\")\n    - `gen_ai.provider.name` (string): The GenAI provider (\"gcp.gen_ai\" or\n      \"gcp.vertex_ai\")\n    - `gen_ai.token.type` (string): The token type (\"input\" or \"output\")\n    - `gen_ai.request.model` (string, optional): The model name used for the\n      request\n    - `gen_ai.response.model` (string, optional): The model name that generated\n      the response\n    - `server.address` (string, optional): GenAI server address\n    - `server.port` (int, optional): GenAI server port\n\n- `gen_ai.client.operation.duration` (Histogram, s): GenAI operation duration in\n  seconds.\n  - **Attributes**:\n    - `gen_ai.operation.name` (string): The operation type (e.g.,\n      \"generate_content\", \"chat\")\n    - `gen_ai.provider.name` (string): The GenAI provider (\"gcp.gen_ai\" or\n      \"gcp.vertex_ai\")\n    - `gen_ai.request.model` (string, optional): The model name used for the\n      request\n    - `gen_ai.response.model` (string, optional): The model name that generated\n      the response\n    - `server.address` (string, optional): GenAI server address\n    - `server.port` (int, optional): GenAI server port\n    - `error.type` (string, optional): Error type if the operation failed\n\n[OpenTelemetry GenAI semantic conventions]:\n  https://github.com/open-telemetry/semantic-conventions/blob/main/docs/gen-ai/gen-ai-metrics.md\n[OpenTelemetry GenAI semantic conventions for events]:\n  https://github.com/open-telemetry/semantic-conventions/blob/8b4f210f43136e57c1f6f47292eb6d38e3bf30bb/docs/gen-ai/gen-ai-events.md\n"}
{"source":"github","repo":"gemini-cli","path":"docs/cli/generation-settings.md","content":"# Advanced Model Configuration\n\nThis guide details the Model Configuration system within the Gemini CLI.\nDesigned for researchers, AI quality engineers, and advanced users, this system\nprovides a rigorous framework for managing generative model hyperparameters and\nbehaviors.\n\n> **Warning**: This is a power-user feature. Configuration values are passed\n> directly to the model provider with minimal validation. Incorrect settings\n> (e.g., incompatible parameter combinations) may result in runtime errors from\n> the API.\n\n## 1. System Overview\n\nThe Model Configuration system (`ModelConfigService`) enables deterministic\ncontrol over model generation. It decouples the requested model identifier\n(e.g., a CLI flag or agent request) from the underlying API configuration. This\nallows for:\n\n- **Precise Hyperparameter Tuning**: Direct control over `temperature`, `topP`,\n  `thinkingBudget`, and other SDK-level parameters.\n- **Environment-Specific Behavior**: Distinct configurations for different\n  operating contexts (e.g., testing vs. production).\n- **Agent-Scoped Customization**: Applying specific settings only when a\n  particular agent is active.\n\nThe system operates on two core primitives: **Aliases** and **Overrides**.\n\n## 2. Configuration Primitives\n\nThese settings are located under the `modelConfigs` key in your configuration\nfile.\n\n### Aliases (`customAliases`)\n\nAliases are named, reusable configuration presets. Users should define their own\naliases (or override system defaults) in the `customAliases` map.\n\n- **Inheritance**: An alias can `extends` another alias (including system\n  defaults like `chat-base`), inheriting its `modelConfig`. Child aliases can\n  overwrite or augment inherited settings.\n- **Abstract Aliases**: An alias is not required to specify a concrete `model`\n  if it serves purely as a base for other aliases.\n\n**Example Hierarchy**:\n\n```json\n\"modelConfigs\": {\n  \"customAliases\": {\n    \"base\": {\n      \"modelConfig\": {\n        \"generateContentConfig\": { \"temperature\": 0.0 }\n      }\n    },\n    \"chat-base\": {\n      \"extends\": \"base\",\n      \"modelConfig\": {\n        \"generateContentConfig\": { \"temperature\": 0.7 }\n      }\n    }\n  }\n}\n```\n\n### Overrides (`overrides`)\n\nOverrides are conditional rules that inject configuration based on the runtime\ncontext. They are evaluated dynamically for each model request.\n\n- **Match Criteria**: Overrides apply when the request context matches the\n  specified `match` properties.\n  - `model`: Matches the requested model name or alias.\n  - `overrideScope`: Matches the distinct scope of the request (typically the\n    agent name, e.g., `codebaseInvestigator`).\n\n**Example Override**:\n\n```json\n\"modelConfigs\": {\n  \"overrides\": [\n    {\n      \"match\": {\n        \"overrideScope\": \"codebaseInvestigator\"\n      },\n      \"modelConfig\": {\n        \"generateContentConfig\": { \"temperature\": 0.1 }\n      }\n    }\n  ]\n}\n```\n\n## 3. Resolution Strategy\n\nThe `ModelConfigService` resolves the final configuration through a two-step\nprocess:\n\n### Step 1: Alias Resolution\n\nThe requested model string is looked up in the merged map of system `aliases`\nand user `customAliases`.\n\n1.  If found, the system recursively resolves the `extends` chain.\n2.  Settings are merged from parent to child (child wins).\n3.  This results in a base `ResolvedModelConfig`.\n4.  If not found, the requested string is treated as the raw model name.\n\n### Step 2: Override Application\n\nThe system evaluates the `overrides` list against the request context (`model`\nand `overrideScope`).\n\n1.  **Filtering**: All matching overrides are identified.\n2.  **Sorting**: Matches are prioritized by **specificity** (the number of\n    matched keys in the `match` object).\n    - Specific matches (e.g., `model` + `overrideScope`) override broad matches\n      (e.g., `model` only).\n    - Tie-breaking: If specificity is equal, the order of definition in the\n      `overrides` array is preserved (last one wins).\n3.  **Merging**: The configurations from the sorted overrides are merged\n    sequentially onto the base configuration.\n\n## 4. Configuration Reference\n\nThe configuration follows the `ModelConfigServiceConfig` interface.\n\n### `ModelConfig` Object\n\nDefines the actual parameters for the model.\n\n| Property                | Type     | Description                                                        |\n| :---------------------- | :------- | :----------------------------------------------------------------- |\n| `model`                 | `string` | The identifier of the model to be called (e.g., `gemini-2.5-pro`). |\n| `generateContentConfig` | `object` | The configuration object passed to the `@google/genai` SDK.        |\n\n### `GenerateContentConfig` (Common Parameters)\n\nDirectly maps to the SDK's `GenerateContentConfig`. Common parameters include:\n\n- **`temperature`**: (`number`) Controls output randomness. Lower values (0.0)\n  are deterministic; higher values (>0.7) are creative.\n- **`topP`**: (`number`) Nucleus sampling probability.\n- **`maxOutputTokens`**: (`number`) Limit on generated response length.\n- **`thinkingConfig`**: (`object`) Configuration for models with reasoning\n  capabilities (e.g., `thinkingBudget`, `includeThoughts`).\n\n## 5. Practical Examples\n\n### Defining a Deterministic Baseline\n\nCreate an alias for tasks requiring high precision, extending the standard chat\nconfiguration but enforcing zero temperature.\n\n```json\n\"modelConfigs\": {\n  \"customAliases\": {\n    \"precise-mode\": {\n      \"extends\": \"chat-base\",\n      \"modelConfig\": {\n        \"generateContentConfig\": {\n          \"temperature\": 0.0,\n          \"topP\": 1.0\n        }\n      }\n    }\n  }\n}\n```\n\n### Agent-Specific Parameter Injection\n\nEnforce extended thinking budgets for a specific agent without altering the\nglobal default, e.g. for the `codebaseInvestigator`.\n\n```json\n\"modelConfigs\": {\n  \"overrides\": [\n    {\n      \"match\": {\n        \"overrideScope\": \"codebaseInvestigator\"\n      },\n      \"modelConfig\": {\n        \"generateContentConfig\": {\n          \"thinkingConfig\": { \"thinkingBudget\": 4096 }\n        }\n      }\n    }\n  ]\n}\n```\n\n### Experimental Model Evaluation\n\nRoute traffic for a specific alias to a preview model for A/B testing, without\nchanging client code.\n\n```json\n\"modelConfigs\": {\n  \"overrides\": [\n    {\n      \"match\": {\n        \"model\": \"gemini-2.5-pro\"\n      },\n      \"modelConfig\": {\n        \"model\": \"gemini-2.5-pro-experimental-001\"\n      }\n    }\n  ]\n}\n```\n"}
{"source":"github","repo":"gemini-cli","path":"docs/cli/settings.md","content":"# Gemini CLI settings (`/settings` command)\n\nControl your Gemini CLI experience with the `/settings` command. The `/settings`\ncommand opens a dialog to view and edit all your Gemini CLI settings, including\nyour UI experience, keybindings, and accessibility features.\n\nYour Gemini CLI settings are stored in a `settings.json` file. In addition to\nusing the `/settings` command, you can also edit them in one of the following\nlocations:\n\n- **User settings**: `~/.gemini/settings.json`\n- **Workspace settings**: `your-project/.gemini/settings.json`\n\nNote: Workspace settings override user settings.\n\n## Settings reference\n\nHere is a list of all the available settings, grouped by category and ordered as\nthey appear in the UI.\n\n### General\n\n| UI Label                        | Setting                            | Description                                                                  | Default     |\n| ------------------------------- | ---------------------------------- | ---------------------------------------------------------------------------- | ----------- |\n| Preview Features (e.g., models) | `general.previewFeatures`          | Enable preview features (e.g., preview models).                              | `false`     |\n| Vim Mode                        | `general.vimMode`                  | Enable Vim keybindings.                                                      | `false`     |\n| Disable Auto Update             | `general.disableAutoUpdate`        | Disable automatic updates.                                                   | `false`     |\n| Enable Prompt Completion        | `general.enablePromptCompletion`   | Enable AI-powered prompt completion suggestions while typing.                | `false`     |\n| Debug Keystroke Logging         | `general.debugKeystrokeLogging`    | Enable debug logging of keystrokes to the console.                           | `false`     |\n| Session Retention               | `general.sessionRetention`         | Settings for automatic session cleanup. This feature is disabled by default. | `undefined` |\n| Enable Session Cleanup          | `general.sessionRetention.enabled` | Enable automatic session cleanup.                                            | `false`     |\n\n### Output\n\n| UI Label      | Setting         | Description                                            | Default |\n| ------------- | --------------- | ------------------------------------------------------ | ------- |\n| Output Format | `output.format` | The format of the CLI output. Can be `text` or `json`. | `text`  |\n\n### UI\n\n| UI Label                       | Setting                                  | Description                                                          | Default |\n| ------------------------------ | ---------------------------------------- | -------------------------------------------------------------------- | ------- |\n| Hide Window Title              | `ui.hideWindowTitle`                     | Hide the window title bar.                                           | `false` |\n| Show Status in Title           | `ui.showStatusInTitle`                   | Show Gemini CLI status and thoughts in the terminal window title.    | `false` |\n| Hide Tips                      | `ui.hideTips`                            | Hide helpful tips in the UI.                                         | `false` |\n| Hide Banner                    | `ui.hideBanner`                          | Hide the application banner.                                         | `false` |\n| Hide Context Summary           | `ui.hideContextSummary`                  | Hide the context summary (GEMINI.md, MCP servers) above the input.   | `false` |\n| Hide CWD                       | `ui.footer.hideCWD`                      | Hide the current working directory path in the footer.               | `false` |\n| Hide Sandbox Status            | `ui.footer.hideSandboxStatus`            | Hide the sandbox status indicator in the footer.                     | `false` |\n| Hide Model Info                | `ui.footer.hideModelInfo`                | Hide the model name and context usage in the footer.                 | `false` |\n| Hide Context Window Percentage | `ui.footer.hideContextPercentage`        | Hides the context window remaining percentage.                       | `true`  |\n| Hide Footer                    | `ui.hideFooter`                          | Hide the footer from the UI.                                         | `false` |\n| Show Memory Usage              | `ui.showMemoryUsage`                     | Display memory usage information in the UI.                          | `false` |\n| Show Line Numbers              | `ui.showLineNumbers`                     | Show line numbers in the chat.                                       | `false` |\n| Show Citations                 | `ui.showCitations`                       | Show citations for generated text in the chat.                       | `false` |\n| Use Full Width                 | `ui.useFullWidth`                        | Use the entire width of the terminal for output.                     | `true`  |\n| Use Alternate Screen Buffer    | `ui.useAlternateBuffer`                  | Use an alternate screen buffer for the UI, preserving shell history. | `true`  |\n| Disable Loading Phrases        | `ui.accessibility.disableLoadingPhrases` | Disable loading phrases for accessibility.                           | `false` |\n| Screen Reader Mode             | `ui.accessibility.screenReader`          | Render output in plain-text to be more screen reader accessible.     | `false` |\n\n### IDE\n\n| UI Label | Setting       | Description                  | Default |\n| -------- | ------------- | ---------------------------- | ------- |\n| IDE Mode | `ide.enabled` | Enable IDE integration mode. | `false` |\n\n### Model\n\n| UI Label                | Setting                      | Description                                                                            | Default |\n| ----------------------- | ---------------------------- | -------------------------------------------------------------------------------------- | ------- |\n| Max Session Turns       | `model.maxSessionTurns`      | Maximum number of user/model/tool turns to keep in a session. -1 means unlimited.      | `-1`    |\n| Compression Threshold   | `model.compressionThreshold` | The fraction of context usage at which to trigger context compression (e.g. 0.2, 0.3). | `0.2`   |\n| Skip Next Speaker Check | `model.skipNextSpeakerCheck` | Skip the next speaker check.                                                           | `true`  |\n\n### Context\n\n| UI Label                             | Setting                                           | Description                                                                                                                                     | Default |\n| ------------------------------------ | ------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------- | ------- |\n| Memory Discovery Max Dirs            | `context.discoveryMaxDirs`                        | Maximum number of directories to search for memory.                                                                                             | `200`   |\n| Load Memory From Include Directories | `context.loadMemoryFromIncludeDirectories`        | Controls how /memory refresh loads GEMINI.md files. When true, include directories are scanned; when false, only the current directory is used. | `false` |\n| Respect .gitignore                   | `context.fileFiltering.respectGitIgnore`          | Respect .gitignore files when searching.                                                                                                        | `true`  |\n| Respect .geminiignore                | `context.fileFiltering.respectGeminiIgnore`       | Respect .geminiignore files when searching.                                                                                                     | `true`  |\n| Enable Recursive File Search         | `context.fileFiltering.enableRecursiveFileSearch` | Enable recursive file search functionality when completing @ references in the prompt.                                                          | `true`  |\n| Disable Fuzzy Search                 | `context.fileFiltering.disableFuzzySearch`        | Disable fuzzy search when searching for files.                                                                                                  | `false` |\n\n### Tools\n\n| UI Label                         | Setting                              | Description                                                                                                     | Default |\n| -------------------------------- | ------------------------------------ | --------------------------------------------------------------------------------------------------------------- | ------- |\n| Enable Interactive Shell         | `tools.shell.enableInteractiveShell` | Use node-pty for an interactive shell experience. Fallback to child_process still applies.                      | `true`  |\n| Show Color                       | `tools.shell.showColor`              | Show color in shell output.                                                                                     | `false` |\n| Auto Accept                      | `tools.autoAccept`                   | Automatically accept and execute tool calls that are considered safe (e.g., read-only operations).              | `false` |\n| Use Ripgrep                      | `tools.useRipgrep`                   | Use ripgrep for file content search instead of the fallback implementation. Provides faster search performance. | `true`  |\n| Enable Tool Output Truncation    | `tools.enableToolOutputTruncation`   | Enable truncation of large tool outputs.                                                                        | `true`  |\n| Tool Output Truncation Threshold | `tools.truncateToolOutputThreshold`  | Truncate tool output if it is larger than this many characters. Set to -1 to disable.                           | `10000` |\n| Tool Output Truncation Lines     | `tools.truncateToolOutputLines`      | The number of lines to keep when truncating tool output.                                                        | `100`   |\n| Enable Message Bus Integration   | `tools.enableMessageBusIntegration`  | Enable policy-based tool confirmation via message bus integration.                                              | `false` |\n\n### Security\n\n| UI Label                   | Setting                        | Description                                        | Default |\n| -------------------------- | ------------------------------ | -------------------------------------------------- | ------- |\n| Disable YOLO Mode          | `security.disableYoloMode`     | Disable YOLO mode, even if enabled by a flag.      | `false` |\n| Blocks extensions from Git | `security.blockGitExtensions`  | Blocks installing and loading extensions from Git. | `false` |\n| Folder Trust               | `security.folderTrust.enabled` | Setting to track whether Folder trust is enabled.  | `false` |\n\n### Experimental\n\n| UI Label                            | Setting                                                 | Description                                                  | Default |\n| ----------------------------------- | ------------------------------------------------------- | ------------------------------------------------------------ | ------- |\n| Enable Codebase Investigator        | `experimental.codebaseInvestigatorSettings.enabled`     | Enable the Codebase Investigator agent.                      | `true`  |\n| Codebase Investigator Max Num Turns | `experimental.codebaseInvestigatorSettings.maxNumTurns` | Maximum number of turns for the Codebase Investigator agent. | `10`    |\n"}
{"source":"github","repo":"gemini-cli","path":"docs/cli/tutorials.md","content":"# Tutorials\n\nThis page contains tutorials for interacting with Gemini CLI.\n\n## Setting up a Model Context Protocol (MCP) server\n\n> [!CAUTION] Before using a third-party MCP server, ensure you trust its source\n> and understand the tools it provides. Your use of third-party servers is at\n> your own risk.\n\nThis tutorial demonstrates how to set up an MCP server, using the\n[GitHub MCP server](https://github.com/github/github-mcp-server) as an example.\nThe GitHub MCP server provides tools for interacting with GitHub repositories,\nsuch as creating issues and commenting on pull requests.\n\n### Prerequisites\n\nBefore you begin, ensure you have the following installed and configured:\n\n- **Docker:** Install and run [Docker].\n- **GitHub Personal Access Token (PAT):** Create a new [classic] or\n  [fine-grained] PAT with the necessary scopes.\n\n[Docker]: https://www.docker.com/\n[classic]: https://github.com/settings/tokens/new\n[fine-grained]: https://github.com/settings/personal-access-tokens/new\n\n### Guide\n\n#### Configure the MCP server in `settings.json`\n\nIn your project's root directory, create or open the\n[`.gemini/settings.json` file](../get-started/configuration.md). Within the\nfile, add the `mcpServers` configuration block, which provides instructions for\nhow to launch the GitHub MCP server.\n\n```json\n{\n  \"mcpServers\": {\n    \"github\": {\n      \"command\": \"docker\",\n      \"args\": [\n        \"run\",\n        \"-i\",\n        \"--rm\",\n        \"-e\",\n        \"GITHUB_PERSONAL_ACCESS_TOKEN\",\n        \"ghcr.io/github/github-mcp-server\"\n      ],\n      \"env\": {\n        \"GITHUB_PERSONAL_ACCESS_TOKEN\": \"${GITHUB_PERSONAL_ACCESS_TOKEN}\"\n      }\n    }\n  }\n}\n```\n\n#### Set your GitHub token\n\n> [!CAUTION] Using a broadly scoped personal access token that has access to\n> personal and private repositories can lead to information from the private\n> repository being leaked into the public repository. We recommend using a\n> fine-grained access token that doesn't share access to both public and private\n> repositories.\n\nUse an environment variable to store your GitHub PAT:\n\n```bash\nGITHUB_PERSONAL_ACCESS_TOKEN=\"pat_YourActualGitHubTokenHere\"\n```\n\nGemini CLI uses this value in the `mcpServers` configuration that you defined in\nthe `settings.json` file.\n\n#### Launch Gemini CLI and verify the connection\n\nWhen you launch Gemini CLI, it automatically reads your configuration and\nlaunches the GitHub MCP server in the background. You can then use natural\nlanguage prompts to ask Gemini CLI to perform GitHub actions. For example:\n\n```bash\n\"get all open issues assigned to me in the 'foo/bar' repo and prioritize them\"\n```\n"}
{"source":"github","repo":"gemini-cli","path":"docs/cli/token-caching.md","content":"# Token caching and cost optimization\n\nGemini CLI automatically optimizes API costs through token caching when using\nAPI key authentication (Gemini API key or Vertex AI). This feature reuses\nprevious system instructions and context to reduce the number of tokens\nprocessed in subsequent requests.\n\n**Token caching is available for:**\n\n- API key users (Gemini API key)\n- Vertex AI users (with project and location setup)\n\n**Token caching is not available for:**\n\n- OAuth users (Google Personal/Enterprise accounts) - the Code Assist API does\n  not support cached content creation at this time\n\nYou can view your token usage and cached token savings using the `/stats`\ncommand. When cached tokens are available, they will be displayed in the stats\noutput.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/cli/trusted-folders.md","content":"# Trusted Folders\n\nThe Trusted Folders feature is a security setting that gives you control over\nwhich projects can use the full capabilities of the Gemini CLI. It prevents\npotentially malicious code from running by asking you to approve a folder before\nthe CLI loads any project-specific configurations from it.\n\n## Enabling the feature\n\nThe Trusted Folders feature is **disabled by default**. To use it, you must\nfirst enable it in your settings.\n\nAdd the following to your user `settings.json` file:\n\n```json\n{\n  \"security\": {\n    \"folderTrust\": {\n      \"enabled\": true\n    }\n  }\n}\n```\n\n## How it works: The trust dialog\n\nOnce the feature is enabled, the first time you run the Gemini CLI from a\nfolder, a dialog will automatically appear, prompting you to make a choice:\n\n- **Trust folder**: Grants full trust to the current folder (e.g.,\n  `my-project`).\n- **Trust parent folder**: Grants trust to the parent directory (e.g.,\n  `safe-projects`), which automatically trusts all of its subdirectories as\n  well. This is useful if you keep all your safe projects in one place.\n- **Don't trust**: Marks the folder as untrusted. The CLI will operate in a\n  restricted \"safe mode.\"\n\nYour choice is saved in a central file (`~/.gemini/trustedFolders.json`), so you\nwill only be asked once per folder.\n\n## Why trust matters: The impact of an untrusted workspace\n\nWhen a folder is **untrusted**, the Gemini CLI runs in a restricted \"safe mode\"\nto protect you. In this mode, the following features are disabled:\n\n1.  **Workspace settings are ignored**: The CLI will **not** load the\n    `.gemini/settings.json` file from the project. This prevents the loading of\n    custom tools and other potentially dangerous configurations.\n\n2.  **Environment variables are ignored**: The CLI will **not** load any `.env`\n    files from the project.\n\n3.  **Extension management is restricted**: You **cannot install, update, or\n    uninstall** extensions.\n\n4.  **Tool auto-acceptance is disabled**: You will always be prompted before any\n    tool is run, even if you have auto-acceptance enabled globally.\n\n5.  **Automatic memory loading is disabled**: The CLI will not automatically\n    load files into context from directories specified in local settings.\n\n6.  **MCP servers do not connect**: The CLI will not attempt to connect to any\n    [Model Context Protocol (MCP)](../tools/mcp-server.md) servers.\n\n7.  **Custom commands are not loaded**: The CLI will not load any custom\n    commands from .toml files, including both project-specific and global user\n    commands.\n\nGranting trust to a folder unlocks the full functionality of the Gemini CLI for\nthat workspace.\n\n## Managing your trust settings\n\nIf you need to change a decision or see all your settings, you have a couple of\noptions:\n\n- **Change the current folder's trust**: Run the `/permissions` command from\n  within the CLI. This will bring up the same interactive dialog, allowing you\n  to change the trust level for the current folder.\n\n- **View all trust rules**: To see a complete list of all your trusted and\n  untrusted folder rules, you can inspect the contents of the\n  `~/.gemini/trustedFolders.json` file in your home directory.\n\n## The trust check process (advanced)\n\nFor advanced users, it's helpful to know the exact order of operations for how\ntrust is determined:\n\n1.  **IDE trust signal**: If you are using the\n    [IDE Integration](../ide-integration/index.md), the CLI first asks the IDE\n    if the workspace is trusted. The IDE's response takes highest priority.\n\n2.  **Local trust file**: If the IDE is not connected, the CLI checks the\n    central `~/.gemini/trustedFolders.json` file.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/cli/sandbox.md","content":"# Sandboxing in the Gemini CLI\n\nThis document provides a guide to sandboxing in the Gemini CLI, including\nprerequisites, quickstart, and configuration.\n\n## Prerequisites\n\nBefore using sandboxing, you need to install and set up the Gemini CLI:\n\n```bash\nnpm install -g @google/gemini-cli\n```\n\nTo verify the installation\n\n```bash\ngemini --version\n```\n\n## Overview of sandboxing\n\nSandboxing isolates potentially dangerous operations (such as shell commands or\nfile modifications) from your host system, providing a security barrier between\nAI operations and your environment.\n\nThe benefits of sandboxing include:\n\n- **Security**: Prevent accidental system damage or data loss.\n- **Isolation**: Limit file system access to project directory.\n- **Consistency**: Ensure reproducible environments across different systems.\n- **Safety**: Reduce risk when working with untrusted code or experimental\n  commands.\n\n## Sandboxing methods\n\nYour ideal method of sandboxing may differ depending on your platform and your\npreferred container solution.\n\n### 1. macOS Seatbelt (macOS only)\n\nLightweight, built-in sandboxing using `sandbox-exec`.\n\n**Default profile**: `permissive-open` - restricts writes outside project\ndirectory but allows most other operations.\n\n### 2. Container-based (Docker/Podman)\n\nCross-platform sandboxing with complete process isolation.\n\n**Note**: Requires building the sandbox image locally or using a published image\nfrom your organization's registry.\n\n## Quickstart\n\n```bash\n# Enable sandboxing with command flag\ngemini -s -p \"analyze the code structure\"\n\n# Use environment variable\nexport GEMINI_SANDBOX=true\ngemini -p \"run the test suite\"\n\n# Configure in settings.json\n{\n  \"tools\": {\n    \"sandbox\": \"docker\"\n  }\n}\n```\n\n## Configuration\n\n### Enable sandboxing (in order of precedence)\n\n1. **Command flag**: `-s` or `--sandbox`\n2. **Environment variable**: `GEMINI_SANDBOX=true|docker|podman|sandbox-exec`\n3. **Settings file**: `\"sandbox\": true` in the `tools` object of your\n   `settings.json` file (e.g., `{\"tools\": {\"sandbox\": true}}`).\n\n### macOS Seatbelt profiles\n\nBuilt-in profiles (set via `SEATBELT_PROFILE` env var):\n\n- `permissive-open` (default): Write restrictions, network allowed\n- `permissive-closed`: Write restrictions, no network\n- `permissive-proxied`: Write restrictions, network via proxy\n- `restrictive-open`: Strict restrictions, network allowed\n- `restrictive-closed`: Maximum restrictions\n\n### Custom sandbox flags\n\nFor container-based sandboxing, you can inject custom flags into the `docker` or\n`podman` command using the `SANDBOX_FLAGS` environment variable. This is useful\nfor advanced configurations, such as disabling security features for specific\nuse cases.\n\n**Example (Podman)**:\n\nTo disable SELinux labeling for volume mounts, you can set the following:\n\n```bash\nexport SANDBOX_FLAGS=\"--security-opt label=disable\"\n```\n\nMultiple flags can be provided as a space-separated string:\n\n```bash\nexport SANDBOX_FLAGS=\"--flag1 --flag2=value\"\n```\n\n## Linux UID/GID handling\n\nThe sandbox automatically handles user permissions on Linux. Override these\npermissions with:\n\n```bash\nexport SANDBOX_SET_UID_GID=true   # Force host UID/GID\nexport SANDBOX_SET_UID_GID=false  # Disable UID/GID mapping\n```\n\n## Troubleshooting\n\n### Common issues\n\n**\"Operation not permitted\"**\n\n- Operation requires access outside sandbox.\n- Try more permissive profile or add mount points.\n\n**Missing commands**\n\n- Add to custom Dockerfile.\n- Install via `sandbox.bashrc`.\n\n**Network issues**\n\n- Check sandbox profile allows network.\n- Verify proxy configuration.\n\n### Debug mode\n\n```bash\nDEBUG=1 gemini -s -p \"debug command\"\n```\n\n**Note:** If you have `DEBUG=true` in a project's `.env` file, it won't affect\ngemini-cli due to automatic exclusion. Use `.gemini/.env` files for gemini-cli\nspecific debug settings.\n\n### Inspect sandbox\n\n```bash\n# Check environment\ngemini -s -p \"run shell command: env | grep SANDBOX\"\n\n# List mounts\ngemini -s -p \"run shell command: mount | grep workspace\"\n```\n\n## Security notes\n\n- Sandboxing reduces but doesn't eliminate all risks.\n- Use the most restrictive profile that allows your work.\n- Container overhead is minimal after first build.\n- GUI applications may not work in sandboxes.\n\n## Related documentation\n\n- [Configuration](../get-started/configuration.md): Full configuration options.\n- [Commands](./commands.md): Available commands.\n- [Troubleshooting](../troubleshooting.md): General troubleshooting.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/cli/configuration.md","content":"# Gemini CLI configuration\n\nGemini CLI offers several ways to configure its behavior, including environment\nvariables, command-line arguments, and settings files. This document outlines\nthe different configuration methods and available settings.\n\n## Configuration layers\n\nConfiguration is applied in the following order of precedence (lower numbers are\noverridden by higher numbers):\n\n1.  **Default values:** Hardcoded defaults within the application.\n2.  **User settings file:** Global settings for the current user.\n3.  **Project settings file:** Project-specific settings.\n4.  **System settings file:** System-wide settings.\n5.  **Environment variables:** System-wide or session-specific variables,\n    potentially loaded from `.env` files.\n6.  **Command-line arguments:** Values passed when launching the CLI.\n\n## Settings files\n\nGemini CLI uses `settings.json` files for persistent configuration. There are\nthree locations for these files:\n\n- **User settings file:**\n  - **Location:** `~/.gemini/settings.json` (where `~` is your home directory).\n  - **Scope:** Applies to all Gemini CLI sessions for the current user.\n- **Project settings file:**\n  - **Location:** `.gemini/settings.json` within your project's root directory.\n  - **Scope:** Applies only when running Gemini CLI from that specific project.\n    Project settings override user settings.\n- **System settings file:**\n  - **Location:** `/etc/gemini-cli/settings.json` (Linux),\n    `C:\\ProgramData\\gemini-cli\\settings.json` (Windows) or\n    `/Library/Application Support/GeminiCli/settings.json` (macOS). The path can\n    be overridden using the `GEMINI_CLI_SYSTEM_SETTINGS_PATH` environment\n    variable.\n  - **Scope:** Applies to all Gemini CLI sessions on the system, for all users.\n    System settings override user and project settings. May be useful for system\n    administrators at enterprises to have controls over users' Gemini CLI\n    setups.\n\n**Note on environment variables in settings:** String values within your\n`settings.json` files can reference environment variables using either\n`$VAR_NAME` or `${VAR_NAME}` syntax. These variables will be automatically\nresolved when the settings are loaded. For example, if you have an environment\nvariable `MY_API_TOKEN`, you could use it in `settings.json` like this:\n`\"apiKey\": \"$MY_API_TOKEN\"`.\n\n### The `.gemini` directory in your project\n\nIn addition to a project settings file, a project's `.gemini` directory can\ncontain other project-specific files related to Gemini CLI's operation, such as:\n\n- [Custom sandbox profiles](#sandboxing) (e.g.,\n  `.gemini/sandbox-macos-custom.sb`, `.gemini/sandbox.Dockerfile`).\n\n### Available settings in `settings.json`:\n\n- **`contextFileName`** (string or array of strings):\n  - **Description:** Specifies the filename for context files (e.g.,\n    `GEMINI.md`, `AGENTS.md`). Can be a single filename or a list of accepted\n    filenames.\n  - **Default:** `GEMINI.md`\n  - **Example:** `\"contextFileName\": \"AGENTS.md\"`\n\n- **`bugCommand`** (object):\n  - **Description:** Overrides the default URL for the `/bug` command.\n  - **Default:**\n    `\"urlTemplate\": \"https://github.com/google-gemini/gemini-cli/issues/new?template=bug_report.yml&title={title}&info={info}\"`\n  - **Properties:**\n    - **`urlTemplate`** (string): A URL that can contain `{title}` and `{info}`\n      placeholders.\n  - **Example:**\n    ```json\n    \"bugCommand\": {\n      \"urlTemplate\": \"https://bug.example.com/new?title={title}&info={info}\"\n    }\n    ```\n\n- **`fileFiltering`** (object):\n  - **Description:** Controls git-aware file filtering behavior for @ commands\n    and file discovery tools.\n  - **Default:** `\"respectGitIgnore\": true, \"enableRecursiveFileSearch\": true`\n  - **Properties:**\n    - **`respectGitIgnore`** (boolean): Whether to respect .gitignore patterns\n      when discovering files. When set to `true`, git-ignored files (like\n      `node_modules/`, `dist/`, `.env`) are automatically excluded from @\n      commands and file listing operations.\n    - **`enableRecursiveFileSearch`** (boolean): Whether to enable searching\n      recursively for filenames under the current tree when completing @\n      prefixes in the prompt.\n  - **Example:**\n    ```json\n    \"fileFiltering\": {\n      \"respectGitIgnore\": true,\n      \"enableRecursiveFileSearch\": false\n    }\n    ```\n\n- **`coreTools`** (array of strings):\n  - **Description:** Allows you to specify a list of core tool names that should\n    be made available to the model. This can be used to restrict the set of\n    built-in tools. See [Built-in Tools](../core/tools-api.md#built-in-tools)\n    for a list of core tools. You can also specify command-specific restrictions\n    for tools that support it, like the `ShellTool`. For example,\n    `\"coreTools\": [\"ShellTool(ls -l)\"]` will only allow the `ls -l` command to\n    be executed.\n  - **Default:** All tools available for use by the Gemini model.\n  - **Example:** `\"coreTools\": [\"ReadFileTool\", \"GlobTool\", \"ShellTool(ls)\"]`.\n\n- **`excludeTools`** (array of strings):\n  - **Description:** Allows you to specify a list of core tool names that should\n    be excluded from the model. A tool listed in both `excludeTools` and\n    `coreTools` is excluded. You can also specify command-specific restrictions\n    for tools that support it, like the `ShellTool`. For example,\n    `\"excludeTools\": [\"ShellTool(rm -rf)\"]` will block the `rm -rf` command.\n  - **Default**: No tools excluded.\n  - **Example:** `\"excludeTools\": [\"run_shell_command\", \"findFiles\"]`.\n  - **Security Note:** Command-specific restrictions in `excludeTools` for\n    `run_shell_command` are based on simple string matching and can be easily\n    bypassed. This feature is **not a security mechanism** and should not be\n    relied upon to safely execute untrusted code. It is recommended to use\n    `coreTools` to explicitly select commands that can be executed.\n\n- **`allowMCPServers`** (array of strings):\n  - **Description:** Allows you to specify a list of MCP server names that\n    should be made available to the model. This can be used to restrict the set\n    of MCP servers to connect to. Note that this will be ignored if\n    `--allowed-mcp-server-names` is set.\n  - **Default:** All MCP servers are available for use by the Gemini model.\n  - **Example:** `\"allowMCPServers\": [\"myPythonServer\"]`.\n  - **Security Note:** This uses simple string matching on MCP server names,\n    which can be modified. If you're a system administrator looking to prevent\n    users from bypassing this, consider configuring the `mcpServers` at the\n    system settings level such that the user will not be able to configure any\n    MCP servers of their own. This should not be used as an airtight security\n    mechanism.\n\n- **`excludeMCPServers`** (array of strings):\n  - **Description:** Allows you to specify a list of MCP server names that\n    should be excluded from the model. A server listed in both\n    `excludeMCPServers` and `allowMCPServers` is excluded. Note that this will\n    be ignored if `--allowed-mcp-server-names` is set.\n  - **Default**: No MCP servers excluded.\n  - **Example:** `\"excludeMCPServers\": [\"myNodeServer\"]`.\n  - **Security note:** This uses simple string matching on MCP server names,\n    which can be modified. If you're a system administrator looking to prevent\n    users from bypassing this, consider configuring the `mcpServers` at the\n    system settings level such that the user will not be able to configure any\n    MCP servers of their own. This should not be used as an airtight security\n    mechanism.\n\n- **`autoAccept`** (boolean):\n  - **Description:** Controls whether the CLI automatically accepts and executes\n    tool calls that are considered safe (e.g., read-only operations) without\n    explicit user confirmation. If set to `true`, the CLI will bypass the\n    confirmation prompt for tools deemed safe.\n  - **Default:** `false`\n  - **Example:** `\"autoAccept\": true`\n\n- **`theme`** (string):\n  - **Description:** Sets the visual [theme](./themes.md) for Gemini CLI.\n  - **Default:** `\"Default\"`\n  - **Example:** `\"theme\": \"GitHub\"`\n\n- **`vimMode`** (boolean):\n  - **Description:** Enables or disables vim mode for input editing. When\n    enabled, the input area supports vim-style navigation and editing commands\n    with NORMAL and INSERT modes. The vim mode status is displayed in the footer\n    and persists between sessions.\n  - **Default:** `false`\n  - **Example:** `\"vimMode\": true`\n\n- **`sandbox`** (boolean or string):\n  - **Description:** Controls whether and how to use sandboxing for tool\n    execution. If set to `true`, Gemini CLI uses a pre-built\n    `gemini-cli-sandbox` Docker image. For more information, see\n    [Sandboxing](#sandboxing).\n  - **Default:** `false`\n  - **Example:** `\"sandbox\": \"docker\"`\n\n- **`toolDiscoveryCommand`** (string):\n  - **Description:** Defines a custom shell command for discovering tools from\n    your project. The shell command must return on `stdout` a JSON array of\n    [function declarations](https://ai.google.dev/gemini-api/docs/function-calling#function-declarations).\n    Tool wrappers are optional.\n  - **Default:** Empty\n  - **Example:** `\"toolDiscoveryCommand\": \"bin/get_tools\"`\n\n- **`toolCallCommand`** (string):\n  - **Description:** Defines a custom shell command for calling a specific tool\n    that was discovered using `toolDiscoveryCommand`. The shell command must\n    meet the following criteria:\n    - It must take function `name` (exactly as in\n      [function declaration](https://ai.google.dev/gemini-api/docs/function-calling#function-declarations))\n      as first command line argument.\n    - It must read function arguments as JSON on `stdin`, analogous to\n      [`functionCall.args`](https://cloud.google.com/vertex-ai/generative-ai/docs/model-reference/inference#functioncall).\n    - It must return function output as JSON on `stdout`, analogous to\n      [`functionResponse.response.content`](https://cloud.google.com/vertex-ai/generative-ai/docs/model-reference/inference#functionresponse).\n  - **Default:** Empty\n  - **Example:** `\"toolCallCommand\": \"bin/call_tool\"`\n\n- **`mcpServers`** (object):\n  - **Description:** Configures connections to one or more Model-Context\n    Protocol (MCP) servers for discovering and using custom tools. Gemini CLI\n    attempts to connect to each configured MCP server to discover available\n    tools. If multiple MCP servers expose a tool with the same name, the tool\n    names will be prefixed with the server alias you defined in the\n    configuration (e.g., `serverAlias__actualToolName`) to avoid conflicts. Note\n    that the system might strip certain schema properties from MCP tool\n    definitions for compatibility.\n  - **Default:** Empty\n  - **Properties:**\n    - **`<SERVER_NAME>`** (object): The server parameters for the named server.\n      - `command` (string, required): The command to execute to start the MCP\n        server.\n      - `args` (array of strings, optional): Arguments to pass to the command.\n      - `env` (object, optional): Environment variables to set for the server\n        process.\n      - `cwd` (string, optional): The working directory in which to start the\n        server.\n      - `timeout` (number, optional): Timeout in milliseconds for requests to\n        this MCP server.\n      - `trust` (boolean, optional): Trust this server and bypass all tool call\n        confirmations.\n      - `includeTools` (array of strings, optional): List of tool names to\n        include from this MCP server. When specified, only the tools listed here\n        will be available from this server (whitelist behavior). If not\n        specified, all tools from the server are enabled by default.\n      - `excludeTools` (array of strings, optional): List of tool names to\n        exclude from this MCP server. Tools listed here will not be available to\n        the model, even if they are exposed by the server. **Note:**\n        `excludeTools` takes precedence over `includeTools` - if a tool is in\n        both lists, it will be excluded.\n  - **Example:**\n    ```json\n    \"mcpServers\": {\n      \"myPythonServer\": {\n        \"command\": \"python\",\n        \"args\": [\"mcp_server.py\", \"--port\", \"8080\"],\n        \"cwd\": \"./mcp_tools/python\",\n        \"timeout\": 5000,\n        \"includeTools\": [\"safe_tool\", \"file_reader\"],\n      },\n      \"myNodeServer\": {\n        \"command\": \"node\",\n        \"args\": [\"mcp_server.js\"],\n        \"cwd\": \"./mcp_tools/node\",\n        \"excludeTools\": [\"dangerous_tool\", \"file_deleter\"]\n      },\n      \"myDockerServer\": {\n        \"command\": \"docker\",\n        \"args\": [\"run\", \"-i\", \"--rm\", \"-e\", \"API_KEY\", \"ghcr.io/foo/bar\"],\n        \"env\": {\n          \"API_KEY\": \"$MY_API_TOKEN\"\n        }\n      }\n    }\n    ```\n\n- **`checkpointing`** (object):\n  - **Description:** Configures the checkpointing feature, which allows you to\n    save and restore conversation and file states. See the\n    [Checkpointing documentation](./checkpointing.md) for more details.\n  - **Default:** `{\"enabled\": false}`\n  - **Properties:**\n    - **`enabled`** (boolean): When `true`, the `/restore` command is available.\n\n- **`preferredEditor`** (string):\n  - **Description:** Specifies the preferred editor to use for viewing diffs.\n  - **Default:** `vscode`\n  - **Example:** `\"preferredEditor\": \"vscode\"`\n\n- **`telemetry`** (object)\n  - **Description:** Configures logging and metrics collection for Gemini CLI.\n    For more information, see [Telemetry](./telemetry.md).\n  - **Default:**\n    `{\"enabled\": false, \"target\": \"local\", \"otlpEndpoint\": \"http://localhost:4317\", \"logPrompts\": true}`\n  - **Properties:**\n    - **`enabled`** (boolean): Whether or not telemetry is enabled.\n    - **`target`** (string): The destination for collected telemetry. Supported\n      values are `local` and `gcp`.\n    - **`otlpEndpoint`** (string): The endpoint for the OTLP Exporter.\n    - **`logPrompts`** (boolean): Whether or not to include the content of user\n      prompts in the logs.\n  - **Example:**\n    ```json\n    \"telemetry\": {\n      \"enabled\": true,\n      \"target\": \"local\",\n      \"otlpEndpoint\": \"http://localhost:16686\",\n      \"logPrompts\": false\n    }\n    ```\n- **`usageStatisticsEnabled`** (boolean):\n  - **Description:** Enables or disables the collection of usage statistics. See\n    [Usage Statistics](#usage-statistics) for more information.\n  - **Default:** `true`\n  - **Example:**\n    ```json\n    \"usageStatisticsEnabled\": false\n    ```\n\n- **`hideTips`** (boolean):\n  - **Description:** Enables or disables helpful tips in the CLI interface.\n  - **Default:** `false`\n  - **Example:**\n\n    ```json\n    \"hideTips\": true\n    ```\n\n- **`hideBanner`** (boolean):\n  - **Description:** Enables or disables the startup banner (ASCII art logo) in\n    the CLI interface.\n  - **Default:** `false`\n  - **Example:**\n\n    ```json\n    \"hideBanner\": true\n    ```\n\n- **`maxSessionTurns`** (number):\n  - **Description:** Sets the maximum number of turns for a session. If the\n    session exceeds this limit, the CLI will stop processing and start a new\n    chat.\n  - **Default:** `-1` (unlimited)\n  - **Example:**\n    ```json\n    \"maxSessionTurns\": 10\n    ```\n\n- **`summarizeToolOutput`** (object):\n  - **Description:** Enables or disables the summarization of tool output. You\n    can specify the token budget for the summarization using the `tokenBudget`\n    setting.\n  - Note: Currently only the `run_shell_command` tool is supported.\n  - **Default:** `{}` (Disabled by default)\n  - **Example:**\n    ```json\n    \"summarizeToolOutput\": {\n      \"run_shell_command\": {\n        \"tokenBudget\": 2000\n      }\n    }\n    ```\n\n- **`excludedProjectEnvVars`** (array of strings):\n  - **Description:** Specifies environment variables that should be excluded\n    from being loaded from project `.env` files. This prevents project-specific\n    environment variables (like `DEBUG=true`) from interfering with gemini-cli\n    behavior. Variables from `.gemini/.env` files are never excluded.\n  - **Default:** `[\"DEBUG\", \"DEBUG_MODE\"]`\n  - **Example:**\n    ```json\n    \"excludedProjectEnvVars\": [\"DEBUG\", \"DEBUG_MODE\", \"NODE_ENV\"]\n    ```\n\n- **`includeDirectories`** (array of strings):\n  - **Description:** Specifies an array of additional absolute or relative paths\n    to include in the workspace context. This allows you to work with files\n    across multiple directories as if they were one. Paths can use `~` to refer\n    to the user's home directory. This setting can be combined with the\n    `--include-directories` command-line flag.\n  - **Default:** `[]`\n  - **Example:**\n    ```json\n    \"includeDirectories\": [\n      \"/path/to/another/project\",\n      \"../shared-library\",\n      \"~/common-utils\"\n    ]\n    ```\n\n- **`loadMemoryFromIncludeDirectories`** (boolean):\n  - **Description:** Controls the behavior of the `/memory refresh` command. If\n    set to `true`, `GEMINI.md` files should be loaded from all directories that\n    are added. If set to `false`, `GEMINI.md` should only be loaded from the\n    current directory.\n  - **Default:** `false`\n  - **Example:**\n    ```json\n    \"loadMemoryFromIncludeDirectories\": true\n    ```\n\n### Example `settings.json`:\n\n```json\n{\n  \"theme\": \"GitHub\",\n  \"sandbox\": \"docker\",\n  \"toolDiscoveryCommand\": \"bin/get_tools\",\n  \"toolCallCommand\": \"bin/call_tool\",\n  \"mcpServers\": {\n    \"mainServer\": {\n      \"command\": \"bin/mcp_server.py\"\n    },\n    \"anotherServer\": {\n      \"command\": \"node\",\n      \"args\": [\"mcp_server.js\", \"--verbose\"]\n    }\n  },\n  \"telemetry\": {\n    \"enabled\": true,\n    \"target\": \"local\",\n    \"otlpEndpoint\": \"http://localhost:4317\",\n    \"logPrompts\": true\n  },\n  \"usageStatisticsEnabled\": true,\n  \"hideTips\": false,\n  \"hideBanner\": false,\n  \"maxSessionTurns\": 10,\n  \"summarizeToolOutput\": {\n    \"run_shell_command\": {\n      \"tokenBudget\": 100\n    }\n  },\n  \"excludedProjectEnvVars\": [\"DEBUG\", \"DEBUG_MODE\", \"NODE_ENV\"],\n  \"includeDirectories\": [\"path/to/dir1\", \"~/path/to/dir2\", \"../path/to/dir3\"],\n  \"loadMemoryFromIncludeDirectories\": true\n}\n```\n\n## Shell history\n\nThe CLI keeps a history of shell commands you run. To avoid conflicts between\ndifferent projects, this history is stored in a project-specific directory\nwithin your user's home folder.\n\n- **Location:** `~/.gemini/tmp/<project_hash>/shell_history`\n  - `<project_hash>` is a unique identifier generated from your project's root\n    path.\n  - The history is stored in a file named `shell_history`.\n\n## Environment variables and `.env` files\n\nEnvironment variables are a common way to configure applications, especially for\nsensitive information like API keys or for settings that might change between\nenvironments.\n\nThe CLI automatically loads environment variables from an `.env` file. The\nloading order is:\n\n1.  `.env` file in the current working directory.\n2.  If not found, it searches upwards in parent directories until it finds an\n    `.env` file or reaches the project root (identified by a `.git` folder) or\n    the home directory.\n3.  If still not found, it looks for `~/.env` (in the user's home directory).\n\n**Environment variable exclusion:** Some environment variables (like `DEBUG` and\n`DEBUG_MODE`) are automatically excluded from being loaded from project `.env`\nfiles to prevent interference with gemini-cli behavior. Variables from\n`.gemini/.env` files are never excluded. You can customize this behavior using\nthe `excludedProjectEnvVars` setting in your `settings.json` file.\n\n- **`GEMINI_API_KEY`** (Required):\n  - Your API key for the Gemini API.\n  - **Crucial for operation.** The CLI will not function without it.\n  - Set this in your shell profile (e.g., `~/.bashrc`, `~/.zshrc`) or an `.env`\n    file.\n- **`GEMINI_MODEL`**:\n  - Specifies the default Gemini model to use.\n  - Overrides the hardcoded default\n  - Example: `export GEMINI_MODEL=\"gemini-2.5-flash\"`\n- **`GEMINI_CLI_CUSTOM_HEADERS`**:\n  - Adds extra HTTP headers to Gemini API and Code Assist requests.\n  - Accepts a comma-separated list of `Name: value` pairs.\n  - Example:\n    `export GEMINI_CLI_CUSTOM_HEADERS=\"X-My-Header: foo, X-Trace-ID: abc123\"`.\n- **`GEMINI_API_KEY_AUTH_MECHANISM`**:\n  - Specifies how the API key should be sent for authentication when using\n    `AuthType.USE_GEMINI` or `AuthType.USE_VERTEX_AI`.\n  - Valid values are `x-goog-api-key` (default) or `bearer`.\n  - If set to `bearer`, the API key will be sent in the\n    `Authorization: Bearer <key>` header.\n  - Example: `export GEMINI_API_KEY_AUTH_MECHANISM=\"bearer\"`\n- **`GOOGLE_API_KEY`**:\n  - Your Google Cloud API key.\n  - Required for using Vertex AI in express mode.\n  - Ensure you have the necessary permissions.\n  - Example: `export GOOGLE_API_KEY=\"YOUR_GOOGLE_API_KEY\"`.\n- **`GOOGLE_CLOUD_PROJECT`**:\n  - Your Google Cloud Project ID.\n  - Required for using Code Assist or Vertex AI.\n  - If using Vertex AI, ensure you have the necessary permissions in this\n    project.\n  - **Cloud shell note:** When running in a Cloud Shell environment, this\n    variable defaults to a special project allocated for Cloud Shell users. If\n    you have `GOOGLE_CLOUD_PROJECT` set in your global environment in Cloud\n    Shell, it will be overridden by this default. To use a different project in\n    Cloud Shell, you must define `GOOGLE_CLOUD_PROJECT` in a `.env` file.\n  - Example: `export GOOGLE_CLOUD_PROJECT=\"YOUR_PROJECT_ID\"`.\n- **`GOOGLE_APPLICATION_CREDENTIALS`** (string):\n  - **Description:** The path to your Google Application Credentials JSON file.\n  - **Example:**\n    `export GOOGLE_APPLICATION_CREDENTIALS=\"/path/to/your/credentials.json\"`\n- **`OTLP_GOOGLE_CLOUD_PROJECT`**:\n  - Your Google Cloud Project ID for Telemetry in Google Cloud\n  - Example: `export OTLP_GOOGLE_CLOUD_PROJECT=\"YOUR_PROJECT_ID\"`.\n- **`GOOGLE_CLOUD_LOCATION`**:\n  - Your Google Cloud Project Location (e.g., us-central1).\n  - Required for using Vertex AI in non express mode.\n  - Example: `export GOOGLE_CLOUD_LOCATION=\"YOUR_PROJECT_LOCATION\"`.\n- **`GEMINI_SANDBOX`**:\n  - Alternative to the `sandbox` setting in `settings.json`.\n  - Accepts `true`, `false`, `docker`, `podman`, or a custom command string.\n- **`HTTP_PROXY` / `HTTPS_PROXY`**:\n  - Specifies the proxy server to use for outgoing HTTP/HTTPS requests.\n  - Example: `export HTTPS_PROXY=\"http://proxy.example.com:8080\"`\n- **`SEATBELT_PROFILE`** (macOS specific):\n  - Switches the Seatbelt (`sandbox-exec`) profile on macOS.\n  - `permissive-open`: (Default) Restricts writes to the project folder (and a\n    few other folders, see\n    `packages/cli/src/utils/sandbox-macos-permissive-open.sb`) but allows other\n    operations.\n  - `strict`: Uses a strict profile that declines operations by default.\n  - `<profile_name>`: Uses a custom profile. To define a custom profile, create\n    a file named `sandbox-macos-<profile_name>.sb` in your project's `.gemini/`\n    directory (e.g., `my-project/.gemini/sandbox-macos-custom.sb`).\n- **`DEBUG` or `DEBUG_MODE`** (often used by underlying libraries or the CLI\n  itself):\n  - Set to `true` or `1` to enable verbose debug logging, which can be helpful\n    for troubleshooting.\n  - **Note:** These variables are automatically excluded from project `.env`\n    files by default to prevent interference with gemini-cli behavior. Use\n    `.gemini/.env` files if you need to set these for gemini-cli specifically.\n- **`NO_COLOR`**:\n  - Set to any value to disable all color output in the CLI.\n- **`CLI_TITLE`**:\n  - Set to a string to customize the title of the CLI.\n- **`CODE_ASSIST_ENDPOINT`**:\n  - Specifies the endpoint for the code assist server.\n  - This is useful for development and testing.\n- **`GEMINI_SYSTEM_MD`**:\n  - Overrides the base system prompt with the contents of a Markdown file.\n  - If set to `1` or `true`, it uses the file at `.gemini/system.md`.\n  - If set to a file path, it uses that file. The path can be absolute or\n    relative. `~` is supported for the home directory.\n  - The specified file must exist.\n- **`GEMINI_WRITE_SYSTEM_MD`**:\n  - Writes the default system prompt to a file. This is useful for getting a\n    template to customize.\n  - If set to `1` or `true`, it writes to `.gemini/system.md`.\n  - If set to a file path, it writes to that path. The path can be absolute or\n    relative. `~` is supported for the home directory. **Note: This will\n    overwrite the file if it already exists.**\n\n## Command-line arguments\n\nArguments passed directly when running the CLI can override other configurations\nfor that specific session.\n\n- **`--model <model_name>`** (**`-m <model_name>`**):\n  - Specifies the Gemini model to use for this session.\n  - Example: `npm start -- --model gemini-1.5-pro-latest`\n- **`--prompt <your_prompt>`** (**`-p <your_prompt>`**):\n  - Used to pass a prompt directly to the command. This invokes Gemini CLI in a\n    non-interactive mode.\n- **`--prompt-interactive <your_prompt>`** (**`-i <your_prompt>`**):\n  - Starts an interactive session with the provided prompt as the initial input.\n  - The prompt is processed within the interactive session, not before it.\n  - Cannot be used when piping input from stdin.\n  - Example: `gemini -i \"explain this code\"`\n- **`--sandbox`** (**`-s`**):\n  - Enables sandbox mode for this session.\n- **`--sandbox-image`**:\n  - Sets the sandbox image URI.\n- **`--debug`** (**`-d`**):\n  - Enables debug mode for this session, providing more verbose output.\n- **`--all-files`** (**`-a`**):\n  - If set, recursively includes all files within the current directory as\n    context for the prompt.\n- **`--help`** (or **`-h`**):\n  - Displays help information about command-line arguments.\n- **`--show-memory-usage`**:\n  - Displays the current memory usage.\n- **`--yolo`**:\n  - Enables YOLO mode, which automatically approves all tool calls.\n- **`--telemetry`**:\n  - Enables [telemetry](./telemetry.md).\n- **`--telemetry-target`**:\n  - Sets the telemetry target. See [telemetry](./telemetry.md) for more\n    information.\n- **`--telemetry-otlp-endpoint`**:\n  - Sets the OTLP endpoint for telemetry. See [telemetry](./telemetry.md) for\n    more information.\n- **`--telemetry-log-prompts`**:\n  - Enables logging of prompts for telemetry. See [telemetry](./telemetry.md)\n    for more information.\n- **`--extensions <extension_name ...>`** (**`-e <extension_name ...>`**):\n  - Specifies a list of extensions to use for the session. If not provided, all\n    available extensions are used.\n  - Use the special term `gemini -e none` to disable all extensions.\n  - Example: `gemini -e my-extension -e my-other-extension`\n- **`--list-extensions`** (**`-l`**):\n  - Lists all available extensions and exits.\n- **`--include-directories <dir1,dir2,...>`**:\n  - Includes additional directories in the workspace for multi-directory\n    support.\n  - Can be specified multiple times or as comma-separated values.\n  - 5 directories can be added at maximum.\n  - Example: `--include-directories /path/to/project1,/path/to/project2` or\n    `--include-directories /path/to/project1 --include-directories /path/to/project2`\n- **`--version`**:\n  - Displays the version of the CLI.\n\n## Context files (hierarchical instructional context)\n\nWhile not strictly configuration for the CLI's _behavior_, context files\n(defaulting to `GEMINI.md` but configurable via the `contextFileName` setting)\nare crucial for configuring the _instructional context_ (also referred to as\n\"memory\") provided to the Gemini model. This powerful feature allows you to give\nproject-specific instructions, coding style guides, or any relevant background\ninformation to the AI, making its responses more tailored and accurate to your\nneeds. The CLI includes UI elements, such as an indicator in the footer showing\nthe number of loaded context files, to keep you informed about the active\ncontext.\n\n- **Purpose:** These Markdown files contain instructions, guidelines, or context\n  that you want the Gemini model to be aware of during your interactions. The\n  system is designed to manage this instructional context hierarchically.\n\n### Example context file content (e.g., `GEMINI.md`)\n\nHere's a conceptual example of what a context file at the root of a TypeScript\nproject might contain:\n\n```markdown\n# Project: My Awesome TypeScript Library\n\n## General Instructions:\n\n- When generating new TypeScript code, please follow the existing coding style.\n- Ensure all new functions and classes have JSDoc comments.\n- Prefer functional programming paradigms where appropriate.\n- All code should be compatible with TypeScript 5.0 and Node.js 20+.\n\n## Coding Style:\n\n- Use 2 spaces for indentation.\n- Interface names should be prefixed with `I` (e.g., `IUserService`).\n- Private class members should be prefixed with an underscore (`_`).\n- Always use strict equality (`===` and `!==`).\n\n## Specific Component: `src/api/client.ts`\n\n- This file handles all outbound API requests.\n- When adding new API call functions, ensure they include robust error handling\n  and logging.\n- Use the existing `fetchWithRetry` utility for all GET requests.\n\n## Regarding Dependencies:\n\n- Avoid introducing new external dependencies unless absolutely necessary.\n- If a new dependency is required, please state the reason.\n```\n\nThis example demonstrates how you can provide general project context, specific\ncoding conventions, and even notes about particular files or components. The\nmore relevant and precise your context files are, the better the AI can assist\nyou. Project-specific context files are highly encouraged to establish\nconventions and context.\n\n- **Hierarchical loading and precedence:** The CLI implements a sophisticated\n  hierarchical memory system by loading context files (e.g., `GEMINI.md`) from\n  several locations. Content from files lower in this list (more specific)\n  typically overrides or supplements content from files higher up (more\n  general). The exact concatenation order and final context can be inspected\n  using the `/memory show` command. The typical loading order is:\n  1.  **Global context file:**\n      - Location: `~/.gemini/<contextFileName>` (e.g., `~/.gemini/GEMINI.md` in\n        your user home directory).\n      - Scope: Provides default instructions for all your projects.\n  2.  **Project root and ancestors context files:**\n      - Location: The CLI searches for the configured context file in the\n        current working directory and then in each parent directory up to either\n        the project root (identified by a `.git` folder) or your home directory.\n      - Scope: Provides context relevant to the entire project or a significant\n        portion of it.\n  3.  **Sub-directory context files (contextual/local):**\n      - Location: The CLI also scans for the configured context file in\n        subdirectories _below_ the current working directory (respecting common\n        ignore patterns like `node_modules`, `.git`, etc.). The breadth of this\n        search is limited to 200 directories by default, but can be configured\n        with a `memoryDiscoveryMaxDirs` field in your `settings.json` file.\n      - Scope: Allows for highly specific instructions relevant to a particular\n        component, module, or subsection of your project.\n- **Concatenation and UI indication:** The contents of all found context files\n  are concatenated (with separators indicating their origin and path) and\n  provided as part of the system prompt to the Gemini model. The CLI footer\n  displays the count of loaded context files, giving you a quick visual cue\n  about the active instructional context.\n- **Importing content:** You can modularize your context files by importing\n  other Markdown files using the `@path/to/file.md` syntax. For more details,\n  see the [Memory Import Processor documentation](../core/memport.md).\n- **Commands for memory management:**\n  - Use `/memory refresh` to force a re-scan and reload of all context files\n    from all configured locations. This updates the AI's instructional context.\n  - Use `/memory show` to display the combined instructional context currently\n    loaded, allowing you to verify the hierarchy and content being used by the\n    AI.\n  - See the [Commands documentation](./commands.md#memory) for full details on\n    the `/memory` command and its sub-commands (`show` and `refresh`).\n\nBy understanding and utilizing these configuration layers and the hierarchical\nnature of context files, you can effectively manage the AI's memory and tailor\nthe Gemini CLI's responses to your specific needs and projects.\n\n## Sandboxing\n\nThe Gemini CLI can execute potentially unsafe operations (like shell commands\nand file modifications) within a sandboxed environment to protect your system.\n\nSandboxing is disabled by default, but you can enable it in a few ways:\n\n- Using `--sandbox` or `-s` flag.\n- Setting `GEMINI_SANDBOX` environment variable.\n- Sandbox is enabled in `--yolo` mode by default.\n\nBy default, it uses a pre-built `gemini-cli-sandbox` Docker image.\n\nFor project-specific sandboxing needs, you can create a custom Dockerfile at\n`.gemini/sandbox.Dockerfile` in your project's root directory. This Dockerfile\ncan be based on the base sandbox image:\n\n```dockerfile\nFROM gemini-cli-sandbox\n\n# Add your custom dependencies or configurations here\n# For example:\n# RUN apt-get update && apt-get install -y some-package\n# COPY ./my-config /app/my-config\n```\n\nWhen `.gemini/sandbox.Dockerfile` exists, you can use `BUILD_SANDBOX`\nenvironment variable when running Gemini CLI to automatically build the custom\nsandbox image:\n\n```bash\nBUILD_SANDBOX=1 gemini -s\n```\n\n## Usage statistics\n\nTo help us improve the Gemini CLI, we collect anonymized usage statistics. This\ndata helps us understand how the CLI is used, identify common issues, and\nprioritize new features.\n\n**What we collect:**\n\n- **Tool calls:** We log the names of the tools that are called, whether they\n  succeed or fail, and how long they take to execute. We do not collect the\n  arguments passed to the tools or any data returned by them.\n- **API requests:** We log the Gemini model used for each request, the duration\n  of the request, and whether it was successful. We do not collect the content\n  of the prompts or responses.\n- **Session information:** We collect information about the configuration of the\n  CLI, such as the enabled tools and the approval mode.\n\n**What we DON'T collect:**\n\n- **Personally identifiable information (PII):** We do not collect any personal\n  information, such as your name, email address, or API keys.\n- **Prompt and response content:** We do not log the content of your prompts or\n  the responses from the Gemini model.\n- **File content:** We do not log the content of any files that are read or\n  written by the CLI.\n\n**How to opt out:**\n\nYou can opt out of usage statistics collection at any time by setting the\n`usageStatisticsEnabled` property to `false` in your `settings.json` file:\n\n```json\n{\n  \"usageStatisticsEnabled\": false\n}\n```\n"}
{"source":"github","repo":"gemini-cli","path":"docs/releases.md","content":"# Gemini CLI releases\n\n## `dev` vs `prod` environment\n\nOur release flows support both `dev` and `prod` environments.\n\nThe `dev` environment pushes to a private Github-hosted NPM repository, with the\npackage names beginning with `@google-gemini/**` instead of `@google/**`.\n\nThe `prod` environment pushes to the public global NPM registry via Wombat\nDressing Room, which is Google's system for managing NPM packages in the\n`@google/**` namespace. The packages are all named `@google/**`.\n\nMore information can be found about these systems in the\n[maintainer repo guide](https://github.com/google-gemini/maintainers-gemini-cli/blob/main/npm.md)\n\n### Package scopes\n\n| Package    | `prod` (Wombat Dressing Room) | `dev` (Github Private NPM Repo)           |\n| ---------- | ----------------------------- | ----------------------------------------- |\n| CLI        | @google/gemini-cli            | @google-gemini/gemini-cli                 |\n| Core       | @google/gemini-cli-core       | @google-gemini/gemini-cli-core A2A Server |\n| A2A Server | @google/gemini-cli-a2a-server | @google-gemini/gemini-cli-a2a-server      |\n\n## Release cadence and tags\n\nWe will follow https://semver.org/ as closely as possible but will call out when\nor if we have to deviate from it. Our weekly releases will be minor version\nincrements and any bug or hotfixes between releases will go out as patch\nversions on the most recent release.\n\nEach Tuesday ~2000 UTC new Stable and Preview releases will be cut. The\npromotion flow is:\n\n- Code is committed to main and pushed each night to nightly\n- After no more than 1 week on main, code is promoted to the `preview` channel\n- After 1 week the most recent `preview` channel is promoted to `stable` channel\n- Patch fixes will be produced against both `preview` and `stable` as needed,\n  with the final 'patch' version number incrementing each time.\n\n### Preview\n\nThese releases will not have been fully vetted and may contain regressions or\nother outstanding issues. Please help us test and install with `preview` tag.\n\n```bash\nnpm install -g @google/gemini-cli@preview\n```\n\n### Stable\n\nThis will be the full promotion of last week's release + any bug fixes and\nvalidations. Use `latest` tag.\n\n```bash\nnpm install -g @google/gemini-cli@latest\n```\n\n### Nightly\n\n- New releases will be published each day at UTC 0000. This will be all changes\n  from the main branch as represented at time of release. It should be assumed\n  there are pending validations and issues. Use `nightly` tag.\n\n```bash\nnpm install -g @google/gemini-cli@nightly\n```\n\n## Weekly release promotion\n\nEach Tuesday, the on-call engineer will trigger the \"Promote Release\" workflow.\nThis single action automates the entire weekly release process:\n\n1.  **Promotes preview to stable:** The workflow identifies the latest `preview`\n    release and promotes it to `stable`. This becomes the new `latest` version\n    on npm.\n2.  **Promotes nightly to preview:** The latest `nightly` release is then\n    promoted to become the new `preview` version.\n3.  **Prepares for next nightly:** A pull request is automatically created and\n    merged to bump the version in `main` in preparation for the next nightly\n    release.\n\nThis process ensures a consistent and reliable release cadence with minimal\nmanual intervention.\n\n### Source of truth for versioning\n\nTo ensure the highest reliability, the release promotion process uses the **NPM\nregistry as the single source of truth** for determining the current version of\neach release channel (`stable`, `preview`, and `nightly`).\n\n1.  **Fetch from NPM:** The workflow begins by querying NPM's `dist-tags`\n    (`latest`, `preview`, `nightly`) to get the exact version strings for the\n    packages currently available to users.\n2.  **Cross-check for integrity:** For each version retrieved from NPM, the\n    workflow performs a critical integrity check:\n    - It verifies that a corresponding **git tag** exists in the repository.\n    - It verifies that a corresponding **GitHub release** has been created.\n3.  **Halt on discrepancy:** If either the git tag or the GitHub Release is\n    missing for a version listed on NPM, the workflow will immediately fail.\n    This strict check prevents promotions from a broken or incomplete previous\n    release and alerts the on-call engineer to a release state inconsistency\n    that must be manually resolved.\n4.  **Calculate next version:** Only after these checks pass does the workflow\n    proceed to calculate the next semantic version based on the trusted version\n    numbers retrieved from NPM.\n\nThis NPM-first approach, backed by integrity checks, makes the release process\nhighly robust and prevents the kinds of versioning discrepancies that can arise\nfrom relying solely on git history or API outputs.\n\n## Manual releases\n\nFor situations requiring a release outside of the regular nightly and weekly\npromotion schedule, and NOT already covered by patching process, you can use the\n`Release: Manual` workflow. This workflow provides a direct way to publish a\nspecific version from any branch, tag, or commit SHA.\n\n### How to create a manual release\n\n1.  Navigate to the **Actions** tab of the repository.\n2.  Select the **Release: Manual** workflow from the list.\n3.  Click the **Run workflow** dropdown button.\n4.  Fill in the required inputs:\n    - **Version**: The exact version to release (e.g., `v0.6.1`). This must be a\n      valid semantic version with a `v` prefix.\n    - **Ref**: The branch, tag, or full commit SHA to release from.\n    - **NPM Channel**: The npm channel to publish to. The options are `preview`,\n      `nightly`, `latest` (for stable releases), and `dev`. The default is\n      `dev`.\n    - **Dry Run**: Leave as `true` to run all steps without publishing, or set\n      to `false` to perform a live release.\n    - **Force Skip Tests**: Set to `true` to skip the test suite. This is not\n      recommended for production releases.\n    - **Skip GitHub Release**: Set to `true` to skip creating a GitHub release\n      and create an npm release only.\n    - **Environment**: Select the appropriate environment. The `dev` environment\n      is intended for testing. The `prod` environment is intended for production\n      releases. `prod` is the default and will require authorization from a\n      release administrator.\n5.  Click **Run workflow**.\n\nThe workflow will then proceed to test (if not skipped), build, and publish the\nrelease. If the workflow fails during a non-dry run, it will automatically\ncreate a GitHub issue with the failure details.\n\n## Rollback/rollforward\n\nIn the event that a release has a critical regression, you can quickly roll back\nto a previous stable version or roll forward to a new patch by changing the npm\n`dist-tag`. The `Release: Change Tags` workflow provides a safe and controlled\nway to do this.\n\nThis is the preferred method for both rollbacks and rollforwards, as it does not\nrequire a full release cycle.\n\n### How to change a release tag\n\n1.  Navigate to the **Actions** tab of the repository.\n2.  Select the **Release: Change Tags** workflow from the list.\n3.  Click the **Run workflow** dropdown button.\n4.  Fill in the required inputs:\n    - **Version**: The existing package version that you want to point the tag\n      to (e.g., `0.5.0-preview-2`). This version **must** already be published\n      to the npm registry.\n    - **Channel**: The npm `dist-tag` to apply (e.g., `preview`, `stable`).\n    - **Dry Run**: Leave as `true` to log the action without making changes, or\n      set to `false` to perform the live tag change.\n    - **Environment**: Select the appropriate environment. The `dev` environment\n      is intended for testing. The `prod` environment is intended for production\n      releases. `prod` is the default and will require authorization from a\n      release administrator.\n5.  Click **Run workflow**.\n\nThe workflow will then run `npm dist-tag add` for the appropriate `gemini-cli`,\n`gemini-cli-core` and `gemini-cli-a2a-server` packages, pointing the specified\nchannel to the specified version.\n\n## Patching\n\nIf a critical bug that is already fixed on `main` needs to be patched on a\n`stable` or `preview` release, the process is now highly automated.\n\n### How to patch\n\n#### 1. Create the patch pull request\n\nThere are two ways to create a patch pull request:\n\n**Option A: From a GitHub comment (recommended)**\n\nAfter a pull request containing the fix has been merged, a maintainer can add a\ncomment on that same PR with the following format:\n\n`/patch [channel]`\n\n- **channel** (optional):\n  - _no channel_ - patches both stable and preview channels (default,\n    recommended for most fixes)\n  - `both` - patches both stable and preview channels (same as default)\n  - `stable` - patches only the stable channel\n  - `preview` - patches only the preview channel\n\nExamples:\n\n- `/patch` (patches both stable and preview - default)\n- `/patch both` (patches both stable and preview - explicit)\n- `/patch stable` (patches only stable)\n- `/patch preview` (patches only preview)\n\nThe `Release: Patch from Comment` workflow will automatically find the merge\ncommit SHA and trigger the `Release: Patch (1) Create PR` workflow. If the PR is\nnot yet merged, it will post a comment indicating the failure.\n\n**Option B: Manually triggering the workflow**\n\nNavigate to the **Actions** tab and run the **Release: Patch (1) Create PR**\nworkflow.\n\n- **Commit**: The full SHA of the commit on `main` that you want to cherry-pick.\n- **Channel**: The channel you want to patch (`stable` or `preview`).\n\nThis workflow will automatically:\n\n1.  Find the latest release tag for the channel.\n2.  Create a release branch from that tag if one doesn't exist (e.g.,\n    `release/v0.5.1-pr-12345`).\n3.  Create a new hotfix branch from the release branch.\n4.  Cherry-pick your specified commit into the hotfix branch.\n5.  Create a pull request from the hotfix branch back to the release branch.\n\n#### 2. Review and merge\n\nReview the automatically created pull request(s) to ensure the cherry-pick was\nsuccessful and the changes are correct. Once approved, merge the pull request.\n\n**Security note:** The `release/*` branches are protected by branch protection\nrules. A pull request to one of these branches requires at least one review from\na code owner before it can be merged. This ensures that no unauthorized code is\nreleased.\n\n#### 2.5. Adding multiple commits to a hotfix (advanced)\n\nIf you need to include multiple fixes in a single patch release, you can add\nadditional commits to the hotfix branch after the initial patch PR has been\ncreated:\n\n1. **Start with the primary fix**: Use `/patch` (or `/patch both`) on the most\n   important PR to create the initial hotfix branch and PR.\n\n2. **Checkout the hotfix branch locally**:\n\n   ```bash\n   git fetch origin\n   git checkout hotfix/v0.5.1/stable/cherry-pick-abc1234  # Use the actual branch name from the PR\n   ```\n\n3. **Cherry-pick additional commits**:\n\n   ```bash\n   git cherry-pick <commit-sha-1>\n   git cherry-pick <commit-sha-2>\n   # Add as many commits as needed\n   ```\n\n4. **Push the updated branch**:\n\n   ```bash\n   git push origin hotfix/v0.5.1/stable/cherry-pick-abc1234\n   ```\n\n5. **Test and review**: The existing patch PR will automatically update with\n   your additional commits. Test thoroughly since you're now releasing multiple\n   changes together.\n\n6. **Update the PR description**: Consider updating the PR title and description\n   to reflect that it includes multiple fixes.\n\nThis approach allows you to group related fixes into a single patch release\nwhile maintaining full control over what gets included and how conflicts are\nresolved.\n\n#### 3. Automatic release\n\nUpon merging the pull request, the `Release: Patch (2) Trigger` workflow is\nautomatically triggered. It will then start the `Release: Patch (3) Release`\nworkflow, which will:\n\n1.  Build and test the patched code.\n2.  Publish the new patch version to npm.\n3.  Create a new GitHub release with the patch notes.\n\nThis fully automated process ensures that patches are created and released\nconsistently and reliably.\n\n#### Troubleshooting: Older branch workflows\n\n**Issue**: If the patch trigger workflow fails with errors like \"Resource not\naccessible by integration\" or references to non-existent workflow files (e.g.,\n`patch-release.yml`), this indicates the hotfix branch contains an outdated\nversion of the workflow files.\n\n**Root cause**: When a PR is merged, GitHub Actions runs the workflow definition\nfrom the **source branch** (the hotfix branch), not from the target branch (the\nrelease branch). If the hotfix branch was created from an older release branch\nthat predates workflow improvements, it will use the old workflow logic.\n\n**Solutions**:\n\n**Option 1: Manual trigger (quick fix)** Manually trigger the updated workflow\nfrom the branch with the latest workflow code:\n\n```bash\n# For a preview channel patch with tests skipped\ngh workflow run release-patch-2-trigger.yml --ref <branch-with-updated-workflow> \\\n  --field ref=\"hotfix/v0.6.0-preview.2/preview/cherry-pick-abc1234\" \\\n  --field workflow_ref=<branch-with-updated-workflow> \\\n  --field dry_run=false \\\n  --field force_skip_tests=true\n\n# For a stable channel patch\ngh workflow run release-patch-2-trigger.yml --ref <branch-with-updated-workflow> \\\n  --field ref=\"hotfix/v0.5.1/stable/cherry-pick-abc1234\" \\\n  --field workflow_ref=<branch-with-updated-workflow> \\\n  --field dry_run=false \\\n  --field force_skip_tests=false\n\n# Example using main branch (most common case)\ngh workflow run release-patch-2-trigger.yml --ref main \\\n  --field ref=\"hotfix/v0.6.0-preview.2/preview/cherry-pick-abc1234\" \\\n  --field workflow_ref=main \\\n  --field dry_run=false \\\n  --field force_skip_tests=true\n```\n\n**Note**: Replace `<branch-with-updated-workflow>` with the branch containing\nthe latest workflow improvements (usually `main`, but could be a feature branch\nif testing updates).\n\n**Option 2: Update the hotfix branch** Merge the latest main branch into your\nhotfix branch to get the updated workflows:\n\n```bash\ngit checkout hotfix/v0.6.0-preview.2/preview/cherry-pick-abc1234\ngit merge main\ngit push\n```\n\nThen close and reopen the PR to retrigger the workflow with the updated version.\n\n**Option 3: Direct release trigger** Skip the trigger workflow entirely and\ndirectly run the release workflow:\n\n```bash\n# Replace channel and release_ref with appropriate values\ngh workflow run release-patch-3-release.yml --ref main \\\n  --field type=\"preview\" \\\n  --field dry_run=false \\\n  --field force_skip_tests=true \\\n  --field release_ref=\"release/v0.6.0-preview.2\"\n```\n\n### Docker\n\nWe also run a Google cloud build called\n[release-docker.yml](../.gcp/release-docker.yml). Which publishes the sandbox\ndocker to match your release. This will also be moved to GH and combined with\nthe main release file once service account permissions are sorted out.\n\n## Release validation\n\nAfter pushing a new release smoke testing should be performed to ensure that the\npackages are working as expected. This can be done by installing the packages\nlocally and running a set of tests to ensure that they are functioning\ncorrectly.\n\n- `npx -y @google/gemini-cli@latest --version` to validate the push worked as\n  expected if you were not doing a rc or dev tag\n- `npx -y @google/gemini-cli@<release tag> --version` to validate the tag pushed\n  appropriately\n- _This is destructive locally_\n  `npm uninstall @google/gemini-cli && npm uninstall -g @google/gemini-cli && npm cache clean --force &&  npm install @google/gemini-cli@<version>`\n- Smoke testing a basic run through of exercising a few llm commands and tools\n  is recommended to ensure that the packages are working as expected. We'll\n  codify this more in the future.\n\n## Local testing and validation: Changes to the packaging and publishing process\n\nIf you need to test the release process without actually publishing to NPM or\ncreating a public GitHub release, you can trigger the workflow manually from the\nGitHub UI.\n\n1.  Go to the\n    [Actions tab](https://github.com/google-gemini/gemini-cli/actions/workflows/release-manual.yml)\n    of the repository.\n2.  Click on the \"Run workflow\" dropdown.\n3.  Leave the `dry_run` option checked (`true`).\n4.  Click the \"Run workflow\" button.\n\nThis will run the entire release process but will skip the `npm publish` and\n`gh release create` steps. You can inspect the workflow logs to ensure\neverything is working as expected.\n\nIt is crucial to test any changes to the packaging and publishing process\nlocally before committing them. This ensures that the packages will be published\ncorrectly and that they will work as expected when installed by a user.\n\nTo validate your changes, you can perform a dry run of the publishing process.\nThis will simulate the publishing process without actually publishing the\npackages to the npm registry.\n\n```bash\nnpm_package_version=9.9.9 SANDBOX_IMAGE_REGISTRY=\"registry\" SANDBOX_IMAGE_NAME=\"thename\" npm run publish:npm --dry-run\n```\n\nThis command will do the following:\n\n1.  Build all the packages.\n2.  Run all the prepublish scripts.\n3.  Create the package tarballs that would be published to npm.\n4.  Print a summary of the packages that would be published.\n\nYou can then inspect the generated tarballs to ensure that they contain the\ncorrect files and that the `package.json` files have been updated correctly. The\ntarballs will be created in the root of each package's directory (e.g.,\n`packages/cli/google-gemini-cli-0.1.6.tgz`).\n\nBy performing a dry run, you can be confident that your changes to the packaging\nprocess are correct and that the packages will be published successfully.\n\n## Release deep dive\n\nThe release process creates two distinct types of artifacts for different\ndistribution channels: standard packages for the NPM registry and a single,\nself-contained executable for GitHub Releases.\n\nHere are the key stages:\n\n**Stage 1: Pre-release sanity checks and versioning**\n\n- **What happens:** Before any files are moved, the process ensures the project\n  is in a good state. This involves running tests, linting, and type-checking\n  (`npm run preflight`). The version number in the root `package.json` and\n  `packages/cli/package.json` is updated to the new release version.\n\n**Stage 2: Building the source code for NPM**\n\n- **What happens:** The TypeScript source code in `packages/core/src` and\n  `packages/cli/src` is compiled into standard JavaScript.\n- **File movement:**\n  - `packages/core/src/**/*.ts` -> compiled to -> `packages/core/dist/`\n  - `packages/cli/src/**/*.ts` -> compiled to -> `packages/cli/dist/`\n- **Why:** The TypeScript code written during development needs to be converted\n  into plain JavaScript that can be run by Node.js. The `core` package is built\n  first as the `cli` package depends on it.\n\n**Stage 3: Publishing standard packages to NPM**\n\n- **What happens:** The `npm publish` command is run for the\n  `@google/gemini-cli-core` and `@google/gemini-cli` packages.\n- **Why:** This publishes them as standard Node.js packages. Users installing\n  via `npm install -g @google/gemini-cli` will download these packages, and\n  `npm` will handle installing the `@google/gemini-cli-core` dependency\n  automatically. The code in these packages is not bundled into a single file.\n\n**Stage 4: Assembling and creating the GitHub release asset**\n\nThis stage happens _after_ the NPM publish and creates the single-file\nexecutable that enables `npx` usage directly from the GitHub repository.\n\n1.  **The JavaScript bundle is created:**\n    - **What happens:** The built JavaScript from both `packages/core/dist` and\n      `packages/cli/dist`, along with all third-party JavaScript dependencies,\n      are bundled by `esbuild` into a single, executable JavaScript file (e.g.,\n      `gemini.js`). The `node-pty` library is excluded from this bundle as it\n      contains native binaries.\n    - **Why:** This creates a single, optimized file that contains all the\n      necessary application code. It simplifies execution for users who want to\n      run the CLI without a full `npm install`, as all dependencies (including\n      the `core` package) are included directly.\n\n2.  **The `bundle` directory is assembled:**\n    - **What happens:** A temporary `bundle` folder is created at the project\n      root. The single `gemini.js` executable is placed inside it, along with\n      other essential files.\n    - **File movement:**\n      - `gemini.js` (from esbuild) -> `bundle/gemini.js`\n      - `README.md` -> `bundle/README.md`\n      - `LICENSE` -> `bundle/LICENSE`\n      - `packages/cli/src/utils/*.sb` (sandbox profiles) -> `bundle/`\n    - **Why:** This creates a clean, self-contained directory with everything\n      needed to run the CLI and understand its license and usage.\n\n3.  **The GitHub release is created:**\n    - **What happens:** The contents of the `bundle` directory, including the\n      `gemini.js` executable, are attached as assets to a new GitHub Release.\n    - **Why:** This makes the single-file version of the CLI available for\n      direct download and enables the\n      `npx https://github.com/google-gemini/gemini-cli` command, which downloads\n      and runs this specific bundled asset.\n\n**Summary of artifacts**\n\n- **NPM:** Publishes standard, un-bundled Node.js packages. The primary artifact\n  is the code in `packages/cli/dist`, which depends on\n  `@google/gemini-cli-core`.\n- **GitHub release:** Publishes a single, bundled `gemini.js` file that contains\n  all dependencies, for easy execution via `npx`.\n\nThis dual-artifact process ensures that both traditional `npm` users and those\nwho prefer the convenience of `npx` have an optimized experience.\n\n## Notifications\n\nFailing release workflows will automatically create an issue with the label\n`release-failure`.\n\nA notification will be posted to the maintainer's chat channel when issues with\nthis type are created.\n\n### Modifying chat notifications\n\nNotifications use\n[GitHub for Google Chat](https://workspace.google.com/marketplace/app/github_for_google_chat/536184076190).\nTo modify the notifications, use `/github-settings` within the chat space.\n\n> [!WARNING] The following instructions describe a fragile workaround that\n> depends on the internal structure of the chat application's UI. It is likely\n> to break with future updates.\n\nThe list of available labels is not currently populated correctly. If you want\nto add a label that does not appear alphabetically in the first 30 labels in the\nrepo, you must use your browser's developer tools to manually modify the UI:\n\n1. Open your browser's developer tools (e.g., Chrome DevTools).\n2. In the `/github-settings` dialog, inspect the list of labels.\n3. Locate one of the `<li>` elements representing a label.\n4. In the HTML, modify the `data-option-value` attribute of that `<li>` element\n   to the desired label name (e.g., `release-failure`).\n5. Click on your modified label in the UI to select it, then save your settings.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/architecture.md","content":"# Gemini CLI Architecture Overview\n\nThis document provides a high-level overview of the Gemini CLI's architecture.\n\n## Core components\n\nThe Gemini CLI is primarily composed of two main packages, along with a suite of\ntools that can be used by the system in the course of handling command-line\ninput:\n\n1.  **CLI package (`packages/cli`):**\n    - **Purpose:** This contains the user-facing portion of the Gemini CLI, such\n      as handling the initial user input, presenting the final output, and\n      managing the overall user experience.\n    - **Key functions contained in the package:**\n      - [Input processing](/docs/cli/commands.md)\n      - History management\n      - Display rendering\n      - [Theme and UI customization](/docs/cli/themes.md)\n      - [CLI configuration settings](/docs/get-started/configuration.md)\n\n2.  **Core package (`packages/core`):**\n    - **Purpose:** This acts as the backend for the Gemini CLI. It receives\n      requests sent from `packages/cli`, orchestrates interactions with the\n      Gemini API, and manages the execution of available tools.\n    - **Key functions contained in the package:**\n      - API client for communicating with the Google Gemini API\n      - Prompt construction and management\n      - Tool registration and execution logic\n      - State management for conversations or sessions\n      - Server-side configuration\n\n3.  **Tools (`packages/core/src/tools/`):**\n    - **Purpose:** These are individual modules that extend the capabilities of\n      the Gemini model, allowing it to interact with the local environment\n      (e.g., file system, shell commands, web fetching).\n    - **Interaction:** `packages/core` invokes these tools based on requests\n      from the Gemini model.\n\n## Interaction flow\n\nA typical interaction with the Gemini CLI follows this flow:\n\n1.  **User input:** The user types a prompt or command into the terminal, which\n    is managed by `packages/cli`.\n2.  **Request to core:** `packages/cli` sends the user's input to\n    `packages/core`.\n3.  **Request processed:** The core package:\n    - Constructs an appropriate prompt for the Gemini API, possibly including\n      conversation history and available tool definitions.\n    - Sends the prompt to the Gemini API.\n4.  **Gemini API response:** The Gemini API processes the prompt and returns a\n    response. This response might be a direct answer or a request to use one of\n    the available tools.\n5.  **Tool execution (if applicable):**\n    - When the Gemini API requests a tool, the core package prepares to execute\n      it.\n    - If the requested tool can modify the file system or execute shell\n      commands, the user is first given details of the tool and its arguments,\n      and the user must approve the execution.\n    - Read-only operations, such as reading files, might not require explicit\n      user confirmation to proceed.\n    - Once confirmed, or if confirmation is not required, the core package\n      executes the relevant action within the relevant tool, and the result is\n      sent back to the Gemini API by the core package.\n    - The Gemini API processes the tool result and generates a final response.\n6.  **Response to CLI:** The core package sends the final response back to the\n    CLI package.\n7.  **Display to user:** The CLI package formats and displays the response to\n    the user in the terminal.\n\n## Key design principles\n\n- **Modularity:** Separating the CLI (frontend) from the Core (backend) allows\n  for independent development and potential future extensions (e.g., different\n  frontends for the same backend).\n- **Extensibility:** The tool system is designed to be extensible, allowing new\n  capabilities to be added.\n- **User experience:** The CLI focuses on providing a rich and interactive\n  terminal experience.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/changelogs/releases.md","content":"# Gemini CLI changelog\n\nGemini CLI has three major release channels: nightly, preview, and stable. For\nmost users, we recommend the stable release.\n\nOn this page, you can find information regarding the current releases and\nhighlights from each release.\n\nFor the full changelog, including nightly releases, refer to\n[Releases - google-gemini/gemini-cli](https://github.com/google-gemini/gemini-cli/releases)\non GitHub.\n\n## Current Releases\n\n| Release channel                            | Notes                                           |\n| :----------------------------------------- | :---------------------------------------------- |\n| Nightly                                    | Nightly release with the most recent changes.   |\n| [Preview](#release-v0190-preview0-preview) | Experimental features ready for early feedback. |\n| [Latest](#release-v0190---v0194-latest)    | Stable, recommended for general use.            |\n\n## Release v0.19.0 - v0.19.4 (Latest)\n\n## Highlights\n\n- **Zed integration:** Users can now leverage Gemini 3 within the Zed\n  integration after enabling \"Preview Features\" in their CLI‚Äôs `/settings`.\n- **Interactive shell:**\n  - **Click-to-Focus:** Go to `/settings` and enable **Use Alternate Buffer**\n    WhenUse Alternate Buffer\" setting is enabled users can click within the\n    embedded shell output to focus it for input.\n  - **Loading phrase:** Clearly indicates when the interactive shell is awaiting\n    user input. ([vid](https://imgur.com/a/kjK8bUK),\n    [pr](https://github.com/google-gemini/gemini-cli/pull/12535) by\n    [@jackwotherspoon](https://github.com/jackwotherspoon))\n\n### What's Changed\n\n- Use lenient MCP output schema validator by @cornmander in\n  https://github.com/google-gemini/gemini-cli/pull/13521\n- Update persistence state to track counts of messages instead of times banner\n  has been displayed by @Adib234 in\n  https://github.com/google-gemini/gemini-cli/pull/13428\n- update docs for http proxy by @scidomino in\n  https://github.com/google-gemini/gemini-cli/pull/13538\n- move stdio by @jacob314 in\n  https://github.com/google-gemini/gemini-cli/pull/13528\n- chore(release): bump version to 0.19.0-nightly.20251120.8e531dc02 by\n  @gemini-cli-robot in https://github.com/google-gemini/gemini-cli/pull/13540\n- Skip pre-commit hooks for shadow repo (#13331) by @vishvananda in\n  https://github.com/google-gemini/gemini-cli/pull/13488\n- fix(ui): Correct mouse click cursor positioning for wide characters by\n  @SandyTao520 in https://github.com/google-gemini/gemini-cli/pull/13537\n- fix(core): correct bash @P prompt transformation detection by @pyrytakala in\n  https://github.com/google-gemini/gemini-cli/pull/13544\n- Optimize and improve test coverage for cli/src/config by @megha1188 in\n  https://github.com/google-gemini/gemini-cli/pull/13485\n- Improve code coverage for cli/src/ui/privacy package by @megha1188 in\n  https://github.com/google-gemini/gemini-cli/pull/13493\n- docs: fix typos in source code and documentation by @fancive in\n  https://github.com/google-gemini/gemini-cli/pull/13577\n- Improved code coverage for cli/src/zed-integration by @megha1188 in\n  https://github.com/google-gemini/gemini-cli/pull/13570\n- feat(ui): build interactive session browser component by @bl-ue in\n  https://github.com/google-gemini/gemini-cli/pull/13351\n- Fix multiple bugs with auth flow including using the implemented but unused\n  restart support. by @jacob314 in\n  https://github.com/google-gemini/gemini-cli/pull/13565\n- feat(core): add modelAvailabilityService for managing and tracking model\n  health by @adamfweidman in\n  https://github.com/google-gemini/gemini-cli/pull/13426\n- docs: fix grammar typo \"a MCP\" to \"an MCP\" by @noahacgn in\n  https://github.com/google-gemini/gemini-cli/pull/13595\n- feat: custom loading phrase when interactive shell requires input by\n  @jackwotherspoon in https://github.com/google-gemini/gemini-cli/pull/12535\n- docs: Update uninstall command to reflect multiple extension support by\n  @JayadityaGit in https://github.com/google-gemini/gemini-cli/pull/13582\n- bug(core): Ensure we use thinking budget on fallback to 2.5 by @joshualitt in\n  https://github.com/google-gemini/gemini-cli/pull/13596\n- Remove useModelRouter experimental flag by @Adib234 in\n  https://github.com/google-gemini/gemini-cli/pull/13593\n- feat(docs): Ensure multiline JS objects are rendered properly. by @joshualitt\n  in https://github.com/google-gemini/gemini-cli/pull/13535\n- Fix exp id logging by @owenofbrien in\n  https://github.com/google-gemini/gemini-cli/pull/13430\n- Moved client id logging into createBasicLogEvent by @owenofbrien in\n  https://github.com/google-gemini/gemini-cli/pull/13607\n- Restore bracketed paste mode after external editor exit by @scidomino in\n  https://github.com/google-gemini/gemini-cli/pull/13606\n- feat(core): Add support for custom aliases for model configs. by @joshualitt\n  in https://github.com/google-gemini/gemini-cli/pull/13546\n- feat(core): Add `BaseLlmClient.generateContent`. by @joshualitt in\n  https://github.com/google-gemini/gemini-cli/pull/13591\n- Turn off alternate buffer mode by default. by @jacob314 in\n  https://github.com/google-gemini/gemini-cli/pull/13623\n- fix(cli): Prevent stdout/stderr patching for extension commands by @chrstnb in\n  https://github.com/google-gemini/gemini-cli/pull/13600\n- Improve test coverage for cli/src/ui/components by @megha1188 in\n  https://github.com/google-gemini/gemini-cli/pull/13598\n- Update ink version to 6.4.6 by @jacob314 in\n  https://github.com/google-gemini/gemini-cli/pull/13631\n- chore/release: bump version to 0.19.0-nightly.20251122.42c2e1b21 by\n  @gemini-cli-robot in https://github.com/google-gemini/gemini-cli/pull/13637\n- chore/release: bump version to 0.19.0-nightly.20251123.dadd606c0 by\n  @gemini-cli-robot in https://github.com/google-gemini/gemini-cli/pull/13675\n- chore/release: bump version to 0.19.0-nightly.20251124.e177314a4 by\n  @gemini-cli-robot in https://github.com/google-gemini/gemini-cli/pull/13713\n- fix(core): Fix context window overflow warning for PDF files by @kkitase in\n  https://github.com/google-gemini/gemini-cli/pull/13548\n- feat :rephrasing the extension logging messages to run the explore command\n  when there are no extensions installed by @JayadityaGit in\n  https://github.com/google-gemini/gemini-cli/pull/13740\n- Improve code coverage for cli package by @megha1188 in\n  https://github.com/google-gemini/gemini-cli/pull/13724\n- Add session subtask in /stats command by @Adib234 in\n  https://github.com/google-gemini/gemini-cli/pull/13750\n- feat(core): Migrate chatCompressionService to model configs. by @joshualitt in\n  https://github.com/google-gemini/gemini-cli/pull/12863\n- feat(hooks): Hook Telemetry Infrastructure by @Edilmo in\n  https://github.com/google-gemini/gemini-cli/pull/9082\n- fix: (some minor improvements to configs and getPackageJson return behaviour)\n  by @grMLEqomlkkU5Eeinz4brIrOVCUCkJuN in\n  https://github.com/google-gemini/gemini-cli/pull/12510\n- feat(hooks): Hook Event Handling by @Edilmo in\n  https://github.com/google-gemini/gemini-cli/pull/9097\n- feat(hooks): Hook Agent Lifecycle Integration by @Edilmo in\n  https://github.com/google-gemini/gemini-cli/pull/9105\n- feat(core): Land bool for alternate system prompt. by @joshualitt in\n  https://github.com/google-gemini/gemini-cli/pull/13764\n- bug(core): Add default chat compression config. by @joshualitt in\n  https://github.com/google-gemini/gemini-cli/pull/13766\n- feat(model-availability): introduce ModelPolicy and PolicyCatalog by\n  @adamfweidman in https://github.com/google-gemini/gemini-cli/pull/13751\n- feat(hooks): Hook System Orchestration by @Edilmo in\n  https://github.com/google-gemini/gemini-cli/pull/9102\n- feat(config): add isModelAvailabilityServiceEnabled setting by @adamfweidman\n  in https://github.com/google-gemini/gemini-cli/pull/13777\n- chore/release: bump version to 0.19.0-nightly.20251125.f6d97d448 by\n  @gemini-cli-robot in https://github.com/google-gemini/gemini-cli/pull/13782\n- chore: remove console.error by @adamfweidman in\n  https://github.com/google-gemini/gemini-cli/pull/13779\n- fix: Add $schema property to settings.schema.json by @sacrosanctic in\n  https://github.com/google-gemini/gemini-cli/pull/12763\n- fix(cli): allow non-GitHub SCP-styled URLs for extension installation by @m0ps\n  in https://github.com/google-gemini/gemini-cli/pull/13800\n- fix(resume): allow passing a prompt via stdin while resuming using --resume by\n  @bl-ue in https://github.com/google-gemini/gemini-cli/pull/13520\n- feat(sessions): add /resume slash command to open the session browser by\n  @bl-ue in https://github.com/google-gemini/gemini-cli/pull/13621\n- docs(sessions): add documentation for chat recording and session management by\n  @bl-ue in https://github.com/google-gemini/gemini-cli/pull/13667\n- Fix TypeError: \"URL.parse is not a function\" for Node.js < v22 by @macarronesc\n  in https://github.com/google-gemini/gemini-cli/pull/13698\n- fallback to flash for TerminalQuota errors by @sehoon38 in\n  https://github.com/google-gemini/gemini-cli/pull/13791\n- Update Code Wiki README badge by @PatoBeltran in\n  https://github.com/google-gemini/gemini-cli/pull/13768\n- Add Databricks auth support and custom header option to gemini cli by\n  @AarushiShah in https://github.com/google-gemini/gemini-cli/pull/11893\n- Update dependency for modelcontextprotocol/sdk to 1.23.0 by @bbiggs in\n  https://github.com/google-gemini/gemini-cli/pull/13827\n- fix(patch): cherry-pick 576fda1 to release/v0.19.0-preview.0-pr-14099\n  [CONFLICTS] by @gemini-cli-robot in\n  https://github.com/google-gemini/gemini-cli/pull/14402\n\n**Full Changelog**:\nhttps://github.com/google-gemini/gemini-cli/compare/v0.18.4...v0.19.0\n\n## Release v0.19.0-preview.0 (Preview)\n\n### What's Changed\n\n- Use lenient MCP output schema validator by @cornmander in\n  https://github.com/google-gemini/gemini-cli/pull/13521\n- Update persistence state to track counts of messages instead of times banner\n  has been displayed by @Adib234 in\n  https://github.com/google-gemini/gemini-cli/pull/13428\n- update docs for http proxy by @scidomino in\n  https://github.com/google-gemini/gemini-cli/pull/13538\n- move stdio by @jacob314 in\n  https://github.com/google-gemini/gemini-cli/pull/13528\n- chore(release): bump version to 0.19.0-nightly.20251120.8e531dc02 by\n  @gemini-cli-robot in https://github.com/google-gemini/gemini-cli/pull/13540\n- Skip pre-commit hooks for shadow repo (#13331) by @vishvananda in\n  https://github.com/google-gemini/gemini-cli/pull/13488\n- fix(ui): Correct mouse click cursor positioning for wide characters by\n  @SandyTao520 in https://github.com/google-gemini/gemini-cli/pull/13537\n- fix(core): correct bash @P prompt transformation detection by @pyrytakala in\n  https://github.com/google-gemini/gemini-cli/pull/13544\n- Optimize and improve test coverage for cli/src/config by @megha1188 in\n  https://github.com/google-gemini/gemini-cli/pull/13485\n- Improve code coverage for cli/src/ui/privacy package by @megha1188 in\n  https://github.com/google-gemini/gemini-cli/pull/13493\n- docs: fix typos in source code and documentation by @fancive in\n  https://github.com/google-gemini/gemini-cli/pull/13577\n- Improved code coverage for cli/src/zed-integration by @megha1188 in\n  https://github.com/google-gemini/gemini-cli/pull/13570\n- feat(ui): build interactive session browser component by @bl-ue in\n  https://github.com/google-gemini/gemini-cli/pull/13351\n- Fix multiple bugs with auth flow including using the implemented but unused\n  restart support. by @jacob314 in\n  https://github.com/google-gemini/gemini-cli/pull/13565\n- feat(core): add modelAvailabilityService for managing and tracking model\n  health by @adamfweidman in\n  https://github.com/google-gemini/gemini-cli/pull/13426\n- docs: fix grammar typo \"a MCP\" to \"an MCP\" by @noahacgn in\n  https://github.com/google-gemini/gemini-cli/pull/13595\n- feat: custom loading phrase when interactive shell requires input by\n  @jackwotherspoon in https://github.com/google-gemini/gemini-cli/pull/12535\n- docs: Update uninstall command to reflect multiple extension support by\n  @JayadityaGit in https://github.com/google-gemini/gemini-cli/pull/13582\n- bug(core): Ensure we use thinking budget on fallback to 2.5 by @joshualitt in\n  https://github.com/google-gemini/gemini-cli/pull/13596\n- Remove useModelRouter experimental flag by @Adib234 in\n  https://github.com/google-gemini/gemini-cli/pull/13593\n- feat(docs): Ensure multiline JS objects are rendered properly. by @joshualitt\n  in https://github.com/google-gemini/gemini-cli/pull/13535\n- Fix exp id logging by @owenofbrien in\n  https://github.com/google-gemini/gemini-cli/pull/13430\n- Moved client id logging into createBasicLogEvent by @owenofbrien in\n  https://github.com/google-gemini/gemini-cli/pull/13607\n- Restore bracketed paste mode after external editor exit by @scidomino in\n  https://github.com/google-gemini/gemini-cli/pull/13606\n- feat(core): Add support for custom aliases for model configs. by @joshualitt\n  in https://github.com/google-gemini/gemini-cli/pull/13546\n- feat(core): Add `BaseLlmClient.generateContent`. by @joshualitt in\n  https://github.com/google-gemini/gemini-cli/pull/13591\n- Turn off alternate buffer mode by default. by @jacob314 in\n  https://github.com/google-gemini/gemini-cli/pull/13623\n- fix(cli): Prevent stdout/stderr patching for extension commands by @chrstnb in\n  https://github.com/google-gemini/gemini-cli/pull/13600\n- Improve test coverage for cli/src/ui/components by @megha1188 in\n  https://github.com/google-gemini/gemini-cli/pull/13598\n- Update ink version to 6.4.6 by @jacob314 in\n  https://github.com/google-gemini/gemini-cli/pull/13631\n- chore/release: bump version to 0.19.0-nightly.20251122.42c2e1b21 by\n  @gemini-cli-robot in https://github.com/google-gemini/gemini-cli/pull/13637\n- chore/release: bump version to 0.19.0-nightly.20251123.dadd606c0 by\n  @gemini-cli-robot in https://github.com/google-gemini/gemini-cli/pull/13675\n- chore/release: bump version to 0.19.0-nightly.20251124.e177314a4 by\n  @gemini-cli-robot in https://github.com/google-gemini/gemini-cli/pull/13713\n- fix(core): Fix context window overflow warning for PDF files by @kkitase in\n  https://github.com/google-gemini/gemini-cli/pull/13548\n- feat :rephrasing the extension logging messages to run the explore command\n  when there are no extensions installed by @JayadityaGit in\n  https://github.com/google-gemini/gemini-cli/pull/13740\n- Improve code coverage for cli package by @megha1188 in\n  https://github.com/google-gemini/gemini-cli/pull/13724\n- Add session subtask in /stats command by @Adib234 in\n  https://github.com/google-gemini/gemini-cli/pull/13750\n- feat(core): Migrate chatCompressionService to model configs. by @joshualitt in\n  https://github.com/google-gemini/gemini-cli/pull/12863\n- feat(hooks): Hook Telemetry Infrastructure by @Edilmo in\n  https://github.com/google-gemini/gemini-cli/pull/9082\n- fix: (some minor improvements to configs and getPackageJson return behaviour)\n  by @grMLEqomlkkU5Eeinz4brIrOVCUCkJuN in\n  https://github.com/google-gemini/gemini-cli/pull/12510\n- feat(hooks): Hook Event Handling by @Edilmo in\n  https://github.com/google-gemini/gemini-cli/pull/9097\n- feat(hooks): Hook Agent Lifecycle Integration by @Edilmo in\n  https://github.com/google-gemini/gemini-cli/pull/9105\n- feat(core): Land bool for alternate system prompt. by @joshualitt in\n  https://github.com/google-gemini/gemini-cli/pull/13764\n- bug(core): Add default chat compression config. by @joshualitt in\n  https://github.com/google-gemini/gemini-cli/pull/13766\n- feat(model-availability): introduce ModelPolicy and PolicyCatalog by\n  @adamfweidman in https://github.com/google-gemini/gemini-cli/pull/13751\n- feat(hooks): Hook System Orchestration by @Edilmo in\n  https://github.com/google-gemini/gemini-cli/pull/9102\n- feat(config): add isModelAvailabilityServiceEnabled setting by @adamfweidman\n  in https://github.com/google-gemini/gemini-cli/pull/13777\n- chore/release: bump version to 0.19.0-nightly.20251125.f6d97d448 by\n  @gemini-cli-robot in https://github.com/google-gemini/gemini-cli/pull/13782\n- chore: remove console.error by @adamfweidman in\n  https://github.com/google-gemini/gemini-cli/pull/13779\n- fix: Add $schema property to settings.schema.json by @sacrosanctic in\n  https://github.com/google-gemini/gemini-cli/pull/12763\n- fix(cli): allow non-GitHub SCP-styled URLs for extension installation by @m0ps\n  in https://github.com/google-gemini/gemini-cli/pull/13800\n- fix(resume): allow passing a prompt via stdin while resuming using --resume by\n  @bl-ue in https://github.com/google-gemini/gemini-cli/pull/13520\n- feat(sessions): add /resume slash command to open the session browser by\n  @bl-ue in https://github.com/google-gemini/gemini-cli/pull/13621\n- docs(sessions): add documentation for chat recording and session management by\n  @bl-ue in https://github.com/google-gemini/gemini-cli/pull/13667\n- Fix TypeError: \"URL.parse is not a function\" for Node.js < v22 by @macarronesc\n  in https://github.com/google-gemini/gemini-cli/pull/13698\n- fallback to flash for TerminalQuota errors by @sehoon38 in\n  https://github.com/google-gemini/gemini-cli/pull/13791\n- Update Code Wiki README badge by @PatoBeltran in\n  https://github.com/google-gemini/gemini-cli/pull/13768\n- Add Databricks auth support and custom header option to gemini cli by\n  @AarushiShah in https://github.com/google-gemini/gemini-cli/pull/11893\n- Update dependency for modelcontextprotocol/sdk to 1.23.0 by @bbiggs in\n  https://github.com/google-gemini/gemini-cli/pull/13827\n\n**Full Changelog**:\nhttps://github.com/google-gemini/gemini-cli/compare/v0.18.0-preview.4...v0.19.0-preview.0\n\n## Release v0.18.0 - v0.18.4\n\n### Highlights\n\n- **Experimental permission improvements**: We're experimenting with a new\n  policy engine in Gemini CLI, letting users and administrators create\n  fine-grained policies for tool calls. This setting is currently behind a flag.\n  See our [policy engine documentation](../core/policy-engine.md) to learn how\n  to use this feature.\n- **Gemini 3 support rolled out for some users**: Some users can now enable\n  Gemini 3 by using the `/settings` flag and toggling **Preview Features**. See\n  our [Gemini 3 on Gemini CLI documentation](../get-started/gemini-3.md) to find\n  out more about using Gemini 3.\n- **Updated UI rollback:** We've temporarily rolled back a previous UI update,\n  which enabled embedded scrolling and mouse support. This can be re-enabled by\n  using the `/settings` command and setting **Use Alternate Screen Buffer** to\n  `true`.\n- **Display your model in your chat history**: You can now go use `/settings`\n  and turn on **Show Model in Chat** to display the model in your chat history.\n- **Uninstall multiple extensions**: You can uninstall multiple extensions with\n  a single command: `gemini extensions uninstall`.\n\n![Uninstalling Gemini extensions with a single command](https://i.imgur.com/pi7nEBI.png)\n\n### What's changed\n\n- Remove obsolete reference to \"help wanted\" label in CONTRIBUTING.md by\n  @aswinashok44 in https://github.com/google-gemini/gemini-cli/pull/13291\n- chore(release): v0.18.0-nightly.20251118.86828bb56 by @skeshive in\n  https://github.com/google-gemini/gemini-cli/pull/13309\n- Docs: Access clarification. by @jkcinouye in\n  https://github.com/google-gemini/gemini-cli/pull/13304\n- Fix links in Gemini 3 Pro documentation by @gmackall in\n  https://github.com/google-gemini/gemini-cli/pull/13312\n- Improve keyboard code parsing by @scidomino in\n  https://github.com/google-gemini/gemini-cli/pull/13307\n- fix(core): Ensure `read_many_files` tool is available to zed. by @joshualitt\n  in https://github.com/google-gemini/gemini-cli/pull/13338\n- Support 3-parameter modifyOtherKeys sequences by @scidomino in\n  https://github.com/google-gemini/gemini-cli/pull/13342\n- Improve pty resize error handling for Windows by @galz10 in\n  https://github.com/google-gemini/gemini-cli/pull/13353\n- fix(ui): Clear input prompt on Escape key press by @SandyTao520 in\n  https://github.com/google-gemini/gemini-cli/pull/13335\n- bug(ui) showLineNumbers had the wrong default value. by @jacob314 in\n  https://github.com/google-gemini/gemini-cli/pull/13356\n- fix(cli): fix crash on startup in NO_COLOR mode (#13343) due to ungua‚Ä¶ by\n  @avilladsen in https://github.com/google-gemini/gemini-cli/pull/13352\n- fix: allow MCP prompts with spaces in name by @jackwotherspoon in\n  https://github.com/google-gemini/gemini-cli/pull/12910\n- Refactor createTransport to duplicate less code by @davidmcwherter in\n  https://github.com/google-gemini/gemini-cli/pull/13010\n- Followup from #10719 by @bl-ue in\n  https://github.com/google-gemini/gemini-cli/pull/13243\n- Capturing github action workflow name if present and send it to clearcut by\n  @MJjainam in https://github.com/google-gemini/gemini-cli/pull/13132\n- feat(sessions): record interactive-only errors and warnings to chat recording\n  JSON files by @bl-ue in https://github.com/google-gemini/gemini-cli/pull/13300\n- fix(zed-integration): Correctly handle cancellation errors by @benbrandt in\n  https://github.com/google-gemini/gemini-cli/pull/13399\n- docs: Add Code Wiki link to README by @holtskinner in\n  https://github.com/google-gemini/gemini-cli/pull/13289\n- Restore keyboard mode when exiting the editor by @scidomino in\n  https://github.com/google-gemini/gemini-cli/pull/13350\n- feat(core, cli): Bump genai version to 1.30.0 by @joshualitt in\n  https://github.com/google-gemini/gemini-cli/pull/13435\n- [cli-ui] Keep header ASCII art colored on non-gradient terminals (#13373) by\n  @bniladridas in https://github.com/google-gemini/gemini-cli/pull/13374\n- Fix Copyright line in LICENSE by @scidomino in\n  https://github.com/google-gemini/gemini-cli/pull/13449\n- Fix typo in write_todos methodology instructions by @Smetalo in\n  https://github.com/google-gemini/gemini-cli/pull/13411\n- feat: update thinking mode support to exclude gemini-2.0 models and simplify\n  logic. by @kevin-ramdass in\n  https://github.com/google-gemini/gemini-cli/pull/13454\n- remove unneeded log by @scidomino in\n  https://github.com/google-gemini/gemini-cli/pull/13456\n- feat: add click-to-focus support for interactive shell by @galz10 in\n  https://github.com/google-gemini/gemini-cli/pull/13341\n- Add User email detail to about box by @ptone in\n  https://github.com/google-gemini/gemini-cli/pull/13459\n- feat(core): Wire up chat code path for model configs. by @joshualitt in\n  https://github.com/google-gemini/gemini-cli/pull/12850\n- chore/release: bump version to 0.18.0-nightly.20251120.2231497b1 by\n  @gemini-cli-robot in https://github.com/google-gemini/gemini-cli/pull/13476\n- feat(core): Fix bug with incorrect model overriding. by @joshualitt in\n  https://github.com/google-gemini/gemini-cli/pull/13477\n- Use synchronous writes when detecting keyboard modes by @scidomino in\n  https://github.com/google-gemini/gemini-cli/pull/13478\n- fix(cli): prevent race condition when restoring prompt after context overflow\n  by @SandyTao520 in https://github.com/google-gemini/gemini-cli/pull/13473\n- Revert \"feat(core): Fix bug with incorrect model overriding.\" by @adamfweidman\n  in https://github.com/google-gemini/gemini-cli/pull/13483\n- Fix: Update system instruction when GEMINI.md memory is loaded or refreshed by\n  @lifefloating in https://github.com/google-gemini/gemini-cli/pull/12136\n- fix(zed-integration): Ensure that the zed integration is classified as\n  interactive by @benbrandt in\n  https://github.com/google-gemini/gemini-cli/pull/13394\n- Copy commands as part of setup-github by @gsehgal in\n  https://github.com/google-gemini/gemini-cli/pull/13464\n- Update banner design by @Adib234 in\n  https://github.com/google-gemini/gemini-cli/pull/13420\n- Protect stdout and stderr so JavaScript code can't accidentally write to\n  stdout corrupting ink rendering by @jacob314 in\n  https://github.com/google-gemini/gemini-cli/pull/13247\n- Enable switching preview features on/off without restart by @Adib234 in\n  https://github.com/google-gemini/gemini-cli/pull/13515\n- feat(core): Use thinking level for Gemini 3 by @joshualitt in\n  https://github.com/google-gemini/gemini-cli/pull/13445\n- Change default compress threshold to 0.5 for api key users by @scidomino in\n  https://github.com/google-gemini/gemini-cli/pull/13517\n- remove duplicated mouse code by @scidomino in\n  https://github.com/google-gemini/gemini-cli/pull/13525\n- feat(zed-integration): Use default model routing for Zed integration by\n  @benbrandt in https://github.com/google-gemini/gemini-cli/pull/13398\n- feat(core): Incorporate Gemini 3 into model config hierarchy. by @joshualitt\n  in https://github.com/google-gemini/gemini-cli/pull/13447\n- fix(patch): cherry-pick 5e218a5 to release/v0.18.0-preview.0-pr-13623 to patch\n  version v0.18.0-preview.0 and create version 0.18.0-preview.1 by\n  @gemini-cli-robot in https://github.com/google-gemini/gemini-cli/pull/13626\n- fix(patch): cherry-pick d351f07 to release/v0.18.0-preview.1-pr-12535 to patch\n  version v0.18.0-preview.1 and create version 0.18.0-preview.2 by\n  @gemini-cli-robot in https://github.com/google-gemini/gemini-cli/pull/13813\n- fix(patch): cherry-pick 3e50be1 to release/v0.18.0-preview.2-pr-13428 to patch\n  version v0.18.0-preview.2 and create version 0.18.0-preview.3 by\n  @gemini-cli-robot in https://github.com/google-gemini/gemini-cli/pull/13821\n- fix(patch): cherry-pick d8a3d08 to release/v0.18.0-preview.3-pr-13791 to patch\n  version v0.18.0-preview.3 and create version 0.18.0-preview.4 by\n  @gemini-cli-robot in https://github.com/google-gemini/gemini-cli/pull/13826\n\n  **Full Changelog**:\n  https://github.com/google-gemini/gemini-cli/compare/v0.17.1...v0.18.0\n"}
{"source":"github","repo":"gemini-cli","path":"docs/changelogs/latest.md","content":"# Latest stable release: v0.19.0 - v0.19.4\n\nReleased: December 1, 2025\n\nFor most users, our latest stable release is the recommended release. Install\nthe latest stable version with:\n\n```\nnpm install -g @google/gemini-cli\n```\n\n## Highlights\n\n- **Zed integration:** Users can now leverage Gemini 3 within the Zed\n  integration after enabling \"Preview Features\" in their CLI‚Äôs `/settings`.\n- **Interactive shell:**\n  - **Click-to-Focus:** Go to `/settings` and enable **Use Alternate Buffer** to\n    click within the embedded shell output to focus it for input.\n  - **Loading phrase:** Clearly indicates when the interactive shell is awaiting\n    user input. ([vid](https://imgur.com/a/kjK8bUK),\n    [pr](https://github.com/google-gemini/gemini-cli/pull/12535) by\n    [@jackwotherspoon](https://github.com/jackwotherspoon))\n\n## What's Changed\n\n- Use lenient MCP output schema validator by @cornmander in\n  https://github.com/google-gemini/gemini-cli/pull/13521\n- Update persistence state to track counts of messages instead of times banner\n  has been displayed by @Adib234 in\n  https://github.com/google-gemini/gemini-cli/pull/13428\n- update docs for http proxy by @scidomino in\n  https://github.com/google-gemini/gemini-cli/pull/13538\n- move stdio by @jacob314 in\n  https://github.com/google-gemini/gemini-cli/pull/13528\n- chore(release): bump version to 0.19.0-nightly.20251120.8e531dc02 by\n  @gemini-cli-robot in https://github.com/google-gemini/gemini-cli/pull/13540\n- Skip pre-commit hooks for shadow repo (#13331) by @vishvananda in\n  https://github.com/google-gemini/gemini-cli/pull/13488\n- fix(ui): Correct mouse click cursor positioning for wide characters by\n  @SandyTao520 in https://github.com/google-gemini/gemini-cli/pull/13537\n- fix(core): correct bash @P prompt transformation detection by @pyrytakala in\n  https://github.com/google-gemini/gemini-cli/pull/13544\n- Optimize and improve test coverage for cli/src/config by @megha1188 in\n  https://github.com/google-gemini/gemini-cli/pull/13485\n- Improve code coverage for cli/src/ui/privacy package by @megha1188 in\n  https://github.com/google-gemini/gemini-cli/pull/13493\n- docs: fix typos in source code and documentation by @fancive in\n  https://github.com/google-gemini/gemini-cli/pull/13577\n- Improved code coverage for cli/src/zed-integration by @megha1188 in\n  https://github.com/google-gemini/gemini-cli/pull/13570\n- feat(ui): build interactive session browser component by @bl-ue in\n  https://github.com/google-gemini/gemini-cli/pull/13351\n- Fix multiple bugs with auth flow including using the implemented but unused\n  restart support. by @jacob314 in\n  https://github.com/google-gemini/gemini-cli/pull/13565\n- feat(core): add modelAvailabilityService for managing and tracking model\n  health by @adamfweidman in\n  https://github.com/google-gemini/gemini-cli/pull/13426\n- docs: fix grammar typo \"a MCP\" to \"an MCP\" by @noahacgn in\n  https://github.com/google-gemini/gemini-cli/pull/13595\n- feat: custom loading phrase when interactive shell requires input by\n  @jackwotherspoon in https://github.com/google-gemini/gemini-cli/pull/12535\n- docs: Update uninstall command to reflect multiple extension support by\n  @JayadityaGit in https://github.com/google-gemini/gemini-cli/pull/13582\n- bug(core): Ensure we use thinking budget on fallback to 2.5 by @joshualitt in\n  https://github.com/google-gemini/gemini-cli/pull/13596\n- Remove useModelRouter experimental flag by @Adib234 in\n  https://github.com/google-gemini/gemini-cli/pull/13593\n- feat(docs): Ensure multiline JS objects are rendered properly. by @joshualitt\n  in https://github.com/google-gemini/gemini-cli/pull/13535\n- Fix exp id logging by @owenofbrien in\n  https://github.com/google-gemini/gemini-cli/pull/13430\n- Moved client id logging into createBasicLogEvent by @owenofbrien in\n  https://github.com/google-gemini/gemini-cli/pull/13607\n- Restore bracketed paste mode after external editor exit by @scidomino in\n  https://github.com/google-gemini/gemini-cli/pull/13606\n- feat(core): Add support for custom aliases for model configs. by @joshualitt\n  in https://github.com/google-gemini/gemini-cli/pull/13546\n- feat(core): Add `BaseLlmClient.generateContent`. by @joshualitt in\n  https://github.com/google-gemini/gemini-cli/pull/13591\n- Turn off alternate buffer mode by default. by @jacob314 in\n  https://github.com/google-gemini/gemini-cli/pull/13623\n- fix(cli): Prevent stdout/stderr patching for extension commands by @chrstnb in\n  https://github.com/google-gemini/gemini-cli/pull/13600\n- Improve test coverage for cli/src/ui/components by @megha1188 in\n  https://github.com/google-gemini/gemini-cli/pull/13598\n- Update ink version to 6.4.6 by @jacob314 in\n  https://github.com/google-gemini/gemini-cli/pull/13631\n- chore/release: bump version to 0.19.0-nightly.20251122.42c2e1b21 by\n  @gemini-cli-robot in https://github.com/google-gemini/gemini-cli/pull/13637\n- chore/release: bump version to 0.19.0-nightly.20251123.dadd606c0 by\n  @gemini-cli-robot in https://github.com/google-gemini/gemini-cli/pull/13675\n- chore/release: bump version to 0.19.0-nightly.20251124.e177314a4 by\n  @gemini-cli-robot in https://github.com/google-gemini/gemini-cli/pull/13713\n- fix(core): Fix context window overflow warning for PDF files by @kkitase in\n  https://github.com/google-gemini/gemini-cli/pull/13548\n- feat :rephrasing the extension logging messages to run the explore command\n  when there are no extensions installed by @JayadityaGit in\n  https://github.com/google-gemini/gemini-cli/pull/13740\n- Improve code coverage for cli package by @megha1188 in\n  https://github.com/google-gemini/gemini-cli/pull/13724\n- Add session subtask in /stats command by @Adib234 in\n  https://github.com/google-gemini/gemini-cli/pull/13750\n- feat(core): Migrate chatCompressionService to model configs. by @joshualitt in\n  https://github.com/google-gemini/gemini-cli/pull/12863\n- feat(hooks): Hook Telemetry Infrastructure by @Edilmo in\n  https://github.com/google-gemini/gemini-cli/pull/9082\n- fix: (some minor improvements to configs and getPackageJson return behaviour)\n  by @grMLEqomlkkU5Eeinz4brIrOVCUCkJuN in\n  https://github.com/google-gemini/gemini-cli/pull/12510\n- feat(hooks): Hook Event Handling by @Edilmo in\n  https://github.com/google-gemini/gemini-cli/pull/9097\n- feat(hooks): Hook Agent Lifecycle Integration by @Edilmo in\n  https://github.com/google-gemini/gemini-cli/pull/9105\n- feat(core): Land bool for alternate system prompt. by @joshualitt in\n  https://github.com/google-gemini/gemini-cli/pull/13764\n- bug(core): Add default chat compression config. by @joshualitt in\n  https://github.com/google-gemini/gemini-cli/pull/13766\n- feat(model-availability): introduce ModelPolicy and PolicyCatalog by\n  @adamfweidman in https://github.com/google-gemini/gemini-cli/pull/13751\n- feat(hooks): Hook System Orchestration by @Edilmo in\n  https://github.com/google-gemini/gemini-cli/pull/9102\n- feat(config): add isModelAvailabilityServiceEnabled setting by @adamfweidman\n  in https://github.com/google-gemini/gemini-cli/pull/13777\n- chore/release: bump version to 0.19.0-nightly.20251125.f6d97d448 by\n  @gemini-cli-robot in https://github.com/google-gemini/gemini-cli/pull/13782\n- chore: remove console.error by @adamfweidman in\n  https://github.com/google-gemini/gemini-cli/pull/13779\n- fix: Add $schema property to settings.schema.json by @sacrosanctic in\n  https://github.com/google-gemini/gemini-cli/pull/12763\n- fix(cli): allow non-GitHub SCP-styled URLs for extension installation by @m0ps\n  in https://github.com/google-gemini/gemini-cli/pull/13800\n- fix(resume): allow passing a prompt via stdin while resuming using --resume by\n  @bl-ue in https://github.com/google-gemini/gemini-cli/pull/13520\n- feat(sessions): add /resume slash command to open the session browser by\n  @bl-ue in https://github.com/google-gemini/gemini-cli/pull/13621\n- docs(sessions): add documentation for chat recording and session management by\n  @bl-ue in https://github.com/google-gemini/gemini-cli/pull/13667\n- Fix TypeError: \"URL.parse is not a function\" for Node.js < v22 by @macarronesc\n  in https://github.com/google-gemini/gemini-cli/pull/13698\n- fallback to flash for TerminalQuota errors by @sehoon38 in\n  https://github.com/google-gemini/gemini-cli/pull/13791\n- Update Code Wiki README badge by @PatoBeltran in\n  https://github.com/google-gemini/gemini-cli/pull/13768\n- Add Databricks auth support and custom header option to gemini cli by\n  @AarushiShah in https://github.com/google-gemini/gemini-cli/pull/11893\n- Update dependency for modelcontextprotocol/sdk to 1.23.0 by @bbiggs in\n  https://github.com/google-gemini/gemini-cli/pull/13827\n- fix(patch): cherry-pick 576fda1 to release/v0.19.0-preview.0-pr-14099\n  [CONFLICTS] by @gemini-cli-robot in\n  https://github.com/google-gemini/gemini-cli/pull/14402\n\n**Full Changelog**:\nhttps://github.com/google-gemini/gemini-cli/compare/v0.18.4...v0.19.0\n"}
{"source":"github","repo":"gemini-cli","path":"docs/changelogs/preview.md","content":"# Preview release: Release v0.19.0-preview.0\n\nReleased: November 25, 2025\n\nOur preview release includes the latest, new, and experimental features. This\nrelease may not be as stable as our [latest weekly release](latest.md).\n\nTo install the preview release:\n\n```\nnpm install -g @google/gemini-cli@preview\n```\n\n## What's changed\n\n- Use lenient MCP output schema validator by @cornmander in\n  https://github.com/google-gemini/gemini-cli/pull/13521\n- Update persistence state to track counts of messages instead of times banner\n  has been displayed by @Adib234 in\n  https://github.com/google-gemini/gemini-cli/pull/13428\n- update docs for http proxy by @scidomino in\n  https://github.com/google-gemini/gemini-cli/pull/13538\n- move stdio by @jacob314 in\n  https://github.com/google-gemini/gemini-cli/pull/13528\n- chore(release): bump version to 0.19.0-nightly.20251120.8e531dc02 by\n  @gemini-cli-robot in https://github.com/google-gemini/gemini-cli/pull/13540\n- Skip pre-commit hooks for shadow repo (#13331) by @vishvananda in\n  https://github.com/google-gemini/gemini-cli/pull/13488\n- fix(ui): Correct mouse click cursor positioning for wide characters by\n  @SandyTao520 in https://github.com/google-gemini/gemini-cli/pull/13537\n- fix(core): correct bash @P prompt transformation detection by @pyrytakala in\n  https://github.com/google-gemini/gemini-cli/pull/13544\n- Optimize and improve test coverage for cli/src/config by @megha1188 in\n  https://github.com/google-gemini/gemini-cli/pull/13485\n- Improve code coverage for cli/src/ui/privacy package by @megha1188 in\n  https://github.com/google-gemini/gemini-cli/pull/13493\n- docs: fix typos in source code and documentation by @fancive in\n  https://github.com/google-gemini/gemini-cli/pull/13577\n- Improved code coverage for cli/src/zed-integration by @megha1188 in\n  https://github.com/google-gemini/gemini-cli/pull/13570\n- feat(ui): build interactive session browser component by @bl-ue in\n  https://github.com/google-gemini/gemini-cli/pull/13351\n- Fix multiple bugs with auth flow including using the implemented but unused\n  restart support. by @jacob314 in\n  https://github.com/google-gemini/gemini-cli/pull/13565\n- feat(core): add modelAvailabilityService for managing and tracking model\n  health by @adamfweidman in\n  https://github.com/google-gemini/gemini-cli/pull/13426\n- docs: fix grammar typo \"a MCP\" to \"an MCP\" by @noahacgn in\n  https://github.com/google-gemini/gemini-cli/pull/13595\n- feat: custom loading phrase when interactive shell requires input by\n  @jackwotherspoon in https://github.com/google-gemini/gemini-cli/pull/12535\n- docs: Update uninstall command to reflect multiple extension support by\n  @JayadityaGit in https://github.com/google-gemini/gemini-cli/pull/13582\n- bug(core): Ensure we use thinking budget on fallback to 2.5 by @joshualitt in\n  https://github.com/google-gemini/gemini-cli/pull/13596\n- Remove useModelRouter experimental flag by @Adib234 in\n  https://github.com/google-gemini/gemini-cli/pull/13593\n- feat(docs): Ensure multiline JS objects are rendered properly. by @joshualitt\n  in https://github.com/google-gemini/gemini-cli/pull/13535\n- Fix exp id logging by @owenofbrien in\n  https://github.com/google-gemini/gemini-cli/pull/13430\n- Moved client id logging into createBasicLogEvent by @owenofbrien in\n  https://github.com/google-gemini/gemini-cli/pull/13607\n- Restore bracketed paste mode after external editor exit by @scidomino in\n  https://github.com/google-gemini/gemini-cli/pull/13606\n- feat(core): Add support for custom aliases for model configs. by @joshualitt\n  in https://github.com/google-gemini/gemini-cli/pull/13546\n- feat(core): Add `BaseLlmClient.generateContent`. by @joshualitt in\n  https://github.com/google-gemini/gemini-cli/pull/13591\n- Turn off alternate buffer mode by default. by @jacob314 in\n  https://github.com/google-gemini/gemini-cli/pull/13623\n- fix(cli): Prevent stdout/stderr patching for extension commands by @chrstnb in\n  https://github.com/google-gemini/gemini-cli/pull/13600\n- Improve test coverage for cli/src/ui/components by @megha1188 in\n  https://github.com/google-gemini/gemini-cli/pull/13598\n- Update ink version to 6.4.6 by @jacob314 in\n  https://github.com/google-gemini/gemini-cli/pull/13631\n- chore/release: bump version to 0.19.0-nightly.20251122.42c2e1b21 by\n  @gemini-cli-robot in https://github.com/google-gemini/gemini-cli/pull/13637\n- chore/release: bump version to 0.19.0-nightly.20251123.dadd606c0 by\n  @gemini-cli-robot in https://github.com/google-gemini/gemini-cli/pull/13675\n- chore/release: bump version to 0.19.0-nightly.20251124.e177314a4 by\n  @gemini-cli-robot in https://github.com/google-gemini/gemini-cli/pull/13713\n- fix(core): Fix context window overflow warning for PDF files by @kkitase in\n  https://github.com/google-gemini/gemini-cli/pull/13548\n- feat :rephrasing the extension logging messages to run the explore command\n  when there are no extensions installed by @JayadityaGit in\n  https://github.com/google-gemini/gemini-cli/pull/13740\n- Improve code coverage for cli package by @megha1188 in\n  https://github.com/google-gemini/gemini-cli/pull/13724\n- Add session subtask in /stats command by @Adib234 in\n  https://github.com/google-gemini/gemini-cli/pull/13750\n- feat(core): Migrate chatCompressionService to model configs. by @joshualitt in\n  https://github.com/google-gemini/gemini-cli/pull/12863\n- feat(hooks): Hook Telemetry Infrastructure by @Edilmo in\n  https://github.com/google-gemini/gemini-cli/pull/9082\n- fix: (some minor improvements to configs and getPackageJson return behaviour)\n  by @grMLEqomlkkU5Eeinz4brIrOVCUCkJuN in\n  https://github.com/google-gemini/gemini-cli/pull/12510\n- feat(hooks): Hook Event Handling by @Edilmo in\n  https://github.com/google-gemini/gemini-cli/pull/9097\n- feat(hooks): Hook Agent Lifecycle Integration by @Edilmo in\n  https://github.com/google-gemini/gemini-cli/pull/9105\n- feat(core): Land bool for alternate system prompt. by @joshualitt in\n  https://github.com/google-gemini/gemini-cli/pull/13764\n- bug(core): Add default chat compression config. by @joshualitt in\n  https://github.com/google-gemini/gemini-cli/pull/13766\n- feat(model-availability): introduce ModelPolicy and PolicyCatalog by\n  @adamfweidman in https://github.com/google-gemini/gemini-cli/pull/13751\n- feat(hooks): Hook System Orchestration by @Edilmo in\n  https://github.com/google-gemini/gemini-cli/pull/9102\n- feat(config): add isModelAvailabilityServiceEnabled setting by @adamfweidman\n  in https://github.com/google-gemini/gemini-cli/pull/13777\n- chore/release: bump version to 0.19.0-nightly.20251125.f6d97d448 by\n  @gemini-cli-robot in https://github.com/google-gemini/gemini-cli/pull/13782\n- chore: remove console.error by @adamfweidman in\n  https://github.com/google-gemini/gemini-cli/pull/13779\n- fix: Add $schema property to settings.schema.json by @sacrosanctic in\n  https://github.com/google-gemini/gemini-cli/pull/12763\n- fix(cli): allow non-GitHub SCP-styled URLs for extension installation by @m0ps\n  in https://github.com/google-gemini/gemini-cli/pull/13800\n- fix(resume): allow passing a prompt via stdin while resuming using --resume by\n  @bl-ue in https://github.com/google-gemini/gemini-cli/pull/13520\n- feat(sessions): add /resume slash command to open the session browser by\n  @bl-ue in https://github.com/google-gemini/gemini-cli/pull/13621\n- docs(sessions): add documentation for chat recording and session management by\n  @bl-ue in https://github.com/google-gemini/gemini-cli/pull/13667\n- Fix TypeError: \"URL.parse is not a function\" for Node.js < v22 by @macarronesc\n  in https://github.com/google-gemini/gemini-cli/pull/13698\n- fallback to flash for TerminalQuota errors by @sehoon38 in\n  https://github.com/google-gemini/gemini-cli/pull/13791\n- Update Code Wiki README badge by @PatoBeltran in\n  https://github.com/google-gemini/gemini-cli/pull/13768\n- Add Databricks auth support and custom header option to gemini cli by\n  @AarushiShah in https://github.com/google-gemini/gemini-cli/pull/11893\n- Update dependency for modelcontextprotocol/sdk to 1.23.0 by @bbiggs in\n  https://github.com/google-gemini/gemini-cli/pull/13827\n\n**Full Changelog**:\nhttps://github.com/google-gemini/gemini-cli/compare/v0.18.0-preview.4...v0.19.0-preview.0\n"}
{"source":"github","repo":"gemini-cli","path":"docs/changelogs/index.md","content":"# Gemini CLI release notes\n\nGemini CLI has three major release channels: nightly, preview, and stable. For\nmost users, we recommend the stable release.\n\nOn this page, you can find information regarding the current releases and\nannouncements from each release.\n\nFor the full changelog, refer to\n[Releases - google-gemini/gemini-cli](https://github.com/google-gemini/gemini-cli/releases)\non GitHub.\n\n## Current releases\n\n| Release channel       | Notes                                           |\n| :-------------------- | :---------------------------------------------- |\n| Nightly               | Nightly release with the most recent changes.   |\n| [Preview](preview.md) | Experimental features ready for early feedback. |\n| [Stable](latest.md)   | Stable, recommended for general use.            |\n\n## Announcements: v0.19.0 - 2025-11-24\n\n- üéâ **New extensions:**\n  - **Eleven Labs:** Create, play, manage your audio play tracks with the Eleven\n    Labs Gemini CLI extension:\n    `gemini extensions install https://github.com/elevenlabs/elevenlabs-mcp`\n- **Zed integration:** Users can now leverage Gemini 3 within the Zed\n  integration after enabling \"Preview Features\" in their CLI‚Äôs `/settings`.\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/13398) by\n  [@benbrandt](https://github.com/benbrandt))\n- **Interactive shell:**\n  - **Click-to-Focus:** When \"Use Alternate Buffer\" setting is enabled, users\n    can click within the embedded shell output to focus it for input.\n    ([pr](https://github.com/google-gemini/gemini-cli/pull/13341) by\n    [@galz10](https://github.com/galz10))\n  - **Loading phrase:** Clearly indicates when the interactive shell is awaiting\n    user input. ([vid](https://imgur.com/a/kjK8bUK),\n    [pr](https://github.com/google-gemini/gemini-cli/pull/12535) by\n    [@jackwotherspoon](https://github.com/jackwotherspoon))\n\n## Announcements: v0.18.0 - 2025-11-17\n\n- üéâ **New extensions:**\n  - **Google Workspace**: Integrate Gemini CLI with your Workspace data. Write\n    docs, build slides, chat with others or even get your calc on in sheets:\n    `gemini extensions install https://github.com/gemini-cli-extensions/workspace`\n    - Blog:\n      [https://allen.hutchison.org/2025/11/19/bringing-the-office-to-the-terminal/](https://allen.hutchison.org/2025/11/19/bringing-the-office-to-the-terminal/)\n  - **Redis:** Manage and search data in Redis with natural language:\n    `gemini extensions install https://github.com/redis/mcp-redis`\n  - **Anomalo:** Query your data warehouse table metadata and quality status\n    through commands and natural language:\n    `gemini extensions install https://github.com/datagravity-ai/anomalo-gemini-extension`\n- **Experimental permission improvements:** We are now experimenting with a new\n  policy engine in Gemini CLI. This allows users and administrators to create\n  fine-grained policy for tool calls. Currently behind a flag. See\n  [https://geminicli.com/docs/core/policy-engine/](../core/policy-engine.md) for\n  more information.\n  - Blog:\n    [https://allen.hutchison.org/2025/11/26/the-guardrails-of-autonomy/](https://allen.hutchison.org/2025/11/26/the-guardrails-of-autonomy/)\n- **Gemini 3 support for paid:** Gemini 3 support has been rolled out to all API\n  key, Google AI Pro or Google AI Ultra (for individuals, not businesses) and\n  Gemini Code Assist Enterprise users. Enable it via `/settings` and toggling on\n  **Preview Features**.\n- **Updated UI rollback:** We‚Äôve temporarily rolled back our updated UI to give\n  it more time to bake. This means for a time you won‚Äôt have embedded scrolling\n  or mouse support. You can re-enable with `/settings` -> **Use Alternate Screen\n  Buffer** -> `true`.\n- **Model in history:** Users can now toggle in `/settings` to display model in\n  their chat history. ([gif](https://imgur.com/a/uEmNKnQ),\n  [pr](https://github.com/google-gemini/gemini-cli/pull/13034) by\n  [@scidomino](https://github.com/scidomino))\n- **Multi-uninstall:** Users can now uninstall multiple extensions with a single\n  command. ([pic](https://imgur.com/a/9Dtq8u2),\n  [pr](https://github.com/google-gemini/gemini-cli/pull/13016) by\n  [@JayadityaGit](https://github.com/JayadityaGit))\n\n## Announcements: v0.16.0 - 2025-11-10\n\n- **Gemini 3 + Gemini CLI:** launch üöÄüöÄüöÄ\n- **Data Commons Gemini CLI Extension** - A new Data Commons Gemini CLI\n  extension that lets you query open-source statistical data from\n  datacommons.org. **To get started, you'll need a Data Commons API key and uv\n  installed**. These and other details to get you started with the extension can\n  be found at\n  [https://github.com/gemini-cli-extensions/datacommons](https://github.com/gemini-cli-extensions/datacommons).\n\n## Announcements: v0.15.0 - 2025-11-03\n\n- **üéâ Seamless scrollable UI and mouse support:** We‚Äôve given Gemini CLI a\n  major facelift to make your terminal experience smoother and much more\n  polished. You now get a flicker-free display with sticky headers that keep\n  important context visible and a stable input prompt that doesn't jump around.\n  We even added mouse support so you can click right where you need to type!\n  ([gif](https://imgur.com/a/O6qc7bx),\n  [@jacob314](https://github.com/jacob314)).\n  - **Announcement:**\n    [https://developers.googleblog.com/en/making-the-terminal-beautiful-one-pixel-at-a-time/](https://developers.googleblog.com/en/making-the-terminal-beautiful-one-pixel-at-a-time/)\n- **üéâ New partner extensions:**\n  - **Arize:** Seamlessly instrument AI applications with Arize AX and grant\n    direct access to Arize support:\n\n    `gemini extensions install https://github.com/Arize-ai/arize-tracing-assistant`\n\n  - **Chronosphere:** Retrieve logs, metrics, traces, events, and specific\n    entities:\n\n    `gemini extensions install https://github.com/chronosphereio/chronosphere-mcp`\n\n  - **Transmit:** Comprehensive context, validation, and automated fixes for\n    creating production-ready authentication and identity workflows:\n\n    `gemini extensions install https://github.com/TransmitSecurity/transmit-security-journey-builder`\n\n- **Todo planning:** Complex questions now get broken down into todo lists that\n  the model can manage and check off. ([gif](https://imgur.com/a/EGDfNlZ),\n  [pr](https://github.com/google-gemini/gemini-cli/pull/12905) by\n  [@anj-s](https://github.com/anj-s))\n- **Disable GitHub extensions:** Users can now prevent the installation and\n  loading of extensions from GitHub.\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/12838) by\n  [@kevinjwang1](https://github.com/kevinjwang1)).\n- **Extensions restart:** Users can now explicitly restart extensions using the\n  `/extensions restart` command.\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/12739) by\n  [@jakemac53](https://github.com/jakemac53)).\n- **Better Angular support:** Angular workflows should now be more seamless\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/10252) by\n  [@MarkTechson](https://github.com/MarkTechson)).\n- **Validate command:** Users can now check that local extensions are formatted\n  correctly. ([pr](https://github.com/google-gemini/gemini-cli/pull/12186) by\n  [@kevinjwang1](https://github.com/kevinjwang1)).\n\n## Announcements: v0.12.0 - 2025-10-27\n\n![Codebase investigator subagent in Gemini CLI.](https://i.imgur.com/4J1njsx.png)\n\n- **üéâ New partner extensions:**\n  - **ü§ó Hugging Face extension:** Access the Hugging Face hub.\n    ([gif](https://drive.google.com/file/d/1LEzIuSH6_igFXq96_tWev11svBNyPJEB/view?usp=sharing&resourcekey=0-LtPTzR1woh-rxGtfPzjjfg))\n\n    `gemini extensions install https://github.com/huggingface/hf-mcp-server`\n\n  - **Monday.com extension**: Analyze your sprints, update your task boards,\n    etc.\n    ([gif](https://drive.google.com/file/d/1cO0g6kY1odiBIrZTaqu5ZakaGZaZgpQv/view?usp=sharing&resourcekey=0-xEr67SIjXmAXRe1PKy7Jlw))\n\n    `gemini extensions install https://github.com/mondaycom/mcp`\n\n  - **Data Commons extension:** Query public datasets or ground responses on\n    data from Data Commons\n    ([gif](https://drive.google.com/file/d/1cuj-B-vmUkeJnoBXrO_Y1CuqphYc6p-O/view?usp=sharing&resourcekey=0-0adXCXDQEd91ZZW63HbW-Q)).\n\n    `gemini extensions install https://github.com/gemini-cli-extensions/datacommons`\n\n- **Model selection:** Choose the Gemini model for your session with `/model`.\n  ([pic](https://imgur.com/a/ABFcWWw),\n  [pr](https://github.com/google-gemini/gemini-cli/pull/8940) by\n  [@abhipatel12](https://github.com/abhipatel12)).\n- **Model routing:** Gemini CLI will now intelligently pick the best model for\n  the task. Simple queries will be sent to Flash while complex analytical or\n  creative tasks will still use the power of Pro. This ensures your quota will\n  last for a longer period of time. You can always opt-out of this via `/model`.\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/9262) by\n  [@abhipatel12](https://github.com/abhipatel12)).\n  - Discussion:\n    [https://github.com/google-gemini/gemini-cli/discussions/12375](https://github.com/google-gemini/gemini-cli/discussions/12375)\n- **Codebase investigator subagent:** We now have a new built-in subagent that\n  will explore your workspace and resolve relevant information to improve\n  overall performance.\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/9988) by\n  [@abhipatel12](https://github.com/abhipatel12),\n  [pr](https://github.com/google-gemini/gemini-cli/pull/10282) by\n  [@silviojr](https://github.com/silviojr)).\n  - Enable, disable, or limit turns in `/settings`, plus advanced configs in\n    `settings.json` ([pic](https://imgur.com/a/yJiggNO),\n    [pr](https://github.com/google-gemini/gemini-cli/pull/10844) by\n    [@silviojr](https://github.com/silviojr)).\n- **Explore extensions with `/extension`:** Users can now open the extensions\n  page in their default browser directly from the CLI using the `/extension`\n  explore command. ([pr](https://github.com/google-gemini/gemini-cli/pull/11846)\n  by [@JayadityaGit](https://github.com/JayadityaGit)).\n- **Configurable compression:** Users can modify the compression threshold in\n  `/settings`. The default has been made more proactive\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/12317) by\n  [@scidomino](https://github.com/scidomino)).\n- **API key authentication:** Users can now securely enter and store their\n  Gemini API key via a new dialog, eliminating the need for environment\n  variables and repeated entry.\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/11760) by\n  [@galz10](https://github.com/galz10)).\n- **Sequential approval:** Users can now approve multiple tool calls\n  sequentially during execution.\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/11593) by\n  [@joshualitt](https://github.com/joshualitt)).\n\n## Announcements: v0.11.0 - 2025-10-20\n\n![Gemini CLI and Jules](https://storage.googleapis.com/gweb-developer-goog-blog-assets/images/Jules_Extension_-_Blog_Header_O346JNt.original.png)\n\n- üéâ **Gemini CLI Jules Extension:** Use Gemini CLI to orchestrate Jules. Spawn\n  remote workers, delegate tedious tasks, or check in on running jobs!\n  - Install:\n    `gemini extensions install https://github.com/gemini-cli-extensions/jules`\n  - Announcement:\n    [https://developers.googleblog.com/en/introducing-the-jules-extension-for-gemini-cli/](https://developers.googleblog.com/en/introducing-the-jules-extension-for-gemini-cli/)\n- **Stream JSON output:** Stream real-time JSONL events with\n  `--output-format stream-json` to monitor AI agent progress when run\n  headlessly. ([gif](https://imgur.com/a/0UCE81X),\n  [pr](https://github.com/google-gemini/gemini-cli/pull/10883) by\n  [@anj-s](https://github.com/anj-s))\n- **Markdown toggle:** Users can now switch between rendered and raw markdown\n  display using `alt+m `or` ctrl+m`. ([gif](https://imgur.com/a/lDNdLqr),\n  [pr](https://github.com/google-gemini/gemini-cli/pull/10383) by\n  [@srivatsj](https://github.com/srivatsj))\n- **Queued message editing:** Users can now quickly edit queued messages by\n  pressing the up arrow key when the input is empty.\n  ([gif](https://imgur.com/a/ioRslLd),\n  [pr](https://github.com/google-gemini/gemini-cli/pull/10392) by\n  [@akhil29](https://github.com/akhil29))\n- **JSON web fetch**: Non-HTML content like JSON APIs or raw source code are now\n  properly shown to the model (previously only supported HTML)\n  ([gif](https://imgur.com/a/Q58U4qJ),\n  [pr](https://github.com/google-gemini/gemini-cli/pull/11284) by\n  [@abhipatel12](https://github.com/abhipatel12))\n- **Non-interactive MCP commands:** Users can now run MCP slash commands in\n  non-interactive mode `gemini \"/some-mcp-prompt\"`.\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/10194) by\n  [@capachino](https://github.com/capachino))\n- **Removal of deprecated flags:** We‚Äôve finally removed a number of deprecated\n  flags to cleanup Gemini CLI‚Äôs invocation profile:\n  - `--all-files` / `-a` in favor of `@` from within Gemini CLI.\n    ([pr](https://github.com/google-gemini/gemini-cli/pull/11228) by\n    [@allenhutchison](https://github.com/allenhutchison))\n  - `--telemetry-*` flags in favor of\n    [environment variables](https://github.com/google-gemini/gemini-cli/pull/11318)\n    ([pr](https://github.com/google-gemini/gemini-cli/pull/11318) by\n    [@allenhutchison](https://github.com/allenhutchison))\n\n## Announcements: v0.10.0 - 2025-10-13\n\n- **Polish:** The team has been heads down bug fixing and investing heavily into\n  polishing existing flows, tools, and interactions.\n- **Interactive Shell Tool calling:** Gemini CLI can now also execute\n  interactive tools if needed\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/11225) by\n  [@galz10](https://github.com/galz10)).\n- **Alt+Key support:** Enables broader support for Alt+Key keyboard shortcuts\n  across different terminals.\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/10767) by\n  [@srivatsj](https://github.com/srivatsj)).\n- **Telemetry Diff stats:** Track line changes made by the model and user during\n  file operations via OTEL.\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/10819) by\n  [@jerop](https://github.com/jerop)).\n\n## Announcements: v0.9.0 - 2025-10-06\n\n- üéâ **Interactive Shell:** Run interactive commands like `vim`, `rebase -i`, or\n  even `gemini` üòé directly in Gemini CLI:\n  - Blog:\n    [https://developers.googleblog.com/en/say-hello-to-a-new-level-of-interactivity-in-gemini-cli/](https://developers.googleblog.com/en/say-hello-to-a-new-level-of-interactivity-in-gemini-cli/)\n- **Install pre-release extensions:** Install the latest `--pre-release`\n  versions of extensions. Used for when an extension‚Äôs release hasn‚Äôt been\n  marked as \"latest\".\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/10752) by\n  [@jakemac53](https://github.com/jakemac53))\n- **Simplified extension creation:** Create a new, empty extension. Templates\n  are no longer required.\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/10629) by\n  [@chrstnb](https://github.com/chrstnb))\n- **OpenTelemetry GenAI metrics:** Aligns telemetry with industry-standard\n  semantic conventions for improved interoperability.\n  ([spec](https://opentelemetry.io/docs/concepts/semantic-conventions/),\n  [pr](https://github.com/google-gemini/gemini-cli/pull/10343) by\n  [@jerop](https://github.com/jerop))\n- **List memory files:** Quickly find the location of your long-term memory\n  files with `/memory list`.\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/10108) by\n  [@sgnagnarella](https://github.com/sgnagnarella))\n\n## Announcements: v0.8.0 - 2025-09-29\n\n- üéâ **Announcing Gemini CLI Extensions** üéâ\n  - Completely customize your Gemini CLI experience to fit your workflow.\n  - Build and share your own Gemini CLI extensions with the world.\n  - Launching with a growing catalog of community, partner, and Google-built\n    extensions.\n    - Check extensions from\n      [key launch partners](https://github.com/google-gemini/gemini-cli/discussions/10718).\n  - Easy install:\n    - `gemini extensions install <github url|folder path>`\n  - Easy management:\n    - `gemini extensions install|uninstall|link`\n    - `gemini extensions enable|disable`\n    - `gemini extensions list|update|new`\n  - Or use commands while running with `/extensions list|update`.\n  - Everything you need to know:\n    [Now open for building: Introducing Gemini CLI extensions](https://blog.google/technology/developers/gemini-cli-extensions/).\n- üéâ **Our New Home Page & Better Documentation** üéâ\n  - Check out our new home page for better getting started material, reference\n    documentation, extensions and more!\n  - _Homepage:_ [https://geminicli.com](https://geminicli.com)\n  - ‚ÄºÔ∏è*NEW documentation:*\n    [https://geminicli.com/docs](https://geminicli.com/docs) (Have any\n    [suggestions](https://github.com/google-gemini/gemini-cli/discussions/8722)?)\n  - _Extensions:_\n    [https://geminicli.com/extensions](https://geminicli.com/extensions)\n- **Non-Interactive Allowed Tools:** `--allowed-tools` will now also work in\n  non-interactive mode.\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/9114) by\n  [@mistergarrison](https://github.com/mistergarrison))\n- **Terminal Title Status:** See the CLI's real-time status and thoughts\n  directly in the terminal window's title by setting `showStatusInTitle: true`.\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/4386) by\n  [@Fridayxiao](https://github.com/Fridayxiao))\n- **Small features, polish, reliability & bug fixes:** A large amount of\n  changes, smaller features, UI updates, reliability and bug fixes + general\n  polish made it in this week!\n\n## Announcements: v0.7.0 - 2025-09-22\n\n- üéâ**Build your own Gemini CLI IDE plugin:** We've published a spec for\n  creating IDE plugins to enable rich context-aware experiences and native\n  in-editor diffing in your IDE of choice.\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/8479) by\n  [@skeshive](https://github.com/skeshive))\n- üéâ **Gemini CLI extensions**\n  - **Flutter:** An early version to help you create, build, test, and run\n    Flutter apps with Gemini CLI\n    ([extension](https://github.com/gemini-cli-extensions/flutter))\n  - **nanobanana:** Integrate nanobanana into Gemini CLI\n    ([extension](https://github.com/gemini-cli-extensions/nanobanana))\n- **Telemetry config via environment:** Manage telemetry settings using\n  environment variables for a more flexible setup.\n  ([docs](https://github.com/google-gemini/gemini-cli/blob/main/docs/cli/telemetry.md#configuration),\n  [pr](https://github.com/google-gemini/gemini-cli/pull/9113) by\n  [@jerop](https://github.com/jerop))\n- **‚Äã‚ÄãExperimental todos:** Track and display progress on complex tasks with a\n  managed checklist. Off by default but can be enabled via\n  `\"useWriteTodos\": true`\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/8761) by\n  [@anj-s](https://github.com/anj-s))\n- **Share chat support for tools:** Using `/chat share` will now also render\n  function calls and responses in the final markdown file.\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/8693) by\n  [@rramkumar1](https://github.com/rramkumar1))\n- **Citations:** Now enabled for all users\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/8570) by\n  [@scidomino](https://github.com/scidomino))\n- **Custom commands in Headless Mode:** Run custom slash commands directly from\n  the command line in non-interactive mode: `gemini \"/joke Chuck Norris\"`\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/8305) by\n  [@capachino](https://github.com/capachino))\n- **Small features, polish, reliability & bug fixes:** A large amount of\n  changes, smaller features, UI updates, reliability and bug fixes + general\n  polish made it in this week!\n\n## Announcements: v0.6.0 - 2025-09-15\n\n- üéâ **Higher limits for Google AI Pro and Ultra subscribers:** We‚Äôre psyched to\n  finally announce that Google AI Pro and AI Ultra subscribers now get access to\n  significantly higher 2.5 quota limits for Gemini CLI!\n  - **Announcement:**\n    [https://blog.google/technology/developers/gemini-cli-code-assist-higher-limits/](https://blog.google/technology/developers/gemini-cli-code-assist-higher-limits/)\n- üéâ**Gemini CLI Databases and BigQuery Extensions:** Connect Gemini CLI to all\n  of your cloud data with Gemini CLI.\n  - Announcement and how to get started with each of the below extensions:\n    [https://cloud.google.com/blog/products/databases/gemini-cli-extensions-for-google-data-cloud?e=48754805](https://cloud.google.com/blog/products/databases/gemini-cli-extensions-for-google-data-cloud?e=48754805)\n  - **AlloyDB:** Interact, manage and observe AlloyDB for PostgreSQL databases\n    ([manage](https://github.com/gemini-cli-extensions/alloydb#configuration),\n    [observe](https://github.com/gemini-cli-extensions/alloydb-observability#configuration))\n  - **BigQuery:** Connect and query your BigQuery datasets or utilize a\n    sub-agent for contextual insights\n    ([query](https://github.com/gemini-cli-extensions/bigquery-data-analytics#configuration),\n    [sub-agent](https://github.com/gemini-cli-extensions/bigquery-conversational-analytics))\n  - **Cloud SQL:** Interact, manage and observe Cloud SQL for PostgreSQL\n    ([manage](https://github.com/gemini-cli-extensions/cloud-sql-postgresql#configuration),[ observe](https://github.com/gemini-cli-extensions/cloud-sql-postgresql-observability#configuration)),\n    Cloud SQL for MySQL\n    ([manage](https://github.com/gemini-cli-extensions/cloud-sql-mysql#configuration),[ observe](https://github.com/gemini-cli-extensions/cloud-sql-mysql-observability#configuration))\n    and Cloud SQL for SQL Server\n    ([manage](https://github.com/gemini-cli-extensions/cloud-sql-sqlserver#configuration),[ observe](https://github.com/gemini-cli-extensions/cloud-sql-sqlserver-observability#configuration))\n    databases.\n  - **Dataplex:** Discover, manage, and govern data and AI artifacts\n    ([extension](https://github.com/gemini-cli-extensions/dataplex#configuration))\n  - **Firestore:** Interact with Firestore databases, collections and documents\n    ([extension](https://github.com/gemini-cli-extensions/firestore-native#configuration))\n  - **Looker:** Query data, run Looks and create dashboards\n    ([extension](https://github.com/gemini-cli-extensions/looker#configuration))\n  - **MySQL:** Interact with MySQL databases\n    ([extension](https://github.com/gemini-cli-extensions/mysql#configuration))\n  - **Postgres:** Interact with PostgreSQL databases\n    ([extension](https://github.com/gemini-cli-extensions/postgres#configuration))\n  - **Spanner:** Interact with Spanner databases\n    ([extension](https://github.com/gemini-cli-extensions/spanner#configuration))\n  - **SQL Server:** Interact with SQL Server databases\n    ([extension](https://github.com/gemini-cli-extensions/sql-server#configuration))\n  - **MCP Toolbox:** Configure and load custom tools for more than 30+ data\n    sources\n    ([extension](https://github.com/gemini-cli-extensions/mcp-toolbox#configuration))\n- **JSON output mode:** Have Gemini CLI output JSON with `--output-format json`\n  when invoked headlessly for easy parsing and post-processing. Includes\n  response, stats and errors.\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/8119) by\n  [@jerop](https://github.com/jerop))\n- **Keybinding triggered approvals:** When you use shortcuts (`shift+y` or\n  `shift+tab`) to activate YOLO/auto-edit modes any pending confirmation dialogs\n  will now approve. ([pr](https://github.com/google-gemini/gemini-cli/pull/6665)\n  by [@bulkypanda](https://github.com/bulkypanda))\n- **Chat sharing:** Convert the current conversation to a Markdown or JSON file\n  with _/chat share &lt;file.md|file.json>_\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/8139) by\n  [@rramkumar1](https://github.com/rramkumar1))\n- **Prompt search:** Search your prompt history using `ctrl+r`.\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/5539) by\n  [@Aisha630](https://github.com/Aisha630))\n- **Input undo/redo:** Recover accidentally deleted text in the input prompt\n  using `ctrl+z` (undo) and `ctrl+shift+z` (redo).\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/4625) by\n  [@masiafrest](https://github.com/masiafrest))\n- **Loop detection confirmation:** When loops are detected you are now presented\n  with a dialog to disable detection for the current session.\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/8231) by\n  [@SandyTao520](https://github.com/SandyTao520))\n- **Direct to Google Cloud Telemetry:** Directly send telemetry to Google Cloud\n  for a simpler and more streamlined setup.\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/8541) by\n  [@jerop](https://github.com/jerop))\n- **Visual Mode Indicator Revamp:** ‚Äòshell‚Äô, 'accept edits' and 'yolo' modes now\n  have colors to match their impact / usage. Input box now also updates.\n  ([shell](https://imgur.com/a/DovpVF1),\n  [accept-edits](https://imgur.com/a/33KDz3J),\n  [yolo](https://imgur.com/a/tbFwIWp),\n  [pr](https://github.com/google-gemini/gemini-cli/pull/8200) by\n  [@miguelsolorio](https://github.com/miguelsolorio))\n- **Small features, polish, reliability & bug fixes:** A large amount of\n  changes, smaller features, UI updates, reliability and bug fixes + general\n  polish made it in this week!\n\n## Announcements: v0.5.0 - 2025-09-08\n\n- üéâ**FastMCP + Gemini CLI**üéâ: Quickly install and manage your Gemini CLI MCP\n  servers with FastMCP ([video](https://imgur.com/a/m8QdCPh),\n  [pr](https://github.com/jlowin/fastmcp/pull/1709) by\n  [@jackwotherspoon](https://github.com/jackwotherspoon)**)**\n  - Getting started:\n    [https://gofastmcp.com/integrations/gemini-cli](https://gofastmcp.com/integrations/gemini-cli)\n- **Positional Prompt for Non-Interactive:** Seamlessly invoke Gemini CLI\n  headlessly via `gemini \"Hello\"`. Synonymous with passing `-p`.\n  ([gif](https://imgur.com/a/hcBznpB),\n  [pr](https://github.com/google-gemini/gemini-cli/pull/7668) by\n  [@allenhutchison](https://github.com/allenhutchison))\n- **Experimental Tool output truncation:** Enable truncating shell tool outputs\n  and saving full output to a file by setting\n  `\"enableToolOutputTruncation\": true `([pr](https://github.com/google-gemini/gemini-cli/pull/8039)\n  by [@SandyTao520](https://github.com/SandyTao520))\n- **Edit Tool improvements:** Gemini CLI‚Äôs ability to edit files should now be\n  far more capable. ([pr](https://github.com/google-gemini/gemini-cli/pull/7679)\n  by [@silviojr](https://github.com/silviojr))\n- **Custom witty messages:** The feature you‚Äôve all been waiting for‚Ä¶\n  Personalized witty loading messages via\n  `\"ui\": { \"customWittyPhrases\": [\"YOLO\"]}` in `settings.json`.\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/7641) by\n  [@JayadityaGit](https://github.com/JayadityaGit))\n- **Nested .gitignore File Handling:** Nested `.gitignore` files are now\n  respected. ([pr](https://github.com/google-gemini/gemini-cli/pull/7645) by\n  [@gsquared94](https://github.com/gsquared94))\n- **Enforced authentication:** System administrators can now mandate a specific\n  authentication method via\n  `\"enforcedAuthType\": \"oauth-personal|gemini-api-key|‚Ä¶\"`in `settings.json`.\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/6564) by\n  [@chrstnb](https://github.com/chrstnb))\n- **A2A development-tool extension:** An RFC for an Agent2Agent\n  ([A2A](https://a2a-protocol.org/latest/)) powered extension for developer tool\n  use cases.\n  ([feedback](https://github.com/google-gemini/gemini-cli/discussions/7822),\n  [pr](https://github.com/google-gemini/gemini-cli/pull/7817) by\n  [@skeshive](https://github.com/skeshive))\n- **Hands on Codelab:\n  **[https://codelabs.developers.google.com/gemini-cli-hands-on](https://codelabs.developers.google.com/gemini-cli-hands-on)\n- **Small features, polish, reliability & bug fixes:** A large amount of\n  changes, smaller features, UI updates, reliability and bug fixes + general\n  polish made it in this week!\n\n## Announcements: v0.4.0 - 2025-09-01\n\n- üéâ**Gemini CLI CloudRun and Security Integrations**üéâ: Automate app deployment\n  and security analysis with CloudRun and Security extension integrations. Once\n  installed deploy your app to the cloud with `/deploy` and find and fix\n  security vulnerabilities with `/security:analyze`.\n  - Announcement and how to get started:\n    [https://cloud.google.com/blog/products/ai-machine-learning/automate-app-deployment-and-security-analysis-with-new-gemini-cli-extensions](https://cloud.google.com/blog/products/ai-machine-learning/automate-app-deployment-and-security-analysis-with-new-gemini-cli-extensions)\n- **Experimental**\n  - **Edit Tool:** Give our new edit tool a try by setting\n    `\"useSmartEdit\": true` in `settings.json`!\n    ([feedback](https://github.com/google-gemini/gemini-cli/discussions/7758),\n    [pr](https://github.com/google-gemini/gemini-cli/pull/6823) by\n    [@silviojr](https://github.com/silviojr))\n  - **Model talking to itself fix:** We‚Äôve removed a model workaround that would\n    encourage Gemini CLI to continue conversations on your behalf. This may be\n    disruptive and can be disabled via `\"skipNextSpeakerCheck\": false` in your\n    `settings.json`\n    ([feedback](https://github.com/google-gemini/gemini-cli/discussions/6666),\n    [pr](https://github.com/google-gemini/gemini-cli/pull/7614) by\n    [@SandyTao520](https://github.com/SandyTao520))\n  - **Prompt completion:** Get real-time AI suggestions to complete your prompts\n    as you type. Enable it with `\"general\": { \"enablePromptCompletion\": true }`\n    and share your feedback!\n    ([gif](https://miro.medium.com/v2/resize:fit:2000/format:webp/1*hvegW7YXOg6N_beUWhTdxA.gif),\n    [pr](https://github.com/google-gemini/gemini-cli/pull/4691) by\n    [@3ks](https://github.com/3ks))\n- **Footer visibility configuration:** Customize the CLI's footer look and feel\n  in `settings.json`\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/7419) by\n  [@miguelsolorio](https://github.com/miguelsolorio))\n  - `hideCWD`: hide current working directory.\n  - `hideSandboxStatus`: hide sandbox status.\n  - `hideModelInfo`: hide current model information.\n  - `hideContextSummary`: hide request context summary.\n- **Citations:** For enterprise Code Assist licenses users will now see\n  citations in their responses by default. Enable this yourself with\n  `\"showCitations\": true`\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/7350) by\n  [@scidomino](https://github.com/scidomino))\n- **Pro Quota Dialog:** Handle daily Pro model usage limits with an interactive\n  dialog that lets you immediately switch auth or fallback.\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/7094) by\n  [@JayadityaGit](https://github.com/JayadityaGit))\n- **Custom commands @:** Embed local file or directory content directly into\n  your custom command prompts using `@{path}` syntax\n  ([gif](https://miro.medium.com/v2/resize:fit:2000/format:webp/1*GosBAo2SjMfFffAnzT7ZMg.gif),\n  [pr](https://github.com/google-gemini/gemini-cli/pull/6716) by\n  [@abhipatel12](https://github.com/abhipatel12))\n- **2.5 Flash Lite support:** You can now use the `gemini-2.5-flash-lite` model\n  for Gemini CLI via `gemini -m ‚Ä¶`.\n  ([gif](https://miro.medium.com/v2/resize:fit:2000/format:webp/1*P4SKwnrsyBuULoHrFqsFKQ.gif),\n  [pr](https://github.com/google-gemini/gemini-cli/pull/4652) by\n  [@psinha40898](https://github.com/psinha40898))\n- **CLI streamlining:** We have deprecated a number of command line arguments in\n  favor of `settings.json`¬†alternatives. We will remove these arguments in a\n  future release. See the PR for the full list of deprecations.\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/7360) by\n  [@allenhutchison](https://github.com/allenhutchison))\n- **JSON session summary:** Track and save detailed CLI session statistics to a\n  JSON file for performance analysis with `--session-summary <path>`\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/7347) by\n  [@leehagoodjames](https://github.com/leehagoodjames))\n- **Robust keyboard handling:** More reliable and consistent behavior for arrow\n  keys, special keys (Home, End, etc.), and modifier combinations across various\n  terminals. ([pr](https://github.com/google-gemini/gemini-cli/pull/7118) by\n  [@deepankarsharma](https://github.com/deepankarsharma))\n- **MCP loading indicator:** Provides visual feedback during CLI initialization\n  when connecting to multiple servers.\n  ([pr](https://github.com/google-gemini/gemini-cli/pull/6923) by\n  [@swissspidy](https://github.com/swissspidy))\n- **Small features, polish, reliability & bug fixes:** A large amount of\n  changes, smaller features, UI updates, reliability and bug fixes + general\n  polish made it in this week!\n"}
{"source":"github","repo":"gemini-cli","path":"docs/ide-integration/ide-companion-spec.md","content":"# Gemini CLI companion plugin: Interface specification\n\n> Last Updated: September 15, 2025\n\nThis document defines the contract for building a companion plugin to enable\nGemini CLI's IDE mode. For VS Code, these features (native diffing, context\nawareness) are provided by the official extension\n([marketplace](https://marketplace.visualstudio.com/items?itemName=Google.gemini-cli-vscode-ide-companion)).\nThis specification is for contributors who wish to bring similar functionality\nto other editors like JetBrains IDEs, Sublime Text, etc.\n\n## I. The communication interface\n\nGemini CLI and the IDE plugin communicate through a local communication channel.\n\n### 1. Transport layer: MCP over HTTP\n\nThe plugin **MUST** run a local HTTP server that implements the **Model Context\nProtocol (MCP)**.\n\n- **Protocol:** The server must be a valid MCP server. We recommend using an\n  existing MCP SDK for your language of choice if available.\n- **Endpoint:** The server should expose a single endpoint (e.g., `/mcp`) for\n  all MCP communication.\n- **Port:** The server **MUST** listen on a dynamically assigned port (i.e.,\n  listen on port `0`).\n\n### 2. Discovery mechanism: The port file\n\nFor Gemini CLI to connect, it needs to discover which IDE instance it's running\nin and what port your server is using. The plugin **MUST** facilitate this by\ncreating a \"discovery file.\"\n\n- **How the CLI finds the file:** The CLI determines the Process ID (PID) of the\n  IDE it's running in by traversing the process tree. It then looks for a\n  discovery file that contains this PID in its name.\n- **File location:** The file must be created in a specific directory:\n  `os.tmpdir()/gemini/ide/`. Your plugin must create this directory if it\n  doesn't exist.\n- **File naming convention:** The filename is critical and **MUST** follow the\n  pattern: `gemini-ide-server-${PID}-${PORT}.json`\n  - `${PID}`: The process ID of the parent IDE process. Your plugin must\n    determine this PID and include it in the filename.\n  - `${PORT}`: The port your MCP server is listening on.\n- **File content and workspace validation:** The file **MUST** contain a JSON\n  object with the following structure:\n\n  ```json\n  {\n    \"port\": 12345,\n    \"workspacePath\": \"/path/to/project1:/path/to/project2\",\n    \"authToken\": \"a-very-secret-token\",\n    \"ideInfo\": {\n      \"name\": \"vscode\",\n      \"displayName\": \"VS Code\"\n    }\n  }\n  ```\n  - `port` (number, required): The port of the MCP server.\n  - `workspacePath` (string, required): A list of all open workspace root paths,\n    delimited by the OS-specific path separator (`:` for Linux/macOS, `;` for\n    Windows). The CLI uses this path to ensure it's running in the same project\n    folder that's open in the IDE. If the CLI's current working directory is not\n    a sub-directory of `workspacePath`, the connection will be rejected. Your\n    plugin **MUST** provide the correct, absolute path(s) to the root of the\n    open workspace(s).\n  - `authToken` (string, required): A secret token for securing the connection.\n    The CLI will include this token in an `Authorization: Bearer <token>` header\n    on all requests.\n  - `ideInfo` (object, required): Information about the IDE.\n    - `name` (string, required): A short, lowercase identifier for the IDE\n      (e.g., `vscode`, `jetbrains`).\n    - `displayName` (string, required): A user-friendly name for the IDE (e.g.,\n      `VS Code`, `JetBrains IDE`).\n\n- **Authentication:** To secure the connection, the plugin **MUST** generate a\n  unique, secret token and include it in the discovery file. The CLI will then\n  include this token in the `Authorization` header for all requests to the MCP\n  server (e.g., `Authorization: Bearer a-very-secret-token`). Your server\n  **MUST** validate this token on every request and reject any that are\n  unauthorized.\n- **Tie-breaking with environment variables (recommended):** For the most\n  reliable experience, your plugin **SHOULD** both create the discovery file and\n  set the `GEMINI_CLI_IDE_SERVER_PORT` environment variable in the integrated\n  terminal. The file serves as the primary discovery mechanism, but the\n  environment variable is crucial for tie-breaking. If a user has multiple IDE\n  windows open for the same workspace, the CLI uses the\n  `GEMINI_CLI_IDE_SERVER_PORT` variable to identify and connect to the correct\n  window's server.\n\n## II. The context interface\n\nTo enable context awareness, the plugin **MAY** provide the CLI with real-time\ninformation about the user's activity in the IDE.\n\n### `ide/contextUpdate` notification\n\nThe plugin **MAY** send an `ide/contextUpdate`\n[notification](https://modelcontextprotocol.io/specification/2025-06-18/basic/index#notifications)\nto the CLI whenever the user's context changes.\n\n- **Triggering events:** This notification should be sent (with a recommended\n  debounce of 50ms) when:\n  - A file is opened, closed, or focused.\n  - The user's cursor position or text selection changes in the active file.\n- **Payload (`IdeContext`):** The notification parameters **MUST** be an\n  `IdeContext` object:\n\n  ```typescript\n  interface IdeContext {\n    workspaceState?: {\n      openFiles?: File[];\n      isTrusted?: boolean;\n    };\n  }\n\n  interface File {\n    // Absolute path to the file\n    path: string;\n    // Last focused Unix timestamp (for ordering)\n    timestamp: number;\n    // True if this is the currently focused file\n    isActive?: boolean;\n    cursor?: {\n      // 1-based line number\n      line: number;\n      // 1-based character number\n      character: number;\n    };\n    // The text currently selected by the user\n    selectedText?: string;\n  }\n  ```\n\n  **Note:** The `openFiles` list should only include files that exist on disk.\n  Virtual files (e.g., unsaved files without a path, editor settings pages)\n  **MUST** be excluded.\n\n### How the CLI uses this context\n\nAfter receiving the `IdeContext` object, the CLI performs several normalization\nand truncation steps before sending the information to the model.\n\n- **File ordering:** The CLI uses the `timestamp` field to determine the most\n  recently used files. It sorts the `openFiles` list based on this value.\n  Therefore, your plugin **MUST** provide an accurate Unix timestamp for when a\n  file was last focused.\n- **Active file:** The CLI considers only the most recent file (after sorting)\n  to be the \"active\" file. It will ignore the `isActive` flag on all other files\n  and clear their `cursor` and `selectedText` fields. Your plugin should focus\n  on setting `isActive: true` and providing cursor/selection details only for\n  the currently focused file.\n- **Truncation:** To manage token limits, the CLI truncates both the file list\n  (to 10 files) and the `selectedText` (to 16KB).\n\nWhile the CLI handles the final truncation, it is highly recommended that your\nplugin also limits the amount of context it sends.\n\n## III. The diffing interface\n\nTo enable interactive code modifications, the plugin **MAY** expose a diffing\ninterface. This allows the CLI to request that the IDE open a diff view, showing\nproposed changes to a file. The user can then review, edit, and ultimately\naccept or reject these changes directly within the IDE.\n\n### `openDiff` tool\n\nThe plugin **MUST** register an `openDiff` tool on its MCP server.\n\n- **Description:** This tool instructs the IDE to open a modifiable diff view\n  for a specific file.\n- **Request (`OpenDiffRequest`):** The tool is invoked via a `tools/call`\n  request. The `arguments` field within the request's `params` **MUST** be an\n  `OpenDiffRequest` object.\n\n  ```typescript\n  interface OpenDiffRequest {\n    // The absolute path to the file to be diffed.\n    filePath: string;\n    // The proposed new content for the file.\n    newContent: string;\n  }\n  ```\n\n- **Response (`CallToolResult`):** The tool **MUST** immediately return a\n  `CallToolResult` to acknowledge the request and report whether the diff view\n  was successfully opened.\n  - On Success: If the diff view was opened successfully, the response **MUST**\n    contain empty content (i.e., `content: []`).\n  - On Failure: If an error prevented the diff view from opening, the response\n    **MUST** have `isError: true` and include a `TextContent` block in the\n    `content` array describing the error.\n\n  The actual outcome of the diff (acceptance or rejection) is communicated\n  asynchronously via notifications.\n\n### `closeDiff` tool\n\nThe plugin **MUST** register a `closeDiff` tool on its MCP server.\n\n- **Description:** This tool instructs the IDE to close an open diff view for a\n  specific file.\n- **Request (`CloseDiffRequest`):** The tool is invoked via a `tools/call`\n  request. The `arguments` field within the request's `params` **MUST** be an\n  `CloseDiffRequest` object.\n\n  ```typescript\n  interface CloseDiffRequest {\n    // The absolute path to the file whose diff view should be closed.\n    filePath: string;\n  }\n  ```\n\n- **Response (`CallToolResult`):** The tool **MUST** return a `CallToolResult`.\n  - On Success: If the diff view was closed successfully, the response **MUST**\n    include a single **TextContent** block in the content array containing the\n    file's final content before closing.\n  - On Failure: If an error prevented the diff view from closing, the response\n    **MUST** have `isError: true` and include a `TextContent` block in the\n    `content` array describing the error.\n\n### `ide/diffAccepted` notification\n\nWhen the user accepts the changes in a diff view (e.g., by clicking an \"Apply\"\nor \"Save\" button), the plugin **MUST** send an `ide/diffAccepted` notification\nto the CLI.\n\n- **Payload:** The notification parameters **MUST** include the file path and\n  the final content of the file. The content may differ from the original\n  `newContent` if the user made manual edits in the diff view.\n\n  ```typescript\n  {\n    // The absolute path to the file that was diffed.\n    filePath: string;\n    // The full content of the file after acceptance.\n    content: string;\n  }\n  ```\n\n### `ide/diffRejected` notification\n\nWhen the user rejects the changes (e.g., by closing the diff view without\naccepting), the plugin **MUST** send an `ide/diffRejected` notification to the\nCLI.\n\n- **Payload:** The notification parameters **MUST** include the file path of the\n  rejected diff.\n\n  ```typescript\n  {\n    // The absolute path to the file that was diffed.\n    filePath: string;\n  }\n  ```\n\n## IV. The lifecycle interface\n\nThe plugin **MUST** manage its resources and the discovery file correctly based\non the IDE's lifecycle.\n\n- **On activation (IDE startup/plugin enabled):**\n  1.  Start the MCP server.\n  2.  Create the discovery file.\n- **On deactivation (IDE shutdown/plugin disabled):**\n  1.  Stop the MCP server.\n  2.  Delete the discovery file.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/ide-integration/index.md","content":"# IDE integration\n\nGemini CLI can integrate with your IDE to provide a more seamless and\ncontext-aware experience. This integration allows the CLI to understand your\nworkspace better and enables powerful features like native in-editor diffing.\n\nCurrently, the supported IDEs are [Antigravity](https://antigravity.google),\n[Visual Studio Code](https://code.visualstudio.com/), and other editors that\nsupport VS Code extensions. To build support for other editors, see the\n[IDE Companion Extension Spec](./ide-companion-spec.md).\n\n## Features\n\n- **Workspace context:** The CLI automatically gains awareness of your workspace\n  to provide more relevant and accurate responses. This context includes:\n  - The **10 most recently accessed files** in your workspace.\n  - Your active cursor position.\n  - Any text you have selected (up to a 16KB limit; longer selections will be\n    truncated).\n\n- **Native diffing:** When Gemini suggests code modifications, you can view the\n  changes directly within your IDE's native diff viewer. This allows you to\n  review, edit, and accept or reject the suggested changes seamlessly.\n\n- **VS Code commands:** You can access Gemini CLI features directly from the VS\n  Code Command Palette (`Cmd+Shift+P` or `Ctrl+Shift+P`):\n  - `Gemini CLI: Run`: Starts a new Gemini CLI session in the integrated\n    terminal.\n  - `Gemini CLI: Accept Diff`: Accepts the changes in the active diff editor.\n  - `Gemini CLI: Close Diff Editor`: Rejects the changes and closes the active\n    diff editor.\n  - `Gemini CLI: View Third-Party Notices`: Displays the third-party notices for\n    the extension.\n\n## Installation and setup\n\nThere are three ways to set up the IDE integration:\n\n### 1. Automatic nudge (recommended)\n\nWhen you run Gemini CLI inside a supported editor, it will automatically detect\nyour environment and prompt you to connect. Answering \"Yes\" will automatically\nrun the necessary setup, which includes installing the companion extension and\nenabling the connection.\n\n### 2. Manual installation from CLI\n\nIf you previously dismissed the prompt or want to install the extension\nmanually, you can run the following command inside Gemini CLI:\n\n```\n/ide install\n```\n\nThis will find the correct extension for your IDE and install it.\n\n### 3. Manual installation from a marketplace\n\nYou can also install the extension directly from a marketplace.\n\n- **For Visual Studio Code:** Install from the\n  [VS Code Marketplace](https://marketplace.visualstudio.com/items?itemName=google.gemini-cli-vscode-ide-companion).\n- **For VS Code forks:** To support forks of VS Code, the extension is also\n  published on the\n  [Open VSX Registry](https://open-vsx.org/extension/google/gemini-cli-vscode-ide-companion).\n  Follow your editor's instructions for installing extensions from this\n  registry.\n\n> NOTE: The \"Gemini CLI Companion\" extension may appear towards the bottom of\n> search results. If you don't see it immediately, try scrolling down or sorting\n> by \"Newly Published\".\n>\n> After manually installing the extension, you must run `/ide enable` in the CLI\n> to activate the integration.\n\n## Usage\n\n### Enabling and disabling\n\nYou can control the IDE integration from within the CLI:\n\n- To enable the connection to the IDE, run:\n  ```\n  /ide enable\n  ```\n- To disable the connection, run:\n  ```\n  /ide disable\n  ```\n\nWhen enabled, Gemini CLI will automatically attempt to connect to the IDE\ncompanion extension.\n\n### Checking the status\n\nTo check the connection status and see the context the CLI has received from the\nIDE, run:\n\n```\n/ide status\n```\n\nIf connected, this command will show the IDE it's connected to and a list of\nrecently opened files it is aware of.\n\n> [!NOTE] The file list is limited to 10 recently accessed files within your\n> workspace and only includes local files on disk.)\n\n### Working with diffs\n\nWhen you ask Gemini to modify a file, it can open a diff view directly in your\neditor.\n\n**To accept a diff**, you can perform any of the following actions:\n\n- Click the **checkmark icon** in the diff editor's title bar.\n- Save the file (e.g., with `Cmd+S` or `Ctrl+S`).\n- Open the Command Palette and run **Gemini CLI: Accept Diff**.\n- Respond with `yes` in the CLI when prompted.\n\n**To reject a diff**, you can:\n\n- Click the **'x' icon** in the diff editor's title bar.\n- Close the diff editor tab.\n- Open the Command Palette and run **Gemini CLI: Close Diff Editor**.\n- Respond with `no` in the CLI when prompted.\n\nYou can also **modify the suggested changes** directly in the diff view before\naccepting them.\n\nIf you select ‚ÄòYes, allow always‚Äô in the CLI, changes will no longer show up in\nthe IDE as they will be auto-accepted.\n\n## Using with sandboxing\n\nIf you are using Gemini CLI within a sandbox, please be aware of the following:\n\n- **On macOS:** The IDE integration requires network access to communicate with\n  the IDE companion extension. You must use a Seatbelt profile that allows\n  network access.\n- **In a Docker container:** If you run Gemini CLI inside a Docker (or Podman)\n  container, the IDE integration can still connect to the VS Code extension\n  running on your host machine. The CLI is configured to automatically find the\n  IDE server on `host.docker.internal`. No special configuration is usually\n  required, but you may need to ensure your Docker networking setup allows\n  connections from the container to the host.\n\n## Troubleshooting\n\nIf you encounter issues with IDE integration, here are some common error\nmessages and how to resolve them.\n\n### Connection errors\n\n- **Message:**\n  `üî¥ Disconnected: Failed to connect to IDE companion extension in [IDE Name]. Please ensure the extension is running. To install the extension, run /ide install.`\n  - **Cause:** Gemini CLI could not find the necessary environment variables\n    (`GEMINI_CLI_IDE_WORKSPACE_PATH` or `GEMINI_CLI_IDE_SERVER_PORT`) to connect\n    to the IDE. This usually means the IDE companion extension is not running or\n    did not initialize correctly.\n  - **Solution:**\n    1.  Make sure you have installed the **Gemini CLI Companion** extension in\n        your IDE and that it is enabled.\n    2.  Open a new terminal window in your IDE to ensure it picks up the correct\n        environment.\n\n- **Message:**\n  `üî¥ Disconnected: IDE connection error. The connection was lost unexpectedly. Please try reconnecting by running /ide enable`\n  - **Cause:** The connection to the IDE companion was lost.\n  - **Solution:** Run `/ide enable` to try and reconnect. If the issue\n    continues, open a new terminal window or restart your IDE.\n\n### Configuration errors\n\n- **Message:**\n  `üî¥ Disconnected: Directory mismatch. Gemini CLI is running in a different location than the open workspace in [IDE Name]. Please run the CLI from one of the following directories: [List of directories]`\n  - **Cause:** The CLI's current working directory is outside the workspace you\n    have open in your IDE.\n  - **Solution:** `cd` into the same directory that is open in your IDE and\n    restart the CLI.\n\n- **Message:**\n  `üî¥ Disconnected: To use this feature, please open a workspace folder in [IDE Name] and try again.`\n  - **Cause:** You have no workspace open in your IDE.\n  - **Solution:** Open a workspace in your IDE and restart the CLI.\n\n### General errors\n\n- **Message:**\n  `IDE integration is not supported in your current environment. To use this feature, run Gemini CLI in one of these supported IDEs: [List of IDEs]`\n  - **Cause:** You are running Gemini CLI in a terminal or environment that is\n    not a supported IDE.\n  - **Solution:** Run Gemini CLI from the integrated terminal of a supported\n    IDE, like Antigravity or VS Code.\n\n- **Message:**\n  `No installer is available for IDE. Please install the Gemini CLI Companion extension manually from the marketplace.`\n  - **Cause:** You ran `/ide install`, but the CLI does not have an automated\n    installer for your specific IDE.\n  - **Solution:** Open your IDE's extension marketplace, search for \"Gemini CLI\n    Companion\", and\n    [install it manually](#3-manual-installation-from-a-marketplace).\n"}
{"source":"github","repo":"gemini-cli","path":"docs/index.md","content":"# Welcome to Gemini CLI documentation\n\nThis documentation provides a comprehensive guide to installing, using, and\ndeveloping Gemini CLI, a tool that lets you interact with Gemini models through\na command-line interface.\n\n## Gemini CLI overview\n\nGemini CLI brings the capabilities of Gemini models to your terminal in an\ninteractive Read-Eval-Print Loop (REPL) environment. Gemini CLI consists of a\nclient-side application (`packages/cli`) that communicates with a local server\n(`packages/core`), which in turn manages requests to the Gemini API and its AI\nmodels. Gemini CLI also contains a variety of tools for tasks such as performing\nfile system operations, running shells, and web fetching, which are managed by\n`packages/core`.\n\n## Navigating the documentation\n\nThis documentation is organized into the following sections:\n\n### Overview\n\n- **[Architecture overview](./architecture.md):** Understand the high-level\n  design of Gemini CLI, including its components and how they interact.\n- **[Contribution guide](../CONTRIBUTING.md):** Information for contributors and\n  developers, including setup, building, testing, and coding conventions.\n\n### Get started\n\n- **[Gemini CLI quickstart](./get-started/index.md):** Let's get started with\n  Gemini CLI.\n- **[Gemini 3 Pro on Gemini CLI](./get-started/gemini-3.md):** Learn how to\n  enable and use Gemini 3.\n- **[Authentication](./get-started/authentication.md):** Authenticate to Gemini\n  CLI.\n- **[Configuration](./get-started/configuration.md):** Learn how to configure\n  the CLI.\n- **[Installation](./get-started/installation.md):** Install and run Gemini CLI.\n- **[Examples](./get-started/examples.md):** Example usage of Gemini CLI.\n\n### CLI\n\n- **[Introduction: Gemini CLI](./cli/index.md):** Overview of the command-line\n  interface.\n- **[Commands](./cli/commands.md):** Description of available CLI commands.\n- **[Checkpointing](./cli/checkpointing.md):** Documentation for the\n  checkpointing feature.\n- **[Custom commands](./cli/custom-commands.md):** Create your own commands and\n  shortcuts for frequently used prompts.\n- **[Enterprise](./cli/enterprise.md):** Gemini CLI for enterprise.\n- **[Headless mode](./cli/headless.md):** Use Gemini CLI programmatically for\n  scripting and automation.\n- **[Keyboard shortcuts](./cli/keyboard-shortcuts.md):** A reference for all\n  keyboard shortcuts to improve your workflow.\n- **[Model selection](./cli/model.md):** Select the model used to process your\n  commands with `/model`.\n- **[Sandbox](./cli/sandbox.md):** Isolate tool execution in a secure,\n  containerized environment.\n- **[Settings](./cli/settings.md):** Configure various aspects of the CLI's\n  behavior and appearance with `/settings`.\n- **[Telemetry](./cli/telemetry.md):** Overview of telemetry in the CLI.\n- **[Themes](./cli/themes.md):** Themes for Gemini CLI.\n- **[Token caching](./cli/token-caching.md):** Token caching and optimization.\n- **[Trusted Folders](./cli/trusted-folders.md):** An overview of the Trusted\n  Folders security feature.\n- **[Tutorials](./cli/tutorials.md):** Tutorials for Gemini CLI.\n- **[Uninstall](./cli/uninstall.md):** Methods for uninstalling the Gemini CLI.\n\n### Core\n\n- **[Introduction: Gemini CLI core](./core/index.md):** Information about Gemini\n  CLI core.\n- **[Memport](./core/memport.md):** Using the Memory Import Processor.\n- **[Tools API](./core/tools-api.md):** Information on how the core manages and\n  exposes tools.\n- **[Policy Engine](./core/policy-engine.md):** Use the Policy Engine for\n  fine-grained control over tool execution.\n\n### Tools\n\n- **[Introduction: Gemini CLI tools](./tools/index.md):** Information about\n  Gemini CLI's tools.\n- **[File system tools](./tools/file-system.md):** Documentation for the\n  `read_file` and `write_file` tools.\n- **[Shell tool](./tools/shell.md):** Documentation for the `run_shell_command`\n  tool.\n- **[Web fetch tool](./tools/web-fetch.md):** Documentation for the `web_fetch`\n  tool.\n- **[Web search tool](./tools/web-search.md):** Documentation for the\n  `google_web_search` tool.\n- **[Memory tool](./tools/memory.md):** Documentation for the `save_memory`\n  tool.\n- **[Todo tool](./tools/todos.md):** Documentation for the `write_todos` tool.\n- **[MCP servers](./tools/mcp-server.md):** Using MCP servers with Gemini CLI.\n\n### Extensions\n\n- **[Introduction: Extensions](./extensions/index.md):** How to extend the CLI\n  with new functionality.\n- **[Get Started with extensions](./extensions/getting-started-extensions.md):**\n  Learn how to build your own extension.\n- **[Extension releasing](./extensions/extension-releasing.md):** How to release\n  Gemini CLI extensions.\n\n### Hooks\n\n- **[Hooks](./hooks/index.md):** Intercept and customize Gemini CLI behavior at\n  key lifecycle points.\n- **[Writing Hooks](./hooks/writing-hooks.md):** Learn how to create your first\n  hook with a comprehensive example.\n- **[Best Practices](./hooks/best-practices.md):** Security, performance, and\n  debugging guidelines for hooks.\n\n### IDE integration\n\n- **[Introduction to IDE integration](./ide-integration/index.md):** Connect the\n  CLI to your editor.\n- **[IDE companion extension spec](./ide-integration/ide-companion-spec.md):**\n  Spec for building IDE companion extensions.\n\n### Development\n\n- **[NPM](./npm.md):** Details on how the project's packages are structured.\n- **[Releases](./releases.md):** Information on the project's releases and\n  deployment cadence.\n- **[Changelog](./changelogs/index.md):** Highlights and notable changes to\n  Gemini CLI.\n- **[Integration tests](./integration-tests.md):** Information about the\n  integration testing framework used in this project.\n- **[Issue and PR automation](./issue-and-pr-automation.md):** A detailed\n  overview of the automated processes we use to manage and triage issues and\n  pull requests.\n\n### Support\n\n- **[FAQ](./faq.md):** Frequently asked questions.\n- **[Troubleshooting guide](./troubleshooting.md):** Find solutions to common\n  problems.\n- **[Quota and pricing](./quota-and-pricing.md):** Learn about the free tier and\n  paid options.\n- **[Terms of service and privacy notice](./tos-privacy.md):** Information on\n  the terms of service and privacy notices applicable to your use of Gemini CLI.\n\nWe hope this documentation helps you make the most of Gemini CLI!\n"}
{"source":"github","repo":"gemini-cli","path":"docs/local-development.md","content":"# Local development guide\n\nThis guide provides instructions for setting up and using local development\nfeatures, such as development tracing.\n\n## Development tracing\n\nDevelopment traces (dev traces) are OpenTelemetry (OTel) traces that help you\ndebug your code by instrumenting interesting events like model calls, tool\nscheduler, tool calls, etc.\n\nDev traces are verbose and are specifically meant for understanding agent\nbehaviour and debugging issues. They are disabled by default.\n\nTo enable dev traces, set the `GEMINI_DEV_TRACING=true` environment variable\nwhen running Gemini CLI.\n\n### Viewing dev traces\n\nYou can view dev traces using either Jaeger or the Genkit Developer UI.\n\n#### Using Genkit\n\nGenkit provides a web-based UI for viewing traces and other telemetry data.\n\n1.  **Start the Genkit telemetry server:**\n\n    Run the following command to start the Genkit server:\n\n    ```bash\n    npm run telemetry -- --target=genkit\n    ```\n\n    The script will output the URL for the Genkit Developer UI, for example:\n\n    ```\n    Genkit Developer UI: http://localhost:4000\n    ```\n\n2.  **Run Gemini CLI with dev tracing:**\n\n    In a separate terminal, run your Gemini CLI command with the\n    `GEMINI_DEV_TRACING` environment variable:\n\n    ```bash\n    GEMINI_DEV_TRACING=true gemini\n    ```\n\n3.  **View the traces:**\n\n    Open the Genkit Developer UI URL in your browser and navigate to the\n    **Traces** tab to view the traces.\n\n#### Using Jaeger\n\nYou can view dev traces in the Jaeger UI. To get started, follow these steps:\n\n1.  **Start the telemetry collector:**\n\n    Run the following command in your terminal to download and start Jaeger and\n    an OTEL collector:\n\n    ```bash\n    npm run telemetry -- --target=local\n    ```\n\n    This command also configures your workspace for local telemetry and provides\n    a link to the Jaeger UI (usually `http://localhost:16686`).\n\n2.  **Run Gemini CLI with dev tracing:**\n\n    In a separate terminal, run your Gemini CLI command with the\n    `GEMINI_DEV_TRACING` environment variable:\n\n    ```bash\n    GEMINI_DEV_TRACING=true gemini\n    ```\n\n3.  **View the traces:**\n\n    After running your command, open the Jaeger UI link in your browser to view\n    the traces.\n\nFor more detailed information on telemetry, see the\n[telemetry documentation](./cli/telemetry.md).\n\n### Instrumenting code with dev traces\n\nYou can add dev traces to your own code for more detailed instrumentation. This\nis useful for debugging and understanding the flow of execution.\n\nUse the `runInDevTraceSpan` function to wrap any section of code in a trace\nspan.\n\nHere is a basic example:\n\n```typescript\nimport { runInDevTraceSpan } from '@google/gemini-cli-core';\n\nawait runInDevTraceSpan({ name: 'my-custom-span' }, async ({ metadata }) => {\n  // The `metadata` object allows you to record the input and output of the\n  // operation as well as other attributes.\n  metadata.input = { key: 'value' };\n  // Set custom attributes.\n  metadata.attributes['gen_ai.request.model'] = 'gemini-4.0-mega';\n\n  // Your code to be traced goes here\n  try {\n    const output = await somethingRisky();\n    metadata.output = output;\n    return output;\n  } catch (e) {\n    metadata.error = e;\n    throw e;\n  }\n});\n```\n\nIn this example:\n\n- `name`: The name of the span, which will be displayed in the trace.\n- `metadata.input`: (Optional) An object containing the input data for the\n  traced operation.\n- `metadata.output`: (Optional) An object containing the output data from the\n  traced operation.\n- `metadata.attributes`: (Optional) A record of custom attributes to add to the\n  span.\n- `metadata.error`: (Optional) An error object to record if the operation fails.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/get-started/authentication.md","content":"# Gemini CLI authentication setup\n\nTo use Gemini CLI, you'll need to authenticate with Google. This guide helps you\nquickly find the best way to sign in based on your account type and how you're\nusing the CLI.\n\nFor most users, we recommend starting Gemini CLI and logging in with your\npersonal Google account.\n\n## Choose your authentication method <a id=\"auth-methods\"></a>\n\nSelect the authentication method that matches your situation in the table below:\n\n| User Type / Scenario                                                   | Recommended Authentication Method                                | Google Cloud Project Required                               |\n| :--------------------------------------------------------------------- | :--------------------------------------------------------------- | :---------------------------------------------------------- |\n| Individual Google accounts                                             | [Login with Google](#login-google)                               | No, with exceptions                                         |\n| Organization users with a company, school, or Google Workspace account | [Login with Google](#login-google)                               | [Yes](#set-gcp)                                             |\n| AI Studio user with a Gemini API key                                   | [Use Gemini API Key](#gemini-api)                                | No                                                          |\n| Google Cloud Vertex AI user                                            | [Vertex AI](#vertex-ai)                                          | [Yes](#set-gcp)                                             |\n| [Headless mode](#headless)                                             | [Use Gemini API Key](#gemini-api) or<br> [Vertex AI](#vertex-ai) | No (for Gemini API Key)<br> [Yes](#set-gcp) (for Vertex AI) |\n\n### What is my Google account type?\n\n- **Individual Google accounts:** Includes all\n  [free tier accounts](../quota-and-pricing/#free-usage) such as Gemini Code\n  Assist for individuals, as well as paid subscriptions for\n  [Google AI Pro and Ultra](https://gemini.google/subscriptions/).\n\n- **Organization accounts:** Accounts using paid licenses through an\n  organization such as a company, school, or\n  [Google Workspace](https://workspace.google.com/). Includes\n  [Google AI Ultra for Business](https://support.google.com/a/answer/16345165)\n  subscriptions.\n\n## (Recommended) Login with Google <a id=\"login-google\"></a>\n\nIf you run Gemini CLI on your local machine, the simplest authentication method\nis logging in with your Google account. This method requires a web browser on a\nmachine that can communicate with the terminal running Gemini CLI (e.g., your\nlocal machine).\n\n> **Important:** If you are a **Google AI Pro** or **Google AI Ultra**\n> subscriber, use the Google account associated with your subscription.\n\nTo authenticate and use Gemini CLI:\n\n1. Start the CLI:\n\n   ```bash\n   gemini\n   ```\n\n2. Select **Login with Google**. Gemini CLI opens a login prompt using your web\n   browser. Follow the on-screen instructions. Your credentials will be cached\n   locally for future sessions.\n\n### Do I need to set my Google Cloud project?\n\nMost individual Google accounts (free and paid) don't require a Google Cloud\nproject for authentication. However, you'll need to set a Google Cloud project\nwhen you meet at least one of the following conditions:\n\n- You are using a company, school, or Google Workspace account.\n- You are using a Gemini Code Assist license from the Google Developer Program.\n- You are using a license from a Gemini Code Assist subscription.\n\nFor instructions, see [Set your Google Cloud Project](#set-gcp).\n\n## Use Gemini API key <a id=\"gemini-api\"></a>\n\nIf you don't want to authenticate using your Google account, you can use an API\nkey from Google AI Studio.\n\nTo authenticate and use Gemini CLI with a Gemini API key:\n\n1. Obtain your API key from\n   [Google AI Studio](https://aistudio.google.com/app/apikey).\n\n2. Set the `GEMINI_API_KEY` environment variable to your key. For example:\n\n   ```bash\n   # Replace YOUR_GEMINI_API_KEY with the key from AI Studio\n   export GEMINI_API_KEY=\"YOUR_GEMINI_API_KEY\"\n   ```\n\n   To make this setting persistent, see\n   [Persisting Environment Variables](#persisting-vars).\n\n3. Start the CLI:\n\n   ```bash\n   gemini\n   ```\n\n4. Select **Use Gemini API key**.\n\n> **Warning:** Treat API keys, especially for services like Gemini, as sensitive\n> credentials. Protect them to prevent unauthorized access and potential misuse\n> of the service under your account.\n\n## Use Vertex AI <a id=\"vertex-ai\"></a>\n\nTo use Gemini CLI with Google Cloud's Vertex AI platform, choose from the\nfollowing authentication options:\n\n- A. Application Default Credentials (ADC) using `gcloud`.\n- B. Service account JSON key.\n- C. Google Cloud API key.\n\nRegardless of your authentication method for Vertex AI, you'll need to set\n`GOOGLE_CLOUD_PROJECT` to your Google Cloud project ID with the Vertex AI API\nenabled, and `GOOGLE_CLOUD_LOCATION` to the location of your Vertex AI resources\nor the location where you want to run your jobs.\n\nFor example:\n\n```bash\n# Replace with your project ID and desired location (e.g., us-central1)\nexport GOOGLE_CLOUD_PROJECT=\"YOUR_PROJECT_ID\"\nexport GOOGLE_CLOUD_LOCATION=\"YOUR_PROJECT_LOCATION\"\n```\n\nTo make any Vertex AI environment variable settings persistent, see\n[Persisting Environment Variables](#persisting-vars).\n\n#### A. Vertex AI - application default credentials (ADC) using `gcloud`\n\nConsider this authentication method if you have Google Cloud CLI installed.\n\n> **Note:** If you have previously set `GOOGLE_API_KEY` or `GEMINI_API_KEY`, you\n> must unset them to use ADC:\n>\n> ```bash\n> unset GOOGLE_API_KEY GEMINI_API_KEY\n> ```\n\n1. Verify you have a Google Cloud project and Vertex AI API is enabled.\n\n2. Log in to Google Cloud:\n\n   ```bash\n   gcloud auth application-default login\n   ```\n\n3. [Configure your Google Cloud Project](#set-gcp).\n\n4. Start the CLI:\n\n   ```bash\n   gemini\n   ```\n\n5. Select **Vertex AI**.\n\n#### B. Vertex AI - service account JSON key\n\nConsider this method of authentication in non-interactive environments, CI/CD\npipelines, or if your organization restricts user-based ADC or API key creation.\n\n> **Note:** If you have previously set `GOOGLE_API_KEY` or `GEMINI_API_KEY`, you\n> must unset them:\n>\n> ```bash\n> unset GOOGLE_API_KEY GEMINI_API_KEY\n> ```\n\n1.  [Create a service account and key](https://cloud.google.com/iam/docs/keys-create-delete)\n    and download the provided JSON file. Assign the \"Vertex AI User\" role to the\n    service account.\n\n2.  Set the `GOOGLE_APPLICATION_CREDENTIALS` environment variable to the JSON\n    file's absolute path. For example:\n\n    ```bash\n    # Replace /path/to/your/keyfile.json with the actual path\n    export GOOGLE_APPLICATION_CREDENTIALS=\"/path/to/your/keyfile.json\"\n    ```\n\n3.  [Configure your Google Cloud Project](#set-gcp).\n\n4.  Start the CLI:\n\n    ```bash\n    gemini\n    ```\n\n5.  Select **Vertex AI**.\n    > **Warning:** Protect your service account key file as it gives access to\n    > your resources.\n\n#### C. Vertex AI - Google Cloud API key\n\n1.  Obtain a Google Cloud API key:\n    [Get an API Key](https://cloud.google.com/vertex-ai/generative-ai/docs/start/api-keys?usertype=newuser).\n\n2.  Set the `GOOGLE_API_KEY` environment variable:\n\n    ```bash\n    # Replace YOUR_GOOGLE_API_KEY with your Vertex AI API key\n    export GOOGLE_API_KEY=\"YOUR_GOOGLE_API_KEY\"\n    ```\n\n    > **Note:** If you see errors like\n    > `\"API keys are not supported by this API...\"`, your organization might\n    > restrict API key usage for this service. Try the other Vertex AI\n    > authentication methods instead.\n\n3.  [Configure your Google Cloud Project](#set-gcp).\n\n4.  Start the CLI:\n\n    ```bash\n    gemini\n    ```\n\n5.  Select **Vertex AI**.\n\n## Set your Google Cloud project <a id=\"set-gcp\"></a>\n\n> **Important:** Most individual Google accounts (free and paid) don't require a\n> Google Cloud project for authentication.\n\nWhen you sign in using your Google account, you may need to configure a Google\nCloud project for Gemini CLI to use. This applies when you meet at least one of\nthe following conditions:\n\n- You are using a Company, School, or Google Workspace account.\n- You are using a Gemini Code Assist license from the Google Developer Program.\n- You are using a license from a Gemini Code Assist subscription.\n\nTo configure Gemini CLI to use a Google Cloud project, do the following:\n\n1.  [Find your Google Cloud Project ID](https://support.google.com/googleapi/answer/7014113).\n\n2.  [Enable the Gemini for Cloud API](https://cloud.google.com/gemini/docs/discover/set-up-gemini#enable-api).\n\n3.  [Configure necessary IAM access permissions](https://cloud.google.com/gemini/docs/discover/set-up-gemini#grant-iam).\n\n4.  Configure your environment variables. Set either the `GOOGLE_CLOUD_PROJECT`\n    or `GOOGLE_CLOUD_PROJECT_ID` variable to the project ID to use with Gemini\n    CLI. Gemini CLI checks for `GOOGLE_CLOUD_PROJECT` first, then falls back to\n    `GOOGLE_CLOUD_PROJECT_ID`.\n\n    For example, to set the `GOOGLE_CLOUD_PROJECT_ID` variable:\n\n    ```bash\n    # Replace YOUR_PROJECT_ID with your actual Google Cloud project ID\n    export GOOGLE_CLOUD_PROJECT=\"YOUR_PROJECT_ID\"\n    ```\n\n    To make this setting persistent, see\n    [Persisting Environment Variables](#persisting-vars).\n\n## Persisting environment variables <a id=\"persisting-vars\"></a>\n\nTo avoid setting environment variables for every terminal session, you can\npersist them with the following methods:\n\n1.  **Add your environment variables to your shell configuration file:** Append\n    the `export ...` commands to your shell's startup file (e.g., `~/.bashrc`,\n    `~/.zshrc`, or `~/.profile`) and reload your shell (e.g.,\n    `source ~/.bashrc`).\n\n    ```bash\n    # Example for .bashrc\n    echo 'export GOOGLE_CLOUD_PROJECT=\"YOUR_PROJECT_ID\"' >> ~/.bashrc\n    source ~/.bashrc\n    ```\n\n    > **Warning:** Be aware that when you export API keys or service account\n    > paths in your shell configuration file, any process launched from that\n    > shell can read them.\n\n2.  **Use a `.env` file:** Create a `.gemini/.env` file in your project\n    directory or home directory. Gemini CLI automatically loads variables from\n    the first `.env` file it finds, searching up from the current directory,\n    then in `~/.gemini/.env` or `~/.env`. `.gemini/.env` is recommended.\n\n    Example for user-wide settings:\n\n    ```bash\n    mkdir -p ~/.gemini\n    cat >> ~/.gemini/.env <<'EOF'\n    GOOGLE_CLOUD_PROJECT=\"your-project-id\"\n    # Add other variables like GEMINI_API_KEY as needed\n    EOF\n    ```\n\nVariables are loaded from the first file found, not merged.\n\n## Running in Google Cloud environments <a id=\"cloud-env\"></a>\n\nWhen running Gemini CLI within certain Google Cloud environments, authentication\nis automatic.\n\nIn a Google Cloud Shell environment, Gemini CLI typically authenticates\nautomatically using your Cloud Shell credentials. In Compute Engine\nenvironments, Gemini CLI automatically uses Application Default Credentials\n(ADC) from the environment's metadata server.\n\nIf automatic authentication fails, use one of the interactive methods described\non this page.\n\n## Running in headless mode <a id=\"headless\"></a>\n\n[Headless mode](../cli/headless) will use your existing authentication method,\nif an existing authentication credential is cached.\n\nIf you have not already logged in with an authentication credential, you must\nconfigure authentication using environment variables:\n\n- [Use Gemini API Key](#gemini-api)\n- [Vertex AI](#vertex-ai)\n\n## What's next?\n\nYour authentication method affects your quotas, pricing, Terms of Service, and\nprivacy notices. Review the following pages to learn more:\n\n- [Gemini CLI: Quotas and Pricing](../quota-and-pricing.md).\n- [Gemini CLI: Terms of Service and Privacy Notice](../tos-privacy.md).\n"}
{"source":"github","repo":"gemini-cli","path":"docs/get-started/configuration-v1.md","content":"# Gemini CLI configuration\n\n**Note on deprecated configuration format**\n\nThis document describes the legacy v1 format for the `settings.json` file. This\nformat is now deprecated.\n\n- The new format will be supported in the stable release starting\n  **[09/10/25]**.\n- Automatic migration from the old format to the new format will begin on\n  **[09/17/25]**.\n\nFor details on the new, recommended format, please see the\n[current Configuration documentation](./configuration.md).\n\nGemini CLI offers several ways to configure its behavior, including environment\nvariables, command-line arguments, and settings files. This document outlines\nthe different configuration methods and available settings.\n\n## Configuration layers\n\nConfiguration is applied in the following order of precedence (lower numbers are\noverridden by higher numbers):\n\n1.  **Default values:** Hardcoded defaults within the application.\n2.  **System defaults file:** System-wide default settings that can be\n    overridden by other settings files.\n3.  **User settings file:** Global settings for the current user.\n4.  **Project settings file:** Project-specific settings.\n5.  **System settings file:** System-wide settings that override all other\n    settings files.\n6.  **Environment variables:** System-wide or session-specific variables,\n    potentially loaded from `.env` files.\n7.  **Command-line arguments:** Values passed when launching the CLI.\n\n## Settings files\n\nGemini CLI uses JSON settings files for persistent configuration. There are four\nlocations for these files:\n\n- **System defaults file:**\n  - **Location:** `/etc/gemini-cli/system-defaults.json` (Linux),\n    `C:\\ProgramData\\gemini-cli\\system-defaults.json` (Windows) or\n    `/Library/Application Support/GeminiCli/system-defaults.json` (macOS). The\n    path can be overridden using the `GEMINI_CLI_SYSTEM_DEFAULTS_PATH`\n    environment variable.\n  - **Scope:** Provides a base layer of system-wide default settings. These\n    settings have the lowest precedence and are intended to be overridden by\n    user, project, or system override settings.\n- **User settings file:**\n  - **Location:** `~/.gemini/settings.json` (where `~` is your home directory).\n  - **Scope:** Applies to all Gemini CLI sessions for the current user. User\n    settings override system defaults.\n- **Project settings file:**\n  - **Location:** `.gemini/settings.json` within your project's root directory.\n  - **Scope:** Applies only when running Gemini CLI from that specific project.\n    Project settings override user settings and system defaults.\n- **System settings file:**\n  - **Location:** `/etc/gemini-cli/settings.json` (Linux),\n    `C:\\ProgramData\\gemini-cli\\settings.json` (Windows) or\n    `/Library/Application Support/GeminiCli/settings.json` (macOS). The path can\n    be overridden using the `GEMINI_CLI_SYSTEM_SETTINGS_PATH` environment\n    variable.\n  - **Scope:** Applies to all Gemini CLI sessions on the system, for all users.\n    System settings act as overrides, taking precedence over all other settings\n    files. May be useful for system administrators at enterprises to have\n    controls over users' Gemini CLI setups.\n\n**Note on environment variables in settings:** String values within your\n`settings.json` files can reference environment variables using either\n`$VAR_NAME` or `${VAR_NAME}` syntax. These variables will be automatically\nresolved when the settings are loaded. For example, if you have an environment\nvariable `MY_API_TOKEN`, you could use it in `settings.json` like this:\n`\"apiKey\": \"$MY_API_TOKEN\"`.\n\n> **Note for Enterprise Users:** For guidance on deploying and managing Gemini\n> CLI in a corporate environment, please see the\n> [Enterprise Configuration](../cli/enterprise.md) documentation.\n\n### The `.gemini` directory in your project\n\nIn addition to a project settings file, a project's `.gemini` directory can\ncontain other project-specific files related to Gemini CLI's operation, such as:\n\n- [Custom sandbox profiles](#sandboxing) (e.g.,\n  `.gemini/sandbox-macos-custom.sb`, `.gemini/sandbox.Dockerfile`).\n\n### Available settings in `settings.json`:\n\n- **`contextFileName`** (string or array of strings):\n  - **Description:** Specifies the filename for context files (e.g.,\n    `GEMINI.md`, `AGENTS.md`). Can be a single filename or a list of accepted\n    filenames.\n  - **Default:** `GEMINI.md`\n  - **Example:** `\"contextFileName\": \"AGENTS.md\"`\n\n- **`bugCommand`** (object):\n  - **Description:** Overrides the default URL for the `/bug` command.\n  - **Default:**\n    `\"urlTemplate\": \"https://github.com/google-gemini/gemini-cli/issues/new?template=bug_report.yml&title={title}&info={info}\"`\n  - **Properties:**\n    - **`urlTemplate`** (string): A URL that can contain `{title}` and `{info}`\n      placeholders.\n  - **Example:**\n    ```json\n    \"bugCommand\": {\n      \"urlTemplate\": \"https://bug.example.com/new?title={title}&info={info}\"\n    }\n    ```\n\n- **`fileFiltering`** (object):\n  - **Description:** Controls git-aware file filtering behavior for @ commands\n    and file discovery tools.\n  - **Default:** `\"respectGitIgnore\": true, \"enableRecursiveFileSearch\": true`\n  - **Properties:**\n    - **`respectGitIgnore`** (boolean): Whether to respect .gitignore patterns\n      when discovering files. When set to `true`, git-ignored files (like\n      `node_modules/`, `dist/`, `.env`) are automatically excluded from @\n      commands and file listing operations.\n    - **`enableRecursiveFileSearch`** (boolean): Whether to enable searching\n      recursively for filenames under the current tree when completing @\n      prefixes in the prompt.\n    - **`disableFuzzySearch`** (boolean): When `true`, disables the fuzzy search\n      capabilities when searching for files, which can improve performance on\n      projects with a large number of files.\n  - **Example:**\n    ```json\n    \"fileFiltering\": {\n      \"respectGitIgnore\": true,\n      \"enableRecursiveFileSearch\": false,\n      \"disableFuzzySearch\": true\n    }\n    ```\n\n### Troubleshooting file search performance\n\nIf you are experiencing performance issues with file searching (e.g., with `@`\ncompletions), especially in projects with a very large number of files, here are\na few things you can try in order of recommendation:\n\n1.  **Use `.geminiignore`:** Create a `.geminiignore` file in your project root\n    to exclude directories that contain a large number of files that you don't\n    need to reference (e.g., build artifacts, logs, `node_modules`). Reducing\n    the total number of files crawled is the most effective way to improve\n    performance.\n\n2.  **Disable fuzzy search:** If ignoring files is not enough, you can disable\n    fuzzy search by setting `disableFuzzySearch` to `true` in your\n    `settings.json` file. This will use a simpler, non-fuzzy matching algorithm,\n    which can be faster.\n\n3.  **Disable recursive file search:** As a last resort, you can disable\n    recursive file search entirely by setting `enableRecursiveFileSearch` to\n    `false`. This will be the fastest option as it avoids a recursive crawl of\n    your project. However, it means you will need to type the full path to files\n    when using `@` completions.\n\n- **`coreTools`** (array of strings):\n  - **Description:** Allows you to specify a list of core tool names that should\n    be made available to the model. This can be used to restrict the set of\n    built-in tools. See [Built-in Tools](../core/tools-api.md#built-in-tools)\n    for a list of core tools. You can also specify command-specific restrictions\n    for tools that support it, like the `ShellTool`. For example,\n    `\"coreTools\": [\"ShellTool(ls -l)\"]` will only allow the `ls -l` command to\n    be executed.\n  - **Default:** All tools available for use by the Gemini model.\n  - **Example:** `\"coreTools\": [\"ReadFileTool\", \"GlobTool\", \"ShellTool(ls)\"]`.\n\n- **`allowedTools`** (array of strings):\n  - **Default:** `undefined`\n  - **Description:** A list of tool names that will bypass the confirmation\n    dialog. This is useful for tools that you trust and use frequently. The\n    match semantics are the same as `coreTools`.\n  - **Example:** `\"allowedTools\": [\"ShellTool(git status)\"]`.\n\n- **`excludeTools`** (array of strings):\n  - **Description:** Allows you to specify a list of core tool names that should\n    be excluded from the model. A tool listed in both `excludeTools` and\n    `coreTools` is excluded. You can also specify command-specific restrictions\n    for tools that support it, like the `ShellTool`. For example,\n    `\"excludeTools\": [\"ShellTool(rm -rf)\"]` will block the `rm -rf` command.\n  - **Default**: No tools excluded.\n  - **Example:** `\"excludeTools\": [\"run_shell_command\", \"findFiles\"]`.\n  - **Security Note:** Command-specific restrictions in `excludeTools` for\n    `run_shell_command` are based on simple string matching and can be easily\n    bypassed. This feature is **not a security mechanism** and should not be\n    relied upon to safely execute untrusted code. It is recommended to use\n    `coreTools` to explicitly select commands that can be executed.\n\n- **`allowMCPServers`** (array of strings):\n  - **Description:** Allows you to specify a list of MCP server names that\n    should be made available to the model. This can be used to restrict the set\n    of MCP servers to connect to. Note that this will be ignored if\n    `--allowed-mcp-server-names` is set.\n  - **Default:** All MCP servers are available for use by the Gemini model.\n  - **Example:** `\"allowMCPServers\": [\"myPythonServer\"]`.\n  - **Security note:** This uses simple string matching on MCP server names,\n    which can be modified. If you're a system administrator looking to prevent\n    users from bypassing this, consider configuring the `mcpServers` at the\n    system settings level such that the user will not be able to configure any\n    MCP servers of their own. This should not be used as an airtight security\n    mechanism.\n\n- **`excludeMCPServers`** (array of strings):\n  - **Description:** Allows you to specify a list of MCP server names that\n    should be excluded from the model. A server listed in both\n    `excludeMCPServers` and `allowMCPServers` is excluded. Note that this will\n    be ignored if `--allowed-mcp-server-names` is set.\n  - **Default**: No MCP servers excluded.\n  - **Example:** `\"excludeMCPServers\": [\"myNodeServer\"]`.\n  - **Security note:** This uses simple string matching on MCP server names,\n    which can be modified. If you're a system administrator looking to prevent\n    users from bypassing this, consider configuring the `mcpServers` at the\n    system settings level such that the user will not be able to configure any\n    MCP servers of their own. This should not be used as an airtight security\n    mechanism.\n\n- **`autoAccept`** (boolean):\n  - **Description:** Controls whether the CLI automatically accepts and executes\n    tool calls that are considered safe (e.g., read-only operations) without\n    explicit user confirmation. If set to `true`, the CLI will bypass the\n    confirmation prompt for tools deemed safe.\n  - **Default:** `false`\n  - **Example:** `\"autoAccept\": true`\n\n- **`theme`** (string):\n  - **Description:** Sets the visual [theme](../cli/themes.md) for Gemini CLI.\n  - **Default:** `\"Default\"`\n  - **Example:** `\"theme\": \"GitHub\"`\n\n- **`vimMode`** (boolean):\n  - **Description:** Enables or disables vim mode for input editing. When\n    enabled, the input area supports vim-style navigation and editing commands\n    with NORMAL and INSERT modes. The vim mode status is displayed in the footer\n    and persists between sessions.\n  - **Default:** `false`\n  - **Example:** `\"vimMode\": true`\n\n- **`sandbox`** (boolean or string):\n  - **Description:** Controls whether and how to use sandboxing for tool\n    execution. If set to `true`, Gemini CLI uses a pre-built\n    `gemini-cli-sandbox` Docker image. For more information, see\n    [Sandboxing](#sandboxing).\n  - **Default:** `false`\n  - **Example:** `\"sandbox\": \"docker\"`\n\n- **`toolDiscoveryCommand`** (string):\n  - **Description:** Defines a custom shell command for discovering tools from\n    your project. The shell command must return on `stdout` a JSON array of\n    [function declarations](https://ai.google.dev/gemini-api/docs/function-calling#function-declarations).\n    Tool wrappers are optional.\n  - **Default:** Empty\n  - **Example:** `\"toolDiscoveryCommand\": \"bin/get_tools\"`\n\n- **`toolCallCommand`** (string):\n  - **Description:** Defines a custom shell command for calling a specific tool\n    that was discovered using `toolDiscoveryCommand`. The shell command must\n    meet the following criteria:\n    - It must take function `name` (exactly as in\n      [function declaration](https://ai.google.dev/gemini-api/docs/function-calling#function-declarations))\n      as first command line argument.\n    - It must read function arguments as JSON on `stdin`, analogous to\n      [`functionCall.args`](https://cloud.google.com/vertex-ai/generative-ai/docs/model-reference/inference#functioncall).\n    - It must return function output as JSON on `stdout`, analogous to\n      [`functionResponse.response.content`](https://cloud.google.com/vertex-ai/generative-ai/docs/model-reference/inference#functionresponse).\n  - **Default:** Empty\n  - **Example:** `\"toolCallCommand\": \"bin/call_tool\"`\n\n- **`mcpServers`** (object):\n  - **Description:** Configures connections to one or more Model-Context\n    Protocol (MCP) servers for discovering and using custom tools. Gemini CLI\n    attempts to connect to each configured MCP server to discover available\n    tools. If multiple MCP servers expose a tool with the same name, the tool\n    names will be prefixed with the server alias you defined in the\n    configuration (e.g., `serverAlias__actualToolName`) to avoid conflicts. Note\n    that the system might strip certain schema properties from MCP tool\n    definitions for compatibility. At least one of `command`, `url`, or\n    `httpUrl` must be provided. If multiple are specified, the order of\n    precedence is `httpUrl`, then `url`, then `command`.\n  - **Default:** Empty\n  - **Properties:**\n    - **`<SERVER_NAME>`** (object): The server parameters for the named server.\n      - `command` (string, optional): The command to execute to start the MCP\n        server via standard I/O.\n      - `args` (array of strings, optional): Arguments to pass to the command.\n      - `env` (object, optional): Environment variables to set for the server\n        process.\n      - `cwd` (string, optional): The working directory in which to start the\n        server.\n      - `url` (string, optional): The URL of an MCP server that uses Server-Sent\n        Events (SSE) for communication.\n      - `httpUrl` (string, optional): The URL of an MCP server that uses\n        streamable HTTP for communication.\n      - `headers` (object, optional): A map of HTTP headers to send with\n        requests to `url` or `httpUrl`.\n      - `timeout` (number, optional): Timeout in milliseconds for requests to\n        this MCP server.\n      - `trust` (boolean, optional): Trust this server and bypass all tool call\n        confirmations.\n      - `description` (string, optional): A brief description of the server,\n        which may be used for display purposes.\n      - `includeTools` (array of strings, optional): List of tool names to\n        include from this MCP server. When specified, only the tools listed here\n        will be available from this server (allowlist behavior). If not\n        specified, all tools from the server are enabled by default.\n      - `excludeTools` (array of strings, optional): List of tool names to\n        exclude from this MCP server. Tools listed here will not be available to\n        the model, even if they are exposed by the server. **Note:**\n        `excludeTools` takes precedence over `includeTools` - if a tool is in\n        both lists, it will be excluded.\n  - **Example:**\n    ```json\n    \"mcpServers\": {\n      \"myPythonServer\": {\n        \"command\": \"python\",\n        \"args\": [\"mcp_server.py\", \"--port\", \"8080\"],\n        \"cwd\": \"./mcp_tools/python\",\n        \"timeout\": 5000,\n        \"includeTools\": [\"safe_tool\", \"file_reader\"],\n      },\n      \"myNodeServer\": {\n        \"command\": \"node\",\n        \"args\": [\"mcp_server.js\"],\n        \"cwd\": \"./mcp_tools/node\",\n        \"excludeTools\": [\"dangerous_tool\", \"file_deleter\"]\n      },\n      \"myDockerServer\": {\n        \"command\": \"docker\",\n        \"args\": [\"run\", \"-i\", \"--rm\", \"-e\", \"API_KEY\", \"ghcr.io/foo/bar\"],\n        \"env\": {\n          \"API_KEY\": \"$MY_API_TOKEN\"\n        }\n      },\n      \"mySseServer\": {\n        \"url\": \"http://localhost:8081/events\",\n        \"headers\": {\n          \"Authorization\": \"Bearer $MY_SSE_TOKEN\"\n        },\n        \"description\": \"An example SSE-based MCP server.\"\n      },\n      \"myStreamableHttpServer\": {\n        \"httpUrl\": \"http://localhost:8082/stream\",\n        \"headers\": {\n          \"X-API-Key\": \"$MY_HTTP_API_KEY\"\n        },\n        \"description\": \"An example Streamable HTTP-based MCP server.\"\n      }\n    }\n    ```\n\n- **`checkpointing`** (object):\n  - **Description:** Configures the checkpointing feature, which allows you to\n    save and restore conversation and file states. See the\n    [Checkpointing documentation](../cli/checkpointing.md) for more details.\n  - **Default:** `{\"enabled\": false}`\n  - **Properties:**\n    - **`enabled`** (boolean): When `true`, the `/restore` command is available.\n\n- **`preferredEditor`** (string):\n  - **Description:** Specifies the preferred editor to use for viewing diffs.\n  - **Default:** `vscode`\n  - **Example:** `\"preferredEditor\": \"vscode\"`\n\n- **`telemetry`** (object)\n  - **Description:** Configures logging and metrics collection for Gemini CLI.\n    For more information, see [Telemetry](../cli/telemetry.md).\n  - **Default:**\n    `{\"enabled\": false, \"target\": \"local\", \"otlpEndpoint\": \"http://localhost:4317\", \"logPrompts\": true}`\n  - **Properties:**\n    - **`enabled`** (boolean): Whether or not telemetry is enabled.\n    - **`target`** (string): The destination for collected telemetry. Supported\n      values are `local` and `gcp`.\n    - **`otlpEndpoint`** (string): The endpoint for the OTLP Exporter.\n    - **`logPrompts`** (boolean): Whether or not to include the content of user\n      prompts in the logs.\n  - **Example:**\n    ```json\n    \"telemetry\": {\n      \"enabled\": true,\n      \"target\": \"local\",\n      \"otlpEndpoint\": \"http://localhost:16686\",\n      \"logPrompts\": false\n    }\n    ```\n- **`usageStatisticsEnabled`** (boolean):\n  - **Description:** Enables or disables the collection of usage statistics. See\n    [Usage Statistics](#usage-statistics) for more information.\n  - **Default:** `true`\n  - **Example:**\n    ```json\n    \"usageStatisticsEnabled\": false\n    ```\n\n- **`hideTips`** (boolean):\n  - **Description:** Enables or disables helpful tips in the CLI interface.\n  - **Default:** `false`\n  - **Example:**\n\n    ```json\n    \"hideTips\": true\n    ```\n\n- **`hideBanner`** (boolean):\n  - **Description:** Enables or disables the startup banner (ASCII art logo) in\n    the CLI interface.\n  - **Default:** `false`\n  - **Example:**\n\n    ```json\n    \"hideBanner\": true\n    ```\n\n- **`maxSessionTurns`** (number):\n  - **Description:** Sets the maximum number of turns for a session. If the\n    session exceeds this limit, the CLI will stop processing and start a new\n    chat.\n  - **Default:** `-1` (unlimited)\n  - **Example:**\n    ```json\n    \"maxSessionTurns\": 10\n    ```\n\n- **`summarizeToolOutput`** (object):\n  - **Description:** Enables or disables the summarization of tool output. You\n    can specify the token budget for the summarization using the `tokenBudget`\n    setting.\n  - Note: Currently only the `run_shell_command` tool is supported.\n  - **Default:** `{}` (Disabled by default)\n  - **Example:**\n    ```json\n    \"summarizeToolOutput\": {\n      \"run_shell_command\": {\n        \"tokenBudget\": 2000\n      }\n    }\n    ```\n\n- **`excludedProjectEnvVars`** (array of strings):\n  - **Description:** Specifies environment variables that should be excluded\n    from being loaded from project `.env` files. This prevents project-specific\n    environment variables (like `DEBUG=true`) from interfering with gemini-cli\n    behavior. Variables from `.gemini/.env` files are never excluded.\n  - **Default:** `[\"DEBUG\", \"DEBUG_MODE\"]`\n  - **Example:**\n    ```json\n    \"excludedProjectEnvVars\": [\"DEBUG\", \"DEBUG_MODE\", \"NODE_ENV\"]\n    ```\n\n- **`includeDirectories`** (array of strings):\n  - **Description:** Specifies an array of additional absolute or relative paths\n    to include in the workspace context. Missing directories will be skipped\n    with a warning by default. Paths can use `~` to refer to the user's home\n    directory. This setting can be combined with the `--include-directories`\n    command-line flag.\n  - **Default:** `[]`\n  - **Example:**\n    ```json\n    \"includeDirectories\": [\n      \"/path/to/another/project\",\n      \"../shared-library\",\n      \"~/common-utils\"\n    ]\n    ```\n\n- **`loadMemoryFromIncludeDirectories`** (boolean):\n  - **Description:** Controls the behavior of the `/memory refresh` command. If\n    set to `true`, `GEMINI.md` files should be loaded from all directories that\n    are added. If set to `false`, `GEMINI.md` should only be loaded from the\n    current directory.\n  - **Default:** `false`\n  - **Example:**\n    ```json\n    \"loadMemoryFromIncludeDirectories\": true\n    ```\n\n- **`showLineNumbers`** (boolean):\n  - **Description:** Controls whether line numbers are displayed in code blocks\n    in the CLI output.\n  - **Default:** `true`\n  - **Example:**\n    ```json\n    \"showLineNumbers\": false\n    ```\n\n- **`accessibility`** (object):\n  - **Description:** Configures accessibility features for the CLI.\n  - **Properties:**\n    - **`screenReader`** (boolean): Enables screen reader mode, which adjusts\n      the TUI for better compatibility with screen readers. This can also be\n      enabled with the `--screen-reader` command-line flag, which will take\n      precedence over the setting.\n    - **`disableLoadingPhrases`** (boolean): Disables the display of loading\n      phrases during operations.\n  - **Default:** `{\"screenReader\": false, \"disableLoadingPhrases\": false}`\n  - **Example:**\n    ```json\n    \"accessibility\": {\n      \"screenReader\": true,\n      \"disableLoadingPhrases\": true\n    }\n    ```\n\n### Example `settings.json`:\n\n```json\n{\n  \"theme\": \"GitHub\",\n  \"sandbox\": \"docker\",\n  \"toolDiscoveryCommand\": \"bin/get_tools\",\n  \"toolCallCommand\": \"bin/call_tool\",\n  \"mcpServers\": {\n    \"mainServer\": {\n      \"command\": \"bin/mcp_server.py\"\n    },\n    \"anotherServer\": {\n      \"command\": \"node\",\n      \"args\": [\"mcp_server.js\", \"--verbose\"]\n    }\n  },\n  \"telemetry\": {\n    \"enabled\": true,\n    \"target\": \"local\",\n    \"otlpEndpoint\": \"http://localhost:4317\",\n    \"logPrompts\": true\n  },\n  \"usageStatisticsEnabled\": true,\n  \"hideTips\": false,\n  \"hideBanner\": false,\n  \"maxSessionTurns\": 10,\n  \"summarizeToolOutput\": {\n    \"run_shell_command\": {\n      \"tokenBudget\": 100\n    }\n  },\n  \"excludedProjectEnvVars\": [\"DEBUG\", \"DEBUG_MODE\", \"NODE_ENV\"],\n  \"includeDirectories\": [\"path/to/dir1\", \"~/path/to/dir2\", \"../path/to/dir3\"],\n  \"loadMemoryFromIncludeDirectories\": true\n}\n```\n\n## Shell history\n\nThe CLI keeps a history of shell commands you run. To avoid conflicts between\ndifferent projects, this history is stored in a project-specific directory\nwithin your user's home folder.\n\n- **Location:** `~/.gemini/tmp/<project_hash>/shell_history`\n  - `<project_hash>` is a unique identifier generated from your project's root\n    path.\n  - The history is stored in a file named `shell_history`.\n\n## Environment variables and `.env` files\n\nEnvironment variables are a common way to configure applications, especially for\nsensitive information like API keys or for settings that might change between\nenvironments. For authentication setup, see the\n[Authentication documentation](./authentication.md) which covers all available\nauthentication methods.\n\nThe CLI automatically loads environment variables from an `.env` file. The\nloading order is:\n\n1.  `.env` file in the current working directory.\n2.  If not found, it searches upwards in parent directories until it finds an\n    `.env` file or reaches the project root (identified by a `.git` folder) or\n    the home directory.\n3.  If still not found, it looks for `~/.env` (in the user's home directory).\n\n**Environment variable exclusion:** Some environment variables (like `DEBUG` and\n`DEBUG_MODE`) are automatically excluded from being loaded from project `.env`\nfiles to prevent interference with gemini-cli behavior. Variables from\n`.gemini/.env` files are never excluded. You can customize this behavior using\nthe `excludedProjectEnvVars` setting in your `settings.json` file.\n\n- **`GEMINI_API_KEY`**:\n  - Your API key for the Gemini API.\n  - One of several available [authentication methods](./authentication.md).\n  - Set this in your shell profile (e.g., `~/.bashrc`, `~/.zshrc`) or an `.env`\n    file.\n- **`GEMINI_MODEL`**:\n  - Specifies the default Gemini model to use.\n  - Overrides the hardcoded default\n  - Example: `export GEMINI_MODEL=\"gemini-2.5-flash\"`\n- **`GOOGLE_API_KEY`**:\n  - Your Google Cloud API key.\n  - Required for using Vertex AI in express mode.\n  - Ensure you have the necessary permissions.\n  - Example: `export GOOGLE_API_KEY=\"YOUR_GOOGLE_API_KEY\"`.\n- **`GOOGLE_CLOUD_PROJECT`**:\n  - Your Google Cloud Project ID.\n  - Required for using Code Assist or Vertex AI.\n  - If using Vertex AI, ensure you have the necessary permissions in this\n    project.\n  - **Cloud Shell note:** When running in a Cloud Shell environment, this\n    variable defaults to a special project allocated for Cloud Shell users. If\n    you have `GOOGLE_CLOUD_PROJECT` set in your global environment in Cloud\n    Shell, it will be overridden by this default. To use a different project in\n    Cloud Shell, you must define `GOOGLE_CLOUD_PROJECT` in a `.env` file.\n  - Example: `export GOOGLE_CLOUD_PROJECT=\"YOUR_PROJECT_ID\"`.\n- **`GOOGLE_APPLICATION_CREDENTIALS`** (string):\n  - **Description:** The path to your Google Application Credentials JSON file.\n  - **Example:**\n    `export GOOGLE_APPLICATION_CREDENTIALS=\"/path/to/your/credentials.json\"`\n- **`OTLP_GOOGLE_CLOUD_PROJECT`**:\n  - Your Google Cloud Project ID for Telemetry in Google Cloud\n  - Example: `export OTLP_GOOGLE_CLOUD_PROJECT=\"YOUR_PROJECT_ID\"`.\n- **`GOOGLE_CLOUD_LOCATION`**:\n  - Your Google Cloud Project Location (e.g., us-central1).\n  - Required for using Vertex AI in non express mode.\n  - Example: `export GOOGLE_CLOUD_LOCATION=\"YOUR_PROJECT_LOCATION\"`.\n- **`GEMINI_SANDBOX`**:\n  - Alternative to the `sandbox` setting in `settings.json`.\n  - Accepts `true`, `false`, `docker`, `podman`, or a custom command string.\n- **`HTTP_PROXY` / `HTTPS_PROXY`**:\n  - Specifies the proxy server to use for outgoing HTTP/HTTPS requests.\n  - Example: `export HTTPS_PROXY=\"http://proxy.example.com:8080\"`\n- **`SEATBELT_PROFILE`** (macOS specific):\n  - Switches the Seatbelt (`sandbox-exec`) profile on macOS.\n  - `permissive-open`: (Default) Restricts writes to the project folder (and a\n    few other folders, see\n    `packages/cli/src/utils/sandbox-macos-permissive-open.sb`) but allows other\n    operations.\n  - `strict`: Uses a strict profile that declines operations by default.\n  - `<profile_name>`: Uses a custom profile. To define a custom profile, create\n    a file named `sandbox-macos-<profile_name>.sb` in your project's `.gemini/`\n    directory (e.g., `my-project/.gemini/sandbox-macos-custom.sb`).\n- **`DEBUG` or `DEBUG_MODE`** (often used by underlying libraries or the CLI\n  itself):\n  - Set to `true` or `1` to enable verbose debug logging, which can be helpful\n    for troubleshooting.\n  - **Note:** These variables are automatically excluded from project `.env`\n    files by default to prevent interference with gemini-cli behavior. Use\n    `.gemini/.env` files if you need to set these for gemini-cli specifically.\n- **`NO_COLOR`**:\n  - Set to any value to disable all color output in the CLI.\n- **`CLI_TITLE`**:\n  - Set to a string to customize the title of the CLI.\n- **`CODE_ASSIST_ENDPOINT`**:\n  - Specifies the endpoint for the code assist server.\n  - This is useful for development and testing.\n\n## Command-line arguments\n\nArguments passed directly when running the CLI can override other configurations\nfor that specific session.\n\n- **`--model <model_name>`** (**`-m <model_name>`**):\n  - Specifies the Gemini model to use for this session.\n  - Example: `npm start -- --model gemini-1.5-pro-latest`\n- **`--prompt <your_prompt>`** (**`-p <your_prompt>`**):\n  - Used to pass a prompt directly to the command. This invokes Gemini CLI in a\n    non-interactive mode.\n- **`--prompt-interactive <your_prompt>`** (**`-i <your_prompt>`**):\n  - Starts an interactive session with the provided prompt as the initial input.\n  - The prompt is processed within the interactive session, not before it.\n  - Cannot be used when piping input from stdin.\n  - Example: `gemini -i \"explain this code\"`\n- **`--sandbox`** (**`-s`**):\n  - Enables sandbox mode for this session.\n- **`--sandbox-image`**:\n  - Sets the sandbox image URI.\n- **`--debug`** (**`-d`**):\n  - Enables debug mode for this session, providing more verbose output.\n\n- **`--help`** (or **`-h`**):\n  - Displays help information about command-line arguments.\n- **`--show-memory-usage`**:\n  - Displays the current memory usage.\n- **`--yolo`**:\n  - Enables YOLO mode, which automatically approves all tool calls.\n- **`--approval-mode <mode>`**:\n  - Sets the approval mode for tool calls. Available modes:\n    - `default`: Prompt for approval on each tool call (default behavior)\n    - `auto_edit`: Automatically approve edit tools (replace, write_file) while\n      prompting for others\n    - `yolo`: Automatically approve all tool calls (equivalent to `--yolo`)\n  - Cannot be used together with `--yolo`. Use `--approval-mode=yolo` instead of\n    `--yolo` for the new unified approach.\n  - Example: `gemini --approval-mode auto_edit`\n- **`--allowed-tools <tool1,tool2,...>`**:\n  - A comma-separated list of tool names that will bypass the confirmation\n    dialog.\n  - Example: `gemini --allowed-tools \"ShellTool(git status)\"`\n- **`--telemetry`**:\n  - Enables [telemetry](../cli/telemetry.md).\n- **`--telemetry-target`**:\n  - Sets the telemetry target. See [telemetry](../cli/telemetry.md) for more\n    information.\n- **`--telemetry-otlp-endpoint`**:\n  - Sets the OTLP endpoint for telemetry. See [telemetry](../cli/telemetry.md)\n    for more information.\n- **`--telemetry-otlp-protocol`**:\n  - Sets the OTLP protocol for telemetry (`grpc` or `http`). Defaults to `grpc`.\n    See [telemetry](../cli/telemetry.md) for more information.\n- **`--telemetry-log-prompts`**:\n  - Enables logging of prompts for telemetry. See\n    [telemetry](../cli/telemetry.md) for more information.\n- **`--extensions <extension_name ...>`** (**`-e <extension_name ...>`**):\n  - Specifies a list of extensions to use for the session. If not provided, all\n    available extensions are used.\n  - Use the special term `gemini -e none` to disable all extensions.\n  - Example: `gemini -e my-extension -e my-other-extension`\n- **`--list-extensions`** (**`-l`**):\n  - Lists all available extensions and exits.\n- **`--include-directories <dir1,dir2,...>`**:\n  - Includes additional directories in the workspace for multi-directory\n    support.\n  - Can be specified multiple times or as comma-separated values.\n  - 5 directories can be added at maximum.\n  - Example: `--include-directories /path/to/project1,/path/to/project2` or\n    `--include-directories /path/to/project1 --include-directories /path/to/project2`\n- **`--screen-reader`**:\n  - Enables screen reader mode for accessibility.\n- **`--version`**:\n  - Displays the version of the CLI.\n\n## Context files (hierarchical instructional context)\n\nWhile not strictly configuration for the CLI's _behavior_, context files\n(defaulting to `GEMINI.md` but configurable via the `contextFileName` setting)\nare crucial for configuring the _instructional context_ (also referred to as\n\"memory\") provided to the Gemini model. This powerful feature allows you to give\nproject-specific instructions, coding style guides, or any relevant background\ninformation to the AI, making its responses more tailored and accurate to your\nneeds. The CLI includes UI elements, such as an indicator in the footer showing\nthe number of loaded context files, to keep you informed about the active\ncontext.\n\n- **Purpose:** These Markdown files contain instructions, guidelines, or context\n  that you want the Gemini model to be aware of during your interactions. The\n  system is designed to manage this instructional context hierarchically.\n\n### Example context file content (e.g., `GEMINI.md`)\n\nHere's a conceptual example of what a context file at the root of a TypeScript\nproject might contain:\n\n```markdown\n# Project: My Awesome TypeScript Library\n\n## General Instructions:\n\n- When generating new TypeScript code, please follow the existing coding style.\n- Ensure all new functions and classes have JSDoc comments.\n- Prefer functional programming paradigms where appropriate.\n- All code should be compatible with TypeScript 5.0 and Node.js 20+.\n\n## Coding Style:\n\n- Use 2 spaces for indentation.\n- Interface names should be prefixed with `I` (e.g., `IUserService`).\n- Private class members should be prefixed with an underscore (`_`).\n- Always use strict equality (`===` and `!==`).\n\n## Specific Component: `src/api/client.ts`\n\n- This file handles all outbound API requests.\n- When adding new API call functions, ensure they include robust error handling\n  and logging.\n- Use the existing `fetchWithRetry` utility for all GET requests.\n\n## Regarding Dependencies:\n\n- Avoid introducing new external dependencies unless absolutely necessary.\n- If a new dependency is required, please state the reason.\n```\n\nThis example demonstrates how you can provide general project context, specific\ncoding conventions, and even notes about particular files or components. The\nmore relevant and precise your context files are, the better the AI can assist\nyou. Project-specific context files are highly encouraged to establish\nconventions and context.\n\n- **Hierarchical loading and precedence:** The CLI implements a sophisticated\n  hierarchical memory system by loading context files (e.g., `GEMINI.md`) from\n  several locations. Content from files lower in this list (more specific)\n  typically overrides or supplements content from files higher up (more\n  general). The exact concatenation order and final context can be inspected\n  using the `/memory show` command. The typical loading order is:\n  1.  **Global context file:**\n      - Location: `~/.gemini/<contextFileName>` (e.g., `~/.gemini/GEMINI.md` in\n        your user home directory).\n      - Scope: Provides default instructions for all your projects.\n  2.  **Project root and ancestors context files:**\n      - Location: The CLI searches for the configured context file in the\n        current working directory and then in each parent directory up to either\n        the project root (identified by a `.git` folder) or your home directory.\n      - Scope: Provides context relevant to the entire project or a significant\n        portion of it.\n  3.  **Sub-directory context files (contextual/local):**\n      - Location: The CLI also scans for the configured context file in\n        subdirectories _below_ the current working directory (respecting common\n        ignore patterns like `node_modules`, `.git`, etc.). The breadth of this\n        search is limited to 200 directories by default, but can be configured\n        with a `memoryDiscoveryMaxDirs` field in your `settings.json` file.\n      - Scope: Allows for highly specific instructions relevant to a particular\n        component, module, or subsection of your project.\n- **Concatenation and UI indication:** The contents of all found context files\n  are concatenated (with separators indicating their origin and path) and\n  provided as part of the system prompt to the Gemini model. The CLI footer\n  displays the count of loaded context files, giving you a quick visual cue\n  about the active instructional context.\n- **Importing content:** You can modularize your context files by importing\n  other Markdown files using the `@path/to/file.md` syntax. For more details,\n  see the [Memory Import Processor documentation](../core/memport.md).\n- **Commands for memory management:**\n  - Use `/memory refresh` to force a re-scan and reload of all context files\n    from all configured locations. This updates the AI's instructional context.\n  - Use `/memory show` to display the combined instructional context currently\n    loaded, allowing you to verify the hierarchy and content being used by the\n    AI.\n  - See the [Commands documentation](../cli/commands.md#memory) for full details\n    on the `/memory` command and its sub-commands (`show` and `refresh`).\n\nBy understanding and utilizing these configuration layers and the hierarchical\nnature of context files, you can effectively manage the AI's memory and tailor\nthe Gemini CLI's responses to your specific needs and projects.\n\n## Sandboxing\n\nThe Gemini CLI can execute potentially unsafe operations (like shell commands\nand file modifications) within a sandboxed environment to protect your system.\n\nSandboxing is disabled by default, but you can enable it in a few ways:\n\n- Using `--sandbox` or `-s` flag.\n- Setting `GEMINI_SANDBOX` environment variable.\n- Sandbox is enabled when using `--yolo` or `--approval-mode=yolo` by default.\n\nBy default, it uses a pre-built `gemini-cli-sandbox` Docker image.\n\nFor project-specific sandboxing needs, you can create a custom Dockerfile at\n`.gemini/sandbox.Dockerfile` in your project's root directory. This Dockerfile\ncan be based on the base sandbox image:\n\n```dockerfile\nFROM gemini-cli-sandbox\n\n# Add your custom dependencies or configurations here\n# For example:\n# RUN apt-get update && apt-get install -y some-package\n# COPY ./my-config /app/my-config\n```\n\nWhen `.gemini/sandbox.Dockerfile` exists, you can use `BUILD_SANDBOX`\nenvironment variable when running Gemini CLI to automatically build the custom\nsandbox image:\n\n```bash\nBUILD_SANDBOX=1 gemini -s\n```\n\n## Usage statistics\n\nTo help us improve the Gemini CLI, we collect anonymized usage statistics. This\ndata helps us understand how the CLI is used, identify common issues, and\nprioritize new features.\n\n**What we collect:**\n\n- **Tool calls:** We log the names of the tools that are called, whether they\n  succeed or fail, and how long they take to execute. We do not collect the\n  arguments passed to the tools or any data returned by them.\n- **API requests:** We log the Gemini model used for each request, the duration\n  of the request, and whether it was successful. We do not collect the content\n  of the prompts or responses.\n- **Session information:** We collect information about the configuration of the\n  CLI, such as the enabled tools and the approval mode.\n\n**What we DON'T collect:**\n\n- **Personally identifiable information (PII):** We do not collect any personal\n  information, such as your name, email address, or API keys.\n- **Prompt and response content:** We do not log the content of your prompts or\n  the responses from the Gemini model.\n- **File content:** We do not log the content of any files that are read or\n  written by the CLI.\n\n**How to opt out:**\n\nYou can opt out of usage statistics collection at any time by setting the\n`usageStatisticsEnabled` property to `false` in your `settings.json` file:\n\n```json\n{\n  \"usageStatisticsEnabled\": false\n}\n```\n"}
{"source":"github","repo":"gemini-cli","path":"docs/get-started/deployment.md","content":"Note: This page will be replaced by [installation.md](installation.md).\n\n# Gemini CLI installation, execution, and deployment\n\nInstall and run Gemini CLI. This document provides an overview of Gemini CLI's\ninstallation methods and deployment architecture.\n\n## How to install and/or run Gemini CLI\n\nThere are several ways to run Gemini CLI. The recommended option depends on how\nyou intend to use Gemini CLI.\n\n- As a standard installation. This is the most straightforward method of using\n  Gemini CLI.\n- In a sandbox. This method offers increased security and isolation.\n- From the source. This is recommended for contributors to the project.\n\n### 1. Standard installation (recommended for standard users)\n\nThis is the recommended way for end-users to install Gemini CLI. It involves\ndownloading the Gemini CLI package from the NPM registry.\n\n- **Global install:**\n\n  ```bash\n  npm install -g @google/gemini-cli\n  ```\n\n  Then, run the CLI from anywhere:\n\n  ```bash\n  gemini\n  ```\n\n- **NPX execution:**\n\n  ```bash\n  # Execute the latest version from NPM without a global install\n  npx @google/gemini-cli\n  ```\n\n### 2. Run in a sandbox (Docker/Podman)\n\nFor security and isolation, Gemini CLI can be run inside a container. This is\nthe default way that the CLI executes tools that might have side effects.\n\n- **Directly from the registry:** You can run the published sandbox image\n  directly. This is useful for environments where you only have Docker and want\n  to run the CLI.\n  ```bash\n  # Run the published sandbox image\n  docker run --rm -it us-docker.pkg.dev/gemini-code-dev/gemini-cli/sandbox:0.1.1\n  ```\n- **Using the `--sandbox` flag:** If you have Gemini CLI installed locally\n  (using the standard installation described above), you can instruct it to run\n  inside the sandbox container.\n  ```bash\n  gemini --sandbox -y -p \"your prompt here\"\n  ```\n\n### 3. Run from source (recommended for Gemini CLI contributors)\n\nContributors to the project will want to run the CLI directly from the source\ncode.\n\n- **Development mode:** This method provides hot-reloading and is useful for\n  active development.\n  ```bash\n  # From the root of the repository\n  npm run start\n  ```\n- **Production-like mode (Linked package):** This method simulates a global\n  installation by linking your local package. It's useful for testing a local\n  build in a production workflow.\n\n  ```bash\n  # Link the local cli package to your global node_modules\n  npm link packages/cli\n\n  # Now you can run your local version using the `gemini` command\n  gemini\n  ```\n\n---\n\n### 4. Running the latest Gemini CLI commit from GitHub\n\nYou can run the most recently committed version of Gemini CLI directly from the\nGitHub repository. This is useful for testing features still in development.\n\n```bash\n# Execute the CLI directly from the main branch on GitHub\nnpx https://github.com/google-gemini/gemini-cli\n```\n\n## Deployment architecture\n\nThe execution methods described above are made possible by the following\narchitectural components and processes:\n\n**NPM packages**\n\nGemini CLI project is a monorepo that publishes two core packages to the NPM\nregistry:\n\n- `@google/gemini-cli-core`: The backend, handling logic and tool execution.\n- `@google/gemini-cli`: The user-facing frontend.\n\nThese packages are used when performing the standard installation and when\nrunning Gemini CLI from the source.\n\n**Build and packaging processes**\n\nThere are two distinct build processes used, depending on the distribution\nchannel:\n\n- **NPM publication:** For publishing to the NPM registry, the TypeScript source\n  code in `@google/gemini-cli-core` and `@google/gemini-cli` is transpiled into\n  standard JavaScript using the TypeScript Compiler (`tsc`). The resulting\n  `dist/` directory is what gets published in the NPM package. This is a\n  standard approach for TypeScript libraries.\n\n- **GitHub `npx` execution:** When running the latest version of Gemini CLI\n  directly from GitHub, a different process is triggered by the `prepare` script\n  in `package.json`. This script uses `esbuild` to bundle the entire application\n  and its dependencies into a single, self-contained JavaScript file. This\n  bundle is created on-the-fly on the user's machine and is not checked into the\n  repository.\n\n**Docker sandbox image**\n\nThe Docker-based execution method is supported by the `gemini-cli-sandbox`\ncontainer image. This image is published to a container registry and contains a\npre-installed, global version of Gemini CLI.\n\n## Release process\n\nThe release process is automated through GitHub Actions. The release workflow\nperforms the following actions:\n\n1.  Build the NPM packages using `tsc`.\n2.  Publish the NPM packages to the artifact registry.\n3.  Create GitHub releases with bundled assets.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/get-started/index.md","content":"# Get started with Gemini CLI\n\nWelcome to Gemini CLI! This guide will help you install, configure, and start\nusing the Gemini CLI to enhance your workflow right from your terminal.\n\n## Quickstart: Install, authenticate, configure, and use Gemini CLI\n\nGemini CLI brings the power of advanced language models directly to your command\nline interface. As an AI-powered assistant, Gemini CLI can help you with a\nvariety of tasks, from understanding and generating code to reviewing and\nediting documents.\n\n## Install\n\nThe standard method to install and run Gemini CLI uses `npm`:\n\n```bash\nnpm install -g @google/gemini-cli\n```\n\nOnce Gemini CLI is installed, run Gemini CLI from your command line:\n\n```bash\ngemini\n```\n\nFor more installation options, see [Gemini CLI Installation](./installation.md).\n\n## Authenticate\n\nTo begin using Gemini CLI, you must authenticate with a Google service. In most\ncases, you can log in with your existing Google account:\n\n1. Run Gemini CLI after installation:\n\n   ```bash\n   gemini\n   ```\n\n2. When asked \"How would you like to authenticate for this project?\" select **1.\n   Login with Google**.\n\n3. Select your Google account.\n\n4. Click on **Sign in**.\n\nCertain account types may require you to configure a Google Cloud project. For\nmore information, including other authentication methods, see\n[Gemini CLI Authentication Setup](./authentication.md).\n\n## Configure\n\nGemini CLI offers several ways to configure its behavior, including environment\nvariables, command-line arguments, and settings files.\n\nTo explore your configuration options, see\n[Gemini CLI Configuration](./configuration.md).\n\n## Use\n\nOnce installed and authenticated, you can start using Gemini CLI by issuing\ncommands and prompts in your terminal. Ask it to generate code, explain files,\nand more.\n\nTo explore the power of Gemini CLI, see [Gemini CLI examples](./examples.md).\n\n## What's next?\n\n- Find out more about [Gemini CLI's tools](../tools/index.md).\n- Review [Gemini CLI's commands](../cli/commands.md).\n- Learn how to [get started with Gemini 3](./gemini-3.md).\n"}
{"source":"github","repo":"gemini-cli","path":"docs/get-started/gemini-3.md","content":"# Gemini 3 Pro on Gemini CLI\n\nWe‚Äôre excited to bring Gemini 3 Pro to Gemini CLI. Gemini 3 Pro is **currently\navailable** on Gemini CLI to all of the following subscribers:\n\n- Google AI Ultra (except Google AI Ultra for Business).\n- Google AI Pro.\n- Gemini Code Assist Standard (requires\n  [administrative enablement](#administrator-instructions)).\n- Gemini Code Assist Enterprise (requires\n  [administrative enablement](#administrator-instructions)).\n- Paid Gemini API key holders.\n- Paid Vertex API key holders.\n\nFor **everyone else**, we're gradually expanding access\n[through a waitlist](https://goo.gle/geminicli-waitlist-signup). If you don't\nhave one of the listed subscriptions, sign up for the waitlist to access Gemini\n3 Pro once approved.\n\n**Note:** Whether you‚Äôre automatically granted access or accepted from the\nwaitlist, you‚Äôll still need to enable Gemini 3 Pro\n[using the `/settings` command](../cli/settings.md).\n\n## How to join the waitlist\n\nUsers not automatically granted access will need to join the waitlist. Follow\nthese instructions to sign up:\n\n- Install Gemini CLI.\n- Authenticate using the **Login with Google** option. You‚Äôll see a banner that\n  says ‚ÄúGemini 3 is now available.‚Äù If you do not see this banner, update your\n  installation of Gemini CLI to the most recent version.\n- Fill out this Google form:\n  [Access Gemini 3 in Gemini CLI](https://goo.gle/geminicli-waitlist-signup).\n  Provide the email address of the account you used to authenticate with Gemini\n  CLI.\n\nUsers will be onboarded in batches, subject to availability. When you‚Äôve been\ngranted access to Gemini 3 Pro, you‚Äôll receive an acceptance email to your\nsubmitted email address.\n\n**Note:** Please wait until you have been approved to use Gemini 3 Pro to enable\n**Preview Features**. If enabled early, the CLI will fallback to Gemini 2.5 Pro.\n\n## How to use Gemini 3 Pro with Gemini CLI\n\nOnce you receive your acceptance email‚Äìor if you are automatically granted\naccess‚Äìyou still need to enable Gemini 3 Pro within Gemini CLI.\n\nTo enable Gemini 3 Pro, use the `/settings` command in Gemini CLI and set\n**Preview Features** to `true`.\n\nFor more information, see [Gemini CLI Settings](../cli/settings.md).\n\n### Usage limits and fallback\n\nGemini CLI will tell you when you reach your Gemini 3 Pro daily usage limit.\nWhen you encounter that limit, you‚Äôll be given the option to switch to Gemini\n2.5 Pro, upgrade for higher limits, or stop. You‚Äôll also be told when your usage\nlimit resets and Gemini 3 Pro can be used again.\n\nSimilarly, when you reach your daily usage limit for Gemini 2.5 Pro, you‚Äôll see\na message prompting fallback to Gemini 2.5 Flash.\n\n### Capacity errors\n\nThere may be times when the Gemini 3 Pro model is overloaded. When that happens,\nGemini CLI will ask you to decide whether you want to keep trying Gemini 3 Pro\nor fallback to Gemini 2.5 Pro.\n\n**Note:** The **Keep trying** option uses exponential backoff, in which Gemini\nCLI waits longer between each retry, when the system is busy. If the retry\ndoesn't happen immediately, please wait a few minutes for the request to\nprocess.\n\n### Model selection and routing types\n\nWhen using Gemini CLI, you may want to control how your requests are routed\nbetween models. By default, Gemini CLI uses **Auto** routing.\n\nWhen using Gemini 3 Pro, you may want to use Auto routing or Pro routing to\nmanage your usage limits:\n\n- **Auto routing:** Auto routing first determines whether a prompt involves a\n  complex or simple operation. For simple prompts, it will automatically use\n  Gemini 2.5 Flash. For complex prompts, if Gemini 3 Pro is enabled, it will use\n  Gemini 3 Pro; otherwise, it will use Gemini 2.5 Pro.\n- **Pro routing:** If you want to ensure your task is processed by the most\n  capable model, use `/model` and select **Pro**. Gemini CLI will prioritize the\n  most capable model available, including Gemini 3 Pro if it has been enabled.\n\nTo learn more about selecting a model and routing, refer to\n[Gemini CLI Model Selection](../cli/model.md).\n\n## How to enable Gemini 3 Pro with Gemini CLI on Gemini Code Assist\n\nIf you're using Gemini Code Assist Standard or Gemini Code Assist Enterprise,\nenabling Gemini 3 Pro on Gemini CLI requires configuring your release channels.\nUsing Gemini 3 Pro will require two steps: administrative enablement and user\nenablement.\n\nTo learn more about these settings, refer to\n[Configure Gemini Code Assist release channels](https://developers.google.com/gemini-code-assist/docs/configure-release-channels).\n\n### Administrator instructions\n\nAn administrator with **Google Cloud Settings Admin** permissions must follow\nthese directions:\n\n- Navigate to the Google Cloud Project you're using with Gemini CLI for Code\n  Assist.\n- Go to **Admin for Gemini** > **Settings**.\n- Under **Release channels for Gemini Code Assist in local IDEs** select\n  **Preview**.\n- Click **Save changes**.\n\n### User instructions\n\nWait for two to three minutes after your administrator has enabled **Preview**,\nthen:\n\n- Open Gemini CLI.\n- Use the `/settings` command.\n- Set **Preview Features** to `true`.\n\nRestart Gemini CLI and you should have access to Gemini 3 Pro.\n\n## Need help?\n\nIf you need help, we recommend searching for an existing\n[GitHub issue](https://github.com/google-gemini/gemini-cli/issues). If you\ncannot find a GitHub issue that matches your concern, you can\n[create a new issue](https://github.com/google-gemini/gemini-cli/issues/new/choose).\nFor comments and feedback, consider opening a\n[GitHub discussion](https://github.com/google-gemini/gemini-cli/discussions).\n"}
{"source":"github","repo":"gemini-cli","path":"docs/get-started/examples.md","content":"# Gemini CLI examples\n\nNot sure where to get started with Gemini CLI? This document covers examples on\nhow to use Gemini CLI for a variety of tasks.\n\n**Note:** Results are examples intended to showcase potential use cases. Your\nresults may vary.\n\n## Rename your photographs based on content\n\nScenario: You have a folder containing the following files:\n\n```bash\nphotos/photo1.png\nphotos/photo2.png\nphotos/photo3.png\n```\n\nGive Gemini the following prompt:\n\n```cli\nRename the photos in my \"photos\" directory based on their contents.\n```\n\nResult: Gemini will ask for permission to rename your files.\n\nSelect **Yes, allow once.** and your files will be renamed:\n\n```bash\nphotos/yellow_flowers.png\nphotos/antique_dresser.png\nphotos/green_android_robot.png\n```\n\n## Explain a repository by reading its code\n\nScenario: You want to understand how a popular open-source utility works by\ninspecting its code, not just its README.\n\nGive Gemini CLI the following prompt:\n\n```cli\nClone the 'chalk' repository from https://github.com/chalk/chalk, read its key source files, and explain how it works.\n```\n\nResult: Gemini will perform a sequence of actions to answer your request.\n\n1.  First, it will ask for permission to run `git clone` to download the\n    repository.\n2.  Next, it will find the important source files and ask for permission to read\n    them.\n3.  Finally, after analyzing the code, it will provide a summary.\n\nGemini CLI will return an explanation based on the actual source code:\n\n```markdown\nThe `chalk` library is a popular npm package for styling terminal output with\ncolors. After analyzing the source code, here's how it works:\n\n- **Core functionality:** The main file sets up a chainable API. Each color or\n  modifier (like `bold` or `italic`) is a getter that appends the corresponding\n  ANSI escape code to an internal stack.\n\n- **Chainable API:** When you call `chalk.red.bold('Hello')`, you are accessing\n  getters. The `red` getter adds the red color code, and the `bold` getter adds\n  the bold code.\n\n- **Output generation:** When the chain is treated as a string (e.g., in\n  `console.log`), a final `toString()` method is called. This method joins all\n  the stored ANSI codes, wraps them around the input string ('Hello'), and adds\n  a reset code at the end. This produces the final, styled string that the\n  terminal can render.\n```\n\n## Combine two spreadsheets into one spreadsheet\n\nScenario: You have two .csv files: `Revenue - 2023.csv` and\n`Revenue - 2024.csv`. Each file contains monthly revenue figures, like so:\n\n```csv\nJanuary,0\nFebruary,0\nMarch,0\nApril,900\nMay,1000\nJune,1000\nJuly,1200\nAugust,1800\nSeptember,2000\nOctober,2400\nNovember,3400\nDecember,2100\n```\n\nYou want to combine these two .csv files into a single .csv file.\n\nGive Gemini CLI the following prompt:\n\n```cli\nCombine the two .csv files into a single .csv file, with each year a different column.\n```\n\nResult: Gemini CLI will read each file and then ask for permission to write a\nnew file. Provide your permission and Gemini CLI will provide the following\n.csv:\n\n```csv\nMonth,2023,2024\nJanuary,0,1000\nFebruary,0,1200\nMarch,0,2400\nApril,900,500\nMay,1000,800\nJune,1000,900\nJuly,1200,1000\nAugust,1800,400\nSeptember,2000,2000\nOctober,2400,3400\nNovember,3400,1800\nDecember,2100,9000\n```\n\n## Run unit tests\n\nScenario: You've written a simple login page. You wish to write unit tests to\nensure that your login page has code coverage.\n\nGive Gemini CLI the following prompt:\n\n```cli\nWrite unit tests for Login.js.\n```\n\nResult: Gemini CLI will ask for permission to write a new file and create a test\nfor your login page\n\n```javascript\nimport React from 'react';\nimport { render, fireEvent, waitFor } from '@testing-library/react';\nimport Login from './Login';\n\n// Mock the API call for login\njest.mock('./api', () => ({\n  login: jest.fn(),\n}));\n\ndescribe('Login component', () => {\n  it('renders the login form correctly', () => {\n    const { getByLabelText, getByText } = render(<Login />);\n\n    expect(getByLabelText('Username')).toBeInTheDocument();\n    expect(getByLabelText('Password')).toBeInTheDocument();\n    expect(getByText('Login')).toBeInTheDocument();\n  });\n\n  it('shows an error message with invalid credentials', async () => {\n    const { getByLabelText, getByText, findByText } = render(<Login />);\n    const usernameInput = getByLabelText('Username');\n    const passwordInput = getByLabelText('Password');\n    const loginButton = getByText('Login');\n\n    // Mock the API to return an error\n    require('./api').login.mockRejectedValue(new Error('Invalid credentials'));\n\n    fireEvent.change(usernameInput, { target: { value: 'testuser' } });\n    fireEvent.change(passwordInput, { target: { value: 'wrongpassword' } });\n    fireEvent.click(loginButton);\n\n    const errorMessage = await findByText('Invalid credentials');\n    expect(errorMessage).toBeInTheDocument();\n  });\n\n  it('logs in successfully with valid credentials', async () => {\n    const onLoginSuccess = jest.fn();\n    const { getByLabelText, getByText } = render(\n      <Login onLoginSuccess={onLoginSuccess} />,\n    );\n    const usernameInput = getByLabelText('Username');\n    const passwordInput = getByLabelText('Password');\n    const loginButton = getByText('Login');\n\n    // Mock the API to return a success message\n    require('./api').login.mockResolvedValue({ success: true });\n\n    fireEvent.change(usernameInput, { target: { value: 'testuser' } });\n    fireEvent.change(passwordInput, { target: { value: 'correctpassword' } });\n    fireEvent.click(loginButton);\n\n    await waitFor(() => {\n      expect(onLoginSuccess).toHaveBeenCalled();\n    });\n  });\n\n  it('disables the submit button while submitting', async () => {\n    const { getByLabelText, getByText } = render(<Login />);\n    const usernameInput = getByLabelText('Username');\n    const passwordInput = getByLabelText('Password');\n    const loginButton = getByText('Login');\n\n    // Mock the API to have a delay\n    require('./api').login.mockImplementation(\n      () =>\n        new Promise((resolve) =>\n          setTimeout(() => resolve({ success: true }), 1000),\n        ),\n    );\n\n    fireEvent.change(usernameInput, { target: { value: 'testuser' } });\n    fireEvent.change(passwordInput, { target: { value: 'correctpassword' } });\n    fireEvent.click(loginButton);\n\n    expect(loginButton).toBeDisabled();\n\n    await waitFor(() => {\n      expect(loginButton).not.toBeDisabled();\n    });\n  });\n});\n```\n"}
{"source":"github","repo":"gemini-cli","path":"docs/get-started/installation.md","content":"# Gemini CLI installation, execution, and deployment\n\nInstall and run Gemini CLI. This document provides an overview of Gemini CLI's\ninstallation methods and deployment architecture.\n\n## How to install and/or run Gemini CLI\n\nThere are several ways to run Gemini CLI. The recommended option depends on how\nyou intend to use Gemini CLI.\n\n- As a standard installation. This is the most straightforward method of using\n  Gemini CLI.\n- In a sandbox. This method offers increased security and isolation.\n- From the source. This is recommended for contributors to the project.\n\n### 1. Standard installation (recommended for standard users)\n\nThis is the recommended way for end-users to install Gemini CLI. It involves\ndownloading the Gemini CLI package from the NPM registry.\n\n- **Global install:**\n\n  ```bash\n  npm install -g @google/gemini-cli\n  ```\n\n  Then, run the CLI from anywhere:\n\n  ```bash\n  gemini\n  ```\n\n- **NPX execution:**\n\n  ```bash\n  # Execute the latest version from NPM without a global install\n  npx @google/gemini-cli\n  ```\n\n### 2. Run in a sandbox (Docker/Podman)\n\nFor security and isolation, Gemini CLI can be run inside a container. This is\nthe default way that the CLI executes tools that might have side effects.\n\n- **Directly from the registry:** You can run the published sandbox image\n  directly. This is useful for environments where you only have Docker and want\n  to run the CLI.\n  ```bash\n  # Run the published sandbox image\n  docker run --rm -it us-docker.pkg.dev/gemini-code-dev/gemini-cli/sandbox:0.1.1\n  ```\n- **Using the `--sandbox` flag:** If you have Gemini CLI installed locally\n  (using the standard installation described above), you can instruct it to run\n  inside the sandbox container.\n  ```bash\n  gemini --sandbox -y -p \"your prompt here\"\n  ```\n\n### 3. Run from source (recommended for Gemini CLI contributors)\n\nContributors to the project will want to run the CLI directly from the source\ncode.\n\n- **Development mode:** This method provides hot-reloading and is useful for\n  active development.\n  ```bash\n  # From the root of the repository\n  npm run start\n  ```\n- **Production-like mode (linked package):** This method simulates a global\n  installation by linking your local package. It's useful for testing a local\n  build in a production workflow.\n\n  ```bash\n  # Link the local cli package to your global node_modules\n  npm link packages/cli\n\n  # Now you can run your local version using the `gemini` command\n  gemini\n  ```\n\n---\n\n### 4. Running the latest Gemini CLI commit from GitHub\n\nYou can run the most recently committed version of Gemini CLI directly from the\nGitHub repository. This is useful for testing features still in development.\n\n```bash\n# Execute the CLI directly from the main branch on GitHub\nnpx https://github.com/google-gemini/gemini-cli\n```\n\n## Deployment architecture\n\nThe execution methods described above are made possible by the following\narchitectural components and processes:\n\n**NPM packages**\n\nGemini CLI project is a monorepo that publishes two core packages to the NPM\nregistry:\n\n- `@google/gemini-cli-core`: The backend, handling logic and tool execution.\n- `@google/gemini-cli`: The user-facing frontend.\n\nThese packages are used when performing the standard installation and when\nrunning Gemini CLI from the source.\n\n**Build and packaging processes**\n\nThere are two distinct build processes used, depending on the distribution\nchannel:\n\n- **NPM publication:** For publishing to the NPM registry, the TypeScript source\n  code in `@google/gemini-cli-core` and `@google/gemini-cli` is transpiled into\n  standard JavaScript using the TypeScript Compiler (`tsc`). The resulting\n  `dist/` directory is what gets published in the NPM package. This is a\n  standard approach for TypeScript libraries.\n\n- **GitHub `npx` execution:** When running the latest version of Gemini CLI\n  directly from GitHub, a different process is triggered by the `prepare` script\n  in `package.json`. This script uses `esbuild` to bundle the entire application\n  and its dependencies into a single, self-contained JavaScript file. This\n  bundle is created on-the-fly on the user's machine and is not checked into the\n  repository.\n\n**Docker sandbox image**\n\nThe Docker-based execution method is supported by the `gemini-cli-sandbox`\ncontainer image. This image is published to a container registry and contains a\npre-installed, global version of Gemini CLI.\n\n## Release process\n\nThe release process is automated through GitHub Actions. The release workflow\nperforms the following actions:\n\n1.  Build the NPM packages using `tsc`.\n2.  Publish the NPM packages to the artifact registry.\n3.  Create GitHub releases with bundled assets.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/get-started/configuration.md","content":"# Gemini CLI configuration\n\n> **Note on configuration format, 9/17/25:** The format of the `settings.json`\n> file has been updated to a new, more organized structure.\n>\n> - The new format will be supported in the stable release starting\n>   **[09/10/25]**.\n> - Automatic migration from the old format to the new format will begin on\n>   **[09/17/25]**.\n>\n> For details on the previous format, please see the\n> [v1 Configuration documentation](./configuration-v1.md).\n\nGemini CLI offers several ways to configure its behavior, including environment\nvariables, command-line arguments, and settings files. This document outlines\nthe different configuration methods and available settings.\n\n## Configuration layers\n\nConfiguration is applied in the following order of precedence (lower numbers are\noverridden by higher numbers):\n\n1.  **Default values:** Hardcoded defaults within the application.\n2.  **System defaults file:** System-wide default settings that can be\n    overridden by other settings files.\n3.  **User settings file:** Global settings for the current user.\n4.  **Project settings file:** Project-specific settings.\n5.  **System settings file:** System-wide settings that override all other\n    settings files.\n6.  **Environment variables:** System-wide or session-specific variables,\n    potentially loaded from `.env` files.\n7.  **Command-line arguments:** Values passed when launching the CLI.\n\n## Settings files\n\nGemini CLI uses JSON settings files for persistent configuration. There are four\nlocations for these files:\n\n> **Tip:** JSON-aware editors can use autocomplete and validation by pointing to\n> the generated schema at `schemas/settings.schema.json` in this repository.\n> When working outside the repo, reference the hosted schema at\n> `https://raw.githubusercontent.com/google-gemini/gemini-cli/main/schemas/settings.schema.json`.\n\n- **System defaults file:**\n  - **Location:** `/etc/gemini-cli/system-defaults.json` (Linux),\n    `C:\\ProgramData\\gemini-cli\\system-defaults.json` (Windows) or\n    `/Library/Application Support/GeminiCli/system-defaults.json` (macOS). The\n    path can be overridden using the `GEMINI_CLI_SYSTEM_DEFAULTS_PATH`\n    environment variable.\n  - **Scope:** Provides a base layer of system-wide default settings. These\n    settings have the lowest precedence and are intended to be overridden by\n    user, project, or system override settings.\n- **User settings file:**\n  - **Location:** `~/.gemini/settings.json` (where `~` is your home directory).\n  - **Scope:** Applies to all Gemini CLI sessions for the current user. User\n    settings override system defaults.\n- **Project settings file:**\n  - **Location:** `.gemini/settings.json` within your project's root directory.\n  - **Scope:** Applies only when running Gemini CLI from that specific project.\n    Project settings override user settings and system defaults.\n- **System settings file:**\n  - **Location:** `/etc/gemini-cli/settings.json` (Linux),\n    `C:\\ProgramData\\gemini-cli\\settings.json` (Windows) or\n    `/Library/Application Support/GeminiCli/settings.json` (macOS). The path can\n    be overridden using the `GEMINI_CLI_SYSTEM_SETTINGS_PATH` environment\n    variable.\n  - **Scope:** Applies to all Gemini CLI sessions on the system, for all users.\n    System settings act as overrides, taking precedence over all other settings\n    files. May be useful for system administrators at enterprises to have\n    controls over users' Gemini CLI setups.\n\n**Note on environment variables in settings:** String values within your\n`settings.json` and `gemini-extension.json` files can reference environment\nvariables using either `$VAR_NAME` or `${VAR_NAME}` syntax. These variables will\nbe automatically resolved when the settings are loaded. For example, if you have\nan environment variable `MY_API_TOKEN`, you could use it in `settings.json` like\nthis: `\"apiKey\": \"$MY_API_TOKEN\"`. Additionally, each extension can have its own\n`.env` file in its directory, which will be loaded automatically.\n\n> **Note for Enterprise Users:** For guidance on deploying and managing Gemini\n> CLI in a corporate environment, please see the\n> [Enterprise Configuration](../cli/enterprise.md) documentation.\n\n### The `.gemini` directory in your project\n\nIn addition to a project settings file, a project's `.gemini` directory can\ncontain other project-specific files related to Gemini CLI's operation, such as:\n\n- [Custom sandbox profiles](#sandboxing) (e.g.,\n  `.gemini/sandbox-macos-custom.sb`, `.gemini/sandbox.Dockerfile`).\n\n### Available settings in `settings.json`\n\nSettings are organized into categories. All settings should be placed within\ntheir corresponding top-level category object in your `settings.json` file.\n\n<!-- SETTINGS-AUTOGEN:START -->\n\n#### `general`\n\n- **`general.previewFeatures`** (boolean):\n  - **Description:** Enable preview features (e.g., preview models).\n  - **Default:** `false`\n\n- **`general.preferredEditor`** (string):\n  - **Description:** The preferred editor to open files in.\n  - **Default:** `undefined`\n\n- **`general.vimMode`** (boolean):\n  - **Description:** Enable Vim keybindings\n  - **Default:** `false`\n\n- **`general.disableAutoUpdate`** (boolean):\n  - **Description:** Disable automatic updates\n  - **Default:** `false`\n\n- **`general.disableUpdateNag`** (boolean):\n  - **Description:** Disable update notification prompts.\n  - **Default:** `false`\n\n- **`general.checkpointing.enabled`** (boolean):\n  - **Description:** Enable session checkpointing for recovery\n  - **Default:** `false`\n  - **Requires restart:** Yes\n\n- **`general.enablePromptCompletion`** (boolean):\n  - **Description:** Enable AI-powered prompt completion suggestions while\n    typing.\n  - **Default:** `false`\n  - **Requires restart:** Yes\n\n- **`general.retryFetchErrors`** (boolean):\n  - **Description:** Retry on \"exception TypeError: fetch failed sending\n    request\" errors.\n  - **Default:** `false`\n\n- **`general.debugKeystrokeLogging`** (boolean):\n  - **Description:** Enable debug logging of keystrokes to the console.\n  - **Default:** `false`\n\n- **`general.sessionRetention.enabled`** (boolean):\n  - **Description:** Enable automatic session cleanup\n  - **Default:** `false`\n\n- **`general.sessionRetention.maxAge`** (string):\n  - **Description:** Maximum age of sessions to keep (e.g., \"30d\", \"7d\", \"24h\",\n    \"1w\")\n  - **Default:** `undefined`\n\n- **`general.sessionRetention.maxCount`** (number):\n  - **Description:** Alternative: Maximum number of sessions to keep (most\n    recent)\n  - **Default:** `undefined`\n\n- **`general.sessionRetention.minRetention`** (string):\n  - **Description:** Minimum retention period (safety limit, defaults to \"1d\")\n  - **Default:** `\"1d\"`\n\n#### `output`\n\n- **`output.format`** (enum):\n  - **Description:** The format of the CLI output.\n  - **Default:** `\"text\"`\n  - **Values:** `\"text\"`, `\"json\"`\n\n#### `ui`\n\n- **`ui.theme`** (string):\n  - **Description:** The color theme for the UI. See the CLI themes guide for\n    available options.\n  - **Default:** `undefined`\n\n- **`ui.customThemes`** (object):\n  - **Description:** Custom theme definitions.\n  - **Default:** `{}`\n\n- **`ui.hideWindowTitle`** (boolean):\n  - **Description:** Hide the window title bar\n  - **Default:** `false`\n  - **Requires restart:** Yes\n\n- **`ui.showStatusInTitle`** (boolean):\n  - **Description:** Show Gemini CLI status and thoughts in the terminal window\n    title\n  - **Default:** `false`\n\n- **`ui.hideTips`** (boolean):\n  - **Description:** Hide helpful tips in the UI\n  - **Default:** `false`\n\n- **`ui.hideBanner`** (boolean):\n  - **Description:** Hide the application banner\n  - **Default:** `false`\n\n- **`ui.hideContextSummary`** (boolean):\n  - **Description:** Hide the context summary (GEMINI.md, MCP servers) above the\n    input.\n  - **Default:** `false`\n\n- **`ui.footer.hideCWD`** (boolean):\n  - **Description:** Hide the current working directory path in the footer.\n  - **Default:** `false`\n\n- **`ui.footer.hideSandboxStatus`** (boolean):\n  - **Description:** Hide the sandbox status indicator in the footer.\n  - **Default:** `false`\n\n- **`ui.footer.hideModelInfo`** (boolean):\n  - **Description:** Hide the model name and context usage in the footer.\n  - **Default:** `false`\n\n- **`ui.footer.hideContextPercentage`** (boolean):\n  - **Description:** Hides the context window remaining percentage.\n  - **Default:** `true`\n\n- **`ui.hideFooter`** (boolean):\n  - **Description:** Hide the footer from the UI\n  - **Default:** `false`\n\n- **`ui.showMemoryUsage`** (boolean):\n  - **Description:** Display memory usage information in the UI\n  - **Default:** `false`\n\n- **`ui.showLineNumbers`** (boolean):\n  - **Description:** Show line numbers in the chat.\n  - **Default:** `true`\n\n- **`ui.showCitations`** (boolean):\n  - **Description:** Show citations for generated text in the chat.\n  - **Default:** `false`\n\n- **`ui.showModelInfoInChat`** (boolean):\n  - **Description:** Show the model name in the chat for each model turn.\n  - **Default:** `false`\n\n- **`ui.useFullWidth`** (boolean):\n  - **Description:** Use the entire width of the terminal for output.\n  - **Default:** `true`\n\n- **`ui.useAlternateBuffer`** (boolean):\n  - **Description:** Use an alternate screen buffer for the UI, preserving shell\n    history.\n  - **Default:** `false`\n  - **Requires restart:** Yes\n\n- **`ui.incrementalRendering`** (boolean):\n  - **Description:** Enable incremental rendering for the UI. This option will\n    reduce flickering but may cause rendering artifacts. Only supported when\n    useAlternateBuffer is enabled.\n  - **Default:** `true`\n  - **Requires restart:** Yes\n\n- **`ui.customWittyPhrases`** (array):\n  - **Description:** Custom witty phrases to display during loading. When\n    provided, the CLI cycles through these instead of the defaults.\n  - **Default:** `[]`\n\n- **`ui.accessibility.disableLoadingPhrases`** (boolean):\n  - **Description:** Disable loading phrases for accessibility\n  - **Default:** `false`\n  - **Requires restart:** Yes\n\n- **`ui.accessibility.screenReader`** (boolean):\n  - **Description:** Render output in plain-text to be more screen reader\n    accessible\n  - **Default:** `false`\n  - **Requires restart:** Yes\n\n#### `ide`\n\n- **`ide.enabled`** (boolean):\n  - **Description:** Enable IDE integration mode\n  - **Default:** `false`\n  - **Requires restart:** Yes\n\n- **`ide.hasSeenNudge`** (boolean):\n  - **Description:** Whether the user has seen the IDE integration nudge.\n  - **Default:** `false`\n\n#### `privacy`\n\n- **`privacy.usageStatisticsEnabled`** (boolean):\n  - **Description:** Enable collection of usage statistics\n  - **Default:** `true`\n  - **Requires restart:** Yes\n\n#### `model`\n\n- **`model.name`** (string):\n  - **Description:** The Gemini model to use for conversations.\n  - **Default:** `undefined`\n\n- **`model.maxSessionTurns`** (number):\n  - **Description:** Maximum number of user/model/tool turns to keep in a\n    session. -1 means unlimited.\n  - **Default:** `-1`\n\n- **`model.summarizeToolOutput`** (object):\n  - **Description:** Enables or disables summarization of tool output. Configure\n    per-tool token budgets (for example {\"run_shell_command\": {\"tokenBudget\":\n    2000}}). Currently only the run_shell_command tool supports summarization.\n  - **Default:** `undefined`\n\n- **`model.compressionThreshold`** (number):\n  - **Description:** The fraction of context usage at which to trigger context\n    compression (e.g. 0.2, 0.3).\n  - **Default:** `0.5`\n  - **Requires restart:** Yes\n\n- **`model.skipNextSpeakerCheck`** (boolean):\n  - **Description:** Skip the next speaker check.\n  - **Default:** `true`\n\n#### `modelConfigs`\n\n- **`modelConfigs.aliases`** (object):\n  - **Description:** Named presets for model configs. Can be used in place of a\n    model name and can inherit from other aliases using an `extends` property.\n  - **Default:**\n\n    ```json\n    {\n      \"base\": {\n        \"modelConfig\": {\n          \"generateContentConfig\": {\n            \"temperature\": 0,\n            \"topP\": 1\n          }\n        }\n      },\n      \"chat-base\": {\n        \"extends\": \"base\",\n        \"modelConfig\": {\n          \"generateContentConfig\": {\n            \"thinkingConfig\": {\n              \"includeThoughts\": true\n            },\n            \"temperature\": 1,\n            \"topP\": 0.95,\n            \"topK\": 64\n          }\n        }\n      },\n      \"chat-base-2.5\": {\n        \"extends\": \"chat-base\",\n        \"modelConfig\": {\n          \"generateContentConfig\": {\n            \"thinkingConfig\": {\n              \"thinkingBudget\": 8192\n            }\n          }\n        }\n      },\n      \"chat-base-3\": {\n        \"extends\": \"chat-base\",\n        \"modelConfig\": {\n          \"generateContentConfig\": {\n            \"thinkingConfig\": {\n              \"thinkingLevel\": \"HIGH\"\n            }\n          }\n        }\n      },\n      \"gemini-3-pro-preview\": {\n        \"extends\": \"chat-base-3\",\n        \"modelConfig\": {\n          \"model\": \"gemini-3-pro-preview\"\n        }\n      },\n      \"gemini-2.5-pro\": {\n        \"extends\": \"chat-base-2.5\",\n        \"modelConfig\": {\n          \"model\": \"gemini-2.5-pro\"\n        }\n      },\n      \"gemini-2.5-flash\": {\n        \"extends\": \"chat-base-2.5\",\n        \"modelConfig\": {\n          \"model\": \"gemini-2.5-flash\"\n        }\n      },\n      \"gemini-2.5-flash-lite\": {\n        \"extends\": \"chat-base-2.5\",\n        \"modelConfig\": {\n          \"model\": \"gemini-2.5-flash-lite\"\n        }\n      },\n      \"gemini-2.5-flash-base\": {\n        \"extends\": \"base\",\n        \"modelConfig\": {\n          \"model\": \"gemini-2.5-flash\"\n        }\n      },\n      \"classifier\": {\n        \"extends\": \"base\",\n        \"modelConfig\": {\n          \"model\": \"gemini-2.5-flash-lite\",\n          \"generateContentConfig\": {\n            \"maxOutputTokens\": 1024,\n            \"thinkingConfig\": {\n              \"thinkingBudget\": 512\n            }\n          }\n        }\n      },\n      \"prompt-completion\": {\n        \"extends\": \"base\",\n        \"modelConfig\": {\n          \"model\": \"gemini-2.5-flash-lite\",\n          \"generateContentConfig\": {\n            \"temperature\": 0.3,\n            \"maxOutputTokens\": 16000,\n            \"thinkingConfig\": {\n              \"thinkingBudget\": 0\n            }\n          }\n        }\n      },\n      \"edit-corrector\": {\n        \"extends\": \"base\",\n        \"modelConfig\": {\n          \"model\": \"gemini-2.5-flash-lite\",\n          \"generateContentConfig\": {\n            \"thinkingConfig\": {\n              \"thinkingBudget\": 0\n            }\n          }\n        }\n      },\n      \"summarizer-default\": {\n        \"extends\": \"base\",\n        \"modelConfig\": {\n          \"model\": \"gemini-2.5-flash-lite\",\n          \"generateContentConfig\": {\n            \"maxOutputTokens\": 2000\n          }\n        }\n      },\n      \"summarizer-shell\": {\n        \"extends\": \"base\",\n        \"modelConfig\": {\n          \"model\": \"gemini-2.5-flash-lite\",\n          \"generateContentConfig\": {\n            \"maxOutputTokens\": 2000\n          }\n        }\n      },\n      \"web-search\": {\n        \"extends\": \"gemini-2.5-flash-base\",\n        \"modelConfig\": {\n          \"generateContentConfig\": {\n            \"tools\": [\n              {\n                \"googleSearch\": {}\n              }\n            ]\n          }\n        }\n      },\n      \"web-fetch\": {\n        \"extends\": \"gemini-2.5-flash-base\",\n        \"modelConfig\": {\n          \"generateContentConfig\": {\n            \"tools\": [\n              {\n                \"urlContext\": {}\n              }\n            ]\n          }\n        }\n      },\n      \"web-fetch-fallback\": {\n        \"extends\": \"gemini-2.5-flash-base\",\n        \"modelConfig\": {}\n      },\n      \"loop-detection\": {\n        \"extends\": \"gemini-2.5-flash-base\",\n        \"modelConfig\": {}\n      },\n      \"loop-detection-double-check\": {\n        \"extends\": \"base\",\n        \"modelConfig\": {\n          \"model\": \"gemini-2.5-pro\"\n        }\n      },\n      \"llm-edit-fixer\": {\n        \"extends\": \"gemini-2.5-flash-base\",\n        \"modelConfig\": {}\n      },\n      \"next-speaker-checker\": {\n        \"extends\": \"gemini-2.5-flash-base\",\n        \"modelConfig\": {}\n      },\n      \"chat-compression-3-pro\": {\n        \"modelConfig\": {\n          \"model\": \"gemini-3-pro-preview\"\n        }\n      },\n      \"chat-compression-2.5-pro\": {\n        \"modelConfig\": {\n          \"model\": \"gemini-2.5-pro\"\n        }\n      },\n      \"chat-compression-2.5-flash\": {\n        \"modelConfig\": {\n          \"model\": \"gemini-2.5-flash\"\n        }\n      },\n      \"chat-compression-2.5-flash-lite\": {\n        \"modelConfig\": {\n          \"model\": \"gemini-2.5-flash-lite\"\n        }\n      },\n      \"chat-compression-default\": {\n        \"modelConfig\": {\n          \"model\": \"gemini-2.5-pro\"\n        }\n      }\n    }\n    ```\n\n- **`modelConfigs.customAliases`** (object):\n  - **Description:** Custom named presets for model configs. These are merged\n    with (and override) the built-in aliases.\n  - **Default:** `{}`\n\n- **`modelConfigs.customOverrides`** (array):\n  - **Description:** Custom model config overrides. These are merged with (and\n    added to) the built-in overrides.\n  - **Default:** `[]`\n\n- **`modelConfigs.overrides`** (array):\n  - **Description:** Apply specific configuration overrides based on matches,\n    with a primary key of model (or alias). The most specific match will be\n    used.\n  - **Default:** `[]`\n\n#### `context`\n\n- **`context.fileName`** (string | string[]):\n  - **Description:** The name of the context file or files to load into memory.\n    Accepts either a single string or an array of strings.\n  - **Default:** `undefined`\n\n- **`context.importFormat`** (string):\n  - **Description:** The format to use when importing memory.\n  - **Default:** `undefined`\n\n- **`context.discoveryMaxDirs`** (number):\n  - **Description:** Maximum number of directories to search for memory.\n  - **Default:** `200`\n\n- **`context.includeDirectories`** (array):\n  - **Description:** Additional directories to include in the workspace context.\n    Missing directories will be skipped with a warning.\n  - **Default:** `[]`\n\n- **`context.loadMemoryFromIncludeDirectories`** (boolean):\n  - **Description:** Controls how /memory refresh loads GEMINI.md files. When\n    true, include directories are scanned; when false, only the current\n    directory is used.\n  - **Default:** `false`\n\n- **`context.fileFiltering.respectGitIgnore`** (boolean):\n  - **Description:** Respect .gitignore files when searching\n  - **Default:** `true`\n  - **Requires restart:** Yes\n\n- **`context.fileFiltering.respectGeminiIgnore`** (boolean):\n  - **Description:** Respect .geminiignore files when searching\n  - **Default:** `true`\n  - **Requires restart:** Yes\n\n- **`context.fileFiltering.enableRecursiveFileSearch`** (boolean):\n  - **Description:** Enable recursive file search functionality when completing\n    @ references in the prompt.\n  - **Default:** `true`\n  - **Requires restart:** Yes\n\n- **`context.fileFiltering.disableFuzzySearch`** (boolean):\n  - **Description:** Disable fuzzy search when searching for files.\n  - **Default:** `false`\n  - **Requires restart:** Yes\n\n#### `tools`\n\n- **`tools.sandbox`** (boolean | string):\n  - **Description:** Sandbox execution environment. Set to a boolean to enable\n    or disable the sandbox, or provide a string path to a sandbox profile.\n  - **Default:** `undefined`\n  - **Requires restart:** Yes\n\n- **`tools.shell.enableInteractiveShell`** (boolean):\n  - **Description:** Use node-pty for an interactive shell experience. Fallback\n    to child_process still applies.\n  - **Default:** `true`\n  - **Requires restart:** Yes\n\n- **`tools.shell.pager`** (string):\n  - **Description:** The pager command to use for shell output. Defaults to\n    `cat`.\n  - **Default:** `\"cat\"`\n\n- **`tools.shell.showColor`** (boolean):\n  - **Description:** Show color in shell output.\n  - **Default:** `false`\n\n- **`tools.shell.inactivityTimeout`** (number):\n  - **Description:** The maximum time in seconds allowed without output from the\n    shell command. Defaults to 5 minutes.\n  - **Default:** `300`\n\n- **`tools.autoAccept`** (boolean):\n  - **Description:** Automatically accept and execute tool calls that are\n    considered safe (e.g., read-only operations).\n  - **Default:** `false`\n\n- **`tools.core`** (array):\n  - **Description:** Restrict the set of built-in tools with an allowlist. Match\n    semantics mirror tools.allowed; see the built-in tools documentation for\n    available names.\n  - **Default:** `undefined`\n  - **Requires restart:** Yes\n\n- **`tools.allowed`** (array):\n  - **Description:** Tool names that bypass the confirmation dialog. Useful for\n    trusted commands (for example [\"run_shell_command(git)\",\n    \"run_shell_command(npm test)\"]). See shell tool command restrictions for\n    matching details.\n  - **Default:** `undefined`\n  - **Requires restart:** Yes\n\n- **`tools.exclude`** (array):\n  - **Description:** Tool names to exclude from discovery.\n  - **Default:** `undefined`\n  - **Requires restart:** Yes\n\n- **`tools.discoveryCommand`** (string):\n  - **Description:** Command to run for tool discovery.\n  - **Default:** `undefined`\n  - **Requires restart:** Yes\n\n- **`tools.callCommand`** (string):\n  - **Description:** Defines a custom shell command for invoking discovered\n    tools. The command must take the tool name as the first argument, read JSON\n    arguments from stdin, and emit JSON results on stdout.\n  - **Default:** `undefined`\n  - **Requires restart:** Yes\n\n- **`tools.useRipgrep`** (boolean):\n  - **Description:** Use ripgrep for file content search instead of the fallback\n    implementation. Provides faster search performance.\n  - **Default:** `true`\n\n- **`tools.enableToolOutputTruncation`** (boolean):\n  - **Description:** Enable truncation of large tool outputs.\n  - **Default:** `true`\n  - **Requires restart:** Yes\n\n- **`tools.truncateToolOutputThreshold`** (number):\n  - **Description:** Truncate tool output if it is larger than this many\n    characters. Set to -1 to disable.\n  - **Default:** `4000000`\n  - **Requires restart:** Yes\n\n- **`tools.truncateToolOutputLines`** (number):\n  - **Description:** The number of lines to keep when truncating tool output.\n  - **Default:** `1000`\n  - **Requires restart:** Yes\n\n- **`tools.enableMessageBusIntegration`** (boolean):\n  - **Description:** Enable policy-based tool confirmation via message bus\n    integration. When enabled, tools automatically respect policy engine\n    decisions (ALLOW/DENY/ASK_USER) without requiring individual tool\n    implementations.\n  - **Default:** `true`\n  - **Requires restart:** Yes\n\n- **`tools.enableHooks`** (boolean):\n  - **Description:** Enable the hooks system for intercepting and customizing\n    Gemini CLI behavior. When enabled, hooks configured in settings will execute\n    at appropriate lifecycle events (BeforeTool, AfterTool, BeforeModel, etc.).\n    Requires MessageBus integration.\n  - **Default:** `false`\n  - **Requires restart:** Yes\n\n#### `mcp`\n\n- **`mcp.serverCommand`** (string):\n  - **Description:** Command to start an MCP server.\n  - **Default:** `undefined`\n  - **Requires restart:** Yes\n\n- **`mcp.allowed`** (array):\n  - **Description:** A list of MCP servers to allow.\n  - **Default:** `undefined`\n  - **Requires restart:** Yes\n\n- **`mcp.excluded`** (array):\n  - **Description:** A list of MCP servers to exclude.\n  - **Default:** `undefined`\n  - **Requires restart:** Yes\n\n#### `useSmartEdit`\n\n- **`useSmartEdit`** (boolean):\n  - **Description:** Enable the smart-edit tool instead of the replace tool.\n  - **Default:** `true`\n\n#### `useWriteTodos`\n\n- **`useWriteTodos`** (boolean):\n  - **Description:** Enable the write_todos tool.\n  - **Default:** `true`\n\n#### `security`\n\n- **`security.disableYoloMode`** (boolean):\n  - **Description:** Disable YOLO mode, even if enabled by a flag.\n  - **Default:** `false`\n  - **Requires restart:** Yes\n\n- **`security.blockGitExtensions`** (boolean):\n  - **Description:** Blocks installing and loading extensions from Git.\n  - **Default:** `false`\n  - **Requires restart:** Yes\n\n- **`security.folderTrust.enabled`** (boolean):\n  - **Description:** Setting to track whether Folder trust is enabled.\n  - **Default:** `false`\n  - **Requires restart:** Yes\n\n- **`security.auth.selectedType`** (string):\n  - **Description:** The currently selected authentication type.\n  - **Default:** `undefined`\n  - **Requires restart:** Yes\n\n- **`security.auth.enforcedType`** (string):\n  - **Description:** The required auth type. If this does not match the selected\n    auth type, the user will be prompted to re-authenticate.\n  - **Default:** `undefined`\n  - **Requires restart:** Yes\n\n- **`security.auth.useExternal`** (boolean):\n  - **Description:** Whether to use an external authentication flow.\n  - **Default:** `undefined`\n  - **Requires restart:** Yes\n\n#### `advanced`\n\n- **`advanced.autoConfigureMemory`** (boolean):\n  - **Description:** Automatically configure Node.js memory limits\n  - **Default:** `false`\n  - **Requires restart:** Yes\n\n- **`advanced.dnsResolutionOrder`** (string):\n  - **Description:** The DNS resolution order.\n  - **Default:** `undefined`\n  - **Requires restart:** Yes\n\n- **`advanced.excludedEnvVars`** (array):\n  - **Description:** Environment variables to exclude from project context.\n  - **Default:**\n\n    ```json\n    [\"DEBUG\", \"DEBUG_MODE\"]\n    ```\n\n- **`advanced.bugCommand`** (object):\n  - **Description:** Configuration for the bug report command.\n  - **Default:** `undefined`\n\n#### `experimental`\n\n- **`experimental.enableAgents`** (boolean):\n  - **Description:** Enable local and remote subagents.\n  - **Default:** `false`\n  - **Requires restart:** Yes\n\n- **`experimental.extensionManagement`** (boolean):\n  - **Description:** Enable extension management features.\n  - **Default:** `true`\n  - **Requires restart:** Yes\n\n- **`experimental.extensionReloading`** (boolean):\n  - **Description:** Enables extension loading/unloading within the CLI session.\n  - **Default:** `false`\n  - **Requires restart:** Yes\n\n- **`experimental.isModelAvailabilityServiceEnabled`** (boolean):\n  - **Description:** Enable model routing using new availability service.\n  - **Default:** `false`\n  - **Requires restart:** Yes\n\n- **`experimental.jitContext`** (boolean):\n  - **Description:** Enable Just-In-Time (JIT) context loading.\n  - **Default:** `false`\n  - **Requires restart:** Yes\n\n- **`experimental.codebaseInvestigatorSettings.enabled`** (boolean):\n  - **Description:** Enable the Codebase Investigator agent.\n  - **Default:** `true`\n  - **Requires restart:** Yes\n\n- **`experimental.codebaseInvestigatorSettings.maxNumTurns`** (number):\n  - **Description:** Maximum number of turns for the Codebase Investigator\n    agent.\n  - **Default:** `10`\n  - **Requires restart:** Yes\n\n- **`experimental.codebaseInvestigatorSettings.maxTimeMinutes`** (number):\n  - **Description:** Maximum time for the Codebase Investigator agent (in\n    minutes).\n  - **Default:** `3`\n  - **Requires restart:** Yes\n\n- **`experimental.codebaseInvestigatorSettings.thinkingBudget`** (number):\n  - **Description:** The thinking budget for the Codebase Investigator agent.\n  - **Default:** `8192`\n  - **Requires restart:** Yes\n\n- **`experimental.codebaseInvestigatorSettings.model`** (string):\n  - **Description:** The model to use for the Codebase Investigator agent.\n  - **Default:** `\"pro\"`\n  - **Requires restart:** Yes\n\n#### `hooks`\n\n- **`hooks.disabled`** (array):\n  - **Description:** List of hook names (commands) that should be disabled.\n    Hooks in this list will not execute even if configured.\n  - **Default:** `[]`\n\n- **`hooks.BeforeTool`** (array):\n  - **Description:** Hooks that execute before tool execution. Can intercept,\n    validate, or modify tool calls.\n  - **Default:** `[]`\n\n- **`hooks.AfterTool`** (array):\n  - **Description:** Hooks that execute after tool execution. Can process\n    results, log outputs, or trigger follow-up actions.\n  - **Default:** `[]`\n\n- **`hooks.BeforeAgent`** (array):\n  - **Description:** Hooks that execute before agent loop starts. Can set up\n    context or initialize resources.\n  - **Default:** `[]`\n\n- **`hooks.AfterAgent`** (array):\n  - **Description:** Hooks that execute after agent loop completes. Can perform\n    cleanup or summarize results.\n  - **Default:** `[]`\n\n- **`hooks.Notification`** (array):\n  - **Description:** Hooks that execute on notification events (errors,\n    warnings, info). Can log or alert on specific conditions.\n  - **Default:** `[]`\n\n- **`hooks.SessionStart`** (array):\n  - **Description:** Hooks that execute when a session starts. Can initialize\n    session-specific resources or state.\n  - **Default:** `[]`\n\n- **`hooks.SessionEnd`** (array):\n  - **Description:** Hooks that execute when a session ends. Can perform cleanup\n    or persist session data.\n  - **Default:** `[]`\n\n- **`hooks.PreCompress`** (array):\n  - **Description:** Hooks that execute before chat history compression. Can\n    back up or analyze conversation before compression.\n  - **Default:** `[]`\n\n- **`hooks.BeforeModel`** (array):\n  - **Description:** Hooks that execute before LLM requests. Can modify prompts,\n    inject context, or control model parameters.\n  - **Default:** `[]`\n\n- **`hooks.AfterModel`** (array):\n  - **Description:** Hooks that execute after LLM responses. Can process\n    outputs, extract information, or log interactions.\n  - **Default:** `[]`\n\n- **`hooks.BeforeToolSelection`** (array):\n  - **Description:** Hooks that execute before tool selection. Can filter or\n    prioritize available tools dynamically.\n  - **Default:** `[]`\n  <!-- SETTINGS-AUTOGEN:END -->\n\n#### `mcpServers`\n\nConfigures connections to one or more Model-Context Protocol (MCP) servers for\ndiscovering and using custom tools. Gemini CLI attempts to connect to each\nconfigured MCP server to discover available tools. If multiple MCP servers\nexpose a tool with the same name, the tool names will be prefixed with the\nserver alias you defined in the configuration (e.g.,\n`serverAlias__actualToolName`) to avoid conflicts. Note that the system might\nstrip certain schema properties from MCP tool definitions for compatibility. At\nleast one of `command`, `url`, or `httpUrl` must be provided. If multiple are\nspecified, the order of precedence is `httpUrl`, then `url`, then `command`.\n\n- **`mcpServers.<SERVER_NAME>`** (object): The server parameters for the named\n  server.\n  - `command` (string, optional): The command to execute to start the MCP server\n    via standard I/O.\n  - `args` (array of strings, optional): Arguments to pass to the command.\n  - `env` (object, optional): Environment variables to set for the server\n    process.\n  - `cwd` (string, optional): The working directory in which to start the\n    server.\n  - `url` (string, optional): The URL of an MCP server that uses Server-Sent\n    Events (SSE) for communication.\n  - `httpUrl` (string, optional): The URL of an MCP server that uses streamable\n    HTTP for communication.\n  - `headers` (object, optional): A map of HTTP headers to send with requests to\n    `url` or `httpUrl`.\n  - `timeout` (number, optional): Timeout in milliseconds for requests to this\n    MCP server.\n  - `trust` (boolean, optional): Trust this server and bypass all tool call\n    confirmations.\n  - `description` (string, optional): A brief description of the server, which\n    may be used for display purposes.\n  - `includeTools` (array of strings, optional): List of tool names to include\n    from this MCP server. When specified, only the tools listed here will be\n    available from this server (allowlist behavior). If not specified, all tools\n    from the server are enabled by default.\n  - `excludeTools` (array of strings, optional): List of tool names to exclude\n    from this MCP server. Tools listed here will not be available to the model,\n    even if they are exposed by the server. **Note:** `excludeTools` takes\n    precedence over `includeTools` - if a tool is in both lists, it will be\n    excluded.\n\n#### `telemetry`\n\nConfigures logging and metrics collection for Gemini CLI. For more information,\nsee [Telemetry](../cli/telemetry.md).\n\n- **Properties:**\n  - **`enabled`** (boolean): Whether or not telemetry is enabled.\n  - **`target`** (string): The destination for collected telemetry. Supported\n    values are `local` and `gcp`.\n  - **`otlpEndpoint`** (string): The endpoint for the OTLP Exporter.\n  - **`otlpProtocol`** (string): The protocol for the OTLP Exporter (`grpc` or\n    `http`).\n  - **`logPrompts`** (boolean): Whether or not to include the content of user\n    prompts in the logs.\n  - **`outfile`** (string): The file to write telemetry to when `target` is\n    `local`.\n  - **`useCollector`** (boolean): Whether to use an external OTLP collector.\n\n### Example `settings.json`\n\nHere is an example of a `settings.json` file with the nested structure, new as\nof v0.3.0:\n\n```json\n{\n  \"general\": {\n    \"vimMode\": true,\n    \"preferredEditor\": \"code\",\n    \"sessionRetention\": {\n      \"enabled\": true,\n      \"maxAge\": \"30d\",\n      \"maxCount\": 100\n    }\n  },\n  \"ui\": {\n    \"theme\": \"GitHub\",\n    \"hideBanner\": true,\n    \"hideTips\": false,\n    \"customWittyPhrases\": [\n      \"You forget a thousand things every day. Make sure this is one of ‚Äôem\",\n      \"Connecting to AGI\"\n    ]\n  },\n  \"tools\": {\n    \"sandbox\": \"docker\",\n    \"discoveryCommand\": \"bin/get_tools\",\n    \"callCommand\": \"bin/call_tool\",\n    \"exclude\": [\"write_file\"]\n  },\n  \"mcpServers\": {\n    \"mainServer\": {\n      \"command\": \"bin/mcp_server.py\"\n    },\n    \"anotherServer\": {\n      \"command\": \"node\",\n      \"args\": [\"mcp_server.js\", \"--verbose\"]\n    }\n  },\n  \"telemetry\": {\n    \"enabled\": true,\n    \"target\": \"local\",\n    \"otlpEndpoint\": \"http://localhost:4317\",\n    \"logPrompts\": true\n  },\n  \"privacy\": {\n    \"usageStatisticsEnabled\": true\n  },\n  \"model\": {\n    \"name\": \"gemini-1.5-pro-latest\",\n    \"maxSessionTurns\": 10,\n    \"summarizeToolOutput\": {\n      \"run_shell_command\": {\n        \"tokenBudget\": 100\n      }\n    }\n  },\n  \"context\": {\n    \"fileName\": [\"CONTEXT.md\", \"GEMINI.md\"],\n    \"includeDirectories\": [\"path/to/dir1\", \"~/path/to/dir2\", \"../path/to/dir3\"],\n    \"loadFromIncludeDirectories\": true,\n    \"fileFiltering\": {\n      \"respectGitIgnore\": false\n    }\n  },\n  \"advanced\": {\n    \"excludedEnvVars\": [\"DEBUG\", \"DEBUG_MODE\", \"NODE_ENV\"]\n  }\n}\n```\n\n## Shell history\n\nThe CLI keeps a history of shell commands you run. To avoid conflicts between\ndifferent projects, this history is stored in a project-specific directory\nwithin your user's home folder.\n\n- **Location:** `~/.gemini/tmp/<project_hash>/shell_history`\n  - `<project_hash>` is a unique identifier generated from your project's root\n    path.\n  - The history is stored in a file named `shell_history`.\n\n## Environment variables and `.env` files\n\nEnvironment variables are a common way to configure applications, especially for\nsensitive information like API keys or for settings that might change between\nenvironments. For authentication setup, see the\n[Authentication documentation](./authentication.md) which covers all available\nauthentication methods.\n\nThe CLI automatically loads environment variables from an `.env` file. The\nloading order is:\n\n1.  `.env` file in the current working directory.\n2.  If not found, it searches upwards in parent directories until it finds an\n    `.env` file or reaches the project root (identified by a `.git` folder) or\n    the home directory.\n3.  If still not found, it looks for `~/.env` (in the user's home directory).\n\n**Environment variable exclusion:** Some environment variables (like `DEBUG` and\n`DEBUG_MODE`) are automatically excluded from being loaded from project `.env`\nfiles to prevent interference with gemini-cli behavior. Variables from\n`.gemini/.env` files are never excluded. You can customize this behavior using\nthe `advanced.excludedEnvVars` setting in your `settings.json` file.\n\n- **`GEMINI_API_KEY`**:\n  - Your API key for the Gemini API.\n  - One of several available [authentication methods](./authentication.md).\n  - Set this in your shell profile (e.g., `~/.bashrc`, `~/.zshrc`) or an `.env`\n    file.\n- **`GEMINI_MODEL`**:\n  - Specifies the default Gemini model to use.\n  - Overrides the hardcoded default\n  - Example: `export GEMINI_MODEL=\"gemini-2.5-flash\"`\n- **`GOOGLE_API_KEY`**:\n  - Your Google Cloud API key.\n  - Required for using Vertex AI in express mode.\n  - Ensure you have the necessary permissions.\n  - Example: `export GOOGLE_API_KEY=\"YOUR_GOOGLE_API_KEY\"`.\n- **`GOOGLE_CLOUD_PROJECT`**:\n  - Your Google Cloud Project ID.\n  - Required for using Code Assist or Vertex AI.\n  - If using Vertex AI, ensure you have the necessary permissions in this\n    project.\n  - **Cloud Shell note:** When running in a Cloud Shell environment, this\n    variable defaults to a special project allocated for Cloud Shell users. If\n    you have `GOOGLE_CLOUD_PROJECT` set in your global environment in Cloud\n    Shell, it will be overridden by this default. To use a different project in\n    Cloud Shell, you must define `GOOGLE_CLOUD_PROJECT` in a `.env` file.\n  - Example: `export GOOGLE_CLOUD_PROJECT=\"YOUR_PROJECT_ID\"`.\n- **`GOOGLE_APPLICATION_CREDENTIALS`** (string):\n  - **Description:** The path to your Google Application Credentials JSON file.\n  - **Example:**\n    `export GOOGLE_APPLICATION_CREDENTIALS=\"/path/to/your/credentials.json\"`\n- **`OTLP_GOOGLE_CLOUD_PROJECT`**:\n  - Your Google Cloud Project ID for Telemetry in Google Cloud\n  - Example: `export OTLP_GOOGLE_CLOUD_PROJECT=\"YOUR_PROJECT_ID\"`.\n- **`GEMINI_TELEMETRY_ENABLED`**:\n  - Set to `true` or `1` to enable telemetry. Any other value is treated as\n    disabling it.\n  - Overrides the `telemetry.enabled` setting.\n- **`GEMINI_TELEMETRY_TARGET`**:\n  - Sets the telemetry target (`local` or `gcp`).\n  - Overrides the `telemetry.target` setting.\n- **`GEMINI_TELEMETRY_OTLP_ENDPOINT`**:\n  - Sets the OTLP endpoint for telemetry.\n  - Overrides the `telemetry.otlpEndpoint` setting.\n- **`GEMINI_TELEMETRY_OTLP_PROTOCOL`**:\n  - Sets the OTLP protocol (`grpc` or `http`).\n  - Overrides the `telemetry.otlpProtocol` setting.\n- **`GEMINI_TELEMETRY_LOG_PROMPTS`**:\n  - Set to `true` or `1` to enable or disable logging of user prompts. Any other\n    value is treated as disabling it.\n  - Overrides the `telemetry.logPrompts` setting.\n- **`GEMINI_TELEMETRY_OUTFILE`**:\n  - Sets the file path to write telemetry to when the target is `local`.\n  - Overrides the `telemetry.outfile` setting.\n- **`GEMINI_TELEMETRY_USE_COLLECTOR`**:\n  - Set to `true` or `1` to enable or disable using an external OTLP collector.\n    Any other value is treated as disabling it.\n  - Overrides the `telemetry.useCollector` setting.\n- **`GOOGLE_CLOUD_LOCATION`**:\n  - Your Google Cloud Project Location (e.g., us-central1).\n  - Required for using Vertex AI in non-express mode.\n  - Example: `export GOOGLE_CLOUD_LOCATION=\"YOUR_PROJECT_LOCATION\"`.\n- **`GEMINI_SANDBOX`**:\n  - Alternative to the `sandbox` setting in `settings.json`.\n  - Accepts `true`, `false`, `docker`, `podman`, or a custom command string.\n- **`SEATBELT_PROFILE`** (macOS specific):\n  - Switches the Seatbelt (`sandbox-exec`) profile on macOS.\n  - `permissive-open`: (Default) Restricts writes to the project folder (and a\n    few other folders, see\n    `packages/cli/src/utils/sandbox-macos-permissive-open.sb`) but allows other\n    operations.\n  - `strict`: Uses a strict profile that declines operations by default.\n  - `<profile_name>`: Uses a custom profile. To define a custom profile, create\n    a file named `sandbox-macos-<profile_name>.sb` in your project's `.gemini/`\n    directory (e.g., `my-project/.gemini/sandbox-macos-custom.sb`).\n- **`DEBUG` or `DEBUG_MODE`** (often used by underlying libraries or the CLI\n  itself):\n  - Set to `true` or `1` to enable verbose debug logging, which can be helpful\n    for troubleshooting.\n  - **Note:** These variables are automatically excluded from project `.env`\n    files by default to prevent interference with gemini-cli behavior. Use\n    `.gemini/.env` files if you need to set these for gemini-cli specifically.\n- **`NO_COLOR`**:\n  - Set to any value to disable all color output in the CLI.\n- **`CLI_TITLE`**:\n  - Set to a string to customize the title of the CLI.\n- **`CODE_ASSIST_ENDPOINT`**:\n  - Specifies the endpoint for the code assist server.\n  - This is useful for development and testing.\n\n## Command-line arguments\n\nArguments passed directly when running the CLI can override other configurations\nfor that specific session.\n\n- **`--model <model_name>`** (**`-m <model_name>`**):\n  - Specifies the Gemini model to use for this session.\n  - Example: `npm start -- --model gemini-1.5-pro-latest`\n- **`--prompt <your_prompt>`** (**`-p <your_prompt>`**):\n  - Used to pass a prompt directly to the command. This invokes Gemini CLI in a\n    non-interactive mode.\n  - For scripting examples, use the `--output-format json` flag to get\n    structured output.\n- **`--prompt-interactive <your_prompt>`** (**`-i <your_prompt>`**):\n  - Starts an interactive session with the provided prompt as the initial input.\n  - The prompt is processed within the interactive session, not before it.\n  - Cannot be used when piping input from stdin.\n  - Example: `gemini -i \"explain this code\"`\n- **`--output-format <format>`**:\n  - **Description:** Specifies the format of the CLI output for non-interactive\n    mode.\n  - **Values:**\n    - `text`: (Default) The standard human-readable output.\n    - `json`: A machine-readable JSON output.\n    - `stream-json`: A streaming JSON output that emits real-time events.\n  - **Note:** For structured output and scripting, use the\n    `--output-format json` or `--output-format stream-json` flag.\n- **`--sandbox`** (**`-s`**):\n  - Enables sandbox mode for this session.\n- **`--debug`** (**`-d`**):\n  - Enables debug mode for this session, providing more verbose output.\n\n- **`--help`** (or **`-h`**):\n  - Displays help information about command-line arguments.\n- **`--yolo`**:\n  - Enables YOLO mode, which automatically approves all tool calls.\n- **`--approval-mode <mode>`**:\n  - Sets the approval mode for tool calls. Available modes:\n    - `default`: Prompt for approval on each tool call (default behavior)\n    - `auto_edit`: Automatically approve edit tools (replace, write_file) while\n      prompting for others\n    - `yolo`: Automatically approve all tool calls (equivalent to `--yolo`)\n  - Cannot be used together with `--yolo`. Use `--approval-mode=yolo` instead of\n    `--yolo` for the new unified approach.\n  - Example: `gemini --approval-mode auto_edit`\n- **`--allowed-tools <tool1,tool2,...>`**:\n  - A comma-separated list of tool names that will bypass the confirmation\n    dialog.\n  - Example: `gemini --allowed-tools \"ShellTool(git status)\"`\n- **`--extensions <extension_name ...>`** (**`-e <extension_name ...>`**):\n  - Specifies a list of extensions to use for the session. If not provided, all\n    available extensions are used.\n  - Use the special term `gemini -e none` to disable all extensions.\n  - Example: `gemini -e my-extension -e my-other-extension`\n- **`--list-extensions`** (**`-l`**):\n  - Lists all available extensions and exits.\n- **`--resume [session_id]`** (**`-r [session_id]`**):\n  - Resume a previous chat session. Use \"latest\" for the most recent session,\n    provide a session index number, or provide a full session UUID.\n  - If no session_id is provided, defaults to \"latest\".\n  - Example: `gemini --resume 5` or `gemini --resume latest` or\n    `gemini --resume a1b2c3d4-e5f6-7890-abcd-ef1234567890` or `gemini --resume`\n  - See [Session Management](../cli/session-management.md) for more details.\n- **`--list-sessions`**:\n  - List all available chat sessions for the current project and exit.\n  - Shows session indices, dates, message counts, and preview of first user\n    message.\n  - Example: `gemini --list-sessions`\n- **`--delete-session <identifier>`**:\n  - Delete a specific chat session by its index number or full session UUID.\n  - Use `--list-sessions` first to see available sessions, their indices, and\n    UUIDs.\n  - Example: `gemini --delete-session 3` or\n    `gemini --delete-session a1b2c3d4-e5f6-7890-abcd-ef1234567890`\n- **`--include-directories <dir1,dir2,...>`**:\n  - Includes additional directories in the workspace for multi-directory\n    support.\n  - Can be specified multiple times or as comma-separated values.\n  - 5 directories can be added at maximum.\n  - Example: `--include-directories /path/to/project1,/path/to/project2` or\n    `--include-directories /path/to/project1 --include-directories /path/to/project2`\n- **`--screen-reader`**:\n  - Enables screen reader mode, which adjusts the TUI for better compatibility\n    with screen readers.\n- **`--version`**:\n  - Displays the version of the CLI.\n- **`--experimental-acp`**:\n  - Starts the agent in ACP mode.\n- **`--allowed-mcp-server-names`**:\n  - Allowed MCP server names.\n- **`--fake-responses`**:\n  - Path to a file with fake model responses for testing.\n- **`--record-responses`**:\n  - Path to a file to record model responses for testing.\n\n## Context files (hierarchical instructional context)\n\nWhile not strictly configuration for the CLI's _behavior_, context files\n(defaulting to `GEMINI.md` but configurable via the `context.fileName` setting)\nare crucial for configuring the _instructional context_ (also referred to as\n\"memory\") provided to the Gemini model. This powerful feature allows you to give\nproject-specific instructions, coding style guides, or any relevant background\ninformation to the AI, making its responses more tailored and accurate to your\nneeds. The CLI includes UI elements, such as an indicator in the footer showing\nthe number of loaded context files, to keep you informed about the active\ncontext.\n\n- **Purpose:** These Markdown files contain instructions, guidelines, or context\n  that you want the Gemini model to be aware of during your interactions. The\n  system is designed to manage this instructional context hierarchically.\n\n### Example context file content (e.g., `GEMINI.md`)\n\nHere's a conceptual example of what a context file at the root of a TypeScript\nproject might contain:\n\n```markdown\n# Project: My Awesome TypeScript Library\n\n## General Instructions:\n\n- When generating new TypeScript code, please follow the existing coding style.\n- Ensure all new functions and classes have JSDoc comments.\n- Prefer functional programming paradigms where appropriate.\n- All code should be compatible with TypeScript 5.0 and Node.js 20+.\n\n## Coding Style:\n\n- Use 2 spaces for indentation.\n- Interface names should be prefixed with `I` (e.g., `IUserService`).\n- Private class members should be prefixed with an underscore (`_`).\n- Always use strict equality (`===` and `!==`).\n\n## Specific Component: `src/api/client.ts`\n\n- This file handles all outbound API requests.\n- When adding new API call functions, ensure they include robust error handling\n  and logging.\n- Use the existing `fetchWithRetry` utility for all GET requests.\n\n## Regarding Dependencies:\n\n- Avoid introducing new external dependencies unless absolutely necessary.\n- If a new dependency is required, please state the reason.\n```\n\nThis example demonstrates how you can provide general project context, specific\ncoding conventions, and even notes about particular files or components. The\nmore relevant and precise your context files are, the better the AI can assist\nyou. Project-specific context files are highly encouraged to establish\nconventions and context.\n\n- **Hierarchical loading and precedence:** The CLI implements a sophisticated\n  hierarchical memory system by loading context files (e.g., `GEMINI.md`) from\n  several locations. Content from files lower in this list (more specific)\n  typically overrides or supplements content from files higher up (more\n  general). The exact concatenation order and final context can be inspected\n  using the `/memory show` command. The typical loading order is:\n  1.  **Global context file:**\n      - Location: `~/.gemini/<configured-context-filename>` (e.g.,\n        `~/.gemini/GEMINI.md` in your user home directory).\n      - Scope: Provides default instructions for all your projects.\n  2.  **Project root and ancestors context files:**\n      - Location: The CLI searches for the configured context file in the\n        current working directory and then in each parent directory up to either\n        the project root (identified by a `.git` folder) or your home directory.\n      - Scope: Provides context relevant to the entire project or a significant\n        portion of it.\n  3.  **Sub-directory context files (contextual/local):**\n      - Location: The CLI also scans for the configured context file in\n        subdirectories _below_ the current working directory (respecting common\n        ignore patterns like `node_modules`, `.git`, etc.). The breadth of this\n        search is limited to 200 directories by default, but can be configured\n        with the `context.discoveryMaxDirs` setting in your `settings.json`\n        file.\n      - Scope: Allows for highly specific instructions relevant to a particular\n        component, module, or subsection of your project.\n- **Concatenation and UI indication:** The contents of all found context files\n  are concatenated (with separators indicating their origin and path) and\n  provided as part of the system prompt to the Gemini model. The CLI footer\n  displays the count of loaded context files, giving you a quick visual cue\n  about the active instructional context.\n- **Importing content:** You can modularize your context files by importing\n  other Markdown files using the `@path/to/file.md` syntax. For more details,\n  see the [Memory Import Processor documentation](../core/memport.md).\n- **Commands for memory management:**\n  - Use `/memory refresh` to force a re-scan and reload of all context files\n    from all configured locations. This updates the AI's instructional context.\n  - Use `/memory show` to display the combined instructional context currently\n    loaded, allowing you to verify the hierarchy and content being used by the\n    AI.\n  - See the [Commands documentation](../cli/commands.md#memory) for full details\n    on the `/memory` command and its sub-commands (`show` and `refresh`).\n\nBy understanding and utilizing these configuration layers and the hierarchical\nnature of context files, you can effectively manage the AI's memory and tailor\nthe Gemini CLI's responses to your specific needs and projects.\n\n## Sandboxing\n\nThe Gemini CLI can execute potentially unsafe operations (like shell commands\nand file modifications) within a sandboxed environment to protect your system.\n\nSandboxing is disabled by default, but you can enable it in a few ways:\n\n- Using `--sandbox` or `-s` flag.\n- Setting `GEMINI_SANDBOX` environment variable.\n- Sandbox is enabled when using `--yolo` or `--approval-mode=yolo` by default.\n\nBy default, it uses a pre-built `gemini-cli-sandbox` Docker image.\n\nFor project-specific sandboxing needs, you can create a custom Dockerfile at\n`.gemini/sandbox.Dockerfile` in your project's root directory. This Dockerfile\ncan be based on the base sandbox image:\n\n```dockerfile\nFROM gemini-cli-sandbox\n\n# Add your custom dependencies or configurations here\n# For example:\n# RUN apt-get update && apt-get install -y some-package\n# COPY ./my-config /app/my-config\n```\n\nWhen `.gemini/sandbox.Dockerfile` exists, you can use `BUILD_SANDBOX`\nenvironment variable when running Gemini CLI to automatically build the custom\nsandbox image:\n\n```bash\nBUILD_SANDBOX=1 gemini -s\n```\n\n## Usage statistics\n\nTo help us improve the Gemini CLI, we collect anonymized usage statistics. This\ndata helps us understand how the CLI is used, identify common issues, and\nprioritize new features.\n\n**What we collect:**\n\n- **Tool calls:** We log the names of the tools that are called, whether they\n  succeed or fail, and how long they take to execute. We do not collect the\n  arguments passed to the tools or any data returned by them.\n- **API requests:** We log the Gemini model used for each request, the duration\n  of the request, and whether it was successful. We do not collect the content\n  of the prompts or responses.\n- **Session information:** We collect information about the configuration of the\n  CLI, such as the enabled tools and the approval mode.\n\n**What we DON'T collect:**\n\n- **Personally identifiable information (PII):** We do not collect any personal\n  information, such as your name, email address, or API keys.\n- **Prompt and response content:** We do not log the content of your prompts or\n  the responses from the Gemini model.\n- **File content:** We do not log the content of any files that are read or\n  written by the CLI.\n\n**How to opt out:**\n\nYou can opt out of usage statistics collection at any time by setting the\n`usageStatisticsEnabled` property to `false` under the `privacy` category in\nyour `settings.json` file:\n\n```json\n{\n  \"privacy\": {\n    \"usageStatisticsEnabled\": false\n  }\n}\n```\n"}
{"source":"github","repo":"gemini-cli","path":"docs/extensions/getting-started-extensions.md","content":"# Getting started with Gemini CLI extensions\n\nThis guide will walk you through creating your first Gemini CLI extension.\nYou'll learn how to set up a new extension, add a custom tool via an MCP server,\ncreate a custom command, and provide context to the model with a `GEMINI.md`\nfile.\n\n## Prerequisites\n\nBefore you start, make sure you have the Gemini CLI installed and a basic\nunderstanding of Node.js and TypeScript.\n\n## Step 1: Create a new extension\n\nThe easiest way to start is by using one of the built-in templates. We'll use\nthe `mcp-server` example as our foundation.\n\nRun the following command to create a new directory called `my-first-extension`\nwith the template files:\n\n```bash\ngemini extensions new my-first-extension mcp-server\n```\n\nThis will create a new directory with the following structure:\n\n```\nmy-first-extension/\n‚îú‚îÄ‚îÄ example.ts\n‚îú‚îÄ‚îÄ gemini-extension.json\n‚îú‚îÄ‚îÄ package.json\n‚îî‚îÄ‚îÄ tsconfig.json\n```\n\n## Step 2: Understand the extension files\n\nLet's look at the key files in your new extension.\n\n### `gemini-extension.json`\n\nThis is the manifest file for your extension. It tells Gemini CLI how to load\nand use your extension.\n\n```json\n{\n  \"name\": \"my-first-extension\",\n  \"version\": \"1.0.0\",\n  \"mcpServers\": {\n    \"nodeServer\": {\n      \"command\": \"node\",\n      \"args\": [\"${extensionPath}${/}dist${/}example.js\"],\n      \"cwd\": \"${extensionPath}\"\n    }\n  }\n}\n```\n\n- `name`: The unique name for your extension.\n- `version`: The version of your extension.\n- `mcpServers`: This section defines one or more Model Context Protocol (MCP)\n  servers. MCP servers are how you can add new tools for the model to use.\n  - `command`, `args`, `cwd`: These fields specify how to start your server.\n    Notice the use of the `${extensionPath}` variable, which Gemini CLI replaces\n    with the absolute path to your extension's installation directory. This\n    allows your extension to work regardless of where it's installed.\n\n### `example.ts`\n\nThis file contains the source code for your MCP server. It's a simple Node.js\nserver that uses the `@modelcontextprotocol/sdk`.\n\n```typescript\n/**\n * @license\n * Copyright 2025 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';\nimport { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';\nimport { z } from 'zod';\n\nconst server = new McpServer({\n  name: 'prompt-server',\n  version: '1.0.0',\n});\n\n// Registers a new tool named 'fetch_posts'\nserver.registerTool(\n  'fetch_posts',\n  {\n    description: 'Fetches a list of posts from a public API.',\n    inputSchema: z.object({}).shape,\n  },\n  async () => {\n    const apiResponse = await fetch(\n      'https://jsonplaceholder.typicode.com/posts',\n    );\n    const posts = await apiResponse.json();\n    const response = { posts: posts.slice(0, 5) };\n    return {\n      content: [\n        {\n          type: 'text',\n          text: JSON.stringify(response),\n        },\n      ],\n    };\n  },\n);\n\n// ... (prompt registration omitted for brevity)\n\nconst transport = new StdioServerTransport();\nawait server.connect(transport);\n```\n\nThis server defines a single tool called `fetch_posts` that fetches data from a\npublic API.\n\n### `package.json` and `tsconfig.json`\n\nThese are standard configuration files for a TypeScript project. The\n`package.json` file defines dependencies and a `build` script, and\n`tsconfig.json` configures the TypeScript compiler.\n\n## Step 3: Build and link your extension\n\nBefore you can use the extension, you need to compile the TypeScript code and\nlink the extension to your Gemini CLI installation for local development.\n\n1.  **Install dependencies:**\n\n    ```bash\n    cd my-first-extension\n    npm install\n    ```\n\n2.  **Build the server:**\n\n    ```bash\n    npm run build\n    ```\n\n    This will compile `example.ts` into `dist/example.js`, which is the file\n    referenced in your `gemini-extension.json`.\n\n3.  **Link the extension:**\n\n    The `link` command creates a symbolic link from the Gemini CLI extensions\n    directory to your development directory. This means any changes you make\n    will be reflected immediately without needing to reinstall.\n\n    ```bash\n    gemini extensions link .\n    ```\n\nNow, restart your Gemini CLI session. The new `fetch_posts` tool will be\navailable. You can test it by asking: \"fetch posts\".\n\n## Step 4: Add a custom command\n\nCustom commands provide a way to create shortcuts for complex prompts. Let's add\na command that searches for a pattern in your code.\n\n1.  Create a `commands` directory and a subdirectory for your command group:\n\n    ```bash\n    mkdir -p commands/fs\n    ```\n\n2.  Create a file named `commands/fs/grep-code.toml`:\n\n    ```toml\n    prompt = \"\"\"\n    Please summarize the findings for the pattern `{{args}}`.\n\n    Search Results:\n    !{grep -r {{args}} .}\n    \"\"\"\n    ```\n\n    This command, `/fs:grep-code`, will take an argument, run the `grep` shell\n    command with it, and pipe the results into a prompt for summarization.\n\nAfter saving the file, restart the Gemini CLI. You can now run\n`/fs:grep-code \"some pattern\"` to use your new command.\n\n## Step 5: Add a custom `GEMINI.md`\n\nYou can provide persistent context to the model by adding a `GEMINI.md` file to\nyour extension. This is useful for giving the model instructions on how to\nbehave or information about your extension's tools. Note that you may not always\nneed this for extensions built to expose commands and prompts.\n\n1.  Create a file named `GEMINI.md` in the root of your extension directory:\n\n    ```markdown\n    # My First Extension Instructions\n\n    You are an expert developer assistant. When the user asks you to fetch\n    posts, use the `fetch_posts` tool. Be concise in your responses.\n    ```\n\n2.  Update your `gemini-extension.json` to tell the CLI to load this file:\n\n    ```json\n    {\n      \"name\": \"my-first-extension\",\n      \"version\": \"1.0.0\",\n      \"contextFileName\": \"GEMINI.md\",\n      \"mcpServers\": {\n        \"nodeServer\": {\n          \"command\": \"node\",\n          \"args\": [\"${extensionPath}${/}dist${/}example.js\"],\n          \"cwd\": \"${extensionPath}\"\n        }\n      }\n    }\n    ```\n\nRestart the CLI again. The model will now have the context from your `GEMINI.md`\nfile in every session where the extension is active.\n\n## Step 6: Releasing your extension\n\nOnce you are happy with your extension, you can share it with others. The two\nprimary ways of releasing extensions are via a Git repository or through GitHub\nReleases. Using a public Git repository is the simplest method.\n\nFor detailed instructions on both methods, please refer to the\n[Extension Releasing Guide](./extension-releasing.md).\n\n## Conclusion\n\nYou've successfully created a Gemini CLI extension! You learned how to:\n\n- Bootstrap a new extension from a template.\n- Add custom tools with an MCP server.\n- Create convenient custom commands.\n- Provide persistent context to the model.\n- Link your extension for local development.\n\nFrom here, you can explore more advanced features and build powerful new\ncapabilities into the Gemini CLI.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/extensions/index.md","content":"# Gemini CLI extensions\n\n_This documentation is up-to-date with the v0.4.0 release._\n\nGemini CLI extensions package prompts, MCP servers, and custom commands into a\nfamiliar and user-friendly format. With extensions, you can expand the\ncapabilities of Gemini CLI and share those capabilities with others. They are\ndesigned to be easily installable and shareable.\n\nTo see examples of extensions, you can browse a gallery of\n[Gemini CLI extensions](https://geminicli.com/extensions/browse/).\n\nSee [getting started docs](getting-started-extensions.md) for a guide on\ncreating your first extension.\n\nSee [releasing docs](extension-releasing.md) for an advanced guide on setting up\nGitHub releases.\n\n## Extension management\n\nWe offer a suite of extension management tools using `gemini extensions`\ncommands.\n\nNote that these commands are not supported from within the CLI, although you can\nlist installed extensions using the `/extensions list` subcommand.\n\nNote that all of these commands will only be reflected in active CLI sessions on\nrestart.\n\n### Installing an extension\n\nYou can install an extension using `gemini extensions install` with either a\nGitHub URL or a local path.\n\nNote that we create a copy of the installed extension, so you will need to run\n`gemini extensions update` to pull in changes from both locally-defined\nextensions and those on GitHub.\n\nNOTE: If you are installing an extension from GitHub, you'll need to have `git`\ninstalled on your machine. See\n[git installation instructions](https://git-scm.com/book/en/v2/Getting-Started-Installing-Git)\nfor help.\n\n```\ngemini extensions install <source> [--ref <ref>] [--auto-update] [--pre-release] [--consent]\n```\n\n- `<source>`: The github URL or local path of the extension to install.\n- `--ref`: The git ref to install from.\n- `--auto-update`: Enable auto-update for this extension.\n- `--pre-release`: Enable pre-release versions for this extension.\n- `--consent`: Acknowledge the security risks of installing an extension and\n  skip the confirmation prompt.\n\n### Uninstalling an extension\n\nTo uninstall one or more extensions, run\n`gemini extensions uninstall <name...>`:\n\n```\ngemini extensions uninstall gemini-cli-security gemini-cli-another-extension\n```\n\n### Disabling an extension\n\nExtensions are, by default, enabled across all workspaces. You can disable an\nextension entirely or for specific workspace.\n\n```\ngemini extensions disable <name> [--scope <scope>]\n```\n\n- `<name>`: The name of the extension to disable.\n- `--scope`: The scope to disable the extension in (`user` or `workspace`).\n\n### Enabling an extension\n\nYou can enable extensions using `gemini extensions enable <name>`. You can also\nenable an extension for a specific workspace using\n`gemini extensions enable <name> --scope=workspace` from within that workspace.\n\n```\ngemini extensions enable <name> [--scope <scope>]\n```\n\n- `<name>`: The name of the extension to enable.\n- `--scope`: The scope to enable the extension in (`user` or `workspace`).\n\n### Updating an extension\n\nFor extensions installed from a local path or a git repository, you can\nexplicitly update to the latest version (as reflected in the\n`gemini-extension.json` `version` field) with `gemini extensions update <name>`.\n\nYou can update all extensions with:\n\n```\ngemini extensions update --all\n```\n\n### Create a boilerplate extension\n\nWe offer several example extensions `context`, `custom-commands`,\n`exclude-tools` and `mcp-server`. You can view these examples\n[here](https://github.com/google-gemini/gemini-cli/tree/main/packages/cli/src/commands/extensions/examples).\n\nTo copy one of these examples into a development directory using the type of\nyour choosing, run:\n\n```\ngemini extensions new <path> [template]\n```\n\n- `<path>`: The path to create the extension in.\n- `[template]`: The boilerplate template to use.\n\n### Link a local extension\n\nThe `gemini extensions link` command will create a symbolic link from the\nextension installation directory to the development path.\n\nThis is useful so you don't have to run `gemini extensions update` every time\nyou make changes you'd like to test.\n\n```\ngemini extensions link <path>\n```\n\n- `<path>`: The path of the extension to link.\n\n## How it works\n\nOn startup, Gemini CLI looks for extensions in `<home>/.gemini/extensions`\n\nExtensions exist as a directory that contains a `gemini-extension.json` file.\nFor example:\n\n`<home>/.gemini/extensions/my-extension/gemini-extension.json`\n\n### `gemini-extension.json`\n\nThe `gemini-extension.json` file contains the configuration for the extension.\nThe file has the following structure:\n\n```json\n{\n  \"name\": \"my-extension\",\n  \"version\": \"1.0.0\",\n  \"mcpServers\": {\n    \"my-server\": {\n      \"command\": \"node my-server.js\"\n    }\n  },\n  \"contextFileName\": \"GEMINI.md\",\n  \"excludeTools\": [\"run_shell_command\"]\n}\n```\n\n- `name`: The name of the extension. This is used to uniquely identify the\n  extension and for conflict resolution when extension commands have the same\n  name as user or project commands. The name should be lowercase or numbers and\n  use dashes instead of underscores or spaces. This is how users will refer to\n  your extension in the CLI. Note that we expect this name to match the\n  extension directory name.\n- `version`: The version of the extension.\n- `mcpServers`: A map of MCP servers to settings. The key is the name of the\n  server, and the value is the server configuration. These servers will be\n  loaded on startup just like MCP servers settingsd in a\n  [`settings.json` file](../get-started/configuration.md). If both an extension\n  and a `settings.json` file settings an MCP server with the same name, the\n  server defined in the `settings.json` file takes precedence.\n  - Note that all MCP server configuration options are supported except for\n    `trust`.\n- `contextFileName`: The name of the file that contains the context for the\n  extension. This will be used to load the context from the extension directory.\n  If this property is not used but a `GEMINI.md` file is present in your\n  extension directory, then that file will be loaded.\n- `excludeTools`: An array of tool names to exclude from the model. You can also\n  specify command-specific restrictions for tools that support it, like the\n  `run_shell_command` tool. For example,\n  `\"excludeTools\": [\"run_shell_command(rm -rf)\"]` will block the `rm -rf`\n  command. Note that this differs from the MCP server `excludeTools`\n  functionality, which can be listed in the MCP server config.\n\nWhen Gemini CLI starts, it loads all the extensions and merges their\nconfigurations. If there are any conflicts, the workspace configuration takes\nprecedence.\n\n### Settings\n\n_Note: This is an experimental feature. We do not yet recommend extension\nauthors introduce settings as part of their core flows._\n\nExtensions can define settings that the user will be prompted to provide upon\ninstallation. This is useful for things like API keys, URLs, or other\nconfiguration that the extension needs to function.\n\nTo define settings, add a `settings` array to your `gemini-extension.json` file.\nEach object in the array should have the following properties:\n\n- `name`: A user-friendly name for the setting.\n- `description`: A description of the setting and what it's used for.\n- `envVar`: The name of the environment variable that the setting will be stored\n  as.\n- `sensitive`: Optional boolean. If true, obfuscates the input the user provides\n  and stores the secret in keychain storage. **Example**\n\n```json\n{\n  \"name\": \"my-api-extension\",\n  \"version\": \"1.0.0\",\n  \"settings\": [\n    {\n      \"name\": \"API Key\",\n      \"description\": \"Your API key for the service.\",\n      \"envVar\": \"MY_API_KEY\"\n    }\n  ]\n}\n```\n\nWhen a user installs this extension, they will be prompted to enter their API\nkey. The value will be saved to a `.env` file in the extension's directory\n(e.g., `<home>/.gemini/extensions/my-api-extension/.env`).\n\nYou can view a list of an extension's settings by running:\n\n```\ngemini extensions settings list <extension name>\n```\n\nand you can update a given setting using:\n\n```\ngemini extensions settings set <extension name> <setting name> [--scope <scope>]\n```\n\n- `--scope`: The scope to set the setting in (`user` or `workspace`). This is\n  optional and will default to `user`.\n\n### Custom commands\n\nExtensions can provide [custom commands](../cli/custom-commands.md) by placing\nTOML files in a `commands/` subdirectory within the extension directory. These\ncommands follow the same format as user and project custom commands and use\nstandard naming conventions.\n\n**Example**\n\nAn extension named `gcp` with the following structure:\n\n```\n.gemini/extensions/gcp/\n‚îú‚îÄ‚îÄ gemini-extension.json\n‚îî‚îÄ‚îÄ commands/\n    ‚îú‚îÄ‚îÄ deploy.toml\n    ‚îî‚îÄ‚îÄ gcs/\n        ‚îî‚îÄ‚îÄ sync.toml\n```\n\nWould provide these commands:\n\n- `/deploy` - Shows as `[gcp] Custom command from deploy.toml` in help\n- `/gcs:sync` - Shows as `[gcp] Custom command from sync.toml` in help\n\n### Conflict resolution\n\nExtension commands have the lowest precedence. When a conflict occurs with user\nor project commands:\n\n1. **No conflict**: Extension command uses its natural name (e.g., `/deploy`)\n2. **With conflict**: Extension command is renamed with the extension prefix\n   (e.g., `/gcp.deploy`)\n\nFor example, if both a user and the `gcp` extension define a `deploy` command:\n\n- `/deploy` - Executes the user's deploy command\n- `/gcp.deploy` - Executes the extension's deploy command (marked with `[gcp]`\n  tag)\n\n## Variables\n\nGemini CLI extensions allow variable substitution in `gemini-extension.json`.\nThis can be useful if e.g., you need the current directory to run an MCP server\nusing `\"cwd\": \"${extensionPath}${/}run.ts\"`.\n\n**Supported variables:**\n\n| variable                   | description                                                                                                                                                     |\n| -------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| `${extensionPath}`         | The fully-qualified path of the extension in the user's filesystem e.g., '/Users/username/.gemini/extensions/example-extension'. This will not unwrap symlinks. |\n| `${workspacePath}`         | The fully-qualified path of the current workspace.                                                                                                              |\n| `${/} or ${pathSeparator}` | The path separator (differs per OS).                                                                                                                            |\n"}
{"source":"github","repo":"gemini-cli","path":"docs/extensions/extension-releasing.md","content":"# Extension releasing\n\nThere are two primary ways of releasing extensions to users:\n\n- [Git repository](#releasing-through-a-git-repository)\n- [Github Releases](#releasing-through-github-releases)\n\nGit repository releases tend to be the simplest and most flexible approach,\nwhile GitHub releases can be more efficient on initial install as they are\nshipped as single archives instead of requiring a git clone which downloads each\nfile individually. Github releases may also contain platform specific archives\nif you need to ship platform specific binary files.\n\n## Releasing through a git repository\n\nThis is the most flexible and simple option. All you need to do is create a\npublicly accessible git repo (such as a public github repository) and then users\ncan install your extension using `gemini extensions install <your-repo-uri>`.\nThey can optionally depend on a specific ref (branch/tag/commit) using the\n`--ref=<some-ref>` argument, this defaults to the default branch.\n\nWhenever commits are pushed to the ref that a user depends on, they will be\nprompted to update the extension. Note that this also allows for easy rollbacks,\nthe HEAD commit is always treated as the latest version regardless of the actual\nversion in the `gemini-extension.json` file.\n\n### Managing release channels using a git repository\n\nUsers can depend on any ref from your git repo, such as a branch or tag, which\nallows you to manage multiple release channels.\n\nFor instance, you can maintain a `stable` branch, which users can install this\nway `gemini extensions install <your-repo-uri> --ref=stable`. Or, you could make\nthis the default by treating your default branch as your stable release branch,\nand doing development in a different branch (for instance called `dev`). You can\nmaintain as many branches or tags as you like, providing maximum flexibility for\nyou and your users.\n\nNote that these `ref` arguments can be tags, branches, or even specific commits,\nwhich allows users to depend on a specific version of your extension. It is up\nto you how you want to manage your tags and branches.\n\n### Example releasing flow using a git repo\n\nWhile there are many options for how you want to manage releases using a git\nflow, we recommend treating your default branch as your \"stable\" release branch.\nThis means that the default behavior for\n`gemini extensions install <your-repo-uri>` is to be on the stable release\nbranch.\n\nLets say you want to maintain three standard release channels, `stable`,\n`preview`, and `dev`. You would do all your standard development in the `dev`\nbranch. When you are ready to do a preview release, you merge that branch into\nyour `preview` branch. When you are ready to promote your preview branch to\nstable, you merge `preview` into your stable branch (which might be your default\nbranch or a different branch).\n\nYou can also cherry pick changes from one branch into another using\n`git cherry-pick`, but do note that this will result in your branches having a\nslightly divergent history from each other, unless you force push changes to\nyour branches on each release to restore the history to a clean slate (which may\nnot be possible for the default branch depending on your repository settings).\nIf you plan on doing cherry picks, you may want to avoid having your default\nbranch be the stable branch to avoid force-pushing to the default branch which\nshould generally be avoided.\n\n## Releasing through GitHub releases\n\nGemini CLI extensions can be distributed through\n[GitHub Releases](https://docs.github.com/en/repositories/releasing-projects-on-github/about-releases).\nThis provides a faster and more reliable initial installation experience for\nusers, as it avoids the need to clone the repository.\n\nEach release includes at least one archive file, which contains the full\ncontents of the repo at the tag that it was linked to. Releases may also include\n[pre-built archives](#custom-pre-built-archives) if your extension requires some\nbuild step or has platform specific binaries attached to it.\n\nWhen checking for updates, gemini will just look for the \"latest\" release on\ngithub (you must mark it as such when creating the release), unless the user\ninstalled a specific release by passing `--ref=<some-release-tag>`.\n\nYou may also install extensions with the `--pre-release` flag in order to get\nthe latest release regardless of whether it has been marked as \"latest\". This\nallows you to test that your release works before actually pushing it to all\nusers.\n\n### Custom pre-built archives\n\nCustom archives must be attached directly to the github release as assets and\nmust be fully self-contained. This means they should include the entire\nextension, see [archive structure](#archive-structure).\n\nIf your extension is platform-independent, you can provide a single generic\nasset. In this case, there should be only one asset attached to the release.\n\nCustom archives may also be used if you want to develop your extension within a\nlarger repository, you can build an archive which has a different layout from\nthe repo itself (for instance it might just be an archive of a subdirectory\ncontaining the extension).\n\n#### Platform specific archives\n\nTo ensure Gemini CLI can automatically find the correct release asset for each\nplatform, you must follow this naming convention. The CLI will search for assets\nin the following order:\n\n1.  **Platform and architecture-Specific:**\n    `{platform}.{arch}.{name}.{extension}`\n2.  **Platform-specific:** `{platform}.{name}.{extension}`\n3.  **Generic:** If only one asset is provided, it will be used as a generic\n    fallback.\n\n- `{name}`: The name of your extension.\n- `{platform}`: The operating system. Supported values are:\n  - `darwin` (macOS)\n  - `linux`\n  - `win32` (Windows)\n- `{arch}`: The architecture. Supported values are:\n  - `x64`\n  - `arm64`\n- `{extension}`: The file extension of the archive (e.g., `.tar.gz` or `.zip`).\n\n**Examples:**\n\n- `darwin.arm64.my-tool.tar.gz` (specific to Apple Silicon Macs)\n- `darwin.my-tool.tar.gz` (for all Macs)\n- `linux.x64.my-tool.tar.gz`\n- `win32.my-tool.zip`\n\n#### Archive structure\n\nArchives must be fully contained extensions and have all the standard\nrequirements - specifically the `gemini-extension.json` file must be at the root\nof the archive.\n\nThe rest of the layout should look exactly the same as a typical extension, see\n[extensions.md](./index.md).\n\n#### Example GitHub Actions workflow\n\nHere is an example of a GitHub Actions workflow that builds and releases a\nGemini CLI extension for multiple platforms:\n\n```yaml\nname: Release Extension\n\non:\n  push:\n    tags:\n      - 'v*'\n\njobs:\n  release:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n\n      - name: Set up Node.js\n        uses: actions/setup-node@v3\n        with:\n          node-version: '20'\n\n      - name: Install dependencies\n        run: npm ci\n\n      - name: Build extension\n        run: npm run build\n\n      - name: Create release assets\n        run: |\n          npm run package -- --platform=darwin --arch=arm64\n          npm run package -- --platform=linux --arch=x64\n          npm run package -- --platform=win32 --arch=x64\n\n      - name: Create GitHub Release\n        uses: softprops/action-gh-release@v1\n        with:\n          files: |\n            release/darwin.arm64.my-tool.tar.gz\n            release/linux.arm64.my-tool.tar.gz\n            release/win32.arm64.my-tool.zip\n```\n"}
{"source":"github","repo":"gemini-cli","path":"docs/quota-and-pricing.md","content":"# Gemini CLI: Quotas and pricing\n\nGemini CLI offers a generous free tier that covers many individual developers'\nuse cases. For enterprise or professional usage, or if you need higher limits,\nseveral options are available depending on your authentication account type.\n\nSee [privacy and terms](./tos-privacy.md) for details on the Privacy Policy and\nTerms of Service.\n\n> **Note:** Published prices are list price; additional negotiated commercial\n> discounting may apply.\n\nThis article outlines the specific quotas and pricing applicable to Gemini CLI\nwhen using different authentication methods.\n\nGenerally, there are three categories to choose from:\n\n- Free Usage: Ideal for experimentation and light use.\n- Paid Tier (fixed price): For individual developers or enterprises who need\n  more generous daily quotas and predictable costs.\n- Pay-As-You-Go: The most flexible option for professional use, long-running\n  tasks, or when you need full control over your usage.\n\n## Free usage\n\nYour journey begins with a generous free tier, perfect for experimentation and\nlight use.\n\nYour free usage limits depend on your authorization type.\n\n### Log in with Google (Gemini Code Assist for individuals)\n\nFor users who authenticate by using their Google account to access Gemini Code\nAssist for individuals. This includes:\n\n- 1000 model requests / user / day\n- 60 model requests / user / minute\n- Model requests will be made across the Gemini model family as determined by\n  Gemini CLI.\n\nLearn more at\n[Gemini Code Assist for Individuals Limits](https://developers.google.com/gemini-code-assist/resources/quotas#quotas-for-agent-mode-gemini-cli).\n\n### Log in with Gemini API Key (unpaid)\n\nIf you are using a Gemini API key, you can also benefit from a free tier. This\nincludes:\n\n- 250 model requests / user / day\n- 10 model requests / user / minute\n- Model requests to Flash model only.\n\nLearn more at\n[Gemini API Rate Limits](https://ai.google.dev/gemini-api/docs/rate-limits).\n\n### Log in with Vertex AI (Express Mode)\n\nVertex AI offers an Express Mode without the need to enable billing. This\nincludes:\n\n- 90 days before you need to enable billing.\n- Quotas and models are variable and specific to your account.\n\nLearn more at\n[Vertex AI Express Mode Limits](https://cloud.google.com/vertex-ai/generative-ai/docs/start/express-mode/overview#quotas).\n\n## Paid tier: Higher limits for a fixed cost\n\nIf you use up your initial number of requests, you can continue to benefit from\nGemini CLI by upgrading to one of the following subscriptions:\n\n- [Google AI Pro and AI Ultra](https://gemini.google/subscriptions/). This is\n  recommended for individual developers. Quotas and pricing are based on a fixed\n  price subscription.\n\n  For predictable costs, you can log in with Google.\n\n  Learn more at\n  [Gemini Code Assist Quotas and Limits](https://developers.google.com/gemini-code-assist/resources/quotas)\n\n- [Purchase a Gemini Code Assist Subscription through Google Cloud ](https://cloud.google.com/gemini/docs/codeassist/overview)\n  by signing up in the Google Cloud console. Learn more at\n  [Set up Gemini Code Assist](https://cloud.google.com/gemini/docs/discover/set-up-gemini).\n\n  Quotas and pricing are based on a fixed price subscription with assigned\n  license seats. For predictable costs, you can sign in with Google.\n\n  This includes:\n  - Gemini Code Assist Standard edition:\n    - 1500 model requests / user / day\n    - 120 model requests / user / minute\n  - Gemini Code Assist Enterprise edition:\n    - 2000 model requests / user / day\n    - 120 model requests / user / minute\n  - Model requests will be made across the Gemini model family as determined by\n    Gemini CLI.\n\n  [Learn more about Gemini Code Assist Standard and Enterprise license limits](https://developers.google.com/gemini-code-assist/resources/quotas#quotas-for-agent-mode-gemini-cli).\n\n## Pay as you go\n\nIf you hit your daily request limits or exhaust your Gemini Pro quota even after\nupgrading, the most flexible solution is to switch to a pay-as-you-go model,\nwhere you pay for the specific amount of processing you use. This is the\nrecommended path for uninterrupted access.\n\nTo do this, log in using a Gemini API key or Vertex AI.\n\n- Vertex AI (Regular Mode):\n  - Quota: Governed by a dynamic shared quota system or pre-purchased\n    provisioned throughput.\n  - Cost: Based on model and token usage.\n\nLearn more at\n[Vertex AI Dynamic Shared Quota](https://cloud.google.com/vertex-ai/generative-ai/docs/resources/dynamic-shared-quota)\nand [Vertex AI Pricing](https://cloud.google.com/vertex-ai/pricing).\n\n- Gemini API key:\n  - Quota: Varies by pricing tier.\n  - Cost: Varies by pricing tier and model/token usage.\n\nLearn more at\n[Gemini API Rate Limits](https://ai.google.dev/gemini-api/docs/rate-limits),\n[Gemini API Pricing](https://ai.google.dev/gemini-api/docs/pricing)\n\nIt‚Äôs important to highlight that when using an API key, you pay per token/call.\nThis can be more expensive for many small calls with few tokens, but it's the\nonly way to ensure your workflow isn't interrupted by quota limits.\n\n## Gemini for workspace plans\n\nThese plans currently apply only to the use of Gemini web-based products\nprovided by Google-based experiences (for example, the Gemini web app or the\nFlow video editor). These plans do not apply to the API usage which powers the\nGemini CLI. Supporting these plans is under active consideration for future\nsupport.\n\n## Tips to avoid high costs\n\nWhen using a Pay as you Go API key, be mindful of your usage to avoid unexpected\ncosts.\n\n- Don't blindly accept every suggestion, especially for computationally\n  intensive tasks like refactoring large codebases.\n- Be intentional with your prompts and commands. You are paying per call, so\n  think about the most efficient way to get the job done.\n\n## Gemini API vs. Vertex\n\n- Gemini API (gemini developer api): This is the fastest way to use the Gemini\n  models directly.\n- Vertex AI: This is the enterprise-grade platform for building, deploying, and\n  managing Gemini models with specific security and control requirements.\n\n## Understanding your usage\n\nA summary of model usage is available through the `/stats` command and presented\non exit at the end of a session.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/troubleshooting.md","content":"# Troubleshooting guide\n\nThis guide provides solutions to common issues and debugging tips, including\ntopics on:\n\n- Authentication or login errors\n- Frequently asked questions (FAQs)\n- Debugging tips\n- Existing GitHub Issues similar to yours or creating new Issues\n\n## Authentication or login errors\n\n- **Error:\n  `You must be a named user on your organization's Gemini Code Assist Standard edition subscription to use this service. Please contact your administrator to request an entitlement to Gemini Code Assist Standard edition.`**\n  - **Cause:** This error might occur if Gemini CLI detects the\n    `GOOGLE_CLOUD_PROJECT` or `GOOGLE_CLOUD_PROJECT_ID` environment variable is\n    defined. Setting these variables forces an organization subscription check.\n    This might be an issue if you are using an individual Google account not\n    linked to an organizational subscription.\n\n  - **Solution:**\n    - **Individual Users:** Unset the `GOOGLE_CLOUD_PROJECT` and\n      `GOOGLE_CLOUD_PROJECT_ID` environment variables. Check and remove these\n      variables from your shell configuration files (for example, `.bashrc`,\n      `.zshrc`) and any `.env` files. If this doesn't resolve the issue, try\n      using a different Google account.\n\n    - **Organizational Users:** Contact your Google Cloud administrator to be\n      added to your organization's Gemini Code Assist subscription.\n\n- **Error: `Failed to login. Message: Request contains an invalid argument`**\n  - **Cause:** Users with Google Workspace accounts or Google Cloud accounts\n    associated with their Gmail accounts may not be able to activate the free\n    tier of the Google Code Assist plan.\n  - **Solution:** For Google Cloud accounts, you can work around this by setting\n    `GOOGLE_CLOUD_PROJECT` to your project ID. Alternatively, you can obtain the\n    Gemini API key from\n    [Google AI Studio](http://aistudio.google.com/app/apikey), which also\n    includes a separate free tier.\n\n- **Error: `UNABLE_TO_GET_ISSUER_CERT_LOCALLY` or\n  `unable to get local issuer certificate`**\n  - **Cause:** You may be on a corporate network with a firewall that intercepts\n    and inspects SSL/TLS traffic. This often requires a custom root CA\n    certificate to be trusted by Node.js.\n  - **Solution:** Set the `NODE_EXTRA_CA_CERTS` environment variable to the\n    absolute path of your corporate root CA certificate file.\n    - Example: `export NODE_EXTRA_CA_CERTS=/path/to/your/corporate-ca.crt`\n\n## Common error messages and solutions\n\n- **Error: `EADDRINUSE` (Address already in use) when starting an MCP server.**\n  - **Cause:** Another process is already using the port that the MCP server is\n    trying to bind to.\n  - **Solution:** Either stop the other process that is using the port or\n    configure the MCP server to use a different port.\n\n- **Error: Command not found (when attempting to run Gemini CLI with\n  `gemini`).**\n  - **Cause:** Gemini CLI is not correctly installed or it is not in your\n    system's `PATH`.\n  - **Solution:** The update depends on how you installed Gemini CLI:\n    - If you installed `gemini` globally, check that your `npm` global binary\n      directory is in your `PATH`. You can update Gemini CLI using the command\n      `npm install -g @google/gemini-cli@latest`.\n    - If you are running `gemini` from source, ensure you are using the correct\n      command to invoke it (e.g., `node packages/cli/dist/index.js ...`). To\n      update Gemini CLI, pull the latest changes from the repository, and then\n      rebuild using the command `npm run build`.\n\n- **Error: `MODULE_NOT_FOUND` or import errors.**\n  - **Cause:** Dependencies are not installed correctly, or the project hasn't\n    been built.\n  - **Solution:**\n    1.  Run `npm install` to ensure all dependencies are present.\n    2.  Run `npm run build` to compile the project.\n    3.  Verify that the build completed successfully with `npm run start`.\n\n- **Error: \"Operation not permitted\", \"Permission denied\", or similar.**\n  - **Cause:** When sandboxing is enabled, Gemini CLI may attempt operations\n    that are restricted by your sandbox configuration, such as writing outside\n    the project directory or system temp directory.\n  - **Solution:** Refer to the [Configuration: Sandboxing](./cli/sandbox.md)\n    documentation for more information, including how to customize your sandbox\n    configuration.\n\n- **Gemini CLI is not running in interactive mode in \"CI\" environments**\n  - **Issue:** The Gemini CLI does not enter interactive mode (no prompt\n    appears) if an environment variable starting with `CI_` (e.g., `CI_TOKEN`)\n    is set. This is because the `is-in-ci` package, used by the underlying UI\n    framework, detects these variables and assumes a non-interactive CI\n    environment.\n  - **Cause:** The `is-in-ci` package checks for the presence of `CI`,\n    `CONTINUOUS_INTEGRATION`, or any environment variable with a `CI_` prefix.\n    When any of these are found, it signals that the environment is\n    non-interactive, which prevents the Gemini CLI from starting in its\n    interactive mode.\n  - **Solution:** If the `CI_` prefixed variable is not needed for the CLI to\n    function, you can temporarily unset it for the command. e.g.,\n    `env -u CI_TOKEN gemini`\n\n- **DEBUG mode not working from project .env file**\n  - **Issue:** Setting `DEBUG=true` in a project's `.env` file doesn't enable\n    debug mode for gemini-cli.\n  - **Cause:** The `DEBUG` and `DEBUG_MODE` variables are automatically excluded\n    from project `.env` files to prevent interference with gemini-cli behavior.\n  - **Solution:** Use a `.gemini/.env` file instead, or configure the\n    `advanced.excludedEnvVars` setting in your `settings.json` to exclude fewer\n    variables.\n\n## Exit codes\n\nThe Gemini CLI uses specific exit codes to indicate the reason for termination.\nThis is especially useful for scripting and automation.\n\n| Exit Code | Error Type                 | Description                                                                                         |\n| --------- | -------------------------- | --------------------------------------------------------------------------------------------------- |\n| 41        | `FatalAuthenticationError` | An error occurred during the authentication process.                                                |\n| 42        | `FatalInputError`          | Invalid or missing input was provided to the CLI. (non-interactive mode only)                       |\n| 44        | `FatalSandboxError`        | An error occurred with the sandboxing environment (e.g., Docker, Podman, or Seatbelt).              |\n| 52        | `FatalConfigError`         | A configuration file (`settings.json`) is invalid or contains errors.                               |\n| 53        | `FatalTurnLimitedError`    | The maximum number of conversational turns for the session was reached. (non-interactive mode only) |\n\n## Debugging tips\n\n- **CLI debugging:**\n  - Use the `--debug` flag for more detailed output.\n  - Check the CLI logs, often found in a user-specific configuration or cache\n    directory.\n\n- **Core debugging:**\n  - Check the server console output for error messages or stack traces.\n  - Increase log verbosity if configurable.\n  - Use Node.js debugging tools (e.g., `node --inspect`) if you need to step\n    through server-side code.\n\n- **Tool issues:**\n  - If a specific tool is failing, try to isolate the issue by running the\n    simplest possible version of the command or operation the tool performs.\n  - For `run_shell_command`, check that the command works directly in your shell\n    first.\n  - For _file system tools_, verify that paths are correct and check the\n    permissions.\n\n- **Pre-flight checks:**\n  - Always run `npm run preflight` before committing code. This can catch many\n    common issues related to formatting, linting, and type errors.\n\n## Existing GitHub issues similar to yours or creating new issues\n\nIf you encounter an issue that was not covered here in this _Troubleshooting\nguide_, consider searching the Gemini CLI\n[Issue tracker on GitHub](https://github.com/google-gemini/gemini-cli/issues).\nIf you can't find an issue similar to yours, consider creating a new GitHub\nIssue with a detailed description. Pull requests are also welcome!\n"}
{"source":"github","repo":"gemini-cli","path":"docs/npm.md","content":"# Package overview\n\nThis monorepo contains two main packages: `@google/gemini-cli` and\n`@google/gemini-cli-core`.\n\n## `@google/gemini-cli`\n\nThis is the main package for the Gemini CLI. It is responsible for the user\ninterface, command parsing, and all other user-facing functionality.\n\nWhen this package is published, it is bundled into a single executable file.\nThis bundle includes all of the package's dependencies, including\n`@google/gemini-cli-core`. This means that whether a user installs the package\nwith `npm install -g @google/gemini-cli` or runs it directly with\n`npx @google/gemini-cli`, they are using this single, self-contained executable.\n\n## `@google/gemini-cli-core`\n\nThis package contains the core logic for interacting with the Gemini API. It is\nresponsible for making API requests, handling authentication, and managing the\nlocal cache.\n\nThis package is not bundled. When it is published, it is published as a standard\nNode.js package with its own dependencies. This allows it to be used as a\nstandalone package in other projects, if needed. All transpiled js code in the\n`dist` folder is included in the package.\n\n## NPM workspaces\n\nThis project uses\n[NPM Workspaces](https://docs.npmjs.com/cli/v10/using-npm/workspaces) to manage\nthe packages within this monorepo. This simplifies development by allowing us to\nmanage dependencies and run scripts across multiple packages from the root of\nthe project.\n\n### How it works\n\nThe root `package.json` file defines the workspaces for this project:\n\n```json\n{\n  \"workspaces\": [\"packages/*\"]\n}\n```\n\nThis tells NPM that any folder inside the `packages` directory is a separate\npackage that should be managed as part of the workspace.\n\n### Benefits of workspaces\n\n- **Simplified dependency management**: Running `npm install` from the root of\n  the project will install all dependencies for all packages in the workspace\n  and link them together. This means you don't need to run `npm install` in each\n  package's directory.\n- **Automatic linking**: Packages within the workspace can depend on each other.\n  When you run `npm install`, NPM will automatically create symlinks between the\n  packages. This means that when you make changes to one package, the changes\n  are immediately available to other packages that depend on it.\n- **Simplified script execution**: You can run scripts in any package from the\n  root of the project using the `--workspace` flag. For example, to run the\n  `build` script in the `cli` package, you can run\n  `npm run build --workspace @google/gemini-cli`.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/hooks/best-practices.md","content":"# Hooks on Gemini CLI: Best practices\n\nThis guide covers security considerations, performance optimization, debugging\ntechniques, and privacy considerations for developing and deploying hooks in\nGemini CLI.\n\n## Security considerations\n\n### Validate all inputs\n\nNever trust data from hooks without validation. Hook inputs may contain\nuser-provided data that could be malicious:\n\n```bash\n#!/usr/bin/env bash\ninput=$(cat)\n\n# Validate JSON structure\nif ! echo \"$input\" | jq empty 2>/dev/null; then\n  echo \"Invalid JSON input\" >&2\n  exit 1\nfi\n\n# Validate required fields\ntool_name=$(echo \"$input\" | jq -r '.tool_name // empty')\nif [ -z \"$tool_name\" ]; then\n  echo \"Missing tool_name field\" >&2\n  exit 1\nfi\n```\n\n### Use timeouts\n\nSet reasonable timeouts to prevent hooks from hanging indefinitely:\n\n```json\n{\n  \"hooks\": {\n    \"BeforeTool\": [\n      {\n        \"matcher\": \"*\",\n        \"hooks\": [\n          {\n            \"name\": \"slow-validator\",\n            \"type\": \"command\",\n            \"command\": \"./hooks/validate.sh\",\n            \"timeout\": 5000\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n**Recommended timeouts:**\n\n- Fast validation: 1000-5000ms\n- Network requests: 10000-30000ms\n- Heavy computation: 30000-60000ms\n\n### Limit permissions\n\nRun hooks with minimal required permissions:\n\n```bash\n#!/usr/bin/env bash\n# Don't run as root\nif [ \"$EUID\" -eq 0 ]; then\n  echo \"Hook should not run as root\" >&2\n  exit 1\nfi\n\n# Check file permissions before writing\nif [ -w \"$file_path\" ]; then\n  # Safe to write\nelse\n  echo \"Insufficient permissions\" >&2\n  exit 1\nfi\n```\n\n### Scan for secrets\n\nUse `BeforeTool` hooks to prevent committing sensitive data:\n\n```javascript\nconst SECRET_PATTERNS = [\n  /api[_-]?key\\s*[:=]\\s*['\"]?[a-zA-Z0-9_-]{20,}['\"]?/i,\n  /password\\s*[:=]\\s*['\"]?[^\\s'\"]{8,}['\"]?/i,\n  /secret\\s*[:=]\\s*['\"]?[a-zA-Z0-9_-]{20,}['\"]?/i,\n  /AKIA[0-9A-Z]{16}/, // AWS access key\n  /ghp_[a-zA-Z0-9]{36}/, // GitHub personal access token\n  /sk-[a-zA-Z0-9]{48}/, // OpenAI API key\n];\n\nfunction containsSecret(content) {\n  return SECRET_PATTERNS.some((pattern) => pattern.test(content));\n}\n```\n\n### Review external scripts\n\nAlways review hook scripts from untrusted sources before enabling them:\n\n```bash\n# Review before installing\ncat third-party-hook.sh | less\n\n# Check for suspicious patterns\ngrep -E 'curl|wget|ssh|eval' third-party-hook.sh\n\n# Verify hook source\nls -la third-party-hook.sh\n```\n\n### Sandbox untrusted hooks\n\nFor maximum security, consider running untrusted hooks in isolated environments:\n\n```bash\n# Run hook in Docker container\ndocker run --rm \\\n  -v \"$GEMINI_PROJECT_DIR:/workspace:ro\" \\\n  -i untrusted-hook-image \\\n  /hook-script.sh < input.json\n```\n\n## Performance\n\n### Keep hooks fast\n\nHooks run synchronously‚Äîslow hooks delay the agent loop. Optimize for speed by\nusing parallel operations:\n\n```javascript\n// Sequential operations are slower\nconst data1 = await fetch(url1).then((r) => r.json());\nconst data2 = await fetch(url2).then((r) => r.json());\nconst data3 = await fetch(url3).then((r) => r.json());\n\n// Prefer parallel operations for better performance\nconst [data1, data2, data3] = await Promise.all([\n  fetch(url1).then((r) => r.json()),\n  fetch(url2).then((r) => r.json()),\n  fetch(url3).then((r) => r.json()),\n]);\n```\n\n### Cache expensive operations\n\nStore results between invocations to avoid repeated computation:\n\n```javascript\nconst fs = require('fs');\nconst path = require('path');\n\nconst CACHE_FILE = '.gemini/hook-cache.json';\n\nfunction readCache() {\n  try {\n    return JSON.parse(fs.readFileSync(CACHE_FILE, 'utf8'));\n  } catch {\n    return {};\n  }\n}\n\nfunction writeCache(data) {\n  fs.writeFileSync(CACHE_FILE, JSON.stringify(data, null, 2));\n}\n\nasync function main() {\n  const cache = readCache();\n  const cacheKey = `tool-list-${(Date.now() / 3600000) | 0}`; // Hourly cache\n\n  if (cache[cacheKey]) {\n    console.log(JSON.stringify(cache[cacheKey]));\n    return;\n  }\n\n  // Expensive operation\n  const result = await computeExpensiveResult();\n  cache[cacheKey] = result;\n  writeCache(cache);\n\n  console.log(JSON.stringify(result));\n}\n```\n\n### Use appropriate events\n\nChoose hook events that match your use case to avoid unnecessary execution.\n`AfterAgent` fires once per agent loop completion, while `AfterModel` fires\nafter every LLM call (potentially multiple times per loop):\n\n```json\n// If checking final completion, use AfterAgent instead of AfterModel\n{\n  \"hooks\": {\n    \"AfterAgent\": [\n      {\n        \"matcher\": \"*\",\n        \"hooks\": [\n          {\n            \"name\": \"final-checker\",\n            \"command\": \"./check-completion.sh\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n### Filter with matchers\n\nUse specific matchers to avoid unnecessary hook execution. Instead of matching\nall tools with `*`, specify only the tools you need:\n\n```json\n{\n  \"matcher\": \"WriteFile|Edit\",\n  \"hooks\": [\n    {\n      \"name\": \"validate-writes\",\n      \"command\": \"./validate.sh\"\n    }\n  ]\n}\n```\n\n### Optimize JSON parsing\n\nFor large inputs, use streaming JSON parsers to avoid loading everything into\nmemory:\n\n```javascript\n// Standard approach: parse entire input\nconst input = JSON.parse(await readStdin());\nconst content = input.tool_input.content;\n\n// For very large inputs: stream and extract only needed fields\nconst { createReadStream } = require('fs');\nconst JSONStream = require('JSONStream');\n\nconst stream = createReadStream(0).pipe(JSONStream.parse('tool_input.content'));\nlet content = '';\nstream.on('data', (chunk) => {\n  content += chunk;\n});\n```\n\n## Debugging\n\n### Log to files\n\nWrite debug information to dedicated log files:\n\n```bash\n#!/usr/bin/env bash\nLOG_FILE=\".gemini/hooks/debug.log\"\n\n# Log with timestamp\nlog() {\n  echo \"[$(date '+%Y-%m-%d %H:%M:%S')] $*\" >> \"$LOG_FILE\"\n}\n\ninput=$(cat)\nlog \"Received input: ${input:0:100}...\"\n\n# Hook logic here\n\nlog \"Hook completed successfully\"\n```\n\n### Use stderr for errors\n\nError messages on stderr are surfaced appropriately based on exit codes:\n\n```javascript\ntry {\n  const result = dangerousOperation();\n  console.log(JSON.stringify({ result }));\n} catch (error) {\n  console.error(`Hook error: ${error.message}`);\n  process.exit(2); // Blocking error\n}\n```\n\n### Test hooks independently\n\nRun hook scripts manually with sample JSON input:\n\n```bash\n# Create test input\ncat > test-input.json << 'EOF'\n{\n  \"session_id\": \"test-123\",\n  \"cwd\": \"/tmp/test\",\n  \"hook_event_name\": \"BeforeTool\",\n  \"tool_name\": \"WriteFile\",\n  \"tool_input\": {\n    \"file_path\": \"test.txt\",\n    \"content\": \"Test content\"\n  }\n}\nEOF\n\n# Test the hook\ncat test-input.json | .gemini/hooks/my-hook.sh\n\n# Check exit code\necho \"Exit code: $?\"\n```\n\n### Check exit codes\n\nEnsure your script returns the correct exit code:\n\n```bash\n#!/usr/bin/env bash\nset -e  # Exit on error\n\n# Hook logic\nprocess_input() {\n  # ...\n}\n\nif process_input; then\n  echo \"Success message\"\n  exit 0\nelse\n  echo \"Error message\" >&2\n  exit 2\nfi\n```\n\n### Enable telemetry\n\nHook execution is logged when `telemetry.logPrompts` is enabled:\n\n```json\n{\n  \"telemetry\": {\n    \"logPrompts\": true\n  }\n}\n```\n\nView hook telemetry in logs to debug execution issues.\n\n### Use hook panel\n\nThe `/hooks panel` command shows execution status and recent output:\n\n```bash\n/hooks panel\n```\n\nCheck for:\n\n- Hook execution counts\n- Recent successes/failures\n- Error messages\n- Execution timing\n\n## Development\n\n### Start simple\n\nBegin with basic logging hooks before implementing complex logic:\n\n```bash\n#!/usr/bin/env bash\n# Simple logging hook to understand input structure\ninput=$(cat)\necho \"$input\" >> .gemini/hook-inputs.log\necho \"Logged input\"\n```\n\n### Use JSON libraries\n\nParse JSON with proper libraries instead of text processing:\n\n**Bad:**\n\n```bash\n# Fragile text parsing\ntool_name=$(echo \"$input\" | grep -oP '\"tool_name\":\\s*\"\\K[^\"]+')\n```\n\n**Good:**\n\n```bash\n# Robust JSON parsing\ntool_name=$(echo \"$input\" | jq -r '.tool_name')\n```\n\n### Make scripts executable\n\nAlways make hook scripts executable:\n\n```bash\nchmod +x .gemini/hooks/*.sh\nchmod +x .gemini/hooks/*.js\n```\n\n### Version control\n\nCommit hooks to share with your team:\n\n```bash\ngit add .gemini/hooks/\ngit add .gemini/settings.json\ngit commit -m \"Add project hooks for security and testing\"\n```\n\n**`.gitignore` considerations:**\n\n```gitignore\n# Ignore hook cache and logs\n.gemini/hook-cache.json\n.gemini/hook-debug.log\n.gemini/memory/session-*.jsonl\n\n# Keep hook scripts\n!.gemini/hooks/*.sh\n!.gemini/hooks/*.js\n```\n\n### Document behavior\n\nAdd descriptions to help others understand your hooks:\n\n```json\n{\n  \"hooks\": {\n    \"BeforeTool\": [\n      {\n        \"matcher\": \"WriteFile|Edit\",\n        \"hooks\": [\n          {\n            \"name\": \"secret-scanner\",\n            \"type\": \"command\",\n            \"command\": \"$GEMINI_PROJECT_DIR/.gemini/hooks/block-secrets.sh\",\n            \"description\": \"Scans code changes for API keys, passwords, and other secrets before writing\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\nAdd comments in hook scripts:\n\n```javascript\n#!/usr/bin/env node\n/**\n * RAG Tool Filter Hook\n *\n * This hook reduces the tool space from 100+ tools to ~15 relevant ones\n * by extracting keywords from the user's request and filtering tools\n * based on semantic similarity.\n *\n * Performance: ~500ms average, cached tool embeddings\n * Dependencies: @google/generative-ai\n */\n```\n\n## Troubleshooting\n\n### Hook not executing\n\n**Check hook name in `/hooks panel`:**\n\n```bash\n/hooks panel\n```\n\nVerify the hook appears in the list and is enabled.\n\n**Verify matcher pattern:**\n\n```bash\n# Test regex pattern\necho \"WriteFile\" | grep -E \"Write.*|Edit\"\n```\n\n**Check disabled list:**\n\n```json\n{\n  \"hooks\": {\n    \"disabled\": [\"my-hook-name\"]\n  }\n}\n```\n\n**Ensure script is executable:**\n\n```bash\nls -la .gemini/hooks/my-hook.sh\nchmod +x .gemini/hooks/my-hook.sh\n```\n\n**Verify script path:**\n\n```bash\n# Check path expansion\necho \"$GEMINI_PROJECT_DIR/.gemini/hooks/my-hook.sh\"\n\n# Verify file exists\ntest -f \"$GEMINI_PROJECT_DIR/.gemini/hooks/my-hook.sh\" && echo \"File exists\"\n```\n\n### Hook timing out\n\n**Check configured timeout:**\n\n```json\n{\n  \"name\": \"slow-hook\",\n  \"timeout\": 60000\n}\n```\n\n**Optimize slow operations:**\n\n```javascript\n// Before: Sequential operations (slow)\nfor (const item of items) {\n  await processItem(item);\n}\n\n// After: Parallel operations (fast)\nawait Promise.all(items.map((item) => processItem(item)));\n```\n\n**Use caching:**\n\n```javascript\nconst cache = new Map();\n\nasync function getCachedData(key) {\n  if (cache.has(key)) {\n    return cache.get(key);\n  }\n  const data = await fetchData(key);\n  cache.set(key, data);\n  return data;\n}\n```\n\n**Consider splitting into multiple faster hooks:**\n\n```json\n{\n  \"hooks\": {\n    \"BeforeTool\": [\n      {\n        \"matcher\": \"WriteFile\",\n        \"hooks\": [\n          {\n            \"name\": \"quick-check\",\n            \"command\": \"./quick-validation.sh\",\n            \"timeout\": 1000\n          }\n        ]\n      },\n      {\n        \"matcher\": \"WriteFile\",\n        \"hooks\": [\n          {\n            \"name\": \"deep-check\",\n            \"command\": \"./deep-analysis.sh\",\n            \"timeout\": 30000\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n### Invalid JSON output\n\n**Validate JSON before outputting:**\n\n```bash\n#!/usr/bin/env bash\noutput='{\"decision\": \"allow\"}'\n\n# Validate JSON\nif echo \"$output\" | jq empty 2>/dev/null; then\n  echo \"$output\"\nelse\n  echo \"Invalid JSON generated\" >&2\n  exit 1\nfi\n```\n\n**Ensure proper quoting and escaping:**\n\n```javascript\n// Bad: Unescaped string interpolation\nconst message = `User said: ${userInput}`;\nconsole.log(JSON.stringify({ message }));\n\n// Good: Automatic escaping\nconsole.log(JSON.stringify({ message: `User said: ${userInput}` }));\n```\n\n**Check for binary data or control characters:**\n\n```javascript\nfunction sanitizeForJSON(str) {\n  return str.replace(/[\\x00-\\x1F\\x7F-\\x9F]/g, ''); // Remove control chars\n}\n\nconst cleanContent = sanitizeForJSON(content);\nconsole.log(JSON.stringify({ content: cleanContent }));\n```\n\n### Exit code issues\n\n**Verify script returns correct codes:**\n\n```bash\n#!/usr/bin/env bash\nset -e  # Exit on error\n\n# Processing logic\nif validate_input; then\n  echo \"Success\"\n  exit 0\nelse\n  echo \"Validation failed\" >&2\n  exit 2\nfi\n```\n\n**Check for unintended errors:**\n\n```bash\n#!/usr/bin/env bash\n# Don't use 'set -e' if you want to handle errors explicitly\n# set -e\n\nif ! command_that_might_fail; then\n  # Handle error\n  echo \"Command failed but continuing\" >&2\nfi\n\n# Always exit explicitly\nexit 0\n```\n\n**Use trap for cleanup:**\n\n```bash\n#!/usr/bin/env bash\n\ncleanup() {\n  # Cleanup logic\n  rm -f /tmp/hook-temp-*\n}\n\ntrap cleanup EXIT\n\n# Hook logic here\n```\n\n### Environment variables not available\n\n**Check if variable is set:**\n\n```bash\n#!/usr/bin/env bash\n\nif [ -z \"$GEMINI_PROJECT_DIR\" ]; then\n  echo \"GEMINI_PROJECT_DIR not set\" >&2\n  exit 1\nfi\n\nif [ -z \"$CUSTOM_VAR\" ]; then\n  echo \"Warning: CUSTOM_VAR not set, using default\" >&2\n  CUSTOM_VAR=\"default-value\"\nfi\n```\n\n**Debug available variables:**\n\n```bash\n#!/usr/bin/env bash\n\n# List all environment variables\nenv > .gemini/hook-env.log\n\n# Check specific variables\necho \"GEMINI_PROJECT_DIR: $GEMINI_PROJECT_DIR\" >> .gemini/hook-env.log\necho \"GEMINI_SESSION_ID: $GEMINI_SESSION_ID\" >> .gemini/hook-env.log\necho \"GEMINI_API_KEY: ${GEMINI_API_KEY:+<set>}\" >> .gemini/hook-env.log\n```\n\n**Use .env files:**\n\n```bash\n#!/usr/bin/env bash\n\n# Load .env file if it exists\nif [ -f \"$GEMINI_PROJECT_DIR/.env\" ]; then\n  source \"$GEMINI_PROJECT_DIR/.env\"\nfi\n```\n\n## Privacy considerations\n\nHook inputs and outputs may contain sensitive information. Gemini CLI respects\nthe `telemetry.logPrompts` setting for hook data logging.\n\n### What data is collected\n\nHook telemetry may include:\n\n- **Hook inputs:** User prompts, tool arguments, file contents\n- **Hook outputs:** Hook responses, decision reasons, added context\n- **Standard streams:** stdout and stderr from hook processes\n- **Execution metadata:** Hook name, event type, duration, success/failure\n\n### Privacy settings\n\n**Enabled (default):**\n\nFull hook I/O is logged to telemetry. Use this when:\n\n- Developing and debugging hooks\n- Telemetry is redirected to a trusted enterprise system\n- You understand and accept the privacy implications\n\n**Disabled:**\n\nOnly metadata is logged (event name, duration, success/failure). Hook inputs and\noutputs are excluded. Use this when:\n\n- Sending telemetry to third-party systems\n- Working with sensitive data\n- Privacy regulations require minimizing data collection\n\n### Configuration\n\n**Disable PII logging in settings:**\n\n```json\n{\n  \"telemetry\": {\n    \"logPrompts\": false\n  }\n}\n```\n\n**Disable via environment variable:**\n\n```bash\nexport GEMINI_TELEMETRY_LOG_PROMPTS=false\n```\n\n### Sensitive data in hooks\n\nIf your hooks process sensitive data:\n\n1. **Minimize logging:** Don't write sensitive data to log files\n2. **Sanitize outputs:** Remove sensitive data before outputting\n3. **Use secure storage:** Encrypt sensitive data at rest\n4. **Limit access:** Restrict hook script permissions\n\n**Example sanitization:**\n\n```javascript\nfunction sanitizeOutput(data) {\n  const sanitized = { ...data };\n\n  // Remove sensitive fields\n  delete sanitized.apiKey;\n  delete sanitized.password;\n\n  // Redact sensitive strings\n  if (sanitized.content) {\n    sanitized.content = sanitized.content.replace(\n      /api[_-]?key\\s*[:=]\\s*['\"]?[a-zA-Z0-9_-]{20,}['\"]?/gi,\n      '[REDACTED]',\n    );\n  }\n\n  return sanitized;\n}\n\nconsole.log(JSON.stringify(sanitizeOutput(hookOutput)));\n```\n\n## Learn more\n\n- [Hooks Reference](index.md) - Complete API reference\n- [Writing Hooks](writing-hooks.md) - Tutorial and examples\n- [Configuration](../cli/configuration.md) - Gemini CLI settings\n- [Hooks Design Document](../hooks-design.md) - Technical architecture\n"}
{"source":"github","repo":"gemini-cli","path":"docs/hooks/index.md","content":"# Gemini CLI hooks\n\nHooks are scripts or programs that Gemini CLI executes at specific points in the\nagentic loop, allowing you to intercept and customize behavior without modifying\nthe CLI's source code.\n\nSee [writing hooks guide](writing-hooks.md) for a tutorial on creating your\nfirst hook and a comprehensive example.\n\nSee [best practices](best-practices.md) for guidelines on security, performance,\nand debugging.\n\n## What are hooks?\n\nWith hooks, you can:\n\n- **Add context:** Inject relevant information before the model processes a\n  request\n- **Validate actions:** Review and block potentially dangerous operations\n- **Enforce policies:** Implement security and compliance requirements\n- **Log interactions:** Track tool usage and model responses\n- **Optimize behavior:** Dynamically adjust tool selection or model parameters\n\nHooks run synchronously as part of the agent loop‚Äîwhen a hook event fires,\nGemini CLI waits for all matching hooks to complete before continuing.\n\n## Core concepts\n\n### Hook events\n\nHooks are triggered by specific events in Gemini CLI's lifecycle. The following\ntable lists all available hook events:\n\n| Event                 | When It Fires                                 | Common Use Cases                           |\n| --------------------- | --------------------------------------------- | ------------------------------------------ |\n| `SessionStart`        | When a session begins                         | Initialize resources, load context         |\n| `SessionEnd`          | When a session ends                           | Clean up, save state                       |\n| `BeforeAgent`         | After user submits prompt, before planning    | Add context, validate prompts              |\n| `AfterAgent`          | When agent loop ends                          | Review output, force continuation          |\n| `BeforeModel`         | Before sending request to LLM                 | Modify prompts, add instructions           |\n| `AfterModel`          | After receiving LLM response                  | Filter responses, log interactions         |\n| `BeforeToolSelection` | Before LLM selects tools (after BeforeModel)  | Filter available tools, optimize selection |\n| `BeforeTool`          | Before a tool executes                        | Validate arguments, block dangerous ops    |\n| `AfterTool`           | After a tool executes                         | Process results, run tests                 |\n| `PreCompress`         | Before context compression                    | Save state, notify user                    |\n| `Notification`        | When a notification occurs (e.g., permission) | Auto-approve, log decisions                |\n\n### Hook types\n\nGemini CLI currently supports **command hooks** that run shell commands or\nscripts:\n\n```json\n{\n  \"type\": \"command\",\n  \"command\": \"$GEMINI_PROJECT_DIR/.gemini/hooks/my-hook.sh\",\n  \"timeout\": 30000\n}\n```\n\n**Note:** Plugin hooks (npm packages) are planned for a future release.\n\n### Matchers\n\nFor tool-related events (`BeforeTool`, `AfterTool`), you can filter which tools\ntrigger the hook:\n\n```json\n{\n  \"hooks\": {\n    \"BeforeTool\": [\n      {\n        \"matcher\": \"WriteFile|Edit\",\n        \"hooks\": [\n          /* hooks for write operations */\n        ]\n      }\n    ]\n  }\n}\n```\n\n**Matcher patterns:**\n\n- **Exact match:** `\"ReadFile\"` matches only `ReadFile`\n- **Regex:** `\"Write.*|Edit\"` matches `WriteFile`, `WriteBinary`, `Edit`\n- **Wildcard:** `\"*\"` or `\"\"` matches all tools\n\n**Session event matchers:**\n\n- **SessionStart:** `startup`, `resume`, `clear`\n- **SessionEnd:** `exit`, `clear`, `logout`, `prompt_input_exit`\n- **PreCompress:** `manual`, `auto`\n- **Notification:** `ToolPermission`\n\n## Hook input/output contract\n\n### Command hook communication\n\nHooks communicate via:\n\n- **Input:** JSON on stdin\n- **Output:** Exit code + stdout/stderr\n\n### Exit codes\n\n- **0:** Success - stdout shown to user (or injected as context for some events)\n- **2:** Blocking error - stderr shown to agent/user, operation may be blocked\n- **Other:** Non-blocking warning - logged but execution continues\n\n### Common input fields\n\nEvery hook receives these base fields:\n\n```json\n{\n  \"session_id\": \"abc123\",\n  \"cwd\": \"/path/to/project\",\n  \"hook_event_name\": \"BeforeTool\",\n  \"timestamp\": \"2025-12-01T10:30:00Z\"\n  // ... event-specific fields\n}\n```\n\n### Event-specific fields\n\n#### BeforeTool\n\n**Input:**\n\n```json\n{\n  \"tool_name\": \"WriteFile\",\n  \"tool_input\": {\n    \"file_path\": \"/path/to/file.ts\",\n    \"content\": \"...\"\n  }\n}\n```\n\n**Output (JSON on stdout):**\n\n```json\n{\n  \"decision\": \"allow|deny|ask|block\",\n  \"reason\": \"Explanation shown to agent\",\n  \"systemMessage\": \"Message shown to user\"\n}\n```\n\nOr simple exit codes:\n\n- Exit 0 = allow (stdout shown to user)\n- Exit 2 = deny (stderr shown to agent)\n\n#### AfterTool\n\n**Input:**\n\n```json\n{\n  \"tool_name\": \"ReadFile\",\n  \"tool_input\": { \"file_path\": \"...\" },\n  \"tool_response\": \"file contents...\"\n}\n```\n\n**Output:**\n\n```json\n{\n  \"decision\": \"allow|deny\",\n  \"hookSpecificOutput\": {\n    \"hookEventName\": \"AfterTool\",\n    \"additionalContext\": \"Extra context for agent\"\n  }\n}\n```\n\n#### BeforeAgent\n\n**Input:**\n\n```json\n{\n  \"prompt\": \"Fix the authentication bug\"\n}\n```\n\n**Output:**\n\n```json\n{\n  \"decision\": \"allow|deny\",\n  \"hookSpecificOutput\": {\n    \"hookEventName\": \"BeforeAgent\",\n    \"additionalContext\": \"Recent project decisions: ...\"\n  }\n}\n```\n\n#### BeforeModel\n\n**Input:**\n\n```json\n{\n  \"llm_request\": {\n    \"model\": \"gemini-2.0-flash-exp\",\n    \"messages\": [{ \"role\": \"user\", \"content\": \"Hello\" }],\n    \"config\": { \"temperature\": 0.7 },\n    \"toolConfig\": {\n      \"functionCallingConfig\": {\n        \"mode\": \"AUTO\",\n        \"allowedFunctionNames\": [\"ReadFile\", \"WriteFile\"]\n      }\n    }\n  }\n}\n```\n\n**Output:**\n\n```json\n{\n  \"decision\": \"allow\",\n  \"hookSpecificOutput\": {\n    \"hookEventName\": \"BeforeModel\",\n    \"llm_request\": {\n      \"messages\": [\n        { \"role\": \"system\", \"content\": \"Additional instructions...\" },\n        { \"role\": \"user\", \"content\": \"Hello\" }\n      ]\n    }\n  }\n}\n```\n\n#### AfterModel\n\n**Input:**\n\n```json\n{\n  \"llm_request\": {\n    \"model\": \"gemini-2.0-flash-exp\",\n    \"messages\": [\n      /* ... */\n    ],\n    \"config\": {\n      /* ... */\n    },\n    \"toolConfig\": {\n      /* ... */\n    }\n  },\n  \"llm_response\": {\n    \"text\": \"string\",\n    \"candidates\": [\n      {\n        \"content\": {\n          \"role\": \"model\",\n          \"parts\": [\"array of content parts\"]\n        },\n        \"finishReason\": \"STOP\"\n      }\n    ]\n  }\n}\n```\n\n**Output:**\n\n```json\n{\n  \"hookSpecificOutput\": {\n    \"hookEventName\": \"AfterModel\",\n    \"llm_response\": {\n      \"candidate\": {\n        /* modified response */\n      }\n    }\n  }\n}\n```\n\n#### BeforeToolSelection\n\n**Input:**\n\n```json\n{\n  \"llm_request\": {\n    \"model\": \"gemini-2.0-flash-exp\",\n    \"messages\": [\n      /* ... */\n    ],\n    \"toolConfig\": {\n      \"functionCallingConfig\": {\n        \"mode\": \"AUTO\",\n        \"allowedFunctionNames\": [\n          /* 100+ tools */\n        ]\n      }\n    }\n  }\n}\n```\n\n**Output:**\n\n```json\n{\n  \"hookSpecificOutput\": {\n    \"hookEventName\": \"BeforeToolSelection\",\n    \"toolConfig\": {\n      \"functionCallingConfig\": {\n        \"mode\": \"ANY\",\n        \"allowedFunctionNames\": [\"ReadFile\", \"WriteFile\", \"Edit\"]\n      }\n    }\n  }\n}\n```\n\nOr simple output (comma-separated tool names sets mode to ANY):\n\n```bash\necho \"ReadFile,WriteFile,Edit\"\n```\n\n#### SessionStart\n\n**Input:**\n\n```json\n{\n  \"source\": \"startup|resume|clear\"\n}\n```\n\n**Output:**\n\n```json\n{\n  \"hookSpecificOutput\": {\n    \"hookEventName\": \"SessionStart\",\n    \"additionalContext\": \"Loaded 5 project memories\"\n  }\n}\n```\n\n#### SessionEnd\n\n**Input:**\n\n```json\n{\n  \"reason\": \"exit|clear|logout|prompt_input_exit|other\"\n}\n```\n\nNo structured output expected (but stdout/stderr logged).\n\n#### PreCompress\n\n**Input:**\n\n```json\n{\n  \"trigger\": \"manual|auto\"\n}\n```\n\n**Output:**\n\n```json\n{\n  \"systemMessage\": \"Compression starting...\"\n}\n```\n\n#### Notification\n\n**Input:**\n\n```json\n{\n  \"notification_type\": \"ToolPermission\",\n  \"message\": \"string\",\n  \"details\": {\n    /* notification details */\n  }\n}\n```\n\n**Output:**\n\n```json\n{\n  \"systemMessage\": \"Notification logged\"\n}\n```\n\n## Configuration\n\nHook definitions are configured in `settings.json` files using the `hooks`\nobject. Configuration can be specified at multiple levels with defined\nprecedence rules.\n\n### Configuration layers\n\nHook configurations are applied in the following order of precedence (higher\nnumbers override lower numbers):\n\n1. **System defaults:** Built-in default settings (lowest precedence)\n2. **User settings:** `~/.gemini/settings.json`\n3. **Project settings:** `.gemini/settings.json` in your project directory\n4. **System settings:** `/etc/gemini-cli/settings.json` (highest precedence)\n\nWithin each level, hooks run in the order they are declared in the\nconfiguration.\n\n### Configuration schema\n\n```json\n{\n  \"hooks\": {\n    \"EventName\": [\n      {\n        \"matcher\": \"pattern\",\n        \"hooks\": [\n          {\n            \"name\": \"hook-identifier\",\n            \"type\": \"command\",\n            \"command\": \"./path/to/script.sh\",\n            \"description\": \"What this hook does\",\n            \"timeout\": 30000\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n**Configuration properties:**\n\n- **`name`** (string, required): Unique identifier for the hook used in\n  `/hooks enable/disable` commands\n- **`type`** (string, required): Hook type - currently only `\"command\"` is\n  supported\n- **`command`** (string, required): Path to the script or command to execute\n- **`description`** (string, optional): Human-readable description shown in\n  `/hooks panel`\n- **`timeout`** (number, optional): Timeout in milliseconds (default: 60000)\n- **`matcher`** (string, optional): Pattern to filter when hook runs (event\n  matchers only)\n\n### Environment variables\n\nHooks have access to:\n\n- `GEMINI_PROJECT_DIR`: Project root directory\n- `GEMINI_SESSION_ID`: Current session ID\n- `GEMINI_API_KEY`: Gemini API key (if configured)\n- All other environment variables from the parent process\n\n## Managing hooks\n\n### View registered hooks\n\nUse the `/hooks panel` command to view all registered hooks:\n\n```bash\n/hooks panel\n```\n\nThis command displays:\n\n- All active hooks organized by event\n- Hook source (user, project, system)\n- Hook type (command or plugin)\n- Execution status and recent output\n\n### Enable and disable hooks\n\nYou can temporarily enable or disable individual hooks using commands:\n\n```bash\n/hooks enable hook-name\n/hooks disable hook-name\n```\n\nThese commands allow you to control hook execution without editing configuration\nfiles. The hook name should match the `name` field in your hook configuration.\n\n### Disabled hooks configuration\n\nTo permanently disable hooks, add them to the `hooks.disabled` array in your\n`settings.json`:\n\n```json\n{\n  \"hooks\": {\n    \"disabled\": [\"secret-scanner\", \"auto-test\"]\n  }\n}\n```\n\n**Note:** The `hooks.disabled` array uses a UNION merge strategy. Disabled hooks\nfrom all configuration levels (user, project, system) are combined and\ndeduplicated, meaning a hook disabled at any level remains disabled.\n\n## Migration from Claude Code\n\nIf you have hooks configured for Claude Code, you can migrate them:\n\n```bash\ngemini hooks migrate --from-claude\n```\n\nThis command:\n\n- Reads `.claude/settings.json`\n- Converts event names (`PreToolUse` ‚Üí `BeforeTool`, etc.)\n- Translates tool names (`Bash` ‚Üí `RunShellCommand`, `Edit` ‚Üí `Edit`)\n- Updates matcher patterns\n- Writes to `.gemini/settings.json`\n\n### Event name mapping\n\n| Claude Code        | Gemini CLI     |\n| ------------------ | -------------- |\n| `PreToolUse`       | `BeforeTool`   |\n| `PostToolUse`      | `AfterTool`    |\n| `UserPromptSubmit` | `BeforeAgent`  |\n| `Stop`             | `AfterAgent`   |\n| `Notification`     | `Notification` |\n| `SessionStart`     | `SessionStart` |\n| `SessionEnd`       | `SessionEnd`   |\n| `PreCompact`       | `PreCompress`  |\n\n### Tool name mapping\n\n| Claude Code | Gemini CLI        |\n| ----------- | ----------------- |\n| `Bash`      | `RunShellCommand` |\n| `Edit`      | `Edit`            |\n| `Read`      | `ReadFile`        |\n| `Write`     | `WriteFile`       |\n\n## Learn more\n\n- [Writing Hooks](writing-hooks.md) - Tutorial and comprehensive example\n- [Best Practices](best-practices.md) - Security, performance, and debugging\n- [Custom Commands](../cli/custom-commands.md) - Create reusable prompt\n  shortcuts\n- [Configuration](../cli/configuration.md) - Gemini CLI configuration options\n- [Hooks Design Document](../hooks-design.md) - Technical architecture details\n"}
{"source":"github","repo":"gemini-cli","path":"docs/hooks/writing-hooks.md","content":"# Writing hooks for Gemini CLI\n\nThis guide will walk you through creating hooks for Gemini CLI, from a simple\nlogging hook to a comprehensive workflow assistant that demonstrates all hook\nevents working together.\n\n## Prerequisites\n\nBefore you start, make sure you have:\n\n- Gemini CLI installed and configured\n- Basic understanding of shell scripting or JavaScript/Node.js\n- Familiarity with JSON for hook input/output\n\n## Quick start\n\nLet's create a simple hook that logs all tool executions to understand the\nbasics.\n\n### Step 1: Create your hook script\n\nCreate a directory for hooks and a simple logging script:\n\n```bash\nmkdir -p .gemini/hooks\ncat > .gemini/hooks/log-tools.sh << 'EOF'\n#!/usr/bin/env bash\n# Read hook input from stdin\ninput=$(cat)\n\n# Extract tool name\ntool_name=$(echo \"$input\" | jq -r '.tool_name')\n\n# Log to file\necho \"[$(date)] Tool executed: $tool_name\" >> .gemini/tool-log.txt\n\n# Return success (exit 0) - output goes to user in transcript mode\necho \"Logged: $tool_name\"\nEOF\n\nchmod +x .gemini/hooks/log-tools.sh\n```\n\n### Step 2: Configure the hook\n\nAdd the hook configuration to `.gemini/settings.json`:\n\n```json\n{\n  \"hooks\": {\n    \"AfterTool\": [\n      {\n        \"matcher\": \"*\",\n        \"hooks\": [\n          {\n            \"name\": \"tool-logger\",\n            \"type\": \"command\",\n            \"command\": \"$GEMINI_PROJECT_DIR/.gemini/hooks/log-tools.sh\",\n            \"description\": \"Log all tool executions\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n### Step 3: Test your hook\n\nRun Gemini CLI and execute any command that uses tools:\n\n```\n> Read the README.md file\n\n[Agent uses ReadFile tool]\n\nLogged: ReadFile\n```\n\nCheck `.gemini/tool-log.txt` to see the logged tool executions.\n\n## Practical examples\n\n### Security: Block secrets in commits\n\nPrevent committing files containing API keys or passwords.\n\n**`.gemini/hooks/block-secrets.sh`:**\n\n```bash\n#!/usr/bin/env bash\ninput=$(cat)\n\n# Extract content being written\ncontent=$(echo \"$input\" | jq -r '.tool_input.content // .tool_input.new_string // \"\"')\n\n# Check for secrets\nif echo \"$content\" | grep -qE 'api[_-]?key|password|secret'; then\n  echo '{\"decision\":\"deny\",\"reason\":\"Potential secret detected\"}' >&2\n  exit 2\nfi\n\nexit 0\n```\n\n**`.gemini/settings.json`:**\n\n```json\n{\n  \"hooks\": {\n    \"BeforeTool\": [\n      {\n        \"matcher\": \"WriteFile|Edit\",\n        \"hooks\": [\n          {\n            \"name\": \"secret-scanner\",\n            \"type\": \"command\",\n            \"command\": \"$GEMINI_PROJECT_DIR/.gemini/hooks/block-secrets.sh\",\n            \"description\": \"Prevent committing secrets\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n### Auto-testing after code changes\n\nAutomatically run tests when code files are modified.\n\n**`.gemini/hooks/auto-test.sh`:**\n\n```bash\n#!/usr/bin/env bash\ninput=$(cat)\n\nfile_path=$(echo \"$input\" | jq -r '.tool_input.file_path')\n\n# Only test .ts files\nif [[ ! \"$file_path\" =~ \\.ts$ ]]; then\n  exit 0\nfi\n\n# Find corresponding test file\ntest_file=\"${file_path%.ts}.test.ts\"\n\nif [ ! -f \"$test_file\" ]; then\n  echo \"‚ö†Ô∏è No test file found\"\n  exit 0\nfi\n\n# Run tests\nif npx vitest run \"$test_file\" --silent 2>&1 | head -20; then\n  echo \"‚úÖ Tests passed\"\nelse\n  echo \"‚ùå Tests failed\"\nfi\n\nexit 0\n```\n\n**`.gemini/settings.json`:**\n\n```json\n{\n  \"hooks\": {\n    \"AfterTool\": [\n      {\n        \"matcher\": \"WriteFile|Edit\",\n        \"hooks\": [\n          {\n            \"name\": \"auto-test\",\n            \"type\": \"command\",\n            \"command\": \"$GEMINI_PROJECT_DIR/.gemini/hooks/auto-test.sh\",\n            \"description\": \"Run tests after code changes\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n### Dynamic context injection\n\nAdd relevant project context before each agent interaction.\n\n**`.gemini/hooks/inject-context.sh`:**\n\n```bash\n#!/usr/bin/env bash\n\n# Get recent git commits for context\ncontext=$(git log -5 --oneline 2>/dev/null || echo \"No git history\")\n\n# Return as JSON\ncat <<EOF\n{\n  \"hookSpecificOutput\": {\n    \"hookEventName\": \"BeforeAgent\",\n    \"additionalContext\": \"Recent commits:\\n$context\"\n  }\n}\nEOF\n```\n\n**`.gemini/settings.json`:**\n\n```json\n{\n  \"hooks\": {\n    \"BeforeAgent\": [\n      {\n        \"matcher\": \"*\",\n        \"hooks\": [\n          {\n            \"name\": \"git-context\",\n            \"type\": \"command\",\n            \"command\": \"$GEMINI_PROJECT_DIR/.gemini/hooks/inject-context.sh\",\n            \"description\": \"Inject git commit history\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n## Advanced features\n\n### RAG-based tool filtering\n\nUse `BeforeToolSelection` to intelligently reduce the tool space based on the\ncurrent task. Instead of sending all 100+ tools to the model, filter to the most\nrelevant ~15 tools using semantic search or keyword matching.\n\nThis improves:\n\n- **Model accuracy:** Fewer similar tools reduce confusion\n- **Response speed:** Smaller tool space is faster to process\n- **Cost efficiency:** Less tokens used per request\n\n### Cross-session memory\n\nUse `SessionStart` and `SessionEnd` hooks to maintain persistent knowledge\nacross sessions:\n\n- **SessionStart:** Load relevant memories from previous sessions\n- **AfterModel:** Record important interactions during the session\n- **SessionEnd:** Extract learnings and store for future use\n\nThis enables the assistant to learn project conventions, remember important\ndecisions, and share knowledge across team members.\n\n### Hook chaining\n\nMultiple hooks for the same event run in the order declared. Each hook can build\nupon previous hooks' outputs:\n\n```json\n{\n  \"hooks\": {\n    \"BeforeAgent\": [\n      {\n        \"matcher\": \"*\",\n        \"hooks\": [\n          {\n            \"name\": \"load-memories\",\n            \"type\": \"command\",\n            \"command\": \"./hooks/load-memories.sh\"\n          },\n          {\n            \"name\": \"analyze-sentiment\",\n            \"type\": \"command\",\n            \"command\": \"./hooks/analyze-sentiment.sh\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n## Complete example: Smart Development Workflow Assistant\n\nThis comprehensive example demonstrates all hook events working together with\ntwo advanced features:\n\n- **RAG-based tool selection:** Reduces 100+ tools to ~15 relevant ones per task\n- **Cross-session memory:** Learns and persists project knowledge\n\n### Architecture\n\n```\nSessionStart ‚Üí Initialize memory & index tools\n     ‚Üì\nBeforeAgent ‚Üí Inject relevant memories\n     ‚Üì\nBeforeModel ‚Üí Add system instructions\n     ‚Üì\nBeforeToolSelection ‚Üí Filter tools via RAG\n     ‚Üì\nBeforeTool ‚Üí Validate security\n     ‚Üì\nAfterTool ‚Üí Run auto-tests\n     ‚Üì\nAfterModel ‚Üí Record interaction\n     ‚Üì\nSessionEnd ‚Üí Extract and store memories\n```\n\n### Installation\n\n**Prerequisites:**\n\n- Node.js 18+\n- Gemini CLI installed\n\n**Setup:**\n\n```bash\n# Create hooks directory\nmkdir -p .gemini/hooks .gemini/memory\n\n# Install dependencies\nnpm install --save-dev chromadb @google/generative-ai\n\n# Copy hook scripts (shown below)\n# Make them executable\nchmod +x .gemini/hooks/*.js\n```\n\n### Configuration\n\n**`.gemini/settings.json`:**\n\n```json\n{\n  \"hooks\": {\n    \"SessionStart\": [\n      {\n        \"matcher\": \"startup\",\n        \"hooks\": [\n          {\n            \"name\": \"init-assistant\",\n            \"type\": \"command\",\n            \"command\": \"node $GEMINI_PROJECT_DIR/.gemini/hooks/init.js\",\n            \"description\": \"Initialize Smart Workflow Assistant\"\n          }\n        ]\n      }\n    ],\n    \"BeforeAgent\": [\n      {\n        \"matcher\": \"*\",\n        \"hooks\": [\n          {\n            \"name\": \"inject-memories\",\n            \"type\": \"command\",\n            \"command\": \"node $GEMINI_PROJECT_DIR/.gemini/hooks/inject-memories.js\",\n            \"description\": \"Inject relevant project memories\"\n          }\n        ]\n      }\n    ],\n    \"BeforeToolSelection\": [\n      {\n        \"matcher\": \"*\",\n        \"hooks\": [\n          {\n            \"name\": \"rag-filter\",\n            \"type\": \"command\",\n            \"command\": \"node $GEMINI_PROJECT_DIR/.gemini/hooks/rag-filter.js\",\n            \"description\": \"Filter tools using RAG\"\n          }\n        ]\n      }\n    ],\n    \"BeforeTool\": [\n      {\n        \"matcher\": \"WriteFile|Edit\",\n        \"hooks\": [\n          {\n            \"name\": \"security-check\",\n            \"type\": \"command\",\n            \"command\": \"node $GEMINI_PROJECT_DIR/.gemini/hooks/security.js\",\n            \"description\": \"Prevent committing secrets\"\n          }\n        ]\n      }\n    ],\n    \"AfterTool\": [\n      {\n        \"matcher\": \"WriteFile|Edit\",\n        \"hooks\": [\n          {\n            \"name\": \"auto-test\",\n            \"type\": \"command\",\n            \"command\": \"node $GEMINI_PROJECT_DIR/.gemini/hooks/auto-test.js\",\n            \"description\": \"Run tests after code changes\"\n          }\n        ]\n      }\n    ],\n    \"AfterModel\": [\n      {\n        \"matcher\": \"*\",\n        \"hooks\": [\n          {\n            \"name\": \"record-interaction\",\n            \"type\": \"command\",\n            \"command\": \"node $GEMINI_PROJECT_DIR/.gemini/hooks/record.js\",\n            \"description\": \"Record interaction for learning\"\n          }\n        ]\n      }\n    ],\n    \"SessionEnd\": [\n      {\n        \"matcher\": \"exit|logout\",\n        \"hooks\": [\n          {\n            \"name\": \"consolidate-memories\",\n            \"type\": \"command\",\n            \"command\": \"node $GEMINI_PROJECT_DIR/.gemini/hooks/consolidate.js\",\n            \"description\": \"Extract and store session learnings\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n### Hook scripts\n\n#### 1. Initialize (SessionStart)\n\n**`.gemini/hooks/init.js`:**\n\n```javascript\n#!/usr/bin/env node\nconst { ChromaClient } = require('chromadb');\nconst path = require('path');\nconst fs = require('fs');\n\nasync function main() {\n  const projectDir = process.env.GEMINI_PROJECT_DIR;\n  const chromaPath = path.join(projectDir, '.gemini', 'chroma');\n\n  // Ensure chroma directory exists\n  fs.mkdirSync(chromaPath, { recursive: true });\n\n  const client = new ChromaClient({ path: chromaPath });\n\n  // Initialize memory collection\n  await client.getOrCreateCollection({\n    name: 'project_memories',\n    metadata: { 'hnsw:space': 'cosine' },\n  });\n\n  // Count existing memories\n  const collection = await client.getCollection({ name: 'project_memories' });\n  const memoryCount = await collection.count();\n\n  console.log(\n    JSON.stringify({\n      hookSpecificOutput: {\n        hookEventName: 'SessionStart',\n        additionalContext: `Smart Workflow Assistant initialized with ${memoryCount} project memories.`,\n      },\n      systemMessage: `üß† ${memoryCount} memories loaded`,\n    }),\n  );\n}\n\nfunction readStdin() {\n  return new Promise((resolve) => {\n    const chunks = [];\n    process.stdin.on('data', (chunk) => chunks.push(chunk));\n    process.stdin.on('end', () => resolve(Buffer.concat(chunks).toString()));\n  });\n}\n\nreadStdin().then(main).catch(console.error);\n```\n\n#### 2. Inject memories (BeforeAgent)\n\n**`.gemini/hooks/inject-memories.js`:**\n\n```javascript\n#!/usr/bin/env node\nconst { GoogleGenerativeAI } = require('@google/generative-ai');\nconst { ChromaClient } = require('chromadb');\nconst path = require('path');\n\nasync function main() {\n  const input = JSON.parse(await readStdin());\n  const { prompt } = input;\n\n  if (!prompt?.trim()) {\n    console.log(JSON.stringify({}));\n    return;\n  }\n\n  // Embed the prompt\n  const genai = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);\n  const model = genai.getGenerativeModel({ model: 'text-embedding-004' });\n  const result = await model.embedContent(prompt);\n\n  // Search memories\n  const projectDir = process.env.GEMINI_PROJECT_DIR;\n  const client = new ChromaClient({\n    path: path.join(projectDir, '.gemini', 'chroma'),\n  });\n\n  try {\n    const collection = await client.getCollection({ name: 'project_memories' });\n    const results = await collection.query({\n      queryEmbeddings: [result.embedding.values],\n      nResults: 3,\n    });\n\n    if (results.documents[0]?.length > 0) {\n      const memories = results.documents[0]\n        .map((doc, i) => {\n          const meta = results.metadatas[0][i];\n          return `- [${meta.category}] ${meta.summary}`;\n        })\n        .join('\\n');\n\n      console.log(\n        JSON.stringify({\n          hookSpecificOutput: {\n            hookEventName: 'BeforeAgent',\n            additionalContext: `\\n## Relevant Project Context\\n\\n${memories}\\n`,\n          },\n          systemMessage: `üí≠ ${results.documents[0].length} memories recalled`,\n        }),\n      );\n    } else {\n      console.log(JSON.stringify({}));\n    }\n  } catch (error) {\n    console.log(JSON.stringify({}));\n  }\n}\n\nfunction readStdin() {\n  return new Promise((resolve) => {\n    const chunks = [];\n    process.stdin.on('data', (chunk) => chunks.push(chunk));\n    process.stdin.on('end', () => resolve(Buffer.concat(chunks).toString()));\n  });\n}\n\nreadStdin().then(main).catch(console.error);\n```\n\n#### 3. RAG tool filter (BeforeToolSelection)\n\n**`.gemini/hooks/rag-filter.js`:**\n\n```javascript\n#!/usr/bin/env node\nconst { GoogleGenerativeAI } = require('@google/generative-ai');\n\nasync function main() {\n  const input = JSON.parse(await readStdin());\n  const { llm_request } = input;\n  const candidateTools =\n    llm_request.toolConfig?.functionCallingConfig?.allowedFunctionNames || [];\n\n  // Skip if already filtered\n  if (candidateTools.length <= 20) {\n    console.log(JSON.stringify({}));\n    return;\n  }\n\n  // Extract recent user messages\n  const recentMessages = llm_request.messages\n    .slice(-3)\n    .filter((m) => m.role === 'user')\n    .map((m) => m.content)\n    .join('\\n');\n\n  // Use fast model to extract task keywords\n  const genai = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);\n  const model = genai.getGenerativeModel({ model: 'gemini-2.0-flash-exp' });\n\n  const result = await model.generateContent(\n    `Extract 3-5 keywords describing needed tool capabilities from this request:\\n\\n${recentMessages}\\n\\nKeywords (comma-separated):`,\n  );\n\n  const keywords = result.response\n    .text()\n    .toLowerCase()\n    .split(',')\n    .map((k) => k.trim());\n\n  // Simple keyword-based filtering + core tools\n  const coreTools = ['ReadFile', 'WriteFile', 'Edit', 'RunShellCommand'];\n  const filtered = candidateTools.filter((tool) => {\n    if (coreTools.includes(tool)) return true;\n    const toolLower = tool.toLowerCase();\n    return keywords.some(\n      (kw) => toolLower.includes(kw) || kw.includes(toolLower),\n    );\n  });\n\n  console.log(\n    JSON.stringify({\n      hookSpecificOutput: {\n        hookEventName: 'BeforeToolSelection',\n        toolConfig: {\n          functionCallingConfig: {\n            mode: 'ANY',\n            allowedFunctionNames: filtered.slice(0, 20),\n          },\n        },\n      },\n      systemMessage: `üéØ Filtered ${candidateTools.length} ‚Üí ${Math.min(filtered.length, 20)} tools`,\n    }),\n  );\n}\n\nfunction readStdin() {\n  return new Promise((resolve) => {\n    const chunks = [];\n    process.stdin.on('data', (chunk) => chunks.push(chunk));\n    process.stdin.on('end', () => resolve(Buffer.concat(chunks).toString()));\n  });\n}\n\nreadStdin().then(main).catch(console.error);\n```\n\n#### 4. Security validation (BeforeTool)\n\n**`.gemini/hooks/security.js`:**\n\n```javascript\n#!/usr/bin/env node\n\nconst SECRET_PATTERNS = [\n  /api[_-]?key\\s*[:=]\\s*['\"]?[a-zA-Z0-9_-]{20,}['\"]?/i,\n  /password\\s*[:=]\\s*['\"]?[^\\s'\"]{8,}['\"]?/i,\n  /secret\\s*[:=]\\s*['\"]?[a-zA-Z0-9_-]{20,}['\"]?/i,\n  /AKIA[0-9A-Z]{16}/, // AWS\n  /ghp_[a-zA-Z0-9]{36}/, // GitHub\n];\n\nasync function main() {\n  const input = JSON.parse(await readStdin());\n  const { tool_input } = input;\n\n  const content = tool_input.content || tool_input.new_string || '';\n\n  for (const pattern of SECRET_PATTERNS) {\n    if (pattern.test(content)) {\n      console.log(\n        JSON.stringify({\n          decision: 'deny',\n          reason:\n            'Potential secret detected in code. Please remove sensitive data.',\n          systemMessage: 'üö® Secret scanner blocked operation',\n        }),\n      );\n      process.exit(2);\n    }\n  }\n\n  console.log(JSON.stringify({ decision: 'allow' }));\n}\n\nfunction readStdin() {\n  return new Promise((resolve) => {\n    const chunks = [];\n    process.stdin.on('data', (chunk) => chunks.push(chunk));\n    process.stdin.on('end', () => resolve(Buffer.concat(chunks).toString()));\n  });\n}\n\nreadStdin().then(main).catch(console.error);\n```\n\n#### 5. Auto-test (AfterTool)\n\n**`.gemini/hooks/auto-test.js`:**\n\n```javascript\n#!/usr/bin/env node\nconst { execSync } = require('child_process');\nconst fs = require('fs');\nconst path = require('path');\n\nasync function main() {\n  const input = JSON.parse(await readStdin());\n  const { tool_input } = input;\n  const filePath = tool_input.file_path;\n\n  if (!filePath?.match(/\\.(ts|js|tsx|jsx)$/)) {\n    console.log(JSON.stringify({}));\n    return;\n  }\n\n  // Find test file\n  const ext = path.extname(filePath);\n  const base = filePath.slice(0, -ext.length);\n  const testFile = `${base}.test${ext}`;\n\n  if (!fs.existsSync(testFile)) {\n    console.log(\n      JSON.stringify({\n        systemMessage: `‚ö†Ô∏è No test file: ${path.basename(testFile)}`,\n      }),\n    );\n    return;\n  }\n\n  // Run tests\n  try {\n    execSync(`npx vitest run ${testFile} --silent`, {\n      encoding: 'utf8',\n      stdio: 'pipe',\n      timeout: 30000,\n    });\n\n    console.log(\n      JSON.stringify({\n        systemMessage: `‚úÖ Tests passed: ${path.basename(filePath)}`,\n      }),\n    );\n  } catch (error) {\n    console.log(\n      JSON.stringify({\n        systemMessage: `‚ùå Tests failed: ${path.basename(filePath)}`,\n      }),\n    );\n  }\n}\n\nfunction readStdin() {\n  return new Promise((resolve) => {\n    const chunks = [];\n    process.stdin.on('data', (chunk) => chunks.push(chunk));\n    process.stdin.on('end', () => resolve(Buffer.concat(chunks).toString()));\n  });\n}\n\nreadStdin().then(main).catch(console.error);\n```\n\n#### 6. Record interaction (AfterModel)\n\n**`.gemini/hooks/record.js`:**\n\n```javascript\n#!/usr/bin/env node\nconst fs = require('fs');\nconst path = require('path');\n\nasync function main() {\n  const input = JSON.parse(await readStdin());\n  const { llm_request, llm_response } = input;\n  const projectDir = process.env.GEMINI_PROJECT_DIR;\n  const sessionId = process.env.GEMINI_SESSION_ID;\n\n  const tempFile = path.join(\n    projectDir,\n    '.gemini',\n    'memory',\n    `session-${sessionId}.jsonl`,\n  );\n\n  fs.mkdirSync(path.dirname(tempFile), { recursive: true });\n\n  // Extract user message and model response\n  const userMsg = llm_request.messages\n    ?.filter((m) => m.role === 'user')\n    .slice(-1)[0]?.content;\n\n  const modelMsg = llm_response.candidates?.[0]?.content?.parts\n    ?.map((p) => p.text)\n    .filter(Boolean)\n    .join('');\n\n  if (userMsg && modelMsg) {\n    const interaction = {\n      timestamp: new Date().toISOString(),\n      user: process.env.USER || 'unknown',\n      request: userMsg.slice(0, 500), // Truncate for storage\n      response: modelMsg.slice(0, 500),\n    };\n\n    fs.appendFileSync(tempFile, JSON.stringify(interaction) + '\\n');\n  }\n\n  console.log(JSON.stringify({}));\n}\n\nfunction readStdin() {\n  return new Promise((resolve) => {\n    const chunks = [];\n    process.stdin.on('data', (chunk) => chunks.push(chunk));\n    process.stdin.on('end', () => resolve(Buffer.concat(chunks).toString()));\n  });\n}\n\nreadStdin().then(main).catch(console.error);\n```\n\n#### 7. Consolidate memories (SessionEnd)\n\n**`.gemini/hooks/consolidate.js`:**\n\n````javascript\n#!/usr/bin/env node\nconst fs = require('fs');\nconst path = require('path');\nconst { GoogleGenerativeAI } = require('@google/generative-ai');\nconst { ChromaClient } = require('chromadb');\n\nasync function main() {\n  const input = JSON.parse(await readStdin());\n  const projectDir = process.env.GEMINI_PROJECT_DIR;\n  const sessionId = process.env.GEMINI_SESSION_ID;\n\n  const tempFile = path.join(\n    projectDir,\n    '.gemini',\n    'memory',\n    `session-${sessionId}.jsonl`,\n  );\n\n  if (!fs.existsSync(tempFile)) {\n    console.log(JSON.stringify({}));\n    return;\n  }\n\n  // Read interactions\n  const interactions = fs\n    .readFileSync(tempFile, 'utf8')\n    .trim()\n    .split('\\n')\n    .filter(Boolean)\n    .map((line) => JSON.parse(line));\n\n  if (interactions.length === 0) {\n    fs.unlinkSync(tempFile);\n    console.log(JSON.stringify({}));\n    return;\n  }\n\n  // Extract memories using LLM\n  const genai = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);\n  const model = genai.getGenerativeModel({ model: 'gemini-2.0-flash-exp' });\n\n  const prompt = `Extract important project learnings from this session.\nFocus on: decisions, conventions, gotchas, patterns.\nReturn JSON array with: category, summary, keywords\n\nSession interactions:\n${JSON.stringify(interactions, null, 2)}\n\nJSON:`;\n\n  try {\n    const result = await model.generateContent(prompt);\n    const text = result.response.text().replace(/```json\\n?|\\n?```/g, '');\n    const memories = JSON.parse(text);\n\n    // Store in ChromaDB\n    const client = new ChromaClient({\n      path: path.join(projectDir, '.gemini', 'chroma'),\n    });\n    const collection = await client.getCollection({ name: 'project_memories' });\n    const embedModel = genai.getGenerativeModel({\n      model: 'text-embedding-004',\n    });\n\n    for (const memory of memories) {\n      const memoryText = `${memory.category}: ${memory.summary}`;\n      const embedding = await embedModel.embedContent(memoryText);\n      const id = `${Date.now()}-${Math.random().toString(36).slice(2)}`;\n\n      await collection.add({\n        ids: [id],\n        embeddings: [embedding.embedding.values],\n        documents: [memoryText],\n        metadatas: [\n          {\n            category: memory.category || 'general',\n            summary: memory.summary,\n            keywords: (memory.keywords || []).join(','),\n            timestamp: new Date().toISOString(),\n          },\n        ],\n      });\n    }\n\n    fs.unlinkSync(tempFile);\n\n    console.log(\n      JSON.stringify({\n        systemMessage: `üß† ${memories.length} new learnings saved for future sessions`,\n      }),\n    );\n  } catch (error) {\n    console.error('Error consolidating memories:', error);\n    fs.unlinkSync(tempFile);\n    console.log(JSON.stringify({}));\n  }\n}\n\nfunction readStdin() {\n  return new Promise((resolve) => {\n    const chunks = [];\n    process.stdin.on('data', (chunk) => chunks.push(chunk));\n    process.stdin.on('end', () => resolve(Buffer.concat(chunks).toString()));\n  });\n}\n\nreadStdin().then(main).catch(console.error);\n````\n\n### Example session\n\n```\n> gemini\n\nüß† 3 memories loaded\n\n> Fix the authentication bug in login.ts\n\nüí≠ 2 memories recalled:\n  - [convention] Use middleware pattern for auth\n  - [gotcha] Remember to update token types\n\nüéØ Filtered 127 ‚Üí 15 tools\n\n[Agent reads login.ts and proposes fix]\n\n‚úÖ Tests passed: login.ts\n\n---\n\n> Add error logging to API endpoints\n\nüí≠ 3 memories recalled:\n  - [convention] Use middleware pattern for auth\n  - [pattern] Centralized error handling in middleware\n  - [decision] Log errors to CloudWatch\n\nüéØ Filtered 127 ‚Üí 18 tools\n\n[Agent implements error logging]\n\n> /exit\n\nüß† 2 new learnings saved for future sessions\n```\n\n### What makes this example special\n\n**RAG-based tool selection:**\n\n- Traditional: Send all 100+ tools causing confusion and context overflow\n- This example: Extract intent, filter to ~15 relevant tools\n- Benefits: Faster responses, better selection, lower costs\n\n**Cross-session memory:**\n\n- Traditional: Each session starts fresh\n- This example: Learns conventions, decisions, gotchas, patterns\n- Benefits: Shared knowledge across team members, persistent learnings\n\n**All hook events integrated:**\n\nDemonstrates every hook event with practical use cases in a cohesive workflow.\n\n### Cost efficiency\n\n- Uses `gemini-2.0-flash-exp` for intent extraction (fast, cheap)\n- Uses `text-embedding-004` for RAG (inexpensive)\n- Caches tool descriptions (one-time cost)\n- Minimal overhead per request (<500ms typically)\n\n### Customization\n\n**Adjust memory relevance:**\n\n```javascript\n// In inject-memories.js, change nResults\nconst results = await collection.query({\n  queryEmbeddings: [result.embedding.values],\n  nResults: 5, // More memories\n});\n```\n\n**Modify tool filter count:**\n\n```javascript\n// In rag-filter.js, adjust the limit\nallowedFunctionNames: filtered.slice(0, 30), // More tools\n```\n\n**Add custom security patterns:**\n\n```javascript\n// In security.js, add patterns\nconst SECRET_PATTERNS = [\n  // ... existing patterns\n  /private[_-]?key/i,\n  /auth[_-]?token/i,\n];\n```\n\n## Learn more\n\n- [Hooks Reference](index.md) - Complete API reference and configuration\n- [Best Practices](best-practices.md) - Security, performance, and debugging\n- [Configuration](../cli/configuration.md) - Gemini CLI settings\n- [Custom Commands](../cli/custom-commands.md) - Create custom commands\n"}
{"source":"github","repo":"gemini-cli","path":"docs/integration-tests.md","content":"# Integration tests\n\nThis document provides information about the integration testing framework used\nin this project.\n\n## Overview\n\nThe integration tests are designed to validate the end-to-end functionality of\nthe Gemini CLI. They execute the built binary in a controlled environment and\nverify that it behaves as expected when interacting with the file system.\n\nThese tests are located in the `integration-tests` directory and are run using a\ncustom test runner.\n\n## Building the tests\n\nPrior to running any integration tests, you need to create a release bundle that\nyou want to actually test:\n\n```bash\nnpm run bundle\n```\n\nYou must re-run this command after making any changes to the CLI source code,\nbut not after making changes to tests.\n\n## Running the tests\n\nThe integration tests are not run as part of the default `npm run test` command.\nThey must be run explicitly using the `npm run test:integration:all` script.\n\nThe integration tests can also be run using the following shortcut:\n\n```bash\nnpm run test:e2e\n```\n\n## Running a specific set of tests\n\nTo run a subset of test files, you can use\n`npm run <integration test command> <file_name1> ....` where &lt;integration\ntest command&gt; is either `test:e2e` or `test:integration*` and `<file_name>`\nis any of the `.test.js` files in the `integration-tests/` directory. For\nexample, the following command runs `list_directory.test.js` and\n`write_file.test.js`:\n\n```bash\nnpm run test:e2e list_directory write_file\n```\n\n### Running a single test by name\n\nTo run a single test by its name, use the `--test-name-pattern` flag:\n\n```bash\nnpm run test:e2e -- --test-name-pattern \"reads a file\"\n```\n\n### Regenerating model responses\n\nSome integration tests use faked out model responses, which may need to be\nregenerated from time to time as the implementations change.\n\nTo regenerate these golden files, set the REGENERATE_MODEL_GOLDENS environment\nvariable to \"true\" when running the tests, for example:\n\n**WARNING**: If running locally you should review these updated responses for\nany information about yourself or your system that gemini may have included in\nthese responses.\n\n```bash\nREGENERATE_MODEL_GOLDENS=\"true\" npm run test:e2e\n```\n\n**WARNING**: Make sure you run **await rig.cleanup()** at the end of your test,\nelse the golden files will not be updated.\n\n### Deflaking a test\n\nBefore adding a **new** integration test, you should test it at least 5 times\nwith the deflake script or workflow to make sure that it is not flaky.\n\n### Deflake script\n\n```bash\nnpm run deflake -- --runs=5 --command=\"npm run test:e2e -- -- --test-name-pattern '<your-new-test-name>'\"\n```\n\n#### Deflake workflow\n\n```bash\ngh workflow run deflake.yml --ref <your-branch> -f test_name_pattern=\"<your-test-name-pattern>\"\n```\n\n### Running all tests\n\nTo run the entire suite of integration tests, use the following command:\n\n```bash\nnpm run test:integration:all\n```\n\n### Sandbox matrix\n\nThe `all` command will run tests for `no sandboxing`, `docker` and `podman`.\nEach individual type can be run using the following commands:\n\n```bash\nnpm run test:integration:sandbox:none\n```\n\n```bash\nnpm run test:integration:sandbox:docker\n```\n\n```bash\nnpm run test:integration:sandbox:podman\n```\n\n## Diagnostics\n\nThe integration test runner provides several options for diagnostics to help\ntrack down test failures.\n\n### Keeping test output\n\nYou can preserve the temporary files created during a test run for inspection.\nThis is useful for debugging issues with file system operations.\n\nTo keep the test output set the `KEEP_OUTPUT` environment variable to `true`.\n\n```bash\nKEEP_OUTPUT=true npm run test:integration:sandbox:none\n```\n\nWhen output is kept, the test runner will print the path to the unique directory\nfor the test run.\n\n### Verbose output\n\nFor more detailed debugging, set the `VERBOSE` environment variable to `true`.\n\n```bash\nVERBOSE=true npm run test:integration:sandbox:none\n```\n\nWhen using `VERBOSE=true` and `KEEP_OUTPUT=true` in the same command, the output\nis streamed to the console and also saved to a log file within the test's\ntemporary directory.\n\nThe verbose output is formatted to clearly identify the source of the logs:\n\n```\n--- TEST: <log dir>:<test-name> ---\n... output from the gemini command ...\n--- END TEST: <log dir>:<test-name> ---\n```\n\n## Linting and formatting\n\nTo ensure code quality and consistency, the integration test files are linted as\npart of the main build process. You can also manually run the linter and\nauto-fixer.\n\n### Running the linter\n\nTo check for linting errors, run the following command:\n\n```bash\nnpm run lint\n```\n\nYou can include the `:fix` flag in the command to automatically fix any fixable\nlinting errors:\n\n```bash\nnpm run lint:fix\n```\n\n## Directory structure\n\nThe integration tests create a unique directory for each test run inside the\n`.integration-tests` directory. Within this directory, a subdirectory is created\nfor each test file, and within that, a subdirectory is created for each\nindividual test case.\n\nThis structure makes it easy to locate the artifacts for a specific test run,\nfile, or case.\n\n```\n.integration-tests/\n‚îî‚îÄ‚îÄ <run-id>/\n    ‚îî‚îÄ‚îÄ <test-file-name>.test.js/\n        ‚îî‚îÄ‚îÄ <test-case-name>/\n            ‚îú‚îÄ‚îÄ output.log\n            ‚îî‚îÄ‚îÄ ...other test artifacts...\n```\n\n## Continuous integration\n\nTo ensure the integration tests are always run, a GitHub Actions workflow is\ndefined in `.github/workflows/chained_e2e.yml`. This workflow automatically runs\nthe integrations tests for pull requests against the `main` branch, or when a\npull request is added to a merge queue.\n\nThe workflow runs the tests in different sandboxing environments to ensure\nGemini CLI is tested across each:\n\n- `sandbox:none`: Runs the tests without any sandboxing.\n- `sandbox:docker`: Runs the tests in a Docker container.\n- `sandbox:podman`: Runs the tests in a Podman container.\n"}
{"source":"github","repo":"gemini-cli","path":"docs/tos-privacy.md","content":"# Gemini CLI: License, Terms of Service, and Privacy Notices\n\nGemini CLI is an open-source tool that lets you interact with Google's powerful\nAI services directly from your command-line interface. The Gemini CLI software\nis licensed under the\n[Apache 2.0 license](https://github.com/google-gemini/gemini-cli/blob/main/LICENSE).\nWhen you use Gemini CLI to access or use Google‚Äôs services, the Terms of Service\nand Privacy Notices applicable to those services apply to such access and use.\n\nYour Gemini CLI Usage Statistics are handled in accordance with Google's Privacy\nPolicy.\n\n**Note:** See [quotas and pricing](/docs/quota-and-pricing.md) for the quota and\npricing details that apply to your usage of the Gemini CLI.\n\n## Supported authentication methods\n\nYour authentication method refers to the method you use to log into and access\nGoogle‚Äôs services with Gemini CLI. Supported authentication methods include:\n\n- Logging in with your Google account to Gemini Code Assist.\n- Using an API key with Gemini Developer API.\n- Using an API key with Vertex AI GenAI API.\n\nThe Terms of Service and Privacy Notices applicable to the aforementioned Google\nservices are set forth in the table below.\n\nIf you log in with your Google account and you do not already have a Gemini Code\nAssist account associated with your Google account, you will be directed to the\nsign up flow for Gemini Code Assist for individuals. If your Google account is\nmanaged by your organization, your administrator may not permit access to Gemini\nCode Assist for individuals. Please see the\n[Gemini Code Assist for individuals FAQs](https://developers.google.com/gemini-code-assist/resources/faqs)\nfor further information.\n\n| Authentication Method    | Service(s)                   | Terms of Service                                                                                        | Privacy Notice                                                                                |\n| :----------------------- | :--------------------------- | :------------------------------------------------------------------------------------------------------ | :-------------------------------------------------------------------------------------------- |\n| Google Account           | Gemini Code Assist services  | [Terms of Service](https://developers.google.com/gemini-code-assist/resources/privacy-notices)          | [Privacy Notices](https://developers.google.com/gemini-code-assist/resources/privacy-notices) |\n| Gemini Developer API Key | Gemini API - Unpaid Services | [Gemini API Terms of Service - Unpaid Services](https://ai.google.dev/gemini-api/terms#unpaid-services) | [Google Privacy Policy](https://policies.google.com/privacy)                                  |\n| Gemini Developer API Key | Gemini API - Paid Services   | [Gemini API Terms of Service - Paid Services](https://ai.google.dev/gemini-api/terms#paid-services)     | [Google Privacy Policy](https://policies.google.com/privacy)                                  |\n| Vertex AI GenAI API Key  | Vertex AI GenAI API          | [Google Cloud Platform Terms of Service](https://cloud.google.com/terms/service-terms/)                 | [Google Cloud Privacy Notice](https://cloud.google.com/terms/cloud-privacy-notice)            |\n\n## 1. If you have logged in with your Google account to Gemini Code Assist\n\nFor users who use their Google account to access\n[Gemini Code Assist](https://codeassist.google), these Terms of Service and\nPrivacy Notice documents apply:\n\n- Gemini Code Assist for individuals:\n  [Google Terms of Service](https://policies.google.com/terms) and\n  [Gemini Code Assist for individuals Privacy Notice](https://developers.google.com/gemini-code-assist/resources/privacy-notice-gemini-code-assist-individuals).\n- Gemini Code Assist with Google AI Pro or Ultra subscription:\n  [Google Terms of Service](https://policies.google.com/terms),\n  [Google One Additional Terms of Service](https://one.google.com/terms-of-service)\n  and [Google Privacy Policy\\*](https://policies.google.com/privacy).\n- Gemini Code Assist Standard and Enterprise editions:\n  [Google Cloud Platform Terms of Service](https://cloud.google.com/terms) and\n  [Google Cloud Privacy Notice](https://cloud.google.com/terms/cloud-privacy-notice).\n\n_\\* If your account is also associated with an active subscription to Gemini\nCode Assist Standard or Enterprise edition, the terms and privacy policy of\nGemini Code Assist Standard or Enterprise edition will apply to all your use of\nGemini Code Assist._\n\n## 2. If you have logged in with a Gemini API key to the Gemini Developer API\n\nIf you are using a Gemini API key for authentication with the\n[Gemini Developer API](https://ai.google.dev/gemini-api/docs), these Terms of\nService and Privacy Notice documents apply:\n\n- Terms of Service: Your use of the Gemini CLI is governed by the\n  [Gemini API Terms of Service](https://ai.google.dev/gemini-api/terms). These\n  terms may differ depending on whether you are using an unpaid or paid service:\n  - For unpaid services, refer to the\n    [Gemini API Terms of Service - Unpaid Services](https://ai.google.dev/gemini-api/terms#unpaid-services).\n  - For paid services, refer to the\n    [Gemini API Terms of Service - Paid Services](https://ai.google.dev/gemini-api/terms#paid-services).\n- Privacy Notice: The collection and use of your data is described in the\n  [Google Privacy Policy](https://policies.google.com/privacy).\n\n## 3. If you have logged in with a Gemini API key to the Vertex AI GenAI API\n\nIf you are using a Gemini API key for authentication with a\n[Vertex AI GenAI API](https://cloud.google.com/vertex-ai/generative-ai/docs/reference/rest)\nbackend, these Terms of Service and Privacy Notice documents apply:\n\n- Terms of Service: Your use of the Gemini CLI is governed by the\n  [Google Cloud Platform Service Terms](https://cloud.google.com/terms/service-terms/).\n- Privacy Notice: The collection and use of your data is described in the\n  [Google Cloud Privacy Notice](https://cloud.google.com/terms/cloud-privacy-notice).\n\n## Usage statistics opt-out\n\nYou may opt-out from sending Gemini CLI Usage Statistics to Google by following\nthe instructions available here:\n[Usage Statistics Configuration](https://github.com/google-gemini/gemini-cli/blob/main/docs/get-started/configuration.md#usage-statistics).\n"}
{"source":"github","repo":"gemini-cli","path":"docs/release-confidence.md","content":"# Release confidence strategy\n\nThis document outlines the strategy for gaining confidence in every release of\nthe Gemini CLI. It serves as a checklist and quality gate for release manager to\nensure we are shipping a high-quality product.\n\n## The goal\n\nTo answer the question, \"Is this release _truly_ ready for our users?\" with a\nhigh degree of confidence, based on a holistic evaluation of automated signals,\nmanual verification, and data.\n\n## Level 1: Automated gates (must pass)\n\nThese are the baseline requirements. If any of these fail, the release is a\nno-go.\n\n### 1. CI/CD health\n\nAll workflows in `.github/workflows/ci.yml` must pass on the `main` branch (for\nnightly) or the release branch (for preview/stable).\n\n- **Platforms:** Tests must pass on **Linux and macOS**.\n  - _Note:_ Windows tests currently run with `continue-on-error: true`. While a\n    failure here doesn't block the release technically, it should be\n    investigated.\n- **Checks:**\n  - **Linting:** No linting errors (ESLint, Prettier, etc.).\n  - **Typechecking:** No TypeScript errors.\n  - **Unit Tests:** All unit tests in `packages/core` and `packages/cli` must\n    pass.\n  - **Build:** The project must build and bundle successfully.\n\n### 2. End-to-end (E2E) tests\n\nAll workflows in `.github/workflows/chained_e2e.yml` must pass.\n\n- **Platforms:** **Linux, macOS and Windows**.\n- **Sandboxing:** Tests must pass with both `sandbox:none` and `sandbox:docker`\n  on Linux.\n\n### 3. Post-deployment smoke tests\n\nAfter a release is published to npm, the `smoke-test.yml` workflow runs. This\nmust pass to confirm the package is installable and the binary is executable.\n\n- **Command:** `npx -y @google/gemini-cli@<tag> --version` must return the\n  correct version without error.\n- **Platform:** Currently runs on `ubuntu-latest`.\n\n## Level 2: Manual verification and dogfooding\n\nAutomated tests cannot catch everything, especially UX issues.\n\n### 1. Dogfooding via `preview` tag\n\nThe weekly release cadence promotes code from `main` -> `nightly` -> `preview`\n-> `stable`.\n\n- **Requirement:** The `preview` release must be used by maintainers for at\n  least **one week** before being promoted to `stable`.\n- **Action:** Maintainers should install the preview version locally:\n  ```bash\n  npm install -g @google/gemini-cli@preview\n  ```\n- **Goal:** To catch regressions and UX issues in day-to-day usage before they\n  reach the broad user base.\n\n### 2. Critical user journey (CUJ) checklist\n\nBefore promoting a `preview` release to `stable`, a release manager must\nmanually run through this checklist.\n\n- **Setup:**\n  - [ ] Uninstall any existing global version:\n        `npm uninstall -g @google/gemini-cli`\n  - [ ] Clear npx cache (optional but recommended): `npm cache clean --force`\n  - [ ] Install the preview version: `npm install -g @google/gemini-cli@preview`\n  - [ ] Verify version: `gemini --version`\n\n- **Authentication:**\n  - [ ] In interactive mode run `/auth` and verify all login flows work:\n    - [ ] Login With Google\n    - [ ] API Key\n    - [ ] Vertex AI\n\n- **Basic prompting:**\n  - [ ] Run `gemini \"Tell me a joke\"` and verify a sensible response.\n  - [ ] Run in interactive mode: `gemini`. Ask a follow-up question to test\n        context.\n\n- **Piped input:**\n  - [ ] Run `echo \"Summarize this\" | gemini` and verify it processes stdin.\n\n- **Context management:**\n  - [ ] In interactive mode, use `@file` to add a local file to context. Ask a\n        question about it.\n\n- **Settings:**\n  - [ ] In interactive mode run `/settings` and make modifications\n  - [ ] Validate that setting is changed\n\n- **Function calling:**\n  - [ ] In interactive mode, ask gemini to \"create a file named hello.md with\n        the content 'hello world'\" and verify the file is created correctly.\n\nIf any of these CUJs fail, the release is a no-go until a patch is applied to\nthe `preview` channel.\n\n### 3. Pre-Launch bug bash (tier 1 and 2 launches)\n\nFor high-impact releases, an organized bug bash is required to ensure a higher\nlevel of quality and to catch issues across a wider range of environments and\nuse cases.\n\n**Definition of tiers:**\n\n- **Tier 1:** Industry-Moving News üöÄ\n- **Tier 2:** Important News for Our Users üì£\n- **Tier 3:** Relevant, but Not Life-Changing üí°\n- **Tier 4:** Bug Fixes ‚öíÔ∏è\n\n**Requirement:**\n\nA bug bash must be scheduled at least **72 hours in advance** of any Tier 1 or\nTier 2 launch.\n\n**Rule of thumb:**\n\nA bug bash should be considered for any release that involves:\n\n- A blog post\n- Coordinated social media announcements\n- Media relations or press outreach\n- A \"Turbo\" launch event\n\n## Level 3: Telemetry and data review\n\n### Dashboard health\n\n- [ ] Go to `go/gemini-cli-dash`.\n- [ ] Navigate to the \"Tool Call\" tab.\n- [ ] Validate that there are no spikes in errors for the release you would like\n      to promote.\n\n### Model evaluation\n\n- [ ] Navigate to `go/gemini-cli-offline-evals-dash`.\n- [ ] Make sure that the release you want to promote's recurring run is within\n      average eval runs.\n\n## The \"go/no-go\" decision\n\nBefore triggering the `Release: Promote` workflow to move `preview` to `stable`:\n\n1.  [ ] **Level 1:** CI and E2E workflows are green for the commit corresponding\n        to the current `preview` tag.\n2.  [ ] **Level 2:** The `preview` version has been out for one week, and the\n        CUJ checklist has been completed successfully by a release manager. No\n        blocking issues have been reported.\n3.  [ ] **Level 3:** Dashboard Health and Model Evaluation checks have been\n        completed and show no regressions.\n\nIf all checks pass, proceed with the promotion.\n"}
{"source":"github","repo":"gemini-cli","path":"ROADMAP.md","content":"# Gemini CLI Roadmap\n\nThe\n[Official Gemini CLI Roadmap](https://github.com/orgs/google-gemini/projects/11/)\n\nGemini CLI is an open-source AI agent that brings the power of Gemini directly\ninto your terminal. It provides lightweight access to Gemini, giving you the\nmost direct path from your prompt to our model.\n\nThis document outlines our approach to the Gemini CLI roadmap. Here, you'll find\nour guiding principles and a breakdown of the key areas we are focused on for\ndevelopment. Our roadmap is not a static list but a dynamic set of priorities\nthat are tracked live in our GitHub Issues.\n\nAs an\n[Apache 2.0 open source project](https://github.com/google-gemini/gemini-cli?tab=Apache-2.0-1-ov-file#readme),\nwe appreciate and welcome\n[public contributions](https://github.com/google-gemini/gemini-cli/blob/main/CONTRIBUTING.md),\nand will give first priority to those contributions aligned with our roadmap. If\nyou want to propose a new feature or change to our roadmap, please start by\n[opening an issue for discussion](https://github.com/google-gemini/gemini-cli/issues/new/choose).\n\n## Disclaimer\n\nThis roadmap represents our current thinking and is for informational purposes\nonly. It is not a commitment or a guarantee of future delivery. The development,\nrelease, and timing of any features are subject to change, and we may update the\nroadmap based on community discussions as well as when our priorities evolve.\n\n## Guiding Principles\n\nOur development is guided by the following principles:\n\n- **Power & Simplicity:** Deliver access to state-of-the-art Gemini models with\n  an intuitive and easy-to-use lightweight command-line interface.\n- **Extensibility:** An adaptable agent to help you with a variety of use cases\n  and environments along with the ability to run these agents anywhere.\n- **Intelligent:** Gemini CLI should be reliably ranked among the best agentic\n  tools as measured by benchmarks like SWE Bench, Terminal Bench, and CSAT.\n- **Free and Open Source:** Foster a thriving open source community where cost\n  isn‚Äôt a barrier to personal use, and PRs get merged quickly. This means\n  resolving and closing issues, pull requests, and discussion posts quickly.\n\n## How the Roadmap Works\n\nOur roadmap is managed directly through GitHub Issues. See our entry point\nRoadmap Issue [here](https://github.com/google-gemini/gemini-cli/issues/4191).\nThis approach allows for transparency and gives you a direct way to learn more\nor get involved with any specific initiative. All our roadmap items will be\ntagged as Type:`Feature` and Label:`maintainer` for features we are actively\nworking on, or Type:`Task` and Label:`maintainer` for a more detailed list of\ntasks.\n\nIssues are organized to provide key information at a glance:\n\n- **Target Quarter:** `Milestone` denotes the anticipated delivery timeline.\n- **Feature Area:** Labels such as `area/model` or `area/tooling` categorize the\n  work.\n- **Issue Type:** _Workstream_ => _Epics_ => _Features_ => _Tasks|Bugs_\n\nTo see what we're working on, you can filter our issues by these dimensions. See\nall our items [here](https://github.com/orgs/google-gemini/projects/11/views/19)\n\n## Focus Areas\n\nTo better organize our efforts, we categorize our work into several key feature\nareas. These labels are used on our GitHub Issues to help you filter and find\ninitiatives that interest you.\n\n- **Authentication:** Secure user access via API keys, Gemini Code Assist login,\n  etc.\n- **Model:** Support new Gemini models, multi-modality, local execution, and\n  performance tuning.\n- **User Experience:** Improve the CLI's usability, performance, interactive\n  features, and documentation.\n- **Tooling:** Built-in tools and the MCP ecosystem.\n- **Core:** Core functionality of the CLI\n- **Extensibility:** Bringing Gemini CLI to other surfaces e.g. GitHub.\n- **Contribution:** Improve the contribution process via test automation and\n  CI/CD pipeline enhancements.\n- **Platform:** Manage installation, OS support, and the underlying CLI\n  framework.\n- **Quality:** Focus on testing, reliability, performance, and overall product\n  quality.\n- **Background Agents:** Enable long-running, autonomous tasks and proactive\n  assistance.\n- **Security and Privacy:** For all things related to security and privacy\n\n## How to Contribute\n\nGemini CLI is an open-source project, and we welcome contributions from the\ncommunity! Whether you're a developer, a designer, or just an enthusiastic user\nyou can find our\n[Community Guidelines here](https://github.com/google-gemini/gemini-cli/blob/main/CONTRIBUTING.md)\nto learn how to get started. There are many ways to get involved:\n\n- **Roadmap:** Please review and find areas in our\n  [roadmap](https://github.com/google-gemini/gemini-cli/issues/4191) that you\n  would like to contribute to. Contributions based on this will be easiest to\n  integrate with.\n- **Report Bugs:** If you find an issue, please create a\n  [bug](https://github.com/google-gemini/gemini-cli/issues/new?template=bug_report.yml)\n  with as much detail as possible. If you believe it is a critical breaking\n  issue preventing direct CLI usage, please tag it as `priority/p0`.\n- **Suggest Features:** Have a great idea? We'd love to hear it! Open a\n  [feature request](https://github.com/google-gemini/gemini-cli/issues/new?template=feature_request.yml).\n- **Contribute Code:** Check out our\n  [CONTRIBUTING.md](https://github.com/google-gemini/gemini-cli/blob/main/CONTRIBUTING.md)\n  file for guidelines on how to submit pull requests. We have a list of \"good\n  first issues\" for new contributors.\n- **Write Documentation:** Help us improve our documentation, tutorials, and\n  examples. We are excited about the future of Gemini CLI and look forward to\n  building it with you!\n"}
