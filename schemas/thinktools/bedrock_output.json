{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://reasonkit.sh/schemas/thinktools/bedrock_output.json",
  "title": "BedRock Output Schema",
  "description": "Structured output for BedRock first principles decomposition module",
  "version": "2.0.0",
  "type": "object",
  "required": [
    "module",
    "version",
    "timestamp",
    "query",
    "decomposition_layers",
    "axioms",
    "assumptions_surfaced",
    "reconstruction",
    "confidence",
    "thinking_trace"
  ],
  "properties": {
    "module": {
      "type": "string",
      "const": "bedrock",
      "description": "Module identifier"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Module version (semver)"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of execution"
    },
    "query": {
      "type": "string",
      "description": "Original problem or system to decompose"
    },
    "decomposition_layers": {
      "type": "array",
      "minItems": 1,
      "maxItems": 5,
      "description": "Layers of decomposition from surface to fundamentals",
      "items": {
        "type": "object",
        "required": ["level", "label", "components", "questions_asked"],
        "properties": {
          "level": {
            "type": "integer",
            "minimum": 1,
            "maximum": 5,
            "description": "Decomposition depth (1=surface, 5=axioms)"
          },
          "label": {
            "type": "string",
            "enum": [
              "Surface observations",
              "Underlying mechanisms",
              "Governing principles",
              "Fundamental axioms",
              "Universal truths"
            ],
            "description": "Layer category"
          },
          "components": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["id", "statement", "verified"],
              "properties": {
                "id": {
                  "type": "string",
                  "pattern": "^L\\d+C\\d+$",
                  "description": "Component identifier (L1C1, L2C3, etc.)"
                },
                "statement": {
                  "type": "string",
                  "description": "The component statement at this layer"
                },
                "verified": {
                  "type": "boolean",
                  "description": "Whether this component is verified"
                },
                "dependencies": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "Component IDs this depends on"
                },
                "evidence": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "Evidence supporting this component"
                }
              }
            }
          },
          "questions_asked": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Questions that led to next layer (e.g., 'What must be true for this to work?')"
          }
        }
      }
    },
    "axioms": {
      "type": "array",
      "description": "Fundamental axioms identified at deepest layer",
      "items": {
        "type": "object",
        "required": ["id", "statement", "type", "verified", "universality"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^A\\d+$",
            "description": "Axiom identifier (A1, A2, etc.)"
          },
          "statement": {
            "type": "string",
            "description": "The axiom statement"
          },
          "type": {
            "type": "string",
            "enum": [
              "logical",
              "mathematical",
              "physical",
              "empirical",
              "definitional"
            ],
            "description": "Type of axiom"
          },
          "verified": {
            "type": "boolean",
            "description": "Whether this axiom is verified/accepted"
          },
          "universality": {
            "type": "number",
            "minimum": 0.0,
            "maximum": 1.0,
            "description": "How universal/fundamental this axiom is"
          },
          "sources": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Sources that establish this axiom"
          }
        }
      }
    },
    "assumptions_surfaced": {
      "type": "array",
      "description": "Hidden assumptions discovered during decomposition",
      "items": {
        "type": "object",
        "required": ["assumption", "layer", "validity", "impact"],
        "properties": {
          "assumption": {
            "type": "string",
            "description": "The assumption statement"
          },
          "layer": {
            "type": "integer",
            "description": "Layer where assumption was found"
          },
          "validity": {
            "type": "string",
            "enum": ["valid", "questionable", "invalid", "context-dependent"],
            "description": "Validity assessment"
          },
          "impact": {
            "type": "string",
            "enum": ["critical", "significant", "minor", "negligible"],
            "description": "Impact if assumption is wrong"
          },
          "challenge": {
            "type": "string",
            "description": "Challenge or counter-example to this assumption"
          }
        }
      }
    },
    "reconstruction": {
      "type": "object",
      "required": ["steps", "coherence", "gaps_identified"],
      "description": "Rebuilding understanding from axioms upward",
      "properties": {
        "steps": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["step_num", "builds_from", "constructs", "valid"],
            "properties": {
              "step_num": {
                "type": "integer",
                "description": "Reconstruction step number"
              },
              "builds_from": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Component/axiom IDs used as foundation"
              },
              "constructs": {
                "type": "string",
                "description": "What is constructed in this step"
              },
              "valid": {
                "type": "boolean",
                "description": "Whether this reconstruction step is valid"
              }
            }
          }
        },
        "coherence": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "How coherent the reconstruction is"
        },
        "gaps_identified": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Gaps found during reconstruction"
        },
        "original_vs_reconstructed": {
          "type": "object",
          "properties": {
            "original": { "type": "string" },
            "reconstructed": { "type": "string" },
            "differences": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        }
      }
    },
    "dependency_tree": {
      "type": "object",
      "description": "Tree structure of dependencies from axioms to conclusions",
      "properties": {
        "nodes": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": { "type": "string" },
              "layer": { "type": "integer" },
              "content": { "type": "string" }
            }
          }
        },
        "edges": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "from": { "type": "string" },
              "to": { "type": "string" },
              "relationship": { "type": "string" }
            }
          }
        }
      }
    },
    "confidence": {
      "type": "object",
      "required": ["overall", "factors", "breakdown"],
      "properties": {
        "overall": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Overall module confidence score"
        },
        "factors": {
          "type": "object",
          "required": [
            "axiom_soundness",
            "decomposition_completeness",
            "assumption_identification",
            "rebuild_coherence"
          ],
          "properties": {
            "axiom_soundness": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "description": "verified_axioms / total_axioms"
            },
            "decomposition_completeness": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "description": "levels_reached / target_depth"
            },
            "assumption_identification": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "description": "assumptions_surfaced / estimated_assumptions"
            },
            "rebuild_coherence": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "description": "1.0 - (gaps_in_rebuild / total_steps)"
            }
          }
        },
        "breakdown": {
          "type": "string",
          "description": "Human-readable explanation of confidence calculation"
        }
      }
    },
    "thinking_trace": {
      "type": "array",
      "description": "Step-by-step reasoning trace for transparency",
      "items": {
        "type": "object",
        "required": ["step", "action", "result"],
        "properties": {
          "step": { "type": "integer" },
          "action": { "type": "string" },
          "result": { "type": "string" },
          "duration_ms": { "type": "integer" }
        }
      }
    },
    "metadata": {
      "type": "object",
      "properties": {
        "execution_time_ms": { "type": "integer" },
        "token_count": { "type": "integer" },
        "model_used": { "type": "string" }
      }
    }
  }
}
